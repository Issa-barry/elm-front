<p-toast></p-toast>

<div class="edit-page">
  <header class="edit-mobile-header">
    <button
      type="button"
      class="edit-back"
      aria-label="Retour à la liste"
      (click)="onCancel()"
    >
      <i class="pi pi-arrow-left"></i>
    </button>
    <h1 class="edit-title">Nouvel utilisateur</h1>
    <span class="edit-header-spacer"></span>
  </header>

  <!-- Rappel UX : usine d'assignation ou message vue consolidée -->
  @if (usineContext.isConsolidated()) {
    <p-message
      severity="warn"
      styleClass="usine-context-message mb-3"
      [text]="'Veuillez sélectionner une usine dans la barre du haut pour pouvoir créer un utilisateur.'"
    />
  } @else if (usineContext.currentUsine(); as usine) {
    <div class="usine-assignation-reminder mb-3">
      <i class="pi pi-building"></i>
      <span>L'utilisateur sera assigné à : <strong>{{ usine.nom }}</strong></span>
    </div>
  }

  <div class="edit-content">
    <app-utilisateurs-form
      [mode]="'create'"
      [loading]="loading"
      (submitForm)="onSubmit($event)"
      (cancel)="onCancel()"
    ></app-utilisateurs-form>
  </div>
</div>
