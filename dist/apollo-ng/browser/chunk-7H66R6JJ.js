import{b as xt}from"./chunk-JP7MEV3K.js";import{a as ne}from"./chunk-AN5NMCKE.js";import{a as ie}from"./chunk-6MPWZMCU.js";import"./chunk-H4R3XQVS.js";import{a as ut,b as gt}from"./chunk-DHO5ZECZ.js";import{a as ht,b as kt}from"./chunk-BS6LNNLV.js";import{a as ft,b as bt}from"./chunk-NW5N26ZF.js";import{a as ee,b as te}from"./chunk-FCSZSTKZ.js";import"./chunk-62XMJ7OZ.js";import{b as _t}from"./chunk-NXMTA3Z5.js";import{d as We}from"./chunk-22WVEZDH.js";import"./chunk-6UNS6ATT.js";import"./chunk-VBF7BBWX.js";import{a as rt,d as ot,e as st,h as lt,i as pt,k as dt}from"./chunk-CZQFGBIP.js";import"./chunk-DKGKIQYD.js";import"./chunk-6R56UM77.js";import{a as X,b as it}from"./chunk-UATLNJ6A.js";import"./chunk-L2T5JW7K.js";import"./chunk-C35SDHAO.js";import"./chunk-IENEWIOW.js";import{b as Z,c as nt}from"./chunk-V7HYCLOH.js";import"./chunk-GCJYWVBV.js";import"./chunk-PZUT5QF4.js";import{c as $,d as at}from"./chunk-QK2KLPR7.js";import"./chunk-IQ3I63NM.js";import"./chunk-KAT22IHP.js";import"./chunk-2MYVVGAW.js";import"./chunk-VRCAH26M.js";import"./chunk-4O43JDMY.js";import"./chunk-LNM7OC6P.js";import{a as mt,b as ct}from"./chunk-BFGT4G5C.js";import"./chunk-D3EQSYXL.js";import"./chunk-FR7DTH2N.js";import"./chunk-E6N6EGUJ.js";import"./chunk-2PEJZBD7.js";import{a as Je,b as Xe,c as Ze,d as $e}from"./chunk-BDIOYTKC.js";import{a as He,b as Qe}from"./chunk-H5W5OS5D.js";import{e as z,h as Y,o as J}from"./chunk-CRGNDKCR.js";import{a as et,b as tt}from"./chunk-BGXPLMJT.js";import{a as E,c as Q}from"./chunk-CSKRJUWU.js";import"./chunk-UWIKY6DF.js";import{c as ze,d as Ye}from"./chunk-6I65RIIA.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import"./chunk-UAZ37PIZ.js";import{i as Ke,j as qe}from"./chunk-ZN2HQ4SK.js";import"./chunk-SEL7WNEU.js";import{Ba as je,Ea as Ue,Fa as Ge,Ga as W,la as K,pa as I,ta as Oe,ua as q}from"./chunk-6ETCFPPD.js";import{i as Ae,k as H,q as Ne,r as Be,u as A}from"./chunk-6PDKYY6Q.js";import"./chunk-4O3FVBGX.js";import{$ as u,$b as S,Ab as we,Bb as Ce,Gb as v,Kb as f,Lb as m,Ma as s,Pb as De,Qb as Ie,R,Ra as de,Rb as Me,S as he,U as ke,Ub as Fe,V as j,Vb as Te,W as U,Wb as Re,Xa as P,Xb as ce,Yb as G,Zb as l,_b as y,aa as g,ab as w,ac as C,ba as xe,bb as Pe,bc as Le,cc as b,db as ye,dc as h,eb as Se,ec as k,fb as Ee,gb as _,gc as L,hc as B,ia as ve,na as pe,ob as me,rc as F,sc as Ve,tc as V,u as be,wb as p,wc as D,xb as r,yb as o,zb as c}from"./chunk-KCZYDF4B.js";import{a as _e,b as fe}from"./chunk-GAL4ENT6.js";var vt=`
    .p-progressspinner {
        position: relative;
        margin: 0 auto;
        width: 100px;
        height: 100px;
        display: inline-block;
    }

    .p-progressspinner::before {
        content: '';
        display: block;
        padding-top: 100%;
    }

    .p-progressspinner-spin {
        height: 100%;
        transform-origin: center center;
        width: 100%;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        animation: p-progressspinner-rotate 2s linear infinite;
    }

    .p-progressspinner-circle {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: 0;
        stroke: dt('progressspinner.colorOne');
        animation:
            p-progressspinner-dash 1.5s ease-in-out infinite,
            p-progressspinner-color 6s ease-in-out infinite;
        stroke-linecap: round;
    }

    @keyframes p-progressspinner-rotate {
        100% {
            transform: rotate(360deg);
        }
    }
    @keyframes p-progressspinner-dash {
        0% {
            stroke-dasharray: 1, 200;
            stroke-dashoffset: 0;
        }
        50% {
            stroke-dasharray: 89, 200;
            stroke-dashoffset: -35px;
        }
        100% {
            stroke-dasharray: 89, 200;
            stroke-dashoffset: -124px;
        }
    }
    @keyframes p-progressspinner-color {
        100%,
        0% {
            stroke: dt('progressspinner.color.one');
        }
        40% {
            stroke: dt('progressspinner.color.two');
        }
        66% {
            stroke: dt('progressspinner.color.three');
        }
        80%,
        90% {
            stroke: dt('progressspinner.color.four');
        }
    }
`;var Dt={root:()=>["p-progressspinner"],spin:"p-progressspinner-spin",circle:"p-progressspinner-circle"},Pt=(()=>{class a extends je{name="progressspinner";style=vt;classes=Dt;static \u0275fac=(()=>{let e;return function(n){return(e||(e=pe(a)))(n||a)}})();static \u0275prov=R({token:a,factory:a.\u0275fac})}return a})();var yt=new ke("PROGRESSSPINNER_INSTANCE"),ue=(()=>{class a extends Ge{$pcProgressSpinner=U(yt,{optional:!0,skipSelf:!0})??void 0;bindDirectiveInstance=U(W,{self:!0});styleClass;strokeWidth="2";fill="none";animationDuration="2s";ariaLabel;onAfterViewChecked(){this.bindDirectiveInstance.setAttrs(this.ptms(["host","root"]))}_componentStyle=U(Pt);static \u0275fac=(()=>{let e;return function(n){return(e||(e=pe(a)))(n||a)}})();static \u0275cmp=w({type:a,selectors:[["p-progressSpinner"],["p-progress-spinner"],["p-progressspinner"]],hostVars:5,hostBindings:function(i,n){i&2&&(me("aria-label",n.ariaLabel)("role","progressbar")("aria-busy",!0),G(n.cn(n.cx("root"),n.styleClass)))},inputs:{styleClass:"styleClass",strokeWidth:"strokeWidth",fill:"fill",animationDuration:"animationDuration",ariaLabel:"ariaLabel"},features:[L([Pt,{provide:yt,useExisting:a},{provide:Ue,useExisting:a}]),Ee([W]),Se],decls:2,vars:10,consts:[["viewBox","25 25 50 50",3,"pBind"],["cx","50","cy","50","r","20","stroke-miterlimit","10",3,"pBind"]],template:function(i,n){i&1&&(xe(),r(0,"svg",0),c(1,"circle",1),o()),i&2&&(G(n.cx("spin")),Te("animation-duration",n.animationDuration),p("pBind",n.ptm("spin")),s(),G(n.cx("circle")),p("pBind",n.ptm("circle")),me("fill",n.fill)("stroke-width",n.strokeWidth))},dependencies:[A,q,W],encapsulation:2,changeDetection:0})}return a})(),St=(()=>{class a{static \u0275fac=function(i){return new(i||a)};static \u0275mod=Pe({type:a});static \u0275inj=he({imports:[ue,q,q]})}return a})();var Et={a_valider:"\xC0 valider",valide:"Valid\xE9",annule:"Annul\xE9"},wt={a_valider:"warn",valide:"success",annule:"danger"};var N=class a{constructor(t){this.http=t}apiUrl=`${ie.apiUrl}/packings`;getPackings(t){let e=new E;return t&&(t.prestataire_id&&(e=e.set("prestataire_id",t.prestataire_id.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.non_payes&&(e=e.set("non_payes",t.non_payes.toString())),t.search&&(e=e.set("search",t.search)),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.page&&(e=e.set("page",t.page.toString()))),this.http.get(this.apiUrl,{params:e})}getPacking(t){return this.http.get(`${this.apiUrl}/${t}`)}createPacking(t){return this.http.post(this.apiUrl,t)}updatePacking(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}changeStatut(t,e){return this.http.patch(`${this.apiUrl}/${t}/statut`,e)}deletePacking(t){return this.http.delete(`${this.apiUrl}/${t}`)}searchPackings(t){let e=new E().set("search",t);return this.http.get(this.apiUrl,{params:e})}getPackingsByPrestataire(t){let e=new E().set("prestataire_id",t.toString());return this.http.get(this.apiUrl,{params:e})}getPackingsByStatut(t){let e=new E().set("statut",t);return this.http.get(this.apiUrl,{params:e})}getPackingsNonPayes(){let t=new E().set("non_payes","true");return this.http.get(this.apiUrl,{params:t})}getPackingsByPeriode(t,e){let i=new E().set("date_debut",t).set("date_fin",e);return this.http.get(this.apiUrl,{params:i})}getPackingsPaginated(t=1,e=10,i){let n=new E().set("page",t.toString()).set("per_page",e.toString());return i&&(i.prestataire_id&&(n=n.set("prestataire_id",i.prestataire_id.toString())),i.statut&&(n=n.set("statut",i.statut)),i.date_debut&&(n=n.set("date_debut",i.date_debut)),i.date_fin&&(n=n.set("date_fin",i.date_fin)),i.non_payes&&(n=n.set("non_payes",i.non_payes.toString())),i.search&&(n=n.set("search",i.search)),i.sort_by&&(n=n.set("sort_by",i.sort_by)),i.sort_order&&(n=n.set("sort_order",i.sort_order))),this.http.get(this.apiUrl,{params:n})}static \u0275fac=function(e){return new(e||a)(j(Q))};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var ae=class a{constructor(t){this.http=t}apiUrl=`${ie.apiUrl}/parametres`;getParametres(t){let e=new E;return t&&(e=e.set("groupe",t)),this.http.get(this.apiUrl,{params:e})}updateParametre(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}getPeriodes(t,e){let i=new E;return t&&(i=i.set("mois",t.toString())),e&&(i=i.set("annee",e.toString())),this.http.get(`${this.apiUrl}/periodes`,{params:i})}static \u0275fac=function(e){return new(e||a)(j(Q))};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};var Nt=["dt"],Bt=()=>({"min-width":"75rem"}),Wt=()=>[10,20,30],Ot=()=>({width:"750px"}),jt=()=>({width:"450px"});function Ut(a,t){if(a&1){let e=v();r(0,"p-button",13),f("onClick",function(){u(e);let n=m();return g(n.openNew())}),o()}}function Gt(a,t){if(a&1){let e=v();r(0,"p-button",20),f("onClick",function(){u(e);let n=m(2);return g(n.clearDateFilters())}),o()}a&2&&p("outlined",!0)("rounded",!0)}function Ht(a,t){if(a&1){let e=v();r(0,"div",14)(1,"p-select",15),k("ngModelChange",function(n){u(e);let d=m();return h(d.filterStatut,n)||(d.filterStatut=n),g(n)}),f("onChange",function(){u(e);let n=m();return g(n.onDateFilter())}),o(),r(2,"p-datepicker",16),k("ngModelChange",function(n){u(e);let d=m();return h(d.filterDateDebut,n)||(d.filterDateDebut=n),g(n)}),f("onSelect",function(){u(e);let n=m();return g(n.onDateFilter())}),o(),r(3,"p-datepicker",17),k("ngModelChange",function(n){u(e);let d=m();return h(d.filterDateFin,n)||(d.filterDateFin=n),g(n)}),f("onSelect",function(){u(e);let n=m();return g(n.onDateFilter())}),o(),_(4,Gt,1,2,"p-button",18),r(5,"p-button",19),f("onClick",function(){u(e);let n=m();return g(n.exportCSV())}),o()()}if(a&2){let e=m();s(),b("ngModel",e.filterStatut),p("options",e.statuses)("showClear",!0),s(),b("ngModel",e.filterDateDebut),p("showIcon",!0)("maxDate",e.filterDateFin),s(),b("ngModel",e.filterDateFin),p("showIcon",!0)("minDate",e.filterDateDebut),s(),p("ngIf",e.filterDateDebut||e.filterDateFin||e.filterStatut)}}function Qt(a,t){if(a&1){let e=v();r(0,"div",21)(1,"h5",22),l(2,"Gestion des Packings"),o(),r(3,"p-iconfield"),c(4,"p-inputicon",23),r(5,"input",24),f("input",function(n){u(e);let d=m(),x=Fe(8);return g(d.onGlobalFilter(x,n))}),o()()()}}function Kt(a,t){a&1&&(r(0,"tr")(1,"th",25),c(2,"p-tableHeaderCheckbox"),o(),r(3,"th",26)(4,"span",14),l(5,"R\xE9f\xE9rence "),c(6,"p-sortIcon",27),o()(),r(7,"th",28)(8,"span",14),l(9,"Prestataire "),c(10,"p-sortIcon",29),o()(),r(11,"th",30),l(12,"Phone"),o(),r(13,"th",31)(14,"span",14),l(15,"D\xE9but "),c(16,"p-sortIcon",32),o()(),r(17,"th",33)(18,"span",14),l(19,"Fin "),c(20,"p-sortIcon",34),o()(),r(21,"th",35)(22,"span",14),l(23,"Rouleaux "),c(24,"p-sortIcon",36),o()(),r(25,"th",37)(26,"span",14),l(27,"Montant "),c(28,"p-sortIcon",38),o()(),r(29,"th",39)(30,"span",14),l(31,"Statut "),c(32,"p-sortIcon",40),o()(),c(33,"th",30),o())}function qt(a,t){if(a&1&&(r(0,"span"),l(1),o()),a&2){let e=m().$implicit;s(),C(" ",e.prestataire.nom," ",e.prestataire.prenom," ")}}function zt(a,t){if(a&1&&(r(0,"span"),l(1),o()),a&2){let e=m().$implicit;s(),y(e.prestataire.phone)}}function Yt(a,t){if(a&1){let e=v();r(0,"tr")(1,"td",25),c(2,"p-tableCheckbox",41),o(),r(3,"td"),l(4),o(),r(5,"td"),_(6,qt,2,2,"span",42),o(),r(7,"td"),_(8,zt,2,1,"span",42),o(),r(9,"td"),l(10),o(),r(11,"td"),l(12),o(),r(13,"td"),l(14),o(),r(15,"td"),l(16),o(),r(17,"td"),c(18,"p-tag",43),o(),r(19,"td")(20,"p-button",44),f("click",function(){let n=u(e).$implicit,d=m();return g(d.editPacking(n))}),o(),r(21,"p-button",45),f("click",function(){let n=u(e).$implicit,d=m();return g(d.deletePacking(n))}),o()()()}if(a&2){let e=t.$implicit,i=m();s(2),p("value",e),s(2),y(e.reference),s(2),p("ngIf",e.prestataire),s(2),p("ngIf",e.prestataire),s(2),y(i.formatDateDisplay(e.date_debut)),s(2),y(i.formatDateDisplay(e.date_fin)),s(2),y(e.nb_rouleaux),s(2),y(i.formatCurrency(e.montant)),s(2),p("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),s(2),p("rounded",!0)("outlined",!0),s(),p("rounded",!0)("outlined",!0)}}function Jt(a,t){a&1&&(r(0,"div",48),c(1,"p-progressSpinner",49),o())}function Xt(a,t){if(a&1&&(r(0,"div",14),c(1,"i",71),r(2,"span"),l(3),o()()),a&2){let e=t.$implicit;s(3),Le("",e.prenom," ",e.nom," - ",e.phone)}}function Zt(a,t){if(a&1&&(r(0,"div",14),c(1,"i",71),r(2,"span"),l(3),o()()),a&2){let e=m().$implicit;s(3),C("",e.prenom," ",e.nom)}}function $t(a,t){if(a&1&&_(0,Zt,4,2,"div",72),a&2){let e=t.$implicit;p("ngIf",e)}}function ei(a,t){a&1&&(r(0,"small",73),l(1,"Le prestataire est requis."),o())}function ti(a,t){if(a&1){let e=v();r(0,"div",50)(1,"div")(2,"label",51),l(3,"Prestataire (Machiniste)"),o(),r(4,"p-select",52),k("ngModelChange",function(n){u(e);let d=m(2);return h(d.selectedPrestataire,n)||(d.selectedPrestataire=n),g(n)}),_(5,Xt,4,3,"ng-template",53)(6,$t,1,1,"ng-template",54),o(),_(7,ei,2,0,"small",55),o(),r(8,"div",56)(9,"div",57)(10,"label",58),l(11,"Date d\xE9but"),o(),r(12,"p-datepicker",59),k("ngModelChange",function(n){u(e);let d=m(2);return h(d.packing.date_debut,n)||(d.packing.date_debut=n),g(n)}),o()(),r(13,"div",57)(14,"label",60),l(15,"Date fin"),o(),r(16,"p-datepicker",61),k("ngModelChange",function(n){u(e);let d=m(2);return h(d.packing.date_fin,n)||(d.packing.date_fin=n),g(n)}),o()()(),r(17,"div",56)(18,"div",57)(19,"label",62),l(20,"Nombre de rouleaux"),o(),r(21,"p-inputnumber",63),k("ngModelChange",function(n){u(e);let d=m(2);return h(d.packing.nb_rouleaux,n)||(d.packing.nb_rouleaux=n),g(n)}),f("onInput",function(){u(e);let n=m(2);return g(n.calculateMontant())}),o()(),r(22,"div",57)(23,"label",64),l(24,"Prix du rouleau (GNF)"),o(),r(25,"p-inputnumber",65),k("ngModelChange",function(n){u(e);let d=m(2);return h(d.packing.prix_par_rouleau,n)||(d.packing.prix_par_rouleau=n),g(n)}),f("onInput",function(){u(e);let n=m(2);return g(n.calculateMontant())}),o()()(),r(26,"div")(27,"label",66),l(28,"Statut"),o(),r(29,"p-select",67),k("ngModelChange",function(n){u(e);let d=m(2);return h(d.packing.statut,n)||(d.packing.statut=n),g(n)}),o()(),r(30,"div",68)(31,"span",69),l(32,"Montant total"),o(),r(33,"span",70),l(34),o()()()}if(a&2){let e=m(2);s(4),b("ngModel",e.selectedPrestataire),p("options",e.prestataires)("filter",!0),s(3),p("ngIf",e.submitted&&!e.selectedPrestataire),s(5),b("ngModel",e.packing.date_debut),p("showIcon",!0),s(4),b("ngModel",e.packing.date_fin),p("showIcon",!0)("minDate",e.packing.date_debut?e.packing.date_debut:null),s(5),b("ngModel",e.packing.nb_rouleaux),p("min",0),s(4),b("ngModel",e.packing.prix_par_rouleau),p("min",0),s(4),b("ngModel",e.packing.statut),p("options",e.statuses),s(5),y(e.formatCurrency(e.packing.montant||0))}}function ii(a,t){if(a&1&&_(0,Jt,2,0,"div",46)(1,ti,35,16,"div",47),a&2){let e=m();p("ngIf",e.dialogLoading),s(),p("ngIf",!e.dialogLoading)}}function ni(a,t){if(a&1){let e=v();r(0,"p-button",74),f("click",function(){u(e);let n=m();return g(n.hideDialog())}),o(),r(1,"p-button",75),f("click",function(){u(e);let n=m();return g(n.savePacking())}),o()}if(a&2){let e=m();p("disabled",e.saving||e.dialogLoading),s(),p("label",e.saving?"Enregistrement...":"Enregistrer")("icon",e.saving?"pi pi-spin pi-spinner":"pi pi-check")("disabled",e.saving||e.dialogLoading)("loading",e.saving)}}var O=class a{constructor(t,e,i,n,d){this.packingService=t;this.prestataireService=e;this.parametresService=i;this.messageService=n;this.confirmationService=d}filterFields=["reference","prestataire.nom","prestataire.prenom","prestataire.phone","statut","montant"];packingDialog=!1;packings=ve([]);packing={};selectedPackings=null;submitted=!1;loading=!1;saving=!1;dialogLoading=!1;filterDateDebut=null;filterDateFin=null;filterStatut=null;prixRouleauDefaut=0;prestataires=[];filteredPrestataires=[];selectedPrestataire=null;statuses=[{label:"\xC0 valider",value:"a_valider"},{label:"Valid\xE9",value:"valide"},{label:"Annul\xE9",value:"annule"}];dt;exportColumns;cols;ngOnInit(){this.loadPackings(),this.loadPrestataires(),this.loadPrixRouleauDefaut(),this.initColumns()}initColumns(){this.cols=[{field:"reference",header:"R\xE9f\xE9rence"},{field:"prestataire",header:"Prestataire"},{field:"date_debut",header:"D\xE9but"},{field:"date_fin",header:"Fin"},{field:"nb_rouleaux",header:"Rouleaux"},{field:"montant",header:"Montant"},{field:"statut",header:"Statut"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}onDateFilter(){this.loadPackings()}clearDateFilters(){this.filterDateDebut=null,this.filterDateFin=null,this.filterStatut=null,this.loadPackings()}loadPackings(){this.loading=!0;let t={};this.filterDateDebut&&(t.date_debut=this.formatDate(this.filterDateDebut)),this.filterDateFin&&(t.date_fin=this.formatDate(this.filterDateFin)),this.filterStatut&&(t.statut=this.filterStatut),this.packingService.getPackings(Object.keys(t).length?t:void 0).subscribe({next:e=>{let i="data"in e&&Array.isArray(e.data)?e.data:e.data?.data||[];this.packings.set(i),this.loading=!1,console.log(e)},error:e=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les packings",life:3e3}),this.loading=!1}})}loadPrixRouleauDefaut(){this.parametresService.getPeriodes().subscribe({next:t=>{this.prixRouleauDefaut=t.data.prix_rouleau_defaut,console.log("prix",t)},error:()=>{this.prixRouleauDefaut=0}})}loadPrestataires(){this.prestataireService.getActivePrestataires().subscribe({next:t=>{this.prestataires=t.data.filter(e=>e.type==="machiniste")},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires",life:3e3})}})}filterPrestataire(t){let e=t.query.toLowerCase();this.filteredPrestataires=this.prestataires.filter(i=>i.nom.toLowerCase().includes(e)||i.prenom.toLowerCase().includes(e)||i.phone.includes(e))}exportCSV(){this.dt.exportCSV()}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}openNew(){this.selectedPrestataire=null,this.submitted=!1,this.packingDialog=!0,this.dialogLoading=!0,be({periodes:this.parametresService.getPeriodes(),prestataires:this.prestataireService.getActivePrestataires()}).subscribe({next:({periodes:t,prestataires:e})=>{this.prixRouleauDefaut=t.data.prix_rouleau_defaut,this.prestataires=e.data.filter(i=>i.type==="machiniste"),this.packing={statut:"valide",nb_rouleaux:0,prix_par_rouleau:this.prixRouleauDefaut,montant:0},this.dialogLoading=!1},error:()=>{this.packing={statut:"valide",nb_rouleaux:0,prix_par_rouleau:this.prixRouleauDefaut,montant:0},this.dialogLoading=!1}})}editPacking(t){this.packing=fe(_e({},t),{date_debut:t.date_debut?new Date(t.date_debut):void 0,date_fin:t.date_fin?new Date(t.date_fin):void 0}),this.selectedPrestataire=t.prestataire||null,this.packingDialog=!0}deletePacking(t){this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir supprimer le packing ${t.reference} ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.packingService.deletePacking(t.id).subscribe({next:()=>{this.packings.set(this.packings().filter(e=>e.id!==t.id)),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing supprim\xE9",life:3e3})},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer le packing",life:3e3})}})}})}deleteSelectedPackings(){this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer les packings s\xE9lectionn\xE9s ?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.selectedPackings?.forEach(t=>{this.packingService.deletePacking(t.id).subscribe()}),this.packings.set(this.packings().filter(t=>!this.selectedPackings?.includes(t))),this.selectedPackings=null,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packings supprim\xE9s",life:3e3})}})}hideDialog(){this.packingDialog=!1,this.submitted=!1}savePacking(){if(this.submitted=!0,!this.selectedPrestataire||this.saving)return;this.saving=!0,this.messageService.add({severity:"info",summary:"En cours",detail:"Enregistrement en cours...",life:2e3});let t={prestataire_id:this.selectedPrestataire.id,date_debut:this.formatDate(this.packing.date_debut),date_fin:this.formatDate(this.packing.date_fin),nb_rouleaux:this.packing.nb_rouleaux||0,prix_par_rouleau:this.packing.prix_par_rouleau||0,montant:this.packing.montant||0,statut:this.packing.statut,notes:this.packing.notes??void 0};this.packing.id?this.packingService.updatePacking(this.packing.id,t).subscribe({next:e=>{let i=this.packings().findIndex(n=>n.id===this.packing.id);if(i!==-1){let n=[...this.packings()];n[i]=e.data,this.packings.set(n)}this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing mis \xE0 jour",life:3e3}),this.packingDialog=!1,this.packing={},this.saving=!1},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de mettre \xE0 jour le packing",life:3e3}),this.saving=!1}}):this.packingService.createPacking(t).subscribe({next:e=>{this.packings.set([...this.packings(),e.data]),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing cr\xE9\xE9",life:3e3}),this.packingDialog=!1,this.packing={},this.saving=!1},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le packing",life:3e3}),this.saving=!1}})}calculateMontant(){this.packing.nb_rouleaux&&this.packing.prix_par_rouleau&&(this.packing.montant=this.packing.nb_rouleaux*this.packing.prix_par_rouleau)}formatDate(t){return t?typeof t=="string"?t:new Date(t).toISOString().split("T")[0]:""}getStatutLabel(t){return Et[t]||t}getStatutSeverity(t){return wt[t]||"info"}formatCurrency(t){return new Intl.NumberFormat("fr-FR",{style:"decimal",minimumFractionDigits:0}).format(t)+" GNF"}formatDateDisplay(t){return t?new Date(t).toLocaleDateString("fr-FR"):""}static \u0275fac=function(e){return new(e||a)(P(N),P(ne),P(ae),P(I),P(K))};static \u0275cmp=w({type:a,selectors:[["app-packing-liste"]],viewQuery:function(e,i){if(e&1&&De(Nt,5),e&2){let n;Ie(n=Me())&&(i.dt=n.first)}},features:[L([I,K])],decls:21,vars:21,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["content",""],["footer",""],[1,"card"],["styleClass","mb-12"],["dataKey","id","currentPageReportTemplate","Affichage {first} \xE0 {last} sur {totalRecords} packings",3,"selectionChange","value","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions","loading"],["header","D\xE9tails du packing",3,"visibleChange","visible","modal"],[1,"mt-4"],["label","Ajouter packing","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick"],[1,"flex","items-center","gap-2"],["optionLabel","label","optionValue","value","placeholder","Statut","styleClass","w-40",3,"ngModelChange","onChange","ngModel","options","showClear"],["dateFormat","dd/mm/yy","placeholder","Date d\xE9but","inputStyleClass","w-full","styleClass","w-40",3,"ngModelChange","onSelect","ngModel","showIcon","maxDate"],["dateFormat","dd/mm/yy","placeholder","Date fin","inputStyleClass","w-full","styleClass","w-40",3,"ngModelChange","onSelect","ngModel","showIcon","minDate"],["icon","pi pi-filter-slash","severity","secondary","pTooltip","Effacer les filtres",3,"outlined","rounded","onClick",4,"ngIf"],["label","Export","icon","pi pi-download","severity","secondary",3,"onClick"],["icon","pi pi-filter-slash","severity","secondary","pTooltip","Effacer les filtres",3,"onClick","outlined","rounded"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Rechercher...",3,"input"],[2,"width","3rem"],["pSortableColumn","reference",2,"min-width","10rem"],["field","reference"],["pSortableColumn","prestataire.nom",2,"min-width","14rem"],["field","prestataire.nom"],[2,"min-width","10rem"],["pSortableColumn","date_debut",2,"min-width","10rem"],["field","date_debut"],["pSortableColumn","date_fin",2,"min-width","10rem"],["field","date_fin"],["pSortableColumn","nb_rouleaux",2,"min-width","8rem"],["field","nb_rouleaux"],["pSortableColumn","montant",2,"min-width","10rem"],["field","montant"],["pSortableColumn","statut",2,"min-width","10rem"],["field","statut"],[3,"value"],[4,"ngIf"],[3,"value","severity"],["icon","pi pi-pencil",1,"mr-2",3,"click","rounded","outlined"],["icon","pi pi-trash","severity","danger",3,"click","rounded","outlined"],["class","flex justify-center items-center py-12",4,"ngIf"],["class","flex flex-col gap-6",4,"ngIf"],[1,"flex","justify-center","items-center","py-12"],["strokeWidth","4"],[1,"flex","flex-col","gap-6"],["for","prestataire",1,"block","font-bold","mb-4"],["optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full",3,"ngModelChange","ngModel","options","filter"],["pTemplate","item"],["pTemplate","selectedItem"],["class","text-red-500",4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-6"],["for","date_debut",1,"block","font-bold","mb-4"],["dateFormat","dd/mm/yy","inputStyleClass","w-full","styleClass","w-full",3,"ngModelChange","ngModel","showIcon"],["for","date_fin",1,"block","font-bold","mb-4"],["dateFormat","dd/mm/yy","inputStyleClass","w-full","styleClass","w-full",3,"ngModelChange","ngModel","showIcon","minDate"],["for","nb_rouleaux",1,"block","font-bold","mb-4"],["id","nb_rouleaux","styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],["for","prix_par_rouleau",1,"block","font-bold","mb-4"],["id","prix_par_rouleau","styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],["for","statut",1,"block","font-bold","mb-4"],["optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","styleClass","w-full",3,"ngModelChange","ngModel","options"],[1,"flex","justify-between","items-center","p-4","mt-4","bg-surface-100","rounded-lg"],[1,"font-bold","text-lg"],[1,"text-2xl","font-semibold","text-primary"],[1,"pi","pi-user","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500"],["label","Annuler","icon","pi pi-times","text","",1,"mt-4",3,"click","disabled"],[1,"mt-4",3,"click","label","icon","disabled","loading"]],template:function(e,i){if(e&1){let n=v();c(0,"p-toast"),r(1,"div",8)(2,"p-toolbar",9),_(3,Ut,1,0,"ng-template",null,0,D)(5,Ht,6,10,"ng-template",null,1,D),o(),r(7,"p-table",10,2),k("selectionChange",function(x){return u(n),h(i.selectedPackings,x)||(i.selectedPackings=x),g(x)}),_(9,Qt,6,0,"ng-template",null,3,D)(11,Kt,34,0,"ng-template",null,4,D)(13,Yt,22,14,"ng-template",null,5,D),o()(),r(15,"p-dialog",11),k("visibleChange",function(x){return u(n),h(i.packingDialog,x)||(i.packingDialog=x),g(x)}),_(16,ii,2,2,"ng-template",null,6,D)(18,ni,2,5,"ng-template",12,7,D),o(),c(20,"p-confirmdialog")}e&2&&(s(7),p("value",i.packings())("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",B(17,Bt)),b("selection",i.selectedPackings),p("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",B(18,Wt))("loading",i.loading),s(8),ce(B(19,Ot)),b("visible",i.packingDialog),p("modal",!0),s(5),ce(B(20,jt)))},dependencies:[A,H,dt,rt,Oe,ot,st,lt,pt,J,z,Y,Ye,ze,qe,te,ee,gt,ut,Qe,He,at,$,nt,Z,bt,ft,ct,mt,$e,Ze,Xe,Je,kt,ht,it,X,xt,_t,tt,et,St,ue],styles:["[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{background-color:var(--surface-50);color:var(--surface-700);font-weight:600;padding:1rem}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr:hover{background-color:var(--surface-50)}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:.75rem 1rem}[_nghost-%COMP%]     .dark .p-datatable .p-datatable-thead>tr>th{background-color:var(--surface-800);color:var(--surface-200)}[_nghost-%COMP%]     .dark .p-datatable .p-datatable-tbody>tr:hover{background-color:var(--surface-800)}"]})};var re=class a{transform(t,e="GNF",i=!0){if(t==null||t==="")return i?"0 GNF":"0";let n=typeof t=="string"?parseFloat(t):t;if(isNaN(n))return i?"0 GNF":"0";let x=Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"  ");return i?`${x} ${e==="EUR"?"\u20AC":"GNF"}`:x}static \u0275fac=function(e){return new(e||a)};static \u0275pipe=ye({name:"money",type:a,pure:!0})};function ai(a,t){if(a&1){let e=v();r(0,"button",37),f("click",function(){u(e);let n=m();return g(n.enableEditing())}),c(1,"i",38),l(2," Modifier "),o()}}function ri(a,t){a&1&&(r(0,"span",39),l(1,"*"),o())}function oi(a,t){if(a&1&&(r(0,"div",28)(1,"div",40),c(2,"i",41),o(),r(3,"div")(4,"div",42),l(5),o(),r(6,"div",43),l(7),o()()()),a&2){let e=t.$implicit;s(5),C("",e.prenom," ",e.nom),s(2),y(e.phone)}}function si(a,t){if(a&1&&(r(0,"div",45),c(1,"i",41),r(2,"span"),l(3),o()()),a&2){let e=m().$implicit;s(3),C("",e.prenom," ",e.nom)}}function li(a,t){if(a&1&&_(0,si,4,2,"div",44),a&2){let e=t.$implicit;p("ngIf",e)}}function pi(a,t){a&1&&(r(0,"small",39),l(1," Veuillez s\xE9lectionner un machiniste "),o())}function di(a,t){a&1&&(r(0,"span",39),l(1,"*"),o())}function mi(a,t){if(a&1&&(r(0,"small",46),l(1),o()),a&2){let e=m();s(),S(" ",e.dateDebutError," ")}}function ci(a,t){a&1&&(r(0,"span",39),l(1,"*"),o())}function ui(a,t){if(a&1&&(r(0,"small",46),l(1),o()),a&2){let e=m();s(),S(" ",e.dateFinError," ")}}function gi(a,t){if(a&1&&(r(0,"small",47),l(1),o()),a&2){let e=m();s(),S(" ",e.dateRangeError," ")}}function _i(a,t){a&1&&(r(0,"span",39),l(1,"*"),o())}function fi(a,t){a&1&&(r(0,"small",39),l(1," Le nombre de rouleaux doit \xEAtre sup\xE9rieur \xE0 0 "),o())}function bi(a,t){a&1&&(r(0,"span",39),l(1,"*"),o())}function hi(a,t){a&1&&(r(0,"small",39),l(1," Le prix unitaire doit \xEAtre sup\xE9rieur \xE0 0 "),o())}function ki(a,t){if(a&1&&(r(0,"div",48),c(1,"i",49),l(2),F(3,"number"),o()),a&2){let e=m();s(2),C(" ",e.model.nb_rouleaux," rouleaux \xD7 ",V(3,2,e.model.prix_par_rouleau,"1.0-0")," GNF ")}}function xi(a,t){a&1&&(r(0,"div",50),c(1,"i",51),l(2," Entrez la quantit\xE9 et le prix unitaire pour calculer le montant "),o())}function vi(a,t){if(a&1&&(r(0,"div",52)(1,"div",53)(2,"div",54),c(3,"i",55),r(4,"span",56),l(5,"R\xE9capitulatif"),o()(),r(6,"div",57)(7,"div",58)(8,"div",59),c(9,"i",60),r(10,"div",61)(11,"div",31),l(12,"Prestataire"),o(),r(13,"div",62),l(14),o(),r(15,"div",63),l(16),o()()(),r(17,"div",59),c(18,"i",64),r(19,"div",61)(20,"div",31),l(21,"P\xE9riode"),o(),r(22,"div",65),l(23),F(24,"date"),F(25,"date"),o(),r(26,"div",63),l(27),o()()()(),r(28,"div",58)(29,"div",59),c(30,"i",66),r(31,"div",61)(32,"div",31),l(33,"Quantit\xE9"),o(),r(34,"div",67),l(35),o()()(),r(36,"div",59),c(37,"i",68),r(38,"div",61)(39,"div",31),l(40,"Prix unitaire"),o(),r(41,"div",65),l(42),F(43,"number"),o()()(),r(44,"div",69),c(45,"i",70),r(46,"div",61)(47,"div",31),l(48,"Montant total"),o(),r(49,"div",71),l(50),F(51,"number"),o()()()()()()()),a&2){let e,i,n=m();s(14),C(" ",(e=n.getSelectedPrestataire())==null?null:e.prenom," ",(e=n.getSelectedPrestataire())==null?null:e.nom," "),s(2),S(" ",(i=n.getSelectedPrestataire())==null?null:i.phone," "),s(7),C(" ",V(24,9,n.model.date_debut,"dd/MM/yyyy")," - ",V(25,12,n.model.date_fin,"dd/MM/yyyy")," "),s(4),S(" ",n.calculateDays()," jour(s) "),s(8),S(" ",n.model.nb_rouleaux," rouleaux "),s(7),S(" ",V(43,15,n.model.prix_par_rouleau,"1.0-0")," GNF "),s(8),S(" ",V(51,18,n.model.montant,"1.0-0")," GNF ")}}function Pi(a,t){if(a&1&&(r(0,"span"),l(1),o()),a&2){let e=m(2);s(),y(e.mode==="create"?"Enregistrer":"Sauvegarder")}}function yi(a,t){a&1&&(r(0,"span"),l(1,"Enregistrement..."),o())}function Si(a,t){if(a&1){let e=v();r(0,"div",72)(1,"button",73),f("click",function(){u(e);let n=m();return g(n.onSubmit())}),c(2,"i",74),_(3,Pi,2,1,"span",75)(4,yi,2,0,"span",75),o(),r(5,"button",76),f("click",function(){u(e);let n=m();return g(n.mode==="create"?n.onCancel():n.cancelEditing())}),c(6,"i",77),l(7," Annuler "),o()()}if(a&2){let e=m();s(),p("disabled",!e.isValid()||e.loading),s(),Re("mr-2",!e.loading),p("ngClass",e.loading?"pi-spin pi-spinner":"pi-check"),s(),p("ngIf",!e.loading),s(),p("ngIf",e.loading),s(),p("disabled",e.loading)}}var M=class{id;prestataire_id;prestataire;reference;date_debut;date_fin;nb_rouleaux=0;prix_par_rouleau=0;montant=0;statut="valide";notes;constructor(t){t&&(this.id=t.id,this.prestataire_id=t.prestataire_id,this.prestataire=t.prestataire,this.reference=t.reference,this.date_debut=t.date_debut?new Date(t.date_debut):null,this.date_fin=t.date_fin?new Date(t.date_fin):null,this.nb_rouleaux=t.nb_rouleaux||0,this.prix_par_rouleau=t.prix_par_rouleau||0,this.montant=t.montant||0,this.statut=t.statut||"valide",this.notes=t.notes)}calculateMontant(){this.montant=this.nb_rouleaux*this.prix_par_rouleau}},oe=class a{mode="create";initialData=null;prestataires=[];loading=!1;submitForm=new de;cancel=new de;submitted=!1;isEditing=!1;model=new M;minDate=new Date;dateDebutError=null;dateFinError=null;dateRangeError=null;ngOnInit(){this.model=this.initialData?new M(this.initialData):new M,this.mode==="create"&&(this.isEditing=!0)}onPrixOrQuantityChange(){this.model.nb_rouleaux&&this.model.prix_par_rouleau&&this.model.calculateMontant()}validateDateDebut(){if(!this.model.date_debut)return this.dateDebutError="Date de d\xE9but obligatoire.",!1;let t=new Date(this.model.date_debut),e=new Date;return e.setHours(0,0,0,0),t<e&&this.mode==="create"?(this.dateDebutError="La date de d\xE9but ne peut pas \xEAtre dans le pass\xE9.",!1):(this.dateDebutError=null,!0)}validateDateFin(){return this.model.date_fin?(this.dateFinError=null,!0):(this.dateFinError="Date de fin obligatoire.",!1)}validateDateRange(){if(!this.model.date_debut||!this.model.date_fin)return!0;let t=new Date(this.model.date_debut);return new Date(this.model.date_fin)<t?(this.dateRangeError="La date de fin doit \xEAtre sup\xE9rieure ou \xE9gale \xE0 la date de d\xE9but.",!1):(this.dateRangeError=null,!0)}onDateDebutChange(){this.submitted&&(this.validateDateDebut(),this.validateDateRange())}onDateFinChange(){this.submitted&&(this.validateDateFin(),this.validateDateRange())}onDateBlur(t){t==="debut"&&this.model.date_debut?this.validateDateDebut():t==="fin"&&this.model.date_fin&&this.validateDateFin(),this.validateDateRange()}getPrestataireLabel(t){return`${t.prenom} ${t.nom} - ${t.phone}`}getSelectedPrestataire(){return this.filteredPrestataires.find(t=>t.id===this.model.prestataire_id)}get filteredPrestataires(){let t=this.model.prestataire_id;return(this.prestataires??[]).filter(e=>t&&e.id===t?!0:e.type==="machiniste")}get minDateFin(){return this.model.date_debut?this.model.date_debut instanceof Date?this.model.date_debut:new Date(this.model.date_debut):this.minDate}calculateDays(){if(!this.model.date_debut||!this.model.date_fin)return 0;let t=new Date(this.model.date_debut),e=new Date(this.model.date_fin),i=Math.abs(e.getTime()-t.getTime());return Math.ceil(i/(1e3*60*60*24))+1}isValid(){return!(this.model.prestataire_id&&this.model.date_debut&&this.model.date_fin&&this.model.nb_rouleaux&&this.model.nb_rouleaux>0&&this.model.prix_par_rouleau&&this.model.prix_par_rouleau>0)?!1:this.validateDateDebut()&&this.validateDateFin()&&this.validateDateRange()}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.dateDebutError=null,this.dateFinError=null,this.dateRangeError=null,this.model=this.initialData?new M(this.initialData):new M}resetForm(){this.submitted=!1,this.dateDebutError=null,this.dateFinError=null,this.dateRangeError=null,this.model=new M}formatDate(t){return t?(typeof t=="string"?new Date(t):t).toISOString().split("T")[0]:""}onSubmit(){if(this.submitted=!0,!this.isValid())return;this.model.calculateMontant();let t={prestataire_id:this.model.prestataire_id,date_debut:this.formatDate(this.model.date_debut),date_fin:this.formatDate(this.model.date_fin),nb_rouleaux:this.model.nb_rouleaux,prix_par_rouleau:this.model.prix_par_rouleau,montant:this.model.montant,statut:this.model.statut,notes:this.model.notes??void 0};this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}hasErrors(){return!!(this.dateDebutError||this.dateFinError||this.dateRangeError)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-packing-from"]],inputs:{mode:"mode",initialData:"initialData",prestataires:"prestataires",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},decls:62,vars:42,consts:[[1,"card"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],["pButton","","pRipple","","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12"],["for","prestataire",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","prestataire","optionLabel","nom","optionValue","id","placeholder","S\xE9lectionnez un machiniste","filterBy","nom,prenom,phone","fluid","",3,"ngModelChange","ngModel","options","filter","showClear","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-6"],["for","dateDebut",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","dateDebut","dateFormat","dd/mm/yy","placeholder","S\xE9lectionnez la date","fluid","",3,"ngModelChange","onSelect","onBlur","ngModel","showIcon","minDate","disabled"],["class","text-red-500 block mt-1",4,"ngIf"],["for","dateFin",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","dateFin","dateFormat","dd/mm/yy","placeholder","S\xE9lectionnez la date","fluid","",3,"ngModelChange","onSelect","onBlur","ngModel","showIcon","minDate","disabled"],["class","text-red-500 block mt-2",4,"ngIf"],[1,"mb-6","col-span-12","grid","grid-cols-12","gap-3"],["for","nbRouleaux",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nbRouleaux","placeholder","Entrez le nombre","mode","decimal","fluid","",3,"ngModelChange","ngModel","showButtons","min","max","useGrouping","disabled"],["for","prixRouleau",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prixRouleau","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix par rouleau","fluid","",3,"ngModelChange","ngModel","min","disabled"],[1,"bg-gradient-to-r","from-primary/10","to-primary/5","border-l-4","border-primary","rounded-lg","p-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-full","bg-primary/20","flex","items-center","justify-center"],[1,"pi","pi-money-bill","text-primary","text-xl"],[1,"text-xs","text-surface-600","dark:text-surface-400","mb-1"],[1,"text-3xl","font-bold","text-primary"],["class","text-sm text-surface-600 dark:text-surface-300 mt-3 flex items-center gap-2",4,"ngIf"],["class","text-sm text-surface-500 dark:text-surface-400 mt-3 italic",4,"ngIf"],["class","col-span-12 mb-6",4,"ngIf"],["class","col-span-12 flex gap-2 mb-4",4,"ngIf"],["pButton","","pRipple","","severity","warn",1,"w-auto",3,"click"],[1,"pi","pi-pencil","mr-2"],[1,"text-red-500"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary/10"],[1,"pi","pi-user","text-primary"],[1,"font-medium"],[1,"text-sm","text-surface-500"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500","block","mt-1"],[1,"text-red-500","block","mt-2"],[1,"text-sm","text-surface-600","dark:text-surface-300","mt-3","flex","items-center","gap-2"],[1,"pi","pi-calculator","text-surface-500"],[1,"text-sm","text-surface-500","dark:text-surface-400","mt-3","italic"],[1,"pi","pi-info-circle","mr-2"],[1,"col-span-12","mb-6"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-5"],[1,"flex","items-center","gap-2","mb-4"],[1,"pi","pi-info-circle","text-blue-600","dark:text-blue-400","text-lg"],[1,"font-bold","text-blue-900","dark:text-blue-100","text-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"space-y-3"],[1,"flex","items-start","gap-3"],[1,"pi","pi-user","text-blue-600","mt-1"],[1,"flex-1"],[1,"font-semibold","text-surface-900","dark:text-surface-0"],[1,"text-sm","text-surface-500","dark:text-surface-400"],[1,"pi","pi-calendar","text-blue-600","mt-1"],[1,"font-medium","text-surface-900","dark:text-surface-0"],[1,"pi","pi-box","text-blue-600","mt-1"],[1,"font-bold","text-primary","text-xl"],[1,"pi","pi-tag","text-blue-600","mt-1"],[1,"flex","items-start","gap-3","pt-3","border-t","border-blue-200","dark:border-blue-700"],[1,"pi","pi-wallet","text-blue-600","mt-1"],[1,"font-bold","text-primary","text-2xl"],[1,"col-span-12","flex","gap-2","mb-4"],["pButton","","pRipple","",1,"w-auto",3,"click","disabled"],[1,"pi",3,"ngClass"],[4,"ngIf"],["pButton","","pRipple","","severity","secondary",1,"w-auto",3,"click","disabled"],[1,"pi","pi-times","mr-2"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"span",2),l(3),o(),_(4,ai,3,0,"button",3),o(),r(5,"div",4),c(6,"div",5),r(7,"div",6)(8,"div",4)(9,"div",7)(10,"label",8),l(11," Prestataire "),_(12,ri,2,0,"span",9),l(13," (Machiniste) "),o(),r(14,"p-select",10),k("ngModelChange",function(d){return h(i.model.prestataire_id,d)||(i.model.prestataire_id=d),d}),_(15,oi,8,3,"ng-template",11)(16,li,1,1,"ng-template",12),o(),_(17,pi,2,0,"small",9),o(),r(18,"div",7)(19,"div",13)(20,"div",14)(21,"label",15),l(22," Date de d\xE9but "),_(23,di,2,0,"span",9),o(),r(24,"p-datepicker",16),k("ngModelChange",function(d){return h(i.model.date_debut,d)||(i.model.date_debut=d),d}),f("onSelect",function(){return i.onDateDebutChange()})("onBlur",function(){return i.onDateBlur("debut")}),o(),_(25,mi,2,1,"small",17),o(),r(26,"div",14)(27,"label",18),l(28," Date de fin "),_(29,ci,2,0,"span",9),o(),r(30,"p-datepicker",19),k("ngModelChange",function(d){return h(i.model.date_fin,d)||(i.model.date_fin=d),d}),f("onSelect",function(){return i.onDateFinChange()})("onBlur",function(){return i.onDateBlur("fin")}),o(),_(31,ui,2,1,"small",17),o()(),_(32,gi,2,1,"small",20),o(),r(33,"div",21)(34,"div",14)(35,"label",22),l(36," Nombre de rouleaux "),_(37,_i,2,0,"span",9),o(),r(38,"p-inputnumber",23),k("ngModelChange",function(d){return h(i.model.nb_rouleaux,d)||(i.model.nb_rouleaux=d),d}),f("ngModelChange",function(){return i.onPrixOrQuantityChange()}),o(),_(39,fi,2,0,"small",9),o(),r(40,"div",14)(41,"label",24),l(42," Prix unitaire (GNF) "),_(43,bi,2,0,"span",9),o(),r(44,"p-inputnumber",25),k("ngModelChange",function(d){return h(i.model.prix_par_rouleau,d)||(i.model.prix_par_rouleau=d),d}),f("ngModelChange",function(){return i.onPrixOrQuantityChange()}),o(),_(45,hi,2,0,"small",9),o()(),r(46,"div",7)(47,"div",26)(48,"div",27)(49,"div",28)(50,"div",29),c(51,"i",30),o(),r(52,"div")(53,"div",31),l(54," Montant total "),o(),r(55,"div",32),l(56),F(57,"money"),o()()()(),_(58,ki,4,5,"div",33)(59,xi,3,0,"div",34),o()(),_(60,vi,52,21,"div",35)(61,Si,8,7,"div",36),o()()()()),e&2&&(s(3),S(" ",i.mode==="create"?"Nouveau Packing":"D\xE9tails du Packing"," "),s(),p("ngIf",i.mode==="edit"&&!i.isEditing),s(8),p("ngIf",i.isEditing),s(2),b("ngModel",i.model.prestataire_id),p("options",i.filteredPrestataires)("filter",!0)("showClear",!0)("disabled",i.fieldsDisabled),s(3),p("ngIf",i.submitted&&!i.model.prestataire_id&&i.isEditing),s(6),p("ngIf",i.isEditing),s(),b("ngModel",i.model.date_debut),p("showIcon",!0)("minDate",i.minDate)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&i.dateDebutError&&i.isEditing),s(4),p("ngIf",i.isEditing),s(),b("ngModel",i.model.date_fin),p("showIcon",!0)("minDate",i.minDateFin)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&i.dateFinError&&i.isEditing),s(),p("ngIf",i.submitted&&i.dateRangeError&&i.isEditing),s(5),p("ngIf",i.isEditing),s(),b("ngModel",i.model.nb_rouleaux),p("showButtons",!0)("min",1)("max",9999)("useGrouping",!1)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&(!i.model.nb_rouleaux||i.model.nb_rouleaux<1)&&i.isEditing),s(4),p("ngIf",i.isEditing),s(),b("ngModel",i.model.prix_par_rouleau),p("min",0)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&(!i.model.prix_par_rouleau||i.model.prix_par_rouleau<=0)&&i.isEditing),s(11),S(" ",Ve(57,40,i.model.montant)," "),s(2),p("ngIf",i.model.nb_rouleaux&&i.model.prix_par_rouleau),s(),p("ngIf",!i.model.nb_rouleaux||!i.model.prix_par_rouleau),s(),p("ngIf",i.model.prestataire_id&&i.model.date_debut&&i.model.date_fin&&i.model.nb_rouleaux&&i.model.prix_par_rouleau&&!i.hasErrors()),s(),p("ngIf",i.isEditing))},dependencies:[A,Ae,H,J,z,Y,X,$,Z,Ke,Be,Ne,re],encapsulation:2})};var se=class a{constructor(t,e,i,n){this.prestataireService=t;this.packingService=e;this.messageService=i;this.router=n}prestataires=[];loading=!1;ngOnInit(){this.loadPrestataires()}loadPrestataires(){this.loading=!0,this.prestataireService.getPrestataires().subscribe({next:t=>{this.prestataires=this.extractPrestataires(t),this.loading=!1},error:t=>{console.error("Erreur lors du chargement des prestataires :",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires",life:3e3}),this.loading=!1}})}extractPrestataires(t){let e=t?.data;return Array.isArray(e)?e:e&&Array.isArray(e.data)?e.data:[]}onSubmit(t){this.loading=!0,this.packingService.createPacking(t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing cr\xE9\xE9 avec succ\xE8s",life:3e3}),this.loading=!1,setTimeout(()=>{this.router.navigate(["/packings/packings-liste"])},1e3)},error:e=>{console.error("Erreur lors de la cr\xE9ation du packing :",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le packing",life:3e3}),this.loading=!1}})}onCancel(){this.router.navigate(["/packings/packings-liste"])}static \u0275fac=function(e){return new(e||a)(P(ne),P(N),P(I),P(We))};static \u0275cmp=w({type:a,selectors:[["app-packing-new"]],features:[L([I])],decls:2,vars:3,consts:[[3,"submitForm","cancel","mode","prestataires","loading"]],template:function(e,i){e&1&&(c(0,"p-toast"),r(1,"app-packing-from",0),f("submitForm",function(d){return i.onSubmit(d)})("cancel",function(){return i.onCancel()}),o()),e&2&&(s(),p("mode","create")("prestataires",i.prestataires)("loading",i.loading))},dependencies:[oe,te,ee],encapsulation:2})};var le=class a{static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-packing-edit"]],decls:2,vars:0,template:function(e,i){e&1&&(we(0,"p"),l(1,"packing-edit works!"),Ce())},encapsulation:2})};var ma=[{path:"",component:O},{path:"packings",component:O},{path:"packings-new",component:se},{path:"packings-edit/:id",component:le},{path:"**",redirectTo:"/notfound"}];export{ma as default};
