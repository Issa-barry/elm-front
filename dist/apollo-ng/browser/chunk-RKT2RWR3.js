import{b as Ne}from"./chunk-MEUB4WWK.js";import{b as ke}from"./chunk-WEJXN6OG.js";import"./chunk-N5VHCF4T.js";import"./chunk-KAWCBAUU.js";import{a as Z,b as Le}from"./chunk-JFBSWTEJ.js";import{a as Be}from"./chunk-IUCT6ZC4.js";import{a as V}from"./chunk-3J34NKPR.js";import{b as De}from"./chunk-6MAGWI7U.js";import{a as Re}from"./chunk-2L636W5W.js";import{a as Fe,b as Ve}from"./chunk-LOBJQVB7.js";import"./chunk-3HDW43E7.js";import{a as Se,d as Ce,e as Ee,f as we,k as Te}from"./chunk-KYBPPGZP.js";import"./chunk-KKEZTC3T.js";import"./chunk-QAU7W4US.js";import"./chunk-GO7AEQHW.js";import"./chunk-44MNQRCX.js";import"./chunk-FHJ3HI6Y.js";import"./chunk-MGFZT6L3.js";import{a as Ie,b as Me}from"./chunk-2M2YESUI.js";import"./chunk-Q737E3VB.js";import"./chunk-GVSJPEUD.js";import"./chunk-CQGFVLY5.js";import"./chunk-ZOHIMUT6.js";import"./chunk-TB7JIXSI.js";import{a as H,b as J}from"./chunk-D4ZZGRXJ.js";import"./chunk-USWDVUUM.js";import"./chunk-KHGHC55C.js";import{a as N}from"./chunk-UQ2UE4DV.js";import{b as Pe}from"./chunk-HYG7NLCW.js";import"./chunk-MYGUYXAJ.js";import"./chunk-UWJ6EXCC.js";import"./chunk-NIW5LLYW.js";import{b as de,d as F}from"./chunk-BKUS5BNA.js";import"./chunk-TZVXXQOJ.js";import"./chunk-PPJOJKS5.js";import{c as q,e as U}from"./chunk-P557RNKH.js";import"./chunk-PALTTDOF.js";import{c as z,d as xe}from"./chunk-WF73AWMM.js";import"./chunk-SXW2RLBH.js";import"./chunk-LSUA6MZX.js";import"./chunk-M2LTT3HJ.js";import"./chunk-JYP5AZVX.js";import"./chunk-T7HI4VPR.js";import{a as he,c as ve}from"./chunk-II7RVJNR.js";import{a as j,b as fe}from"./chunk-PW7MMR7K.js";import{b as ce,e as A,h as O,p as G}from"./chunk-3LUOICNH.js";import{a as ye,b as be}from"./chunk-3G6KBQ3S.js";import"./chunk-D7FY7VLK.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as ge,j as _e}from"./chunk-IK72ORTM.js";import"./chunk-Z2XDSDL7.js";import{la as W,pa as S,ta as ue}from"./chunk-344GK45C.js";import{k as M,v as w}from"./chunk-6PXXCRY5.js";import"./chunk-4O3FVBGX.js";import{$ as f,$b as C,Ab as c,Hb as v,Ja as K,Lb as _,Mb as d,Na as o,Sa as X,Vb as ne,Xb as ae,Ya as h,Yb as oe,Zb as se,_b as m,aa as g,ac as R,bb as E,dc as b,ec as P,fc as x,gc as le,hb as u,hc as I,ic as B,ma as re,sc as pe,uc as me,wc as k,xb as s,yb as a,zb as n}from"./chunk-E5DLUAUS.js";import{a as T,b as ie}from"./chunk-GAL4ENT6.js";var Ue=()=>[10,25,50],ze=()=>["nom_complet","email","phone","reference","pays","ville","specialite","type","type_label"],He=()=>({"min-width":"150px"});function Je(r,i){if(r&1){let e=v();a(0,"button",14),_("click",function(){f(e);let p=d(2);return g(p.navigateToCreate())}),n()}}function Qe(r,i){if(r&1){let e=v();a(0,"div",7)(1,"p-icon-field",8),c(2,"p-inputicon",9),a(3,"input",10),_("input",function(p){f(e);let l=d(),y=ne(3);return g(l.onGlobalFilter(y,p))}),n()(),a(4,"div",11)(5,"p-select",12),x("ngModelChange",function(p){f(e);let l=d();return P(l.selectedStatus,p)||(l.selectedStatus=p),g(p)}),_("onChange",function(){f(e);let p=d();return g(p.filterByStatus())}),n(),u(6,Je,1,0,"button",13),n()()}if(r&2){let e=d();o(5),oe(B(6,He)),s("options",e.statusOptions),b("ngModel",e.selectedStatus),s("showClear",!0),o(),s("ngIf",e.canCreate)}}function Ye(r,i){r&1&&(a(0,"tr")(1,"th",15)(2,"span",16),m(3," Nom complet "),c(4,"p-sortIcon",17),n()(),a(5,"th",18)(6,"span",16),m(7," T\xE9l\xE9phone "),c(8,"p-sortIcon",19),n()(),a(9,"th",20)(10,"span",16),m(11," Type "),c(12,"p-sortIcon",21),n()(),a(13,"th",22)(14,"span",16),m(15," Adresse "),c(16,"p-sortIcon",23),n()(),a(17,"th",24)(18,"span",16),m(19," Statut "),c(20,"p-sortIcon",25),n()(),a(21,"th",26),m(22," Actions "),n()())}function Ke(r,i){if(r&1&&c(0,"p-tag",37),r&2){let e=d().$implicit,t=d();s("value",e.type_label)("severity",t.getTypeSeverity(e.type))}}function Xe(r,i){r&1&&(a(0,"span",42),m(1,"-"),n())}function Ze(r,i){if(r&1){let e=v();a(0,"button",43),_("click",function(p){f(e);let l=d().$implicit,y=d();return g(y.toggleStatus(p,l.id))}),n()}if(r&2){let e=d().$implicit;ae("p-button-success",e.is_active)("p-button-danger",!e.is_active),s("icon",e.is_active?"pi pi-lock-open":"pi pi-lock")("pTooltip",e.is_active?"D\xE9sactiver":"Activer")}}function $e(r,i){if(r&1){let e=v();a(0,"button",44),_("click",function(p){f(e);let l=d().$implicit,y=d();return g(y.deletePrestataire(p,l.id))}),n()}r&2&&s("pTooltip","Supprimer")}function et(r,i){if(r&1){let e=v();a(0,"tr",27)(1,"td")(2,"div",16)(3,"div",28),m(4),n(),a(5,"div")(6,"div",29),m(7),n(),a(8,"div",30),m(9),n()()()(),a(10,"td")(11,"div",31)(12,"span",32),m(13),pe(14,"phoneFormat"),n()()(),a(15,"td"),u(16,Ke,1,2,"p-tag",33)(17,Xe,2,0,"span",34),n(),a(18,"td")(19,"div",16),c(20,"span"),a(21,"div")(22,"div",35),m(23),n(),a(24,"div",36),m(25),n()()()(),a(26,"td"),c(27,"p-tag",37),n(),a(28,"td")(29,"div",38)(30,"button",39),_("click",function(p){let l=f(e).$implicit,y=d();return g(y.goToEdit(p,l.id))}),n(),u(31,Ze,1,6,"button",40)(32,$e,1,1,"button",41),n()()()}if(r&2){let e=i.$implicit,t=d();s("pSelectableRow",e),o(4),R(" ",t.getInitials(e.nom_complet)," "),o(3),C(e.nom_complet),o(2),C(e.reference),o(4),C(me(14,18,e.phone,"INT")),o(3),s("ngIf",e.type_label),o(),s("ngIf",!e.type_label),o(3),se(le("fi fi-",e.code_pays==null?null:e.code_pays.toLowerCase()," text-xl")),o(3),C(e.ville),o(2),C(e.quartier),o(2),s("value",e.is_active?"Actif":"Inactif")("severity",e.is_active?"success":"danger"),o(3),s("pTooltip",t.canUpdate?"Modifier":"Voir")("disabled",!t.canUpdate),o(),s("ngIf",t.canUpdate),o(),s("ngIf",t.canDelete)}}function tt(r,i){r&1&&(a(0,"tr")(1,"td",45)(2,"div",46),c(3,"i",47),a(4,"span"),m(5,"Aucun prestataire trouv\xE9"),n()()()())}var L=class r{constructor(i,e,t,p,l){this.prestataireService=i;this.router=e;this.messageService=t;this.confirmationService=p;this.authService=l;this.canCreate=this.authService.hasPermission("prestataires.create"),this.canUpdate=this.authService.hasPermission("prestataires.update"),this.canDelete=this.authService.hasPermission("prestataires.delete")}prestataires=[];selectedPrestataire=null;loading=!1;selectedStatus=null;statusOptions=[{label:"Actif",value:!0},{label:"Inactif",value:!1}];canCreate=!1;canUpdate=!1;canDelete=!1;ngOnInit(){this.loadPrestataires()}loadPrestataires(){this.loading=!0;let i=this.selectedStatus!==null?{is_active:this.selectedStatus}:void 0;this.prestataireService.getPrestataires(i).subscribe({next:e=>{e.success&&(this.prestataires=Array.isArray(e.data)?e.data:e.data.data),console.log(e),this.loading=!1},error:e=>{console.error("Erreur lors du chargement des prestataires:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires"}),this.loading=!1}})}onGlobalFilter(i,e){i.filterGlobal(e.target.value,"contains")}filterByStatus(){this.loadPrestataires()}navigateToCreate(){this.router.navigate(["contacts/prestateurs/new"])}onRowSelect(i){this.router.navigate(["contacts/prestateurs/edit",i.data.id])}goToEdit(i,e){i.stopPropagation(),this.router.navigate(["contacts/prestateurs/edit/",e])}toggleStatus(i,e){i.stopPropagation();let p=this.prestataires.find(l=>l.id===e)?.is_active?"d\xE9sactiver":"activer";this.confirmationService.confirm({message:`Voulez-vous vraiment ${p} ce prestataire ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui",rejectLabel:"Non",accept:()=>{this.prestataireService.togglePrestataireStatus(e).subscribe({next:l=>{l.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:l.message}),this.loadPrestataires())},error:l=>{console.error("Erreur:",l),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de changer le statut du prestataire"})}})}})}deletePrestataire(i,e){i.stopPropagation(),this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer ce prestataire ? Cette action est irr\xE9versible.",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, supprimer",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.prestataireService.deletePrestataire(e).subscribe({next:t=>{t.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Prestataire supprim\xE9 avec succ\xE8s"}),this.loadPrestataires())},error:t=>{console.error("Erreur:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer le prestataire"})}})}})}getInitials(i){if(!i)return"??";let e=i.trim().split(" ");return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():i.substring(0,2).toUpperCase()}formatPhone(i){return i?i.replace(/^\+\d{1,3}/,"").trim().replace(/(\d{2})(?=\d)/g,"$1 "):"-"}getTypeSeverity(i){return i?{machiniste:"info",mecanicien:"warn",consultant:"success",fournisseur:"danger"}[i]:"secondary"}static \u0275fac=function(e){return new(e||r)(h(V),h(F),h(S),h(W),h(Pe))};static \u0275cmp=E({type:r,selectors:[["app-prestateurs-liste"]],features:[I([S,W])],decls:12,vars:11,consts:[["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],[1,"card"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","  {first} / {last} de {totalRecords} entr\xE9es","selectionMode","single","styleClass","cursor-pointer",3,"selectionChange","onRowSelect","value","paginator","rows","showCurrentPageReport","loading","rowsPerPageOptions","globalFilterFields","selection","rowHover"],[1,"flex","flex-wrap","gap-2","items-center","justify-between"],[1,"w-full","sm:w-80","order-1","sm:order-0"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher un prestataire...",1,"w-full",3,"input"],[1,"flex","gap-2","w-full","sm:w-auto","flex-order-0","sm:flex-order-1"],["placeholder","Tous les statuts",3,"ngModelChange","onChange","options","ngModel","showClear"],["pButton","","outlined","","class","flex-shrink-0","icon","pi pi-user-plus","label","Nouveau",3,"click",4,"ngIf"],["pButton","","outlined","","icon","pi pi-user-plus","label","Nouveau",1,"flex-shrink-0",3,"click"],["pSortableColumn","nom_complet",1,"white-space-nowrap",2,"width","25%"],[1,"flex","items-center","gap-2"],["field","nom_complet"],["pSortableColumn","phone",1,"white-space-nowrap",2,"width","15%"],["field","phone"],["pSortableColumn","type",1,"white-space-nowrap",2,"width","12%"],["field","type"],["pSortableColumn","pays",1,"white-space-nowrap",2,"width","18%"],["field","pays"],["pSortableColumn","is_active",1,"white-space-nowrap",2,"width","10%"],["field","is_active"],[1,"white-space-nowrap",2,"width","10%"],[3,"pSelectableRow"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary-100","text-primary-700","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-surface-500","mt-1"],[1,"flex","items-center","gap-1"],[1,"text-surface-700"],[3,"value","severity",4,"ngIf"],["class","text-surface-400",4,"ngIf"],[1,"font-medium"],[1,"text-sm","text-surface-500"],[3,"value","severity"],[1,"flex","gap-2"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","pTooltip","disabled"],["pButton","","pRipple","","class","p-button-rounded p-button-text p-button-sm","tooltipPosition","top",3,"icon","p-button-success","p-button-danger","pTooltip","click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","class","p-button-rounded p-button-text p-button-danger p-button-sm","tooltipPosition","top",3,"pTooltip","click",4,"ngIf"],[1,"text-surface-400"],["pButton","","pRipple","","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","icon","pTooltip"],["pButton","","pRipple","","icon","pi pi-trash","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-danger","p-button-sm",3,"click","pTooltip"],["colspan","6",1,"text-center","py-8"],[1,"flex","flex-col","items-center","gap-3","text-surface-500"],[1,"pi","pi-users","text-4xl"]],template:function(e,t){if(e&1){let p=v();c(0,"p-confirmDialog"),a(1,"div",5)(2,"p-table",6,0),x("selectionChange",function(y){return f(p),P(t.selectedPrestataire,y)||(t.selectedPrestataire=y),g(y)}),_("onRowSelect",function(y){return f(p),g(t.onRowSelect(y))}),u(4,Qe,7,7,"ng-template",null,1,k)(6,Ye,23,0,"ng-template",null,2,k)(8,et,33,21,"ng-template",null,3,k)(10,tt,6,0,"ng-template",null,4,k),n()()}e&2&&(o(2),s("value",t.prestataires)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("loading",t.loading)("rowsPerPageOptions",B(9,Ue))("globalFilterFields",B(10,ze)),b("selection",t.selectedPrestataire),s("rowHover",!0))},dependencies:[w,M,G,A,O,Te,Se,Ce,we,Ee,fe,j,U,q,he,ve,Me,Ie,be,ye,xe,z,Ve,Fe,Re],encapsulation:2})};var Ge=[{value:"machiniste",label:"Machiniste"},{value:"mecanicien",label:"M\xE9canicien"},{value:"consultant",label:"Consultant"},{value:"fournisseur",label:"Fournisseur"}];function it(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function rt(r,i){r&1&&(a(0,"small",31),m(1," Type obligatoire. "),n())}function nt(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function at(r,i){r&1&&(a(0,"small",31),m(1," Raison sociale obligatoire. "),n())}function ot(r,i){if(r&1){let e=v();a(0,"div",8)(1,"label",32),m(2," Raison sociale "),u(3,nt,2,0,"span",10),n(),a(4,"input",33),x("ngModelChange",function(p){f(e);let l=d();return P(l.model.raison_sociale,p)||(l.model.raison_sociale=p),g(p)}),n(),u(5,at,2,0,"small",10),n()}if(r&2){let e=d();o(3),s("ngIf",e.isEditing),o(),b("ngModel",e.model.raison_sociale),s("invalid",e.submitted&&!(e.model.raison_sociale!=null&&e.model.raison_sociale.trim()))("disabled",e.fieldsDisabled),o(),s("ngIf",e.submitted&&!(e.model.raison_sociale!=null&&e.model.raison_sociale.trim())&&e.isEditing)}}function st(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function lt(r,i){r&1&&(a(0,"small",31),m(1," Nom obligatoire. "),n())}function pt(r,i){if(r&1){let e=v();a(0,"div",25)(1,"label",34),m(2," Nom "),u(3,st,2,0,"span",10),n(),a(4,"input",35),x("ngModelChange",function(p){f(e);let l=d();return P(l.model.nom,p)||(l.model.nom=p),g(p)}),n(),u(5,lt,2,0,"small",10),n()}if(r&2){let e=d();o(3),s("ngIf",e.isEditing),o(),b("ngModel",e.model.nom),s("invalid",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim()))("disabled",e.fieldsDisabled),o(),s("ngIf",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim())&&e.isEditing)}}function mt(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function dt(r,i){r&1&&(a(0,"small",31),m(1," Pr\xE9nom obligatoire. "),n())}function ut(r,i){if(r&1){let e=v();a(0,"div",25)(1,"label",36),m(2," Pr\xE9nom "),u(3,mt,2,0,"span",10),n(),a(4,"input",37),x("ngModelChange",function(p){f(e);let l=d();return P(l.model.prenom,p)||(l.model.prenom=p),g(p)}),n(),u(5,dt,2,0,"small",10),n()}if(r&2){let e=d();o(3),s("ngIf",e.isEditing),o(),b("ngModel",e.model.prenom),s("invalid",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim()))("disabled",e.fieldsDisabled),o(),s("ngIf",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim())&&e.isEditing)}}function ct(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function ft(r,i){if(r&1&&(a(0,"div",38),c(1,"img",39),a(2,"span",40),m(3),n(),a(4,"span"),m(5),n()()),r&2){let e=i.$implicit;o(),s("src",e.flag,K)("alt",e.name),o(2),C(e.dialCode),o(2),C(e.name)}}function gt(r,i){if(r&1&&(a(0,"div",38),c(1,"img",39),a(2,"span",40),m(3),n(),a(4,"span"),m(5),n()()),r&2){let e=d().$implicit;o(),s("src",e.flag,K)("alt",e.name),o(2),C(e.dialCode),o(2),C(e.name)}}function _t(r,i){if(r&1&&u(0,gt,6,4,"div",41),r&2){let e=i.$implicit;s("ngIf",e)}}function ht(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function vt(r,i){r&1&&(a(0,"small",42),m(1," T\xE9l\xE9phone obligatoire. "),n())}function yt(r,i){if(r&1&&(a(0,"small",42),m(1),n()),r&2){let e=d();o(),R(" ",e.phoneError," ")}}function bt(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function Pt(r,i){r&1&&(a(0,"small",31),m(1," Ville obligatoire. "),n())}function xt(r,i){r&1&&(a(0,"span",31),m(1,"*"),n())}function St(r,i){r&1&&(a(0,"small",31),m(1," Quartier obligatoire. "),n())}function Ct(r,i){if(r&1){let e=v();a(0,"div",43)(1,"button",44),_("click",function(){f(e);let p=d();return g(p.onSubmit())}),n(),a(2,"button",45),_("click",function(){f(e);let p=d();return g(p.onCancel())}),n()()}if(r&2){let e=d();o(),s("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),o(),s("disabled",e.loading)}}var D=class r{mode="create";initialData=null;loading=!1;submitForm=new X;cancel=new X;submitted=!1;isEditing=!1;model={};type_piece_identite=[];prestataireTypes=Ge;phoneError=null;phoneCountry="GN";countries=Be;ngOnInit(){this.type_piece_identite=[{name:"Carte d'identit\xE9",code:"CI"},{name:"Passport",code:"PASSPORT"},{name:"Permis de conduire",code:"PERMIS"}],this.initializeModel()}ngOnChanges(i){if(i.initialData){let e=i.initialData;e.currentValue&&Object.keys(e.currentValue).length>0&&(console.log("NgOnChanges - Nouvelles donn\xE9es:",e.currentValue),this.initializeModel())}}initializeModel(){console.log("InitializeModel appel\xE9 avec:",this.initialData),this.model=this.initialData?T({},this.initialData):{},this.mode==="create"&&!this.model.ville?.trim()&&(this.model.ville="Conakry"),console.log("Model apr\xE8s initialisation:",this.model),this.mode==="create"?this.isEditing=!0:this.mode==="edit"&&this.initialData&&(this.isEditing=!0),this.model.code_pays?(this.phoneCountry=this.model.code_pays,console.log("Pays d\xE9tect\xE9 depuis code_pays:",this.phoneCountry)):this.model.phone&&(this.detectPhoneCountry(this.model.phone),console.log("Pays d\xE9tect\xE9 depuis phone:",this.phoneCountry)),this.submitted=!1,this.phoneError=null}detectPhoneCountry(i){try{let e=Z(i);e&&e.country&&(this.phoneCountry=e.country)}catch{}}validatePhone(){if(!this.model.phone?.trim())return this.phoneError="T\xE9l\xE9phone obligatoire.",!1;try{if(!Le(this.model.phone,this.phoneCountry))return this.phoneError=`Num\xE9ro invalide pour ${this.getCountryName(this.phoneCountry)}.`,!1;let e=Z(this.model.phone,this.phoneCountry);return e?(this.model.phone=e.formatInternational(),this.model.code_pays=this.phoneCountry,this.model.pays=this.getCountryName(this.phoneCountry),this.phoneError=null,!0):(this.phoneError="Format de num\xE9ro invalide.",!1)}catch{return this.phoneError="Format de num\xE9ro invalide.",!1}}getCountryName(i){let e=this.countries.find(t=>t.code===i);return e?e.name:i}getSelectedCountryDialCode(){let i=this.countries.find(e=>e.code===this.phoneCountry);return i?i.dialCode:""}getCountryFlag(i){let e=this.countries.find(t=>t.code===i);return e?e.flag:""}onCountryChange(){this.model.phone&&this.validatePhone()}onPhoneInput(){this.submitted&&this.validatePhone()}onPhoneBlur(){this.model.phone?.trim()&&this.validatePhone()}isValid(){if(!this.model.type)return!1;if(this.model.type==="fournisseur"){if(!!!(this.model.raison_sociale?.trim()&&this.model.phone?.trim()&&this.model.ville?.trim()&&this.model.quartier?.trim()))return!1}else if(!!!(this.model.nom?.trim()&&this.model.prenom?.trim()&&this.model.phone?.trim()&&this.model.ville?.trim()&&this.model.quartier?.trim()))return!1;return this.validatePhone()}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.phoneError=null,this.model=this.initialData?T({},this.initialData):{},this.model.code_pays?this.phoneCountry=this.model.code_pays:this.model.phone&&this.detectPhoneCountry(this.model.phone)}onSubmit(){this.submitted=!0,this.isValid()&&this.submitForm.emit(T({},this.model))}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}get formTitle(){if(this.mode==="create")return"Ajout prestataire";let i=this.model.reference?.trim();return"Modification prestataire"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=E({type:r,selectors:[["app-prestateurs-from"]],inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[re],decls:49,vars:31,consts:[[1,"card"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2"],[1,"text-surface-900","dark:text-surface-0","font-medium","text-xl","mb-4"],[1,"m-0","p-0","text-surface-600","dark:text-surface-200","leading-normal","mr-4"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12","md:col-span-12"],["for","type",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","ngModel","options","disabled","invalid"],["class","mb-6 col-span-12 md:col-span-12",4,"ngIf"],["class","mb-6 col-span-12 md:col-span-6",4,"ngIf"],[1,"mb-6","col-span-12"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-4"],["for","codePays",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","codePays","optionLabel","name","optionValue","code","placeholder","S\xE9lectionner un pays","fluid","",3,"ngModelChange","onChange","ngModel","options","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"col-span-12","md:col-span-8"],["for","phone",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","phone","type","tel","pInputText","","fluid","","placeholder","Exemple: 622 00 00 00",3,"ngModelChange","input","blur","ngModel","invalid","disabled"],["class","text-red-500 block mt-2",4,"ngIf"],[1,"mb-6","col-span-12","md:col-span-6"],["for","ville",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","ville","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","quartier",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","quartier","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["class","col-span-12 flex gap-2",4,"ngIf"],[1,"text-red-500"],["for","raison_sociale",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","raison_sociale","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","nom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","prenom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prenom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],[1,"flex","items-center","gap-2"],[1,"w-5","h-auto","rounded-sm",3,"src","alt"],[1,"font-semibold","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500","block","mt-2"],[1,"col-span-12","flex","gap-2"],["pButton","","pRipple","","icon","pi pi-check",1,"w-auto",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"w-auto",3,"click","disabled"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"span",2),m(3),n()(),a(4,"div",3)(5,"div",4),c(6,"div",5),a(7,"p",6),m(8," Les champs s'affiche en fonctin du type de prestateur. "),n()(),a(9,"div",7)(10,"div",3)(11,"div",8)(12,"label",9),m(13," Type de prestataire "),u(14,it,2,0,"span",10),n(),a(15,"p-select",11),x("ngModelChange",function(l){return P(t.model.type,l)||(t.model.type=l),l}),n(),u(16,rt,2,0,"small",10),n(),u(17,ot,6,5,"div",12)(18,pt,6,5,"div",13)(19,ut,6,5,"div",13),a(20,"div",14)(21,"div",15)(22,"div",16)(23,"label",17),m(24," Pays "),u(25,ct,2,0,"span",10),n(),a(26,"p-select",18),x("ngModelChange",function(l){return P(t.phoneCountry,l)||(t.phoneCountry=l),l}),_("onChange",function(){return t.onCountryChange()}),u(27,ft,6,4,"ng-template",19)(28,_t,1,1,"ng-template",20),n()(),a(29,"div",21)(30,"label",22),m(31," T\xE9l\xE9phone "),u(32,ht,2,0,"span",10),n(),a(33,"input",23),x("ngModelChange",function(l){return P(t.model.phone,l)||(t.model.phone=l),l}),_("input",function(){return t.onPhoneInput()})("blur",function(){return t.onPhoneBlur()}),n()()(),u(34,vt,2,0,"small",24)(35,yt,2,1,"small",24),n(),a(36,"div",25)(37,"label",26),m(38," Ville "),u(39,bt,2,0,"span",10),n(),a(40,"input",27),x("ngModelChange",function(l){return P(t.model.ville,l)||(t.model.ville=l),l}),n(),u(41,Pt,2,0,"small",10),n(),a(42,"div",25)(43,"label",28),m(44," Quartier "),u(45,xt,2,0,"span",10),n(),a(46,"input",29),x("ngModelChange",function(l){return P(t.model.quartier,l)||(t.model.quartier=l),l}),n(),u(47,St,2,0,"small",10),n(),u(48,Ct,3,4,"div",30),n()()()()),e&2&&(o(3),R(" ",t.formTitle," "),o(11),s("ngIf",t.isEditing),o(),b("ngModel",t.model.type),s("options",t.prestataireTypes)("disabled",t.fieldsDisabled)("invalid",t.submitted&&!t.model.type),o(),s("ngIf",t.submitted&&!t.model.type&&t.isEditing),o(),s("ngIf",t.model.type==="fournisseur"),o(),s("ngIf",t.model.type!=="fournisseur"),o(),s("ngIf",t.model.type!=="fournisseur"),o(6),s("ngIf",t.isEditing),o(),b("ngModel",t.phoneCountry),s("options",t.countries)("disabled",t.fieldsDisabled),o(6),s("ngIf",t.isEditing),o(),b("ngModel",t.model.phone),s("invalid",(t.submitted||t.phoneError)&&(!(t.model.phone!=null&&t.model.phone.trim())||!!t.phoneError))("disabled",t.fieldsDisabled),o(),s("ngIf",t.submitted&&!(t.model.phone!=null&&t.model.phone.trim())&&t.isEditing),o(),s("ngIf",t.phoneError&&(t.model.phone==null?null:t.model.phone.trim())&&t.isEditing),o(4),s("ngIf",t.isEditing),o(),b("ngModel",t.model.ville),s("invalid",t.submitted&&!(t.model.ville!=null&&t.model.ville.trim()))("disabled",t.fieldsDisabled),o(),s("ngIf",t.submitted&&!(t.model.ville!=null&&t.model.ville.trim())&&t.isEditing),o(4),s("ngIf",t.isEditing),o(),b("ngModel",t.model.quartier),s("invalid",t.submitted&&!(t.model.quartier!=null&&t.model.quartier.trim()))("disabled",t.fieldsDisabled),o(),s("ngIf",t.submitted&&!(t.model.quartier!=null&&t.model.quartier.trim())&&t.isEditing),o(),s("ngIf",t.isEditing))},dependencies:[w,M,z,j,De,ke,ue,U,q,Ne,_e,ge,G,ce,A,O],encapsulation:2})};var Q=class r{constructor(i,e,t){this.prestataireService=i;this.messageService=e;this.router=t}loading=!1;onSubmit(i){this.loading=!0;let e={nom:i.nom||"",prenom:i.prenom||"",phone:i.phone||"",pays:i.pays||"Guin\xE9e",code_pays:i.code_pays||"GN",code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville||"",quartier:i.quartier||void 0,adresse:i.adresse||void 0,raison_sociale:i.raison_sociale||void 0,email:i.email||void 0,specialite:i.specialite||void 0,type:i.type||void 0,tarif_horaire:i.tarif_horaire||void 0,notes:i.notes||void 0};console.log(e),this.prestataireService.createPrestataire(e).subscribe({next:t=>{t.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Prestataire cr\xE9\xE9 avec succ\xE8s"}),setTimeout(()=>{this.router.navigate(["contacts/prestateurs"])},1500)),this.loading=!1},error:t=>{console.error("Erreur lors de la cr\xE9ation:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Erreur lors de la cr\xE9ation du prestataire"}),this.loading=!1}})}getCodePhonePays(i){return{GN:"+224",SL:"+232",LR:"+231",CI:"+225",SN:"+221",ML:"+223",BF:"+226",NE:"+227",TG:"+228",BJ:"+229",GH:"+233",NG:"+234",GM:"+220",GW:"+245",CV:"+238",MR:"+222",FR:"+33",BE:"+32",CH:"+41",LU:"+352",CA:"+1",US:"+1"}[i]||"+224"}static \u0275fac=function(e){return new(e||r)(h(V),h(S),h(F))};static \u0275cmp=E({type:r,selectors:[["app-prestateurs-new"]],features:[I([S])],decls:2,vars:2,consts:[[3,"submitForm","mode","loading"]],template:function(e,t){e&1&&(c(0,"p-toast"),a(1,"app-prestateurs-from",0),_("submitForm",function(l){return t.onSubmit(l)}),n()),e&2&&(o(),s("mode","create")("loading",t.loading))},dependencies:[w,D,J,H],encapsulation:2})};function wt(r,i){r&1&&(a(0,"div",3),c(1,"i",4),n())}function Tt(r,i){if(r&1){let e=v();a(0,"app-prestateurs-from",5),_("submitForm",function(p){f(e);let l=d();return g(l.onSubmit(p))})("cancel",function(){f(e);let p=d();return g(p.onCancel())}),n()}if(r&2){let e=d();s("mode","edit")("initialData",e.prestateursData)("loading",e.loading)}}var Y=class r{constructor(i,e,t,p){this.route=i;this.router=e;this.prestataireService=t;this.messageService=p}loading=!1;prestateurId=null;prestateursData=null;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");console.log("id=",i),i&&(this.prestateurId=parseInt(i,10),this.loadPrestataire(this.prestateurId))}loadPrestataire(i){this.loading=!0,this.prestataireService.getPrestataire(i).subscribe({next:e=>{if(console.log("bonjour",e),e.success&&e.data){let t=e.data;this.prestateursData={id:t.id,reference:t.reference,type:t.type||void 0,nom:t.nom,prenom:t.prenom,raison_sociale:t.raison_sociale||void 0,phone:t.phone,email:t.email||void 0,pays:t.pays,code_pays:t.code_pays,code_phone_pays:t.code_phone_pays,ville:t.ville,quartier:t.quartier||void 0,adresse:t.adresse||void 0,specialite:t.specialite||void 0,tarif_horaire:t.tarif_horaire||void 0,notes:t.notes||void 0}}this.loading=!1},error:e=>{console.error("Erreur lors du chargement:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors du chargement du prestataire"}),this.loading=!1}})}onSubmit(i){if(!this.prestateurId)return;this.loading=!0;let e={nom:i.nom,prenom:i.prenom,phone:i.phone,pays:i.pays,code_pays:i.code_pays,code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville,quartier:i.quartier||void 0,adresse:i.adresse||void 0,raison_sociale:i.raison_sociale||void 0,email:i.email||void 0,specialite:i.specialite||void 0,type:i.type||void 0,tarif_horaire:i.tarif_horaire||void 0,notes:i.notes||void 0};this.prestataireService.updatePrestataire(this.prestateurId,e).subscribe({next:t=>{t.success&&(this.prestateursData=ie(T({},i),{reference:i.reference||this.prestateursData?.reference}),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Prestataire modifi\xE9 avec succ\xE8s"})),this.loading=!1},error:t=>{console.error("Erreur lors de la modification:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Erreur lors de la modification du prestataire"}),this.loading=!1}})}onCancel(){this.router.navigate(["contacts/prestateurs"])}getCodePhonePays(i){return{GN:"+224",SL:"+232",LR:"+231",CI:"+225",SN:"+221",ML:"+223",BF:"+226",NE:"+227",TG:"+228",BJ:"+229",GH:"+233",NG:"+234",GM:"+220",GW:"+245",CV:"+238",MR:"+222",FR:"+33",BE:"+32",CH:"+41",LU:"+352",CA:"+1",US:"+1"}[i]||"+224"}static \u0275fac=function(e){return new(e||r)(h(de),h(F),h(V),h(S))};static \u0275cmp=E({type:r,selectors:[["app-prestateurs-edit"]],features:[I([S])],decls:4,vars:2,consts:[[1,"p-4"],["class","flex justify-center items-center h-96",4,"ngIf"],[3,"mode","initialData","loading","submitForm","cancel",4,"ngIf"],[1,"flex","justify-center","items-center","h-96"],[1,"pi","pi-spin","pi-spinner","text-4xl","text-primary"],[3,"submitForm","cancel","mode","initialData","loading"]],template:function(e,t){e&1&&(c(0,"p-toast"),a(1,"div",0),u(2,wt,2,0,"div",1)(3,Tt,1,3,"app-prestateurs-from",2),n()),e&2&&(o(2),s("ngIf",t.loading&&!t.prestateursData),o(),s("ngIf",t.prestateursData))},dependencies:[w,M,D,J,H],encapsulation:2})};var Li=[{path:"",component:L,canActivate:[N],data:{permissions:["prestataires.read"]}},{path:"prestateurs",component:L,canActivate:[N],data:{permissions:["prestataires.read"]}},{path:"new",component:Q,canActivate:[N],data:{permissions:["prestataires.create"]}},{path:"edit/:id",component:Y,canActivate:[N],data:{permissions:["prestataires.update"]}},{path:"**",redirectTo:"/notfound"}];export{Li as default};
