import{b as mt}from"./chunk-6RJTZISX.js";import{b as dt}from"./chunk-QTPK4WUM.js";import{a as je,b as Ge}from"./chunk-OAYELUTM.js";import{a as pt,b as ut}from"./chunk-WEJXN6OG.js";import"./chunk-N5VHCF4T.js";import"./chunk-KAWCBAUU.js";import{b as ct}from"./chunk-DPE5ICRY.js";import{a as $e,b as et}from"./chunk-IMZITBI5.js";import{a as lt,b as st}from"./chunk-6MAGWI7U.js";import{a as ot,b as at}from"./chunk-LOBJQVB7.js";import{a as tt,b as it}from"./chunk-3HDW43E7.js";import{a as Qe,d as Ye,e as Ke,h as Je,i as Xe,k as Ze}from"./chunk-KYBPPGZP.js";import"./chunk-KKEZTC3T.js";import"./chunk-QAU7W4US.js";import"./chunk-GO7AEQHW.js";import"./chunk-44MNQRCX.js";import{b as pe,c as ue}from"./chunk-FHJ3HI6Y.js";import"./chunk-MGFZT6L3.js";import{a as rt,b as nt}from"./chunk-2M2YESUI.js";import"./chunk-Q737E3VB.js";import"./chunk-GVSJPEUD.js";import"./chunk-CQGFVLY5.js";import"./chunk-ZOHIMUT6.js";import"./chunk-TB7JIXSI.js";import{a as W,b as N}from"./chunk-D4ZZGRXJ.js";import"./chunk-USWDVUUM.js";import"./chunk-KHGHC55C.js";import{a as G}from"./chunk-MDPPMPGK.js";import{a as ze,b as qe}from"./chunk-3CPQXP4V.js";import"./chunk-MYGUYXAJ.js";import{b as He}from"./chunk-UWJ6EXCC.js";import"./chunk-NIW5LLYW.js";import{b as Ie,d as U}from"./chunk-C4SKCR7Q.js";import"./chunk-TZVXXQOJ.js";import{a as ke,d as Te}from"./chunk-PPJOJKS5.js";import{c as ae,d as Le,e as le}from"./chunk-P557RNKH.js";import"./chunk-PALTTDOF.js";import{c as se,d as de}from"./chunk-WF73AWMM.js";import"./chunk-SXW2RLBH.js";import"./chunk-LSUA6MZX.js";import"./chunk-M2LTT3HJ.js";import"./chunk-JYP5AZVX.js";import"./chunk-T7HI4VPR.js";import{a as Re,b as Ae,c as Be,d as Ue}from"./chunk-II7RVJNR.js";import{a as ie,b as re}from"./chunk-PW7MMR7K.js";import{b as Z,e as $,h as ee,n as Fe,p as te}from"./chunk-3LUOICNH.js";import{a as We,b as Ne}from"./chunk-3G6KBQ3S.js";import"./chunk-D7FY7VLK.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as ne,j as oe}from"./chunk-IK72ORTM.js";import{a as Ve,b as De}from"./chunk-Z2XDSDL7.js";import{la as X,pa as M}from"./chunk-344GK45C.js";import{j as Ee,k as B,v as F}from"./chunk-6PXXCRY5.js";import"./chunk-4O3FVBGX.js";import{$ as c,$b as O,Ab as f,Hb as h,Ja as q,La as R,Lb as _,Mb as p,Na as s,Qb as Y,R as we,Rb as K,Sa as be,Sb as J,V as Me,Vb as A,Xb as Oe,Ya as C,Yb as he,_b as u,aa as m,ac as ve,bb as T,bc as Pe,dc as v,ea as L,ec as P,fc as x,hb as g,hc as I,ic as j,ma as Se,o as w,u as Ce,wc as S,xb as d,yb as a,zb as r}from"./chunk-E5DLUAUS.js";import{a as D,b as Q,c as fe}from"./chunk-GAL4ENT6.js";var V={materiel:"Mat\xE9riel",service:"Service",fabricable:"Fabricable",achat_vente:"Achat/Vente"},E={brouillon:"Brouillon",actif:"Actif",inactif:"Inactif",archive:"Archiv\xE9",rupture_stock:"Rupture de stock"},ce={brouillon:"secondary",actif:"success",inactif:"danger",archive:"danger",rupture_stock:"warn"};var y=class o{id=0;nom="";code="";prix_usine=null;prix_vente=null;prix_achat=null;qte_stock=0;cout=null;statut="brouillon";type="materiel";in_stock=!0;is_archived=!1;archived_at=null;description=null;image_url=null;created_by=null;updated_by=null;deleted_by=null;archived_by=null;created_at="";updated_at="";deleted_at=null;creator;updater;archiver;deleter;created_by_name;updated_by_name;archived_by_name;deleted_by_name;constructor(t){t&&Object.assign(this,t)}getImageUrl(t="assets/demo/images/no-product.png"){return this.image_url?this.image_url.startsWith("http://")||this.image_url.startsWith("https://")?this.image_url:`assets/demo/images/produits/${this.image_url}`:t}formatPrix(t,e="GNF"){return`${(typeof t=="number"?t:0).toLocaleString("fr-FR")} ${e}`}static fromApi(t){return new o(Q(D({},t),{prix_usine:t?.prix_usine!==null&&t?.prix_usine!==void 0?Number(t.prix_usine):null,prix_vente:t?.prix_vente!==null&&t?.prix_vente!==void 0?Number(t.prix_vente):null,prix_achat:t?.prix_achat!==null&&t?.prix_achat!==void 0?Number(t.prix_achat):null,cout:t?.cout!==null&&t?.cout!==void 0?Number(t.cout):null}))}static fromApiArray(t){return t.map(e=>o.fromApi(e))}};var k=class o{constructor(t){this.http=t}apiUrl=`${ze.apiUrl}/produits`;getAll(){return this.http.get(this.apiUrl).pipe(w(t=>y.fromApiArray(t.data)))}getArchived(){return this.http.get(`${this.apiUrl}/archived`).pipe(w(t=>y.fromApiArray(t.data)))}search(t){let e=new ke;return t.search&&(e=e.set("search",t.search)),t.type&&(e=e.set("type",t.type)),t.statut&&(e=e.set("statut",t.statut)),t.in_stock!==void 0&&(e=e.set("in_stock",t.in_stock.toString())),t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),this.http.get(`${this.apiUrl}/search`,{params:e}).pipe(w(i=>Q(D({},i),{data:y.fromApiArray(i.data)})))}getStatistics(){return this.http.get(`${this.apiUrl}/statistics`).pipe(w(t=>t.data))}getById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(w(e=>y.fromApi(e.data)))}create(t){if(t.image){let l=this.toFormData(t);return this.http.post(this.apiUrl,l).pipe(w(b=>y.fromApi(b.data)))}let n=t,{image:e}=n,i=fe(n,["image"]);return this.http.post(this.apiUrl,i).pipe(w(l=>y.fromApi(l.data)))}update(t,e){if(e.image){let b=this.toFormData(e);return b.append("_method","PUT"),this.http.post(`${this.apiUrl}/${t}`,b).pipe(w(ht=>y.fromApi(ht.data)))}let l=e,{image:i}=l,n=fe(l,["image"]);return this.http.put(`${this.apiUrl}/${t}`,n).pipe(w(b=>y.fromApi(b.data)))}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}updateStock(t,e){return this.http.patch(`${this.apiUrl}/${t}/stock`,e).pipe(w(i=>y.fromApi(i.data)))}changeStatus(t,e){return this.http.patch(`${this.apiUrl}/${t}/status`,e).pipe(w(i=>y.fromApi(i.data)))}archive(t){return this.http.patch(`${this.apiUrl}/${t}/archive`,{}).pipe(w(e=>y.fromApi(e.data)))}unarchive(t){return this.http.patch(`${this.apiUrl}/${t}/unarchive`,{}).pipe(w(e=>y.fromApi(e.data)))}toFormData(t){let e=new FormData;return t.nom&&e.append("nom",t.nom),t.type&&e.append("type",t.type),t.qte_stock!==void 0&&t.qte_stock!==null&&e.append("qte_stock",t.qte_stock.toString()),t.prix_usine!==void 0&&t.prix_usine!==null&&e.append("prix_usine",t.prix_usine.toString()),t.prix_vente!==void 0&&t.prix_vente!==null&&e.append("prix_vente",t.prix_vente.toString()),t.prix_achat!==void 0&&t.prix_achat!==null&&e.append("prix_achat",t.prix_achat.toString()),t.statut&&e.append("statut",t.statut),t.description&&e.append("description",t.description),t.cout!==void 0&&t.cout!==null&&e.append("cout",t.cout.toString()),t.image instanceof File&&e.append("image",t.image,t.image.name),console.log("FormData content:"),e.forEach((i,n)=>{console.log(`  ${n}:`,i)}),e}static \u0275fac=function(e){return new(e||o)(Me(Te))};static \u0275prov=we({token:o,factory:o.\u0275fac,providedIn:"root"})};var Mt=["dt"],St=()=>({"min-width":"75rem"}),Ot=()=>[10,20,30],Et=()=>({width:"720px",maxWidth:"95vw"}),kt=()=>({width:"450px"});function Tt(o,t){if(o&1){let e=h();a(0,"p-button",44),_("click",function(n){c(e);let l=p().$implicit,b=p(2);return n.stopPropagation(),m(b.deleteProduct(l))}),r()}o&2&&d("rounded",!0)("outlined",!0)}function It(o,t){if(o&1){let e=h();a(0,"article",29),_("click",function(n){let l=c(e).$implicit,b=p(2);return m(b.goToEditProduit(n,l.id))}),a(1,"div",30)(2,"div",31),f(3,"i",32),r()(),a(4,"div",33)(5,"div",34)(6,"div",35)(7,"div",36),u(8),r(),a(9,"div",37),u(10),r()(),f(11,"p-tag",38),r(),a(12,"div",39)(13,"span",40),u(14),r(),a(15,"div",41)(16,"button",42),_("click",function(n){let l=c(e).$implicit,b=p(2);return m(b.goToEditProduit(n,l.id))}),r(),g(17,Tt,1,2,"p-button",43),r()()()()}if(o&2){let e=t.$implicit,i=p(2);s(8),O(e.code||"Sans code"),s(2),O(e.nom),s(),d("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),s(3),Pe("",e.qte_stock," en stock \xB7 ",i.formatCurrency(e.prix_vente)),s(2),d("pTooltip",i.canUpdate?"Modifier":"Voir")("disabled",!i.canUpdate),s(),d("ngIf",i.canDelete)}}function Ft(o,t){if(o&1&&(a(0,"section",27),g(1,It,18,9,"article",28),r()),o&2){let e=p();s(),d("ngForOf",e.mobileVisibleProduits)("ngForTrackBy",e.trackByProduitId)}}function Vt(o,t){o&1&&(a(0,"div",46),u(1,"Chargement des produits..."),r())}function Dt(o,t){o&1&&(a(0,"div",46),u(1,"Aucun produit trouve."),r())}function Lt(o,t){if(o&1&&g(0,Vt,2,0,"div",45)(1,Dt,2,0,"div",45),o&2){let e=p();d("ngIf",e.loading),s(),d("ngIf",!e.loading&&!e.mobileFilteredProduits.length)}}function Rt(o,t){if(o&1){let e=h();a(0,"div",47)(1,"p-button",48),_("onClick",function(){c(e);let n=p();return m(n.loadMoreMobile())}),r()()}}function At(o,t){if(o&1){let e=h();a(0,"button",49),_("click",function(){c(e);let n=p();return m(n.goToNewProduits())}),f(1,"i",50),a(2,"span",51),u(3,"Nouveau produit"),r()()}}function Bt(o,t){if(o&1){let e=h();a(0,"p-button",54),_("onClick",function(){c(e);let n=p(2);return m(n.goToNewProduits())}),r()}if(o&2){let e=p(2);d("disabled",!e.canCreate)}}function Ut(o,t){if(o&1){let e=h();a(0,"p-button",55),_("onClick",function(){c(e);let n=p(2);return m(n.deleteSelectedProducts())}),r()}if(o&2){let e=p(2);d("disabled",!e.selectedProduits||!e.selectedProduits.length)}}function Wt(o,t){if(o&1&&g(0,Bt,1,1,"p-button",52)(1,Ut,1,1,"p-button",53),o&2){let e=p();d("ngIf",e.canCreate),s(),d("ngIf",e.canDelete)}}function Nt(o,t){if(o&1){let e=h();a(0,"p-button",56),_("onClick",function(){c(e);let n=p();return m(n.exportCSV())}),r()}}function zt(o,t){if(o&1){let e=h();a(0,"div",57)(1,"h5",58),u(2,"Gestion des Produits"),r(),a(3,"p-iconfield"),f(4,"p-inputicon",18),a(5,"input",59),_("input",function(n){c(e);let l=p(),b=A(27);return m(l.onGlobalFilter(b,n))}),r()()()}}function qt(o,t){o&1&&(a(0,"tr")(1,"th",60),f(2,"p-tableHeaderCheckbox"),r(),a(3,"th",61)(4,"span",62),u(5,"Code "),f(6,"p-sortIcon",63),r()(),a(7,"th",64)(8,"span",62),u(9,"Nom "),f(10,"p-sortIcon",65),r()(),a(11,"th",66)(12,"span",62),u(13,"Type "),f(14,"p-sortIcon",67),r()(),a(15,"th",68)(16,"span",62),u(17,"Qt\xE9 "),f(18,"p-sortIcon",69),r()(),a(19,"th",70)(20,"span",62),u(21,"Status "),f(22,"p-sortIcon",71),r()(),a(23,"th",72),u(24,"Action"),r()())}function jt(o,t){if(o&1){let e=h();a(0,"p-button",78),_("click",function(){c(e);let n=p().$implicit,l=p();return m(l.deleteProduct(n))}),r()}o&2&&d("rounded",!0)("outlined",!0)}function Gt(o,t){if(o&1){let e=h();a(0,"tr")(1,"td",60),f(2,"p-tableCheckbox",73),r(),a(3,"td",72),u(4),r(),a(5,"td",74),u(6),r(),a(7,"td"),u(8),r(),a(9,"td"),u(10),r(),a(11,"td"),f(12,"p-tag",75),r(),a(13,"td")(14,"button",76),_("click",function(n){let l=c(e).$implicit,b=p();return m(b.goToEditProduit(n,l.id))}),r(),g(15,jt,1,2,"p-button",77),r()()}if(o&2){let e=t.$implicit,i=p();s(2),d("value",e),s(2),O(e.code),s(2),O(e.nom),s(2),O(e.type),s(2),O(e.qte_stock),s(2),d("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),s(2),d("pTooltip",i.canUpdate?"Modifier":"Voir")("disabled",!i.canUpdate),s(),d("ngIf",i.canDelete)}}function Ht(o,t){if(o&1){let e=h();a(0,"div",101)(1,"label",102),u(2,"Code"),r(),a(3,"input",103),x("ngModelChange",function(n){c(e);let l=p(2);return P(l.produit.code,n)||(l.produit.code=n),m(n)}),r()()}if(o&2){let e=p(2);s(3),v("ngModel",e.produit.code),d("disabled",!0)}}function Qt(o,t){o&1&&(a(0,"small",104),u(1,"Type obligatoire."),r())}function Yt(o,t){o&1&&(a(0,"small",104),u(1,"Nom obligatoire."),r())}function Kt(o,t){if(o&1){let e=h();a(0,"div")(1,"label",105),u(2,"Statut"),r(),a(3,"p-select",106),x("ngModelChange",function(n){c(e);let l=p(2);return P(l.produit.statut,n)||(l.produit.statut=n),m(n)}),r()()}if(o&2){let e=p(2);s(3),v("ngModel",e.produit.statut),d("options",e.statutOptions)}}function Jt(o,t){if(o&1){let e=h();g(0,Ht,4,2,"div",79),a(1,"div",80)(2,"div")(3,"label",81),u(4,"Type"),r(),a(5,"p-select",82),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.type,n)||(l.produit.type=n),m(n)}),r(),g(6,Qt,2,0,"small",83),r(),a(7,"div")(8,"label",84),u(9,"Nom"),r(),a(10,"input",85),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.nom,n)||(l.produit.nom=n),m(n)}),r(),g(11,Yt,2,0,"small",83),r(),a(12,"div")(13,"label",86),u(14,"Description"),r(),a(15,"textarea",87),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.description,n)||(l.produit.description=n),m(n)}),r()(),g(16,Kt,4,2,"div",88),a(17,"div",89)(18,"div",90)(19,"label",91),u(20,"Quantit\xE9"),r(),a(21,"p-inputnumber",92),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.qte_stock,n)||(l.produit.qte_stock=n),m(n)}),r()(),a(22,"div",90)(23,"label",93),u(24,"Co\xFBt"),r(),a(25,"p-inputnumber",94),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.cout,n)||(l.produit.cout=n),m(n)}),r()()(),a(26,"div",89)(27,"div",90)(28,"label",95),u(29,"Prix achat"),r(),a(30,"p-inputnumber",96),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.prix_achat,n)||(l.produit.prix_achat=n),m(n)}),r()(),a(31,"div",90)(32,"label",97),u(33,"Prix vente"),r(),a(34,"p-inputnumber",98),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.prix_vente,n)||(l.produit.prix_vente=n),m(n)}),r()()(),a(35,"div")(36,"label",99),u(37,"Prix usine"),r(),a(38,"p-inputnumber",100),x("ngModelChange",function(n){c(e);let l=p();return P(l.produit.prix_usine,n)||(l.produit.prix_usine=n),m(n)}),r()()()}if(o&2){let e=p();d("ngIf",e.produit==null?null:e.produit.id),s(5),v("ngModel",e.produit.type),d("options",e.typeOptions),s(),d("ngIf",e.submitted&&!e.produit.type),s(4),v("ngModel",e.produit.nom),s(),d("ngIf",e.submitted&&!(e.produit.nom!=null&&e.produit.nom.trim())),s(4),v("ngModel",e.produit.description),s(),d("ngIf",e.produit==null?null:e.produit.id),s(5),v("ngModel",e.produit.qte_stock),s(4),v("ngModel",e.produit.cout),s(5),v("ngModel",e.produit.prix_achat),s(4),v("ngModel",e.produit.prix_vente),s(4),v("ngModel",e.produit.prix_usine)}}function Xt(o,t){if(o&1){let e=h();a(0,"p-button",107),_("click",function(){c(e);let n=p();return m(n.hideDialog())}),r(),a(1,"p-button",108),_("click",function(){c(e);let n=p();return m(n.saveProduit())}),r()}if(o&2){let e=p();d("disabled",e.saving),s(),d("disabled",e.saving)("loading",e.saving)}}var H=class o{constructor(t,e,i,n,l,b){this.router=t;this.produitService=e;this.messageService=i;this.confirmationService=n;this.authService=l;this.document=b;this.canCreate=this.authService.hasPermission("produits.create"),this.canUpdate=this.authService.hasPermission("produits.update"),this.canDelete=this.authService.hasPermission("produits.delete")}produits=[];produit=new y;loading=!0;saving=!1;filterFields=["code","nom","description","type","statut","qte_stock"];produitDialog=!1;selectedProduits;submitted=!1;typeOptions=[];statutOptions=[];dt;exportColumns;cols;canCreate=!1;canUpdate=!1;canDelete=!1;mobileSearchTerm="";mobilePageSize=8;mobileVisibleCount=this.mobilePageSize;mobileBreakpoint=768;mobilePwaClass="produits-mobile-pwa";exportCSV(){this.dt.exportCSV()}ngOnInit(){this.initOptions(),this.initColumns(),this.loadProduits(),this.syncMobilePwaMode()}ngOnDestroy(){this.clearMobilePwaMode()}onWindowResize(){this.syncMobilePwaMode()}loadProduits(){this.loading=!0,this.produitService.getAll().subscribe({next:t=>{this.produits=t,this.resetMobilePagination(),this.loading=!1},error:t=>{console.error("Erreur lors du chargement des produits :",t),this.loading=!1,this.showApiError(t,"Chargement des produits impossible")}})}initOptions(){this.typeOptions=Object.entries(V).map(([t,e])=>({label:e,value:t})),this.statutOptions=Object.entries(E).map(([t,e])=>({label:e,value:t}))}initColumns(){this.cols=[{field:"code",header:"Code",customExportHeader:"Product Code"},{field:"nom",header:"Nom"},{field:"image",header:"Image"},{field:"prix_vente",header:"Prix"},{field:"type",header:"Type"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}onMobileSearchChange(t){this.mobileVisibleCount=this.mobilePageSize}get mobileFilteredProduits(){let t=this.mobileSearchTerm.trim().toLowerCase();return t?this.produits.filter(e=>[e.code,e.nom,e.description,this.getTypeLabel(e.type),this.getStatutLabel(e.statut),e.qte_stock].some(n=>this.searchableValue(n).includes(t))):this.produits}get mobileVisibleProduits(){return this.mobileFilteredProduits.slice(0,this.mobileVisibleCount)}get canLoadMoreMobile(){return this.mobileVisibleCount<this.mobileFilteredProduits.length}loadMoreMobile(){this.mobileVisibleCount+=this.mobilePageSize}trackByProduitId(t,e){return e.id||e.code||t}openNew(){this.produit=new y,this.submitted=!1,this.produitDialog=!0}editProduct(t){this.produit=new y(D({},t)),this.produitDialog=!0}deleteSelectedProducts(){this.confirmationService.confirm({message:"Are you sure you want to delete the selected products?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{let t=(this.selectedProduits??[]).map(e=>e.id).filter(e=>!!e);t.length!==0&&Ce(t.map(e=>this.produitService.delete(e))).subscribe({next:()=>{this.produits=this.produits.filter(e=>!t.includes(e.id)),this.selectedProduits=null,this.messageService.add({severity:"success",summary:"Successful",detail:"Products Deleted",life:3e3})},error:e=>{console.error("Erreur lors de la suppression des produits :",e),this.showApiError(e,"Suppression impossible")}})}})}hideDialog(){this.produitDialog=!1,this.submitted=!1}deleteProduct(t){this.confirmationService.confirm({message:"Are you sure you want to delete "+(t.nom||"this product")+"?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{t.id&&this.produitService.delete(t.id).subscribe({next:()=>{this.produits=this.produits.filter(e=>e.id!==t.id),this.messageService.add({severity:"success",summary:"Successful",detail:"Product Deleted",life:3e3})},error:e=>{console.error("Erreur lors de la suppression du produit :",e),this.showApiError(e,"Suppression impossible")}})}})}getSeverity(t){switch(t){case"INSTOCK":return"success";case"LOWSTOCK":return"warn";case"OUTOFSTOCK":return"danger";default:return"info"}}getStatutSeverity(t){return t?ce[t]??ce.brouillon:ce.brouillon}getStatutLabel(t){return t?E[t]??E.brouillon:E.brouillon}getTypeLabel(t){return t?V[t]??t:"-"}formatCurrency(t){return typeof t!="number"?"-":`${new Intl.NumberFormat("fr-GN",{maximumFractionDigits:0}).format(t)} GNF`}saveProduit(){if(this.submitted=!0,!this.produit.nom?.trim()||!this.produit.type||this.saving)return;this.saving=!0;let t={nom:this.produit.nom.trim(),type:this.produit.type,qte_stock:this.produit.qte_stock??0,statut:this.produit.statut,cout:this.produit.cout??void 0,description:this.produit.description??void 0,prix_usine:this.produit.prix_usine??void 0,prix_vente:this.produit.prix_vente??void 0,prix_achat:this.produit.prix_achat??void 0},e=!!this.produit.id;(e?this.produitService.update(this.produit.id,t):this.produitService.create(t)).subscribe({next:()=>{this.produitDialog=!1,this.produit=new y,this.submitted=!1,this.saving=!1,this.loadProduits(),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:e?"Produit mis \xE0 jour":"Produit cr\xE9\xE9",life:3e3})},error:n=>{this.saving=!1,this.showApiError(n,"Sauvegarde impossible")}})}showApiError(t,e){let i="Erreur",n=this.extractErrorMessage(t,e);t.status===422&&t.error?.errors?Object.values(t.error.errors).flat().forEach(b=>{this.messageService.add({severity:"error",summary:"Validation",detail:b,life:5e3})}):this.messageService.add({severity:"error",summary:i,detail:n,life:5e3})}extractErrorMessage(t,e){return typeof t?.error?.message=="string"&&t.error.message.trim().length>0?t.error.message:typeof t?.message=="string"&&t.message.trim().length>0?t.message:e}goToNewProduits(){this.router.navigate(["/produits/produits-new"])}goHome(){this.router.navigate(["/"])}goToEditProduit(t,e){t.stopPropagation(),this.router.navigate(["/produits/produits-edit",e])}resetMobilePagination(){this.mobileVisibleCount=this.mobilePageSize}searchableValue(t){return t==null?"":String(t).toLowerCase()}syncMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.clearMobilePwaMode())}clearMobilePwaMode(){this.document.body.classList.remove(this.mobilePwaClass)}static \u0275fac=function(e){return new(e||o)(C(U),C(k),C(M),C(X),C(qe),C(L))};static \u0275cmp=T({type:o,selectors:[["app-produits-liste"]],viewQuery:function(e,i){if(e&1&&Y(Mt,5),e&2){let n;K(n=J())&&(i.dt=n.first)}},hostBindings:function(e,i){e&1&&_("resize",function(){return i.onWindowResize()},R)},features:[I([M,k,X])],decls:40,vars:29,consts:[["mobileListState",""],["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["content",""],["footer",""],[1,"produits-mobile-app"],[1,"mobile-header"],["pButton","","pRipple","","icon","pi pi-arrow-left","aria-label","Retour \xE0 l'accueil",1,"p-button-rounded","p-button-text","mobile-back",3,"click"],[1,"mobile-title-wrap"],[1,"mobile-title"],[1,"mobile-subtitle"],["pButton","","pRipple","","icon","pi pi-upload","aria-label","Export",1,"p-button-rounded","p-button-text","mobile-add",3,"click"],[1,"mobile-scroll"],[1,"mobile-search"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Rechercher un produit...",3,"ngModelChange","ngModel"],["class","mobile-list",4,"ngIf","ngIfElse"],["class","mobile-load-more",4,"ngIf"],["type","button","class","mobile-fab","aria-label","Nouveau produit",3,"click",4,"ngIf"],[1,"card","produits-desktop"],["styleClass","mb-12"],["dataKey","id","currentPageReportTemplate","  {first} \xE0 {last} sur {totalRecords} produits",3,"selectionChange","value","loading","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions"],[3,"visibleChange","visible","header","modal"],[1,"mobile-list"],["class","mobile-produit-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mobile-produit-card",3,"click"],[1,"mobile-card-media"],["aria-hidden","true",1,"mobile-card-image-placeholder"],[1,"pi","pi-box"],[1,"mobile-card-body"],[1,"mobile-card-top"],[1,"mobile-card-main"],[1,"mobile-code"],[1,"mobile-name"],["styleClass","mobile-status-tag",3,"value","severity"],[1,"mobile-card-footer"],[1,"mobile-card-summary"],[1,"mobile-card-actions"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm","mobile-eye-action",3,"click","pTooltip","disabled"],["icon","pi pi-trash","severity","danger","styleClass","mobile-delete-action",3,"rounded","outlined","click",4,"ngIf"],["icon","pi pi-trash","severity","danger","styleClass","mobile-delete-action",3,"click","rounded","outlined"],["class","mobile-state",4,"ngIf"],[1,"mobile-state"],[1,"mobile-load-more"],["label","Charger plus","icon","pi pi-angle-down","styleClass","mobile-load-more-btn",3,"onClick"],["type","button","aria-label","Nouveau produit",1,"mobile-fab",3,"click"],[1,"pi","pi-plus"],[1,"mobile-fab-label"],["label","Nouveau","icon","pi pi-plus","severity","secondary","class","mr-2",3,"disabled","onClick",4,"ngIf"],["severity","secondary","label","Delete","icon","pi pi-trash","outlined","",3,"disabled","onClick",4,"ngIf"],["label","Nouveau","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick","disabled"],["severity","secondary","label","Delete","icon","pi pi-trash","outlined","",3,"onClick","disabled"],["label","Export","icon","pi pi-upload","severity","secondary",3,"onClick"],[1,"flex","items-center","justify-between"],[1,"m-0"],["pInputText","","type","text","placeholder","Rechercher...",3,"input"],[2,"width","3rem"],["pSortableColumn","code",2,"min-width","16rem"],[1,"flex","items-center","gap-2"],["field","code"],["pSortableColumn","nom",2,"min-width","16rem"],["field","nom"],["pSortableColumn","type",2,"min-width","10rem"],["field","type"],["pSortableColumn","qte_stock",2,"min-width","12rem"],["field","qte_stock"],["pSortableColumn","statut",2,"min-width","12rem"],["field","statut"],[2,"min-width","12rem"],[3,"value"],[2,"min-width","16rem"],[3,"value","severity"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm","mr-2",3,"click","pTooltip","disabled"],["icon","pi pi-trash","severity","danger",3,"rounded","outlined","click",4,"ngIf"],["icon","pi pi-trash","severity","danger",3,"click","rounded","outlined"],["class","mb-4",4,"ngIf"],[1,"flex","flex-col","gap-6"],["for","type",1,"block","font-bold","mb-4"],["inputId","type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","ngModel","options"],["class","text-red-500",4,"ngIf"],["for","nom",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","nom","required","","autofocus","","fluid","",3,"ngModelChange","ngModel"],["for","description",1,"block","font-bold","mb-4"],["id","description","pTextarea","","rows","3","cols","20","fluid","",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-6"],["for","qte_stock",1,"block","font-bold","mb-4"],["id","qte_stock","fluid","",3,"ngModelChange","ngModel"],["for","cout",1,"block","font-bold","mb-4"],["id","cout","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_achat",1,"block","font-bold","mb-4"],["id","prix_achat","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_vente",1,"block","font-bold","mb-4"],["id","prix_vente","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_usine",1,"block","font-bold","mb-4"],["id","prix_usine","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],[1,"mb-4"],["for","code",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","code","fluid","",3,"ngModelChange","ngModel","disabled"],[1,"text-red-500"],["for","statut",1,"block","font-bold","mb-4"],["inputId","statut","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","fluid","",3,"ngModelChange","ngModel","options"],["label","Annuler","icon","pi pi-times","text","",3,"click","disabled"],["label","Enregistrer","icon","pi pi-check",3,"click","disabled","loading"]],template:function(e,i){if(e&1){let n=h();f(0,"p-toast"),a(1,"div",9)(2,"header",10)(3,"button",11),_("click",function(){return c(n),m(i.goHome())}),r(),a(4,"div",12)(5,"h1",13),u(6,"Produits"),r(),a(7,"p",14),u(8),r()(),a(9,"button",15),_("click",function(){return c(n),m(i.exportCSV())}),r()(),a(10,"div",16)(11,"section",17)(12,"p-iconfield"),f(13,"p-inputicon",18),a(14,"input",19),x("ngModelChange",function(b){return c(n),P(i.mobileSearchTerm,b)||(i.mobileSearchTerm=b),m(b)}),_("ngModelChange",function(b){return c(n),m(i.onMobileSearchChange(b))}),r()()(),g(15,Ft,2,2,"section",20)(16,Lt,2,2,"ng-template",null,0,S)(18,Rt,2,0,"div",21),r(),g(19,At,4,0,"button",22),r(),a(20,"div",23)(21,"p-toolbar",24),g(22,Wt,2,2,"ng-template",null,1,S)(24,Nt,1,0,"ng-template",null,2,S),r(),a(26,"p-table",25,3),x("selectionChange",function(b){return c(n),P(i.selectedProduits,b)||(i.selectedProduits=b),m(b)}),g(28,zt,6,0,"ng-template",null,4,S)(30,qt,25,0,"ng-template",null,5,S)(32,Gt,16,10,"ng-template",null,6,S),r()(),a(34,"p-dialog",26),x("visibleChange",function(b){return c(n),P(i.produitDialog,b)||(i.produitDialog=b),m(b)}),g(35,Jt,39,13,"ng-template",null,7,S)(37,Xt,2,3,"ng-template",null,8,S),r(),f(39,"p-confirmdialog")}if(e&2){let n=A(17);s(8),Pe("",i.mobileFilteredProduits.length," produit",i.mobileFilteredProduits.length>1?"s":""),s(6),v("ngModel",i.mobileSearchTerm),s(),d("ngIf",!i.loading&&i.mobileVisibleProduits.length)("ngIfElse",n),s(3),d("ngIf",!i.loading&&i.canLoadMoreMobile),s(),d("ngIf",i.canCreate),s(7),d("value",i.produits)("loading",i.loading)("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",j(25,St)),v("selection",i.selectedProduits),d("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",j(26,Ot)),s(8),he(j(27,Et)),v("visible",i.produitDialog),d("header",i.produit!=null&&i.produit.id?"Modifier un produit":"Nouveau produit")("modal",!0),s(5),he(j(28,kt))}},dependencies:[F,Ee,B,Ze,Qe,Ye,Ke,Je,Xe,te,Z,$,Fe,ee,le,ae,Le,oe,ne,N,W,et,$e,dt,re,ie,st,lt,de,se,He,ue,pe,it,tt,nt,rt,Ue,Be,Ae,Re,at,ot,Ne,We],styles:["[_nghost-%COMP%]{display:block}.produits-mobile-app[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 768px){[_nghost-%COMP%]{--mobile-primary: #5f6bff;--mobile-text: #334155;--mobile-muted: #7f8ca3;--mobile-card: #f9fbff;--mobile-border: #dbe2ee}.produits-desktop[_ngcontent-%COMP%]{display:none}.produits-mobile-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;height:100vh;height:100dvh;overflow:hidden;margin-top:calc(-.25rem - env(safe-area-inset-top));margin-left:-.875rem;margin-right:-.875rem;margin-bottom:calc(-.875rem - env(safe-area-inset-bottom));padding:0 .875rem env(safe-area-inset-bottom);padding-left:calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:linear-gradient(180deg,#f3f5f9,#eaedf4 58%,#e5eaf1);animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.mobile-header[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;gap:.55rem;margin:0 -.875rem;padding:calc(.5rem + env(safe-area-inset-top)) calc(.875rem + env(safe-area-inset-right)) .6rem calc(.875rem + env(safe-area-inset-left));background:var(--mobile-card);border-bottom:1px solid var(--mobile-border);box-shadow:0 1px 3px #0f172a0f;position:sticky;top:0;z-index:30}.mobile-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:.75rem;padding-bottom:calc(4rem + env(safe-area-inset-bottom))}.mobile-back[_ngcontent-%COMP%], .mobile-add[_ngcontent-%COMP%]{width:2.15rem;height:2.15rem;border-radius:999px;flex-shrink:0;color:var(--mobile-primary)!important;background:#5f6bff1a!important}.mobile-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-title[_ngcontent-%COMP%]{margin:0;font-size:1.35rem;line-height:1.1;font-weight:800;color:var(--mobile-text)}.mobile-subtitle[_ngcontent-%COMP%]{margin:.2rem 0 0;font-size:.76rem;font-weight:600;color:var(--mobile-muted)}.mobile-search[_ngcontent-%COMP%]{background:#f7f9fd;border:1.5px solid var(--mobile-border);border-radius:.95rem;padding:.35rem .55rem;box-shadow:inset 0 1px #ffffffb3}.mobile-search[_ngcontent-%COMP%]   .p-iconfield[_ngcontent-%COMP%], .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{width:100%}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{border:0;box-shadow:none;background:transparent;color:var(--mobile-text);font-size:.96rem}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]::placeholder{color:#92a0b7}.mobile-quick-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;padding:0 .15rem}.mobile-quick-actions[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{flex:1}.mobile-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.65rem;margin-top:1rem}.mobile-produit-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:1rem;padding:.9rem;box-shadow:0 10px 24px #0f172a0f;cursor:pointer;transition:box-shadow .2s ease}.mobile-produit-card[_ngcontent-%COMP%]:active{box-shadow:0 4px 12px #0f172a14}.mobile-card-media[_ngcontent-%COMP%]{flex-shrink:0}.mobile-card-image-placeholder[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:.65rem;background:#eef1f6;border:1px solid var(--mobile-border);display:flex;align-items:center;justify-content:center}.mobile-card-image-placeholder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.5rem;color:#92a0b7}.mobile-card-body[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-card-top[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:.5rem;margin-bottom:.4rem}.mobile-card-main[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-code[_ngcontent-%COMP%]{margin-bottom:.1rem;font-size:.72rem;line-height:1.2;color:#8b98b0;letter-spacing:.02em;font-weight:700}.mobile-name[_ngcontent-%COMP%]{font-size:1rem;line-height:1.25;font-weight:700;color:var(--mobile-text);word-break:break-word}.mobile-card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;flex-wrap:wrap}.mobile-card-summary[_ngcontent-%COMP%]{font-size:.8rem;color:var(--mobile-muted);font-weight:600}.mobile-card-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.35rem}.mobile-eye-action[_ngcontent-%COMP%]{width:2.05rem;height:2.05rem;color:var(--mobile-primary)!important}.mobile-state[_ngcontent-%COMP%]{margin-top:1rem;background:#f8faff;border:1px dashed var(--mobile-border);border-radius:1rem;padding:1rem;text-align:center;color:var(--mobile-muted);font-size:.9rem}.mobile-load-more[_ngcontent-%COMP%]{padding-top:.4rem}.mobile-fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(1rem + env(safe-area-inset-bottom));right:calc(1rem + env(safe-area-inset-right));z-index:25;width:3.5rem;height:3.5rem;min-width:3.5rem;min-height:3.5rem;padding:0;border:none;border-radius:50%;background:var(--mobile-primary);color:#fff;box-shadow:0 4px 14px #5f6bff73;display:flex;align-items:center;justify-content:center;gap:.35rem;font-weight:700;font-size:.9rem;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.mobile-fab[_ngcontent-%COMP%]:active{transform:scale(.96)}.mobile-fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.35rem}.mobile-fab-label[_ngcontent-%COMP%]{display:none}}@media screen and (max-width: 768px) and (min-width: 400px){.mobile-fab[_ngcontent-%COMP%]{width:auto;height:3rem;min-height:3rem;padding:0 1.25rem;border-radius:999px}.mobile-fab-label[_ngcontent-%COMP%]{display:inline}}@media screen and (max-width: 768px){[_nghost-%COMP%]     .mobile-action-btn{width:100%;justify-content:flex-start;border:0!important;background:transparent!important;color:#4f5d79!important;padding:.35rem .45rem!important;font-weight:700;border-radius:.7rem;box-shadow:none!important}[_nghost-%COMP%]     .mobile-action-btn .p-button-icon{color:var(--mobile-primary);font-size:.95rem}[_nghost-%COMP%]     .mobile-action-btn .p-button-label{font-size:.95rem}[_nghost-%COMP%]     .mobile-status-tag{font-size:.79rem;font-weight:700;border-radius:.55rem;padding:.22rem .55rem}[_nghost-%COMP%]     .mobile-status-tag.p-tag-success{background:#d9f7e5;color:#168f4a}[_nghost-%COMP%]     .mobile-status-tag.p-tag-warn, [_nghost-%COMP%]     .mobile-status-tag.p-tag-warning{background:#ffe8d3;color:#dc6408}[_nghost-%COMP%]     .mobile-status-tag.p-tag-danger{background:#ffe3e1;color:#dd3f39}[_nghost-%COMP%]     .mobile-status-tag.p-tag-secondary{background:#e8edf6;color:#64748b}[_nghost-%COMP%]     .mobile-delete-action{width:2.05rem;height:2.05rem;border-radius:999px!important;border-color:#ffb9b4!important;color:#ef4444!important;background:#ffffffe6!important}[_nghost-%COMP%]     .mobile-delete-action .p-button-icon{font-size:.84rem}[_nghost-%COMP%]     .mobile-load-more-btn{width:100%;border-radius:999px;justify-content:center;font-weight:700;border:1px solid #cfd7ff;background:#eef2ff;color:#4f5df4}.app-dark   [_nghost-%COMP%]{--mobile-primary: var(--p-primary-400);--mobile-text: var(--p-surface-100);--mobile-muted: var(--p-surface-400);--mobile-card: var(--p-surface-800);--mobile-border: var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .produits-mobile-app[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .produits-mobile-app[_ngcontent-%COMP%]{background:var(--p-surface-950)}.app-dark[_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);box-shadow:none}.app-dark[_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]::placeholder, .app-dark   [_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]::placeholder{color:var(--p-surface-500)}.app-dark[_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%]{box-shadow:0 4px 12px #00000026}.app-dark[_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%]:active, .app-dark   [_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%]:active{box-shadow:0 4px 12px #00000040}.app-dark[_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%]{background:var(--p-surface-700);border-color:var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .mobile-code[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-code[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);color:var(--p-surface-400)}.app-dark   [_nghost-%COMP%]     .mobile-action-btn{color:var(--p-surface-300)!important}.app-dark   [_nghost-%COMP%]     .mobile-action-btn .p-button-icon{color:var(--p-primary-400)}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-success{background:#05966933;color:#34d399}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-warn, .app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-warning{background:#d9770633;color:#fbbf24}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-danger{background:#dc262633;color:#f87171}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-secondary{background:var(--p-surface-700);color:var(--p-surface-300)}.app-dark   [_nghost-%COMP%]     .mobile-delete-action{border-color:var(--p-surface-600)!important;background:var(--p-surface-700)!important;color:#f87171!important}.app-dark   [_nghost-%COMP%]     .mobile-load-more-btn{border-color:var(--p-surface-600);background:var(--p-surface-800);color:var(--p-primary-400)}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}"]})};var Zt=["buttonEl"];function $t(o,t){if(o&1){let e=h();a(0,"button",68),_("click",function(){c(e);let n=p();return m(n.enableEditing())}),r()}}function ei(o,t){o&1&&(a(0,"div",71),f(1,"i",72),a(2,"span"),u(3,"Ajouter une photo"),r()())}function ti(o,t){if(o&1){let e=h();a(0,"button",76),_("click",function(n){c(e);let l=p(4);return m(l.removeImage(n))}),f(1,"i",77),r()}}function ii(o,t){if(o&1&&(a(0,"div",73),f(1,"img",74),g(2,ti,2,0,"button",75),r()),o&2){let e=p(3);s(),d("src",e.imagePreview||e.product.getImageUrl(),q),s(),d("ngIf",!e.fieldsDisabled)}}function ri(o,t){if(o&1){let e=h();a(0,"div",70),_("click",function(){c(e),p();let n=A(2),l=p();return m(!l.fieldsDisabled&&n.advancedFileInput.nativeElement.click())}),g(1,ei,4,0,"div",13)(2,ii,3,2,"div",12),r()}if(o&2){let e=p(2);s(),d("ngIf",!e.imagePreview&&!e.product.image_url),s(),d("ngIf",e.imagePreview||e.product.image_url)}}function ni(o,t){if(o&1){let e=h();a(0,"div")(1,"p-fileUpload",69,0),_("onSelect",function(n){c(e);let l=p();return m(l.onUpload(n))}),g(3,ri,3,2,"ng-template",null,1,S),r()()}if(o&2){let e=p();s(),d("customUpload",!0)("multiple",!1)("showUploadButton",!1)("showCancelButton",!1)("auto",!0)("disabled",e.fieldsDisabled)}}function oi(o,t){if(o&1&&(a(0,"div",73),f(1,"img",74),r()),o&2){let e=p();s(),d("src",e.product.getImageUrl(),q)}}function ai(o,t){o&1&&(a(0,"div",71),f(1,"i",78),a(2,"span"),u(3,"Aucune image"),r()())}function li(o,t){o&1&&(a(0,"small",79),u(1," Nom du produit obligatoire. "),r())}function si(o,t){o&1&&(a(0,"small",79),u(1," Obligatoire "),r())}function di(o,t){o&1&&(a(0,"small",79),u(1," Obligatoire "),r())}function pi(o,t){o&1&&(a(0,"small",79),u(1," Obligatoire "),r())}function ui(o,t){if(o&1){let e=h();a(0,"div",19)(1,"span",20),u(2,"Usine"),r(),a(3,"p-inputnumber",21),x("ngModelChange",function(n){c(e);let l=p();return P(l.product.prix_usine,n)||(l.product.prix_usine=n),m(n)}),r(),g(4,pi,2,0,"small",17),r()}if(o&2){let e=p();s(3),v("ngModel",e.product.prix_usine),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)),s(),d("ngIf",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)&&e.isEditing)}}function ci(o,t){o&1&&(a(0,"div",80),f(1,"i",81),u(2," Au moins un prix requis pour un service. "),r())}function mi(o,t){o&1&&(a(0,"small",82),f(1,"i",83),u(2," Stock non g\xE9r\xE9 pour les services "),r())}function gi(o,t){if(o&1){let e=h();a(0,"div",84)(1,"button",85),_("click",function(){c(e);let n=p();return m(n.onSubmit())}),r(),a(2,"button",86),_("click",function(){c(e);let n=p();return m(n.mode==="create"?n.onCancel():n.cancelEditing())}),r()()}if(o&2){let e=p();s(),d("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),s(),d("disabled",e.loading)}}function _i(o,t){if(o&1){let e=h();a(0,"button",87),_("click",function(){c(e);let n=p();return m(n.enableEditing())}),r()}}function fi(o,t){o&1&&(a(0,"small",79),u(1," Nom du produit obligatoire. "),r())}function bi(o,t){o&1&&(a(0,"small",79),u(1," Prix d'achat obligatoire pour ce type. "),r())}function hi(o,t){o&1&&(a(0,"small",79),u(1," Prix de vente obligatoire pour ce type. "),r())}function vi(o,t){o&1&&(a(0,"small",79),u(1,' Prix usine obligatoire pour "Fabricable". '),r())}function Pi(o,t){if(o&1){let e=h();a(0,"div",88)(1,"p-inputnumber",89),x("ngModelChange",function(n){c(e);let l=p();return P(l.product.prix_usine,n)||(l.product.prix_usine=n),m(n)}),r(),g(2,vi,2,0,"small",17),r()}if(o&2){let e=p();s(),v("ngModel",e.product.prix_usine),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)),s(),d("ngIf",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)&&e.isEditing)}}function xi(o,t){o&1&&(a(0,"div",90),f(1,"i",91),u(2," Pour un service, renseignez au moins un prix : achat ou vente. "),r())}function yi(o,t){o&1&&(a(0,"div",96),f(1,"i",97),a(2,"span",98),u(3,"Ajouter une image"),r(),a(4,"span",99),u(5,"Cliquez pour s\xE9lectionner"),r()())}function Ci(o,t){if(o&1){let e=h();a(0,"button",104),_("click",function(n){c(e);let l=p(4);return m(l.removeImage(n))}),f(1,"i",77),r()}}function wi(o,t){if(o&1&&(a(0,"div",100)(1,"div",101),f(2,"img",102),g(3,Ci,2,0,"button",103),r()()),o&2){let e=p(3);s(2),d("src",e.imagePreview||e.product.getImageUrl(),q),s(),d("ngIf",!e.fieldsDisabled)}}function Mi(o,t){if(o&1){let e=h();a(0,"div",93),_("click",function(){c(e),p();let n=A(2),l=p();return m(!l.fieldsDisabled&&n.advancedFileInput.nativeElement.click())}),g(1,yi,6,0,"div",94)(2,wi,4,2,"div",95),r()}if(o&2){let e=p(2);s(),d("ngIf",!e.imagePreview&&!e.product.image_url),s(),d("ngIf",e.imagePreview||e.product.image_url)}}function Si(o,t){if(o&1){let e=h();a(0,"div")(1,"p-fileUpload",92,2),_("onSelect",function(n){c(e);let l=p();return m(l.onUpload(n))}),g(3,Mi,3,2,"ng-template",null,1,S),r()()}if(o&2){let e=p();s(),d("customUpload",!0)("multiple",!1)("showUploadButton",!1)("showCancelButton",!1)("auto",!0)("disabled",e.fieldsDisabled)}}function Oi(o,t){if(o&1&&(a(0,"div",105),f(1,"img",102),r()),o&2){let e=p();s(),d("src",e.product.getImageUrl(),q)}}function Ei(o,t){o&1&&(a(0,"small",106),f(1,"i",107),u(2,"Le stock n'est pas g\xE9r\xE9 pour les services. "),r())}function ki(o,t){if(o&1){let e=h();a(0,"div",108)(1,"div",109)(2,"button",110),_("click",function(){c(e);let n=p();return m(n.onSubmit())}),r(),a(3,"button",111),_("click",function(){c(e);let n=p();return m(n.mode==="create"?n.onCancel():n.cancelEditing())}),r()()()}if(o&2){let e=p();s(2),d("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),s(),d("disabled",e.loading)}}var z=class o{buttonEl;mode="create";initialData=null;loading=!1;submitForm=new be;cancel=new be;submitted=!1;isEditing=!1;typeOptions=[{label:V.materiel,value:"materiel"},{label:V.service,value:"service"},{label:V.fabricable,value:"fabricable"},{label:V.achat_vente,value:"achat_vente"}];statutOptions=[{label:E.brouillon,value:"brouillon"},{label:E.actif,value:"actif"},{label:E.inactif,value:"inactif"},{label:E.rupture_stock,value:"rupture_stock"}];product=new y({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"actif",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null});selectedImageFile=null;imagePreview=null;ngOnInit(){this.initialData&&(this.product=new y(this.initialData),this.imagePreview=this.initialData.image_url),this.mode==="create"&&(this.isEditing=!0)}isPrixUsineVisible(){return this.product.type==="fabricable"}isPrixUsineRequired(){return this.product.type==="fabricable"}isPrixVenteRequired(){return["fabricable","achat_vente"].includes(this.product.type)}ngOnChanges(t){t.initialData?.currentValue&&(this.product=new y(t.initialData.currentValue),this.imagePreview=t.initialData.currentValue.image_url??null,this.mode==="edit"&&(this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null)),t.mode?.currentValue==="create"&&(this.isEditing=!0)}isPrixAchatRequired(){return["materiel","achat_vente"].includes(this.product.type)}isQteStockDisabled(){return this.product.type==="service"||this.fieldsDisabled}isValidPrice(t){return typeof t=="number"&&t>=0}isPriceMissing(t){return t==null}hasServicePrice(){return this.isValidPrice(this.product.prix_achat)||this.isValidPrice(this.product.prix_vente)}showServicePriceError(){return this.submitted&&this.isEditing&&this.product.type==="service"&&!this.hasServicePrice()}get isActifSwitch(){return this.product.statut==="actif"}onStatutToggleChange(t){this.product.statut=t?"actif":"inactif"}onTypeChange(){this.isPrixUsineVisible()||(this.product.prix_usine=null),this.product.type==="service"&&(this.product.qte_stock=0)}isValid(){return!(!this.product.nom?.trim()||!this.product.type||this.isPrixUsineRequired()&&!this.isValidPrice(this.product.prix_usine)||this.isPrixVenteRequired()&&!this.isValidPrice(this.product.prix_vente)||this.isPrixAchatRequired()&&!this.isValidPrice(this.product.prix_achat)||this.product.type==="service"&&!this.hasServicePrice())}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null,this.initialData?(this.product=new y(this.initialData),this.imagePreview=this.initialData.image_url):this.resetForm()}onUpload(t){if(t?.files?.length){let e=t.files[0];this.selectedImageFile=e;let i=new FileReader;i.onload=n=>this.imagePreview=n.target.result,i.readAsDataURL(e)}}removeImage(t){t.stopPropagation(),this.selectedImageFile=null,this.imagePreview=null,this.product.image_url=null}onSubmit(){if(this.submitted=!0,!this.isValid())return;let t={nom:this.product.nom.trim(),type:this.product.type,qte_stock:this.product.qte_stock,description:this.product.description?.trim()||void 0,cout:this.product.cout??void 0};t.statut=this.product.statut,this.product.prix_usine!==null&&(t.prix_usine=this.product.prix_usine),this.product.prix_vente!==null&&(t.prix_vente=this.product.prix_vente),this.product.prix_achat!==null&&(t.prix_achat=this.product.prix_achat),this.selectedImageFile&&(t.image=this.selectedImageFile),console.log("DTO:",t),this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}getPrixHelperText(){switch(this.product.type){case"materiel":return"Prix d'achat obligatoire";case"service":return"Pour un service, renseignez au moins un prix : achat ou vente";case"fabricable":return"Prix usine et prix de vente obligatoires";case"achat_vente":return"Prix d'achat et prix de vente obligatoires";default:return"S\xC3\xA9lectionnez un type de produit"}}resetForm(){this.submitted=!1,this.selectedImageFile=null,this.imagePreview=null,this.product=new y({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"actif",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-produits-form"]],viewQuery:function(e,i){if(e&1&&Y(Zt,5),e&2){let n;K(n=J())&&(i.buttonEl=n)}},inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[I([M]),Se],decls:112,vars:73,consts:[["mobileFileUploader",""],["content",""],["fileUploader",""],[1,"card","product-form"],[1,"mobile-form-container"],[1,"mobile-form-header"],["pButton","","pRipple","","icon","pi pi-arrow-left",1,"p-button-rounded","p-button-text","mobile-form-back",3,"click"],[1,"mobile-form-title-wrap"],[1,"mobile-form-title"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-rounded p-button-text mobile-form-edit",3,"click",4,"ngIf"],[1,"mobile-image-card"],[4,"ngIf"],["class","mobile-upload-preview",4,"ngIf"],["class","mobile-upload-placeholder",4,"ngIf"],[1,"mobile-section-card"],[1,"mobile-field-label"],["pInputText","","type","text","placeholder","Nom du produit","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],["class","text-red-500",4,"ngIf"],[1,"mobile-price-grid"],[1,"mobile-price-item"],[1,"mobile-price-label"],["mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","min","disabled"],["class","mobile-price-item",4,"ngIf"],["class","mobile-service-alert",4,"ngIf"],[1,"mobile-meta-row"],[1,"mobile-meta-field"],["placeholder","Type","fluid","",3,"ngModelChange","onChange","options","ngModel","disabled"],["placeholder","0","fluid","",3,"ngModelChange","ngModel","showButtons","min","disabled"],["class","mobile-info-hint",4,"ngIf"],[1,"mobile-section-card","mobile-status-row"],[1,"mobile-status-label"],[1,"mobile-status-value"],[1,"ml-auto",3,"ngModelChange","ngModel","disabled"],["class","mobile-bottom-actions",4,"ngIf"],[1,"desktop-form-container"],[1,"flex","justify-between","items-start","gap-4","mb-8","form-header"],[1,"block","text-surface-900","dark:text-surface-0","font-bold","text-2xl"],[1,"text-surface-500","dark:text-surface-300"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-6","flex-wrap"],[1,"col-span-12","lg:col-span-8"],[1,"form-section","mb-6"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","mt-2"],["id","nom","pInputText","","type","text","placeholder","Nom du produit","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],[1,"col-span-12","mt-4"],[1,"col-span-12","lg:col-span-4"],["inputId","prix_achat","mode","currency","currency","GNF","locale","fr-GN","placeholder","prix d'achat","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["inputId","prix_vente","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix de vente","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["inputId","cout","mode","currency","currency","GNF","locale","fr-GN","placeholder","co\xFBt","fluid","",3,"ngModelChange","ngModel","min","disabled"],["class","col-span-12 lg:col-span-4 mt-4",4,"ngIf"],["class","col-span-12 service-alert",4,"ngIf"],[1,"form-section"],[1,"section-title"],[1,"pi","pi-image","mr-2"],["class","flex justify-center mt-2",4,"ngIf"],[1,"col-span-12","lg:col-span-4","flex","flex-col","gap-y-4","mt-7"],[1,"border","border-surface-200","dark:border-surface-700","rounded"],[1,"text-surface-900","dark:text-surface-0","font-bold","block","border-b","border-surface-200","dark:border-surface-700","p-4"],[1,"p-4"],[1,"bg-surface-100","dark:bg-surface-700","py-2","px-4","flex","items-center","rounded"],[1,"text-black/90","dark:text-surface-0!","font-bold","mr-4"],[1,"text-black/60","dark:text-surface-0!","font-semibold"],["placeholder","S\xE9lectionner un type",3,"ngModelChange","onChange","options","ngModel","disabled"],["class","text-gray-500 block mt-2 mb-2 ml-4",4,"ngIf"],[1,"sticky","top-6","flex","flex-col","gap-4"],["class","form-section p-4",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-rounded","p-button-text","mobile-form-edit",3,"click"],["name","image","accept","image/*","styleClass","mobile-uploader",3,"onSelect","customUpload","multiple","showUploadButton","showCancelButton","auto","disabled"],[1,"mobile-upload-zone",3,"click"],[1,"mobile-upload-placeholder"],[1,"pi","pi-camera"],[1,"mobile-upload-preview"],["alt","Image du produit",3,"src"],["pButton","","pRipple","","rounded","","type","button","severity","danger","class","mobile-remove-img",3,"click",4,"ngIf"],["pButton","","pRipple","","rounded","","type","button","severity","danger",1,"mobile-remove-img",3,"click"],[1,"pi","pi-times"],[1,"pi","pi-image"],[1,"text-red-500"],[1,"mobile-service-alert"],[1,"pi","pi-exclamation-circle"],[1,"mobile-info-hint"],[1,"pi","pi-info-circle"],[1,"mobile-bottom-actions"],["pButton","","pRipple","","icon","pi pi-check",1,"mobile-btn-save",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"mobile-btn-cancel",3,"click","disabled"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn",1,"w-auto",3,"click"],[1,"col-span-12","lg:col-span-4","mt-4"],["inputId","prix_usine","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix usine","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],[1,"col-span-12","service-alert"],[1,"pi","pi-exclamation-circle","mr-2"],["name","image","accept","image/*","styleClass","product-uploader border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 p-0 rounded-lg",3,"onSelect","customUpload","multiple","showUploadButton","showCancelButton","auto","disabled"],[1,"w-full","py-4","upload-dropzone",3,"click"],["class","h-48 flex flex-col justify-center items-center",4,"ngIf"],["class","relative w-full flex justify-center py-3",4,"ngIf"],[1,"h-48","flex","flex-col","justify-center","items-center"],[1,"pi","pi-image","text-primary","text-4xl","mb-4"],[1,"block","font-semibold","text-surface-900","dark:text-surface-0","text-lg"],[1,"text-surface-500","text-sm","mt-1"],[1,"relative","w-full","flex","justify-center","py-3"],[1,"relative"],["alt","Image du produit",1,"max-h-72","rounded","shadow","object-contain",3,"src"],["pButton","","pRipple","","rounded","","type","button","severity","danger","class","absolute -top-2 -right-2",3,"click",4,"ngIf"],["pButton","","pRipple","","rounded","","type","button","severity","danger",1,"absolute","-top-2","-right-2",3,"click"],[1,"flex","justify-center","mt-2"],[1,"text-gray-500","block","mt-2","mb-2","ml-4"],[1,"pi","pi-info-circle","mr-1"],[1,"form-section","p-4"],[1,"flex","gap-3"],["pButton","","pRipple","","icon","pi pi-check",1,"flex-1",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"flex-1",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",3)(1,"div",4)(2,"header",5)(3,"button",6),_("click",function(){return i.onCancel()}),r(),a(4,"div",7)(5,"h1",8),u(6),r()(),g(7,$t,1,0,"button",9),r(),a(8,"div",10),g(9,ni,5,6,"div",11)(10,oi,2,1,"div",12)(11,ai,4,0,"div",13),r(),a(12,"div",14)(13,"label",15),u(14,"Nom du produit"),r(),a(15,"input",16),x("ngModelChange",function(l){return P(i.product.nom,l)||(i.product.nom=l),l}),r(),g(16,li,2,0,"small",17),r(),a(17,"div",14)(18,"label",15),u(19,"Prix"),r(),a(20,"div",18)(21,"div",19)(22,"span",20),u(23,"Achat"),r(),a(24,"p-inputnumber",21),x("ngModelChange",function(l){return P(i.product.prix_achat,l)||(i.product.prix_achat=l),l}),r(),g(25,si,2,0,"small",17),r(),a(26,"div",19)(27,"span",20),u(28,"Vente"),r(),a(29,"p-inputnumber",21),x("ngModelChange",function(l){return P(i.product.prix_vente,l)||(i.product.prix_vente=l),l}),r(),g(30,di,2,0,"small",17),r(),a(31,"div",19)(32,"span",20),u(33,"Co\xFBt"),r(),a(34,"p-inputnumber",22),x("ngModelChange",function(l){return P(i.product.cout,l)||(i.product.cout=l),l}),r()(),g(35,ui,5,5,"div",23),r(),g(36,ci,3,0,"div",24),r(),a(37,"div",14)(38,"div",25)(39,"div",26)(40,"label",15),u(41,"Type"),r(),a(42,"p-select",27),x("ngModelChange",function(l){return P(i.product.type,l)||(i.product.type=l),l}),_("onChange",function(){return i.onTypeChange()}),r()(),a(43,"div",26)(44,"label",15),u(45,"Stock"),r(),a(46,"p-inputnumber",28),x("ngModelChange",function(l){return P(i.product.qte_stock,l)||(i.product.qte_stock=l),l}),r()()(),g(47,mi,3,0,"small",29),r(),a(48,"div",30)(49,"span",31),u(50,"Status"),r(),a(51,"span",32),u(52),r(),a(53,"p-toggleswitch",33),_("ngModelChange",function(l){return i.onStatutToggleChange(l)}),r()(),g(54,gi,3,4,"div",34),r(),a(55,"div",35)(56,"div",36)(57,"div")(58,"span",37),u(59),r(),a(60,"small",38),u(61," Renseignez les informations principales, les prix et le statut de publication. "),r()(),g(62,_i,1,0,"button",39),r(),a(63,"p-fluid",40)(64,"div",41)(65,"div",42)(66,"div",43)(67,"div",44)(68,"input",45),x("ngModelChange",function(l){return P(i.product.nom,l)||(i.product.nom=l),l}),r(),g(69,fi,2,0,"small",17),r(),a(70,"div",46)(71,"div",43)(72,"div",47)(73,"p-inputnumber",48),x("ngModelChange",function(l){return P(i.product.prix_achat,l)||(i.product.prix_achat=l),l}),r(),g(74,bi,2,0,"small",17),r(),a(75,"div",47)(76,"p-inputnumber",49),x("ngModelChange",function(l){return P(i.product.prix_vente,l)||(i.product.prix_vente=l),l}),r(),g(77,hi,2,0,"small",17),r(),a(78,"div",47)(79,"p-inputnumber",50),x("ngModelChange",function(l){return P(i.product.cout,l)||(i.product.cout=l),l}),r()()()(),g(80,Pi,3,5,"div",51)(81,xi,3,0,"div",52),r()(),a(82,"div",53)(83,"div",54),f(84,"i",55),u(85," Visuel du produit "),r(),g(86,Si,5,6,"div",11)(87,Oi,2,1,"div",56),r()(),a(88,"div",57)(89,"div",58)(90,"span",59),u(91,"Etat du produit"),r(),a(92,"div",60)(93,"div",61)(94,"span",62),u(95,"Status:"),r(),a(96,"span",63),u(97),r(),a(98,"p-toggleswitch",33),_("ngModelChange",function(l){return i.onStatutToggleChange(l)}),r()()()(),a(99,"div",58)(100,"span",59),u(101,"Type"),r(),a(102,"div",60)(103,"p-select",64),x("ngModelChange",function(l){return P(i.product.type,l)||(i.product.type=l),l}),_("onChange",function(){return i.onTypeChange()}),r()()(),a(104,"div",58)(105,"span",59),u(106,"Quantit\xE9 en stock"),r(),a(107,"div",60)(108,"p-inputnumber",28),x("ngModelChange",function(l){return P(i.product.qte_stock,l)||(i.product.qte_stock=l),l}),r()(),g(109,Ei,3,0,"small",65),r(),a(110,"div",66),g(111,ki,4,4,"div",67),r()()()()()),e&2&&(s(6),ve(" ",i.mode==="create"?"Nouveau produit":"D\xE9tails du produit"," "),s(),d("ngIf",i.mode==="edit"&&!i.isEditing),s(2),d("ngIf",i.isEditing),s(),d("ngIf",!i.isEditing&&i.product.image_url),s(),d("ngIf",!i.isEditing&&!i.product.image_url),s(4),v("ngModel",i.product.nom),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())),s(),d("ngIf",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())&&i.isEditing),s(8),v("ngModel",i.product.prix_achat),d("min",0)("disabled",i.fieldsDisabled)("invalid",i.submitted&&i.isPrixAchatRequired()&&i.isPriceMissing(i.product.prix_achat)),s(),d("ngIf",i.submitted&&i.isPrixAchatRequired()&&i.isPriceMissing(i.product.prix_achat)&&i.isEditing),s(4),v("ngModel",i.product.prix_vente),d("min",0)("disabled",i.fieldsDisabled)("invalid",i.submitted&&i.isPrixVenteRequired()&&i.isPriceMissing(i.product.prix_vente)),s(),d("ngIf",i.submitted&&i.isPrixVenteRequired()&&i.isPriceMissing(i.product.prix_vente)&&i.isEditing),s(4),v("ngModel",i.product.cout),d("min",0)("disabled",i.fieldsDisabled),s(),d("ngIf",i.isPrixUsineVisible()),s(),d("ngIf",i.showServicePriceError()),s(6),d("options",i.typeOptions),v("ngModel",i.product.type),d("disabled",i.fieldsDisabled),s(4),v("ngModel",i.product.qte_stock),d("showButtons",!0)("min",0)("disabled",i.isQteStockDisabled()),s(),d("ngIf",i.product.type==="service"),s(4),Oe("active",i.isActifSwitch),s(),O(i.isActifSwitch?"Actif":"Inactif"),s(),d("ngModel",i.isActifSwitch)("disabled",i.fieldsDisabled),s(),d("ngIf",i.isEditing),s(5),ve(" ",i.mode==="create"?"Cr\xE9er un produit":"D\xE9tails du produit"," "),s(3),d("ngIf",i.mode==="edit"&&!i.isEditing),s(6),v("ngModel",i.product.nom),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())),s(),d("ngIf",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())&&i.isEditing),s(4),v("ngModel",i.product.prix_achat),d("min",0)("disabled",i.fieldsDisabled)("invalid",i.submitted&&i.isPrixAchatRequired()&&i.isPriceMissing(i.product.prix_achat)),s(),d("ngIf",i.submitted&&i.isPrixAchatRequired()&&i.isPriceMissing(i.product.prix_achat)&&i.isEditing),s(2),v("ngModel",i.product.prix_vente),d("min",0)("disabled",i.fieldsDisabled)("invalid",i.submitted&&i.isPrixVenteRequired()&&i.isPriceMissing(i.product.prix_vente)),s(),d("ngIf",i.submitted&&i.isPrixVenteRequired()&&i.isPriceMissing(i.product.prix_vente)&&i.isEditing),s(2),v("ngModel",i.product.cout),d("min",0)("disabled",i.fieldsDisabled),s(),d("ngIf",i.isPrixUsineVisible()),s(),d("ngIf",i.showServicePriceError()),s(5),d("ngIf",i.isEditing),s(),d("ngIf",!i.isEditing&&i.product.image_url),s(10),O(i.isActifSwitch?"Actif":"Inactif"),s(),d("ngModel",i.isActifSwitch)("disabled",i.fieldsDisabled),s(5),d("options",i.typeOptions),v("ngModel",i.product.type),d("disabled",i.fieldsDisabled),s(5),v("ngModel",i.product.qte_stock),d("showButtons",!0)("min",0)("disabled",i.isQteStockDisabled()),s(),d("ngIf",i.product.type==="service"),s(2),d("ngIf",i.isEditing))},dependencies:[F,B,mt,re,ie,te,Z,$,ee,ut,pt,le,ae,de,se,Ge,je,oe,ne,ct,De,Ve,ue,pe],styles:[".product-form[_ngcontent-%COMP%]   .mobile-form-container[_ngcontent-%COMP%]{display:none}.product-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--surface-200);padding-bottom:1rem}.product-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]{border:1px solid var(--surface-200);border-radius:.875rem;background:var(--surface-0);padding:1.25rem}.product-form[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-bottom:1rem;font-weight:700;color:var(--text-color)}.product-form[_ngcontent-%COMP%]   .side-title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-color);padding:1rem 1rem .875rem;border-bottom:1px solid var(--surface-200);background:color-mix(in srgb,var(--surface-50) 70%,transparent)}.product-form[_ngcontent-%COMP%]   .helper-chip[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--blue-100) 50%,transparent);border-radius:999px;padding:.35rem .7rem;font-weight:500}.product-form[_ngcontent-%COMP%]   .status-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-size:.8rem;font-weight:700;border-radius:999px;padding:.2rem .6rem}.product-form[_ngcontent-%COMP%]   .status-pill-active[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.product-form[_ngcontent-%COMP%]   .status-pill-inactive[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.product-form[_ngcontent-%COMP%]   .service-alert[_ngcontent-%COMP%]{display:flex;align-items:center;color:#991b1b;background:#fef2f2;border:1px solid #fecaca;border-radius:.5rem;padding:.65rem .8rem;font-size:.9rem}.product-form[_ngcontent-%COMP%]   .upload-dropzone[_ngcontent-%COMP%]{cursor:pointer;border-radius:.75rem;transition:background-color .2s ease}.product-form[_ngcontent-%COMP%]   .upload-dropzone[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary-50) 35%,transparent)}@media screen and (max-width: 768px){.product-form[_ngcontent-%COMP%]{border:0!important;border-radius:0!important;box-shadow:none!important;background:#f8f9fc!important;margin:-.5rem -.875rem calc(-.5rem - env(safe-area-inset-bottom));padding:0;min-height:100dvh}.product-form[_ngcontent-%COMP%]   .mobile-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:calc(.75rem + env(safe-area-inset-top)) 1rem calc(5.5rem + env(safe-area-inset-bottom));animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.product-form[_ngcontent-%COMP%]   .desktop-form-container[_ngcontent-%COMP%]{display:none!important}.product-form[_ngcontent-%COMP%]   .mobile-form-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding-bottom:.25rem}.product-form[_ngcontent-%COMP%]   .mobile-form-back[_ngcontent-%COMP%], .product-form[_ngcontent-%COMP%]   .mobile-form-edit[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:999px;flex-shrink:0;color:#1e293b!important;background:transparent!important;border:0!important;box-shadow:none!important}.product-form[_ngcontent-%COMP%]   .mobile-form-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0}.product-form[_ngcontent-%COMP%]   .mobile-form-title[_ngcontent-%COMP%]{margin:0;font-size:1.15rem;font-weight:700;color:#1e293b;letter-spacing:-.01em}.product-form[_ngcontent-%COMP%]   .mobile-image-card[_ngcontent-%COMP%]{background:#fff;border-radius:1rem;overflow:hidden;box-shadow:0 1px 3px #0000000f,0 4px 12px #0000000a}.product-form   [_nghost-%COMP%]     .mobile-uploader{border:0!important;background:transparent!important;box-shadow:none!important}.product-form   [_nghost-%COMP%]     .mobile-uploader .p-fileupload-header{display:none}.product-form   [_nghost-%COMP%]     .mobile-uploader .p-fileupload-file-list{display:none}.product-form   [_nghost-%COMP%]     .mobile-uploader .p-fileupload-content{padding:0;border:0;min-height:auto;height:auto!important}.product-form[_ngcontent-%COMP%]   .mobile-upload-zone[_ngcontent-%COMP%]{cursor:pointer;min-height:11rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:11rem;color:#94a3b8;gap:.5rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#cbd5e1}.product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600}.product-form[_ngcontent-%COMP%]   .mobile-upload-preview[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;padding:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:12rem;width:auto;border-radius:.75rem;object-fit:contain}.product-form[_ngcontent-%COMP%]   .mobile-remove-img[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem;width:1.75rem!important;height:1.75rem!important;border-radius:999px!important}.product-form[_ngcontent-%COMP%]   .mobile-remove-img[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.7rem}.product-form[_ngcontent-%COMP%]   .mobile-section-card[_ngcontent-%COMP%]{background:#fff;border-radius:1rem;padding:1rem;box-shadow:0 1px 3px #0000000f,0 4px 12px #0000000a}.product-form[_ngcontent-%COMP%]   .mobile-field-label[_ngcontent-%COMP%]{display:block;font-size:.7rem;font-weight:700;color:#94a3b8;text-transform:uppercase;letter-spacing:.06em;margin-bottom:.5rem}.product-form[_ngcontent-%COMP%]   .mobile-price-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-price-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.product-form[_ngcontent-%COMP%]   .mobile-price-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:#64748b}.product-form[_ngcontent-%COMP%]   .mobile-service-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.35rem;margin-top:.6rem;padding:.5rem .65rem;background:#fef2f2;border:1px solid #fecaca;border-radius:.65rem;font-size:.8rem;color:#991b1b}.product-form[_ngcontent-%COMP%]   .mobile-meta-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-meta-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.product-form[_ngcontent-%COMP%]   .mobile-info-hint[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;margin-top:.5rem;font-size:.75rem;color:#94a3b8;font-weight:500}.product-form[_ngcontent-%COMP%]   .mobile-status-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.product-form[_ngcontent-%COMP%]   .mobile-status-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700;color:#334155}.product-form[_ngcontent-%COMP%]   .mobile-status-value[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:#94a3b8}.product-form[_ngcontent-%COMP%]   .mobile-status-value.active[_ngcontent-%COMP%]{color:#16a34a}.product-form   [_nghost-%COMP%]     .p-inputtext, .product-form   [_nghost-%COMP%]     .p-inputnumber-input, .product-form   [_nghost-%COMP%]     .p-select-label{font-size:16px!important;min-height:2.65rem}.product-form[_ngcontent-%COMP%]   .mobile-bottom-actions[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;z-index:50;display:flex;gap:.5rem;padding:.75rem 1rem calc(.75rem + env(safe-area-inset-bottom));background:#ffffffeb;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1px solid #e2e8f0}.product-form[_ngcontent-%COMP%]   .mobile-btn-save[_ngcontent-%COMP%]{flex:1;border-radius:.75rem!important;font-weight:700!important;min-height:2.75rem}.product-form[_ngcontent-%COMP%]   .mobile-btn-cancel[_ngcontent-%COMP%]{flex:0 0 auto;border-radius:.75rem!important;font-weight:600!important;min-height:2.75rem}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}","[_nghost-%COMP%]     .p-fileupload-header{display:none}[_nghost-%COMP%]     .p-fileupload-file-list{display:none}[_nghost-%COMP%]     .p-fileupload-content{height:20rem}"]})};var ge=class o{constructor(t,e,i,n){this.router=t;this.messageService=e;this.produitService=i;this.document=n}loading=!1;mobileBreakpoint=768;mobilePwaClass="produits-mobile-pwa";ngOnInit(){this.updateMobilePwaMode()}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onResize(){this.updateMobilePwaMode()}updateMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}onSubmitForm(t){this.loading=!0,this.produitService.create(t).subscribe({next:e=>this.handleSuccess("Produit cr\xE9\xE9 avec succ\xE8s",e),error:e=>this.handleError("Erreur lors de la cr\xE9ation du produit",e)})}onCancel(){this.router.navigate(["/produits"])}handleSuccess(t,e){if(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t,life:2e3}),this.loading=!1,e?.id){this.router.navigate(["/produits/produits-edit",e.id]);return}this.router.navigate(["/produits"])}handleError(t,e){let i=e?.error?.message||t;e?.status===422&&e?.error?.errors?Object.values(e.error.errors).flat().forEach(l=>{this.messageService.add({severity:"error",summary:i,detail:l,life:5e3})}):this.messageService.add({severity:"error",summary:"Erreur",detail:i,life:5e3}),this.loading=!1,console.error(e)}static \u0275fac=function(e){return new(e||o)(C(U),C(M),C(k),C(L))};static \u0275cmp=T({type:o,selectors:[["app-produits-new"]],hostBindings:function(e,i){e&1&&_("resize",function(){return i.onResize()},R)},features:[I([M])],decls:2,vars:1,consts:[["mode","create",3,"submitForm","cancel","loading"]],template:function(e,i){e&1&&(f(0,"p-toast"),a(1,"app-produits-form",0),_("submitForm",function(l){return i.onSubmitForm(l)})("cancel",function(){return i.onCancel()}),r()),e&2&&(s(),d("loading",i.loading))},dependencies:[F,z,N,W],encapsulation:2})};function Ti(o,t){if(o&1){let e=h();a(0,"app-produits-form",1),_("submitForm",function(n){c(e);let l=p();return m(l.onSubmitForm(n))})("cancel",function(){c(e);let n=p();return m(n.onCancel())}),r()}if(o&2){let e=p();d("initialData",e.initialData)("loading",e.loading)}}var _e=class o{constructor(t,e,i,n,l){this.route=t;this.router=e;this.produitService=i;this.messageService=n;this.document=l}loading=!1;produitId=null;initialData=null;mobileBreakpoint=768;mobilePwaClass="produits-mobile-pwa";ngOnInit(){this.updateMobilePwaMode();let t=this.route.snapshot.paramMap.get("id"),e=t?Number(t):NaN;if(!Number.isFinite(e)||e<=0){this.router.navigate(["/produits"]);return}this.produitId=e,this.loadProduit(e)}onSubmitForm(t){this.produitId&&(this.loading=!0,this.produitService.update(this.produitId,t).subscribe({next:e=>{this.initialData=e,this.loading=!1,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Produit modifi\xE9 avec succ\xE8s",life:3e3})},error:e=>{this.loading=!1,this.showApiError(e,"Erreur lors de la modification du produit")}}))}onCancel(){this.router.navigate(["/produits"])}loadProduit(t){this.loading=!0,this.produitService.getById(t).subscribe({next:e=>{this.initialData=e,this.loading=!1},error:e=>{this.loading=!1,this.showApiError(e,"Erreur lors du chargement du produit")}})}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onResize(){this.updateMobilePwaMode()}updateMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}showApiError(t,e){let i=t?.error?.message||e;this.messageService.add({severity:"error",summary:"Erreur",detail:i,life:5e3})}static \u0275fac=function(e){return new(e||o)(C(Ie),C(U),C(k),C(M),C(L))};static \u0275cmp=T({type:o,selectors:[["app-produits-edit"]],hostBindings:function(e,i){e&1&&_("resize",function(){return i.onResize()},R)},features:[I([M])],decls:2,vars:1,consts:[["mode","edit",3,"initialData","loading","submitForm","cancel",4,"ngIf"],["mode","edit",3,"submitForm","cancel","initialData","loading"]],template:function(e,i){e&1&&(f(0,"p-toast"),g(1,Ti,1,2,"app-produits-form",0)),e&2&&(s(),d("ngIf",i.initialData))},dependencies:[F,B,z,N,W],encapsulation:2})};var Mn=[{path:"",component:H,canActivate:[G],data:{permissions:["produits.read"]}},{path:"produits",component:H,canActivate:[G],data:{permissions:["produits.read"]}},{path:"produits-new",component:ge,canActivate:[G],data:{permissions:["produits.create"]}},{path:"produits-edit/:id",component:_e,canActivate:[G],data:{permissions:["produits.update"]}},{path:"**",redirectTo:"/notfound"}];export{Mn as default};
