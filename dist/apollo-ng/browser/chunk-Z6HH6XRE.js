import{b as bt}from"./chunk-FIRJDGKN.js";import{a as Ke,b as Xe}from"./chunk-THODNM2F.js";import{a as me,b as ge}from"./chunk-UYHYJYGE.js";import{a as gt,b as _t}from"./chunk-RMUQ5QFN.js";import"./chunk-DHNGRSPN.js";import"./chunk-C7PWX4PE.js";import{b as ft}from"./chunk-KLTWHGHO.js";import{a as nt,b as ot}from"./chunk-IVABBIHU.js";import{a as ut,b as mt}from"./chunk-O5L43C6R.js";import{a as pt,b as ct}from"./chunk-KMRV2N6M.js";import{a as at,b as lt}from"./chunk-H4KISS4Y.js";import{a as Ze,d as $e,e as et,h as tt,i as it,k as rt}from"./chunk-FAOFKJXD.js";import"./chunk-3QIGOFE4.js";import"./chunk-VY5FRMVP.js";import"./chunk-VA5GRZBG.js";import"./chunk-OXRSOWZ3.js";import{b as be,c as he}from"./chunk-SXELAHNQ.js";import"./chunk-FI2CF337.js";import{a as st,b as dt}from"./chunk-VSQCQ24J.js";import"./chunk-V7GDW42M.js";import"./chunk-STL3P7XI.js";import"./chunk-KNGMUWFG.js";import"./chunk-OTOT72YN.js";import"./chunk-6U2WNUGO.js";import{a as j,b as q}from"./chunk-HF32A2CA.js";import"./chunk-FTQB7FTX.js";import"./chunk-44T26ZS7.js";import{a as H}from"./chunk-PH5LLDEG.js";import{a as Ye,b as Je}from"./chunk-AYOHQ7P3.js";import"./chunk-YMFRS67F.js";import"./chunk-IFIPOOEL.js";import"./chunk-4TQIXGP4.js";import{b as te,d as z}from"./chunk-VQUDGCBD.js";import"./chunk-S2XX7DX2.js";import{a as Oe,d as Ae}from"./chunk-NORXBCZV.js";import{c as ce,d as Ne,e as ue}from"./chunk-T3MKQJWS.js";import"./chunk-4FGKRRQA.js";import{c as _e,d as fe}from"./chunk-R3ZMZYQP.js";import"./chunk-XSJCRAZB.js";import"./chunk-GYVBNXO5.js";import"./chunk-OSUQ7URW.js";import"./chunk-VWZJRGWP.js";import"./chunk-7N4JNZOK.js";import{a as ze,b as je,c as qe,d as Ge}from"./chunk-2HOTGEAR.js";import{a as le,b as se}from"./chunk-AZ5YUZOD.js";import{b as re,e as ne,h as oe,n as We,p as ae}from"./chunk-M7MSZX5F.js";import{a as He,b as Qe}from"./chunk-NNASGCWH.js";import"./chunk-WQPC23GX.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as de,j as pe}from"./chunk-RUBANO5L.js";import{a as Ue,b as Be}from"./chunk-F23BEZGE.js";import{la as ie,pa as w}from"./chunk-LL554BBV.js";import{j as Re,k as N,v as L}from"./chunk-4WY7URSD.js";import"./chunk-4O3FVBGX.js";import{$b as c,Ab as n,Bb as b,C as Te,F as Ie,Ib as h,Ka as I,Ma as W,Mb as g,N as Fe,Nb as p,Oa as s,Rb as K,S as Ve,Sb as X,Ta as J,Tb as Z,W as De,Wb as U,Yb as $,Za as y,Zb as we,aa as u,ac as S,ba as m,bc as V,cb as F,cc as ee,ec as v,f as Me,fa as A,fc as P,gc as C,ib as _,ic as D,jc as B,na as Le,o as M,u as Ee,xc as O,yb as d,zb as a}from"./chunk-VV6362ZN.js";import{a as k,b as Y,c as ye}from"./chunk-GAL4ENT6.js";var R={materiel:"Mat\xE9riel",service:"Service",fabricable:"Fabricable",achat_vente:"Achat/Vente"},E={brouillon:"Brouillon",actif:"Actif",inactif:"Inactif",archive:"Archiv\xE9",rupture_stock:"Rupture de stock"},ve={brouillon:"secondary",actif:"success",inactif:"danger",archive:"danger",rupture_stock:"warn"};var x=class r{id=0;nom="";code="";prix_usine=null;prix_vente=null;prix_achat=null;qte_stock=0;cout=null;statut="brouillon";type="materiel";in_stock=!0;is_archived=!1;archived_at=null;description=null;image_url=null;created_by=null;updated_by=null;deleted_by=null;archived_by=null;created_at="";updated_at="";deleted_at=null;creator;updater;archiver;deleter;created_by_name;updated_by_name;archived_by_name;deleted_by_name;constructor(t){t&&Object.assign(this,t)}getImageUrl(t="assets/demo/images/no-product.png"){return this.image_url?this.image_url.startsWith("http://")||this.image_url.startsWith("https://")?this.image_url:`assets/demo/images/produits/${this.image_url}`:t}formatPrix(t,e="GNF"){return`${(typeof t=="number"?t:0).toLocaleString("fr-FR")} ${e}`}static fromApi(t){return new r(Y(k({},t),{prix_usine:t?.prix_usine!==null&&t?.prix_usine!==void 0?Number(t.prix_usine):null,prix_vente:t?.prix_vente!==null&&t?.prix_vente!==void 0?Number(t.prix_vente):null,prix_achat:t?.prix_achat!==null&&t?.prix_achat!==void 0?Number(t.prix_achat):null,cout:t?.cout!==null&&t?.cout!==void 0?Number(t.cout):null}))}static fromApiArray(t){return t.map(e=>r.fromApi(e))}};var T=class r{constructor(t){this.http=t}apiUrl=`${Ye.apiUrl}/produits`;getAll(){return this.http.get(this.apiUrl).pipe(M(t=>x.fromApiArray(t.data)))}getAllFiltered(t={}){let e=new Oe;return t.statut&&(e=e.set("statut",t.statut)),t.type&&(e=e.set("type",t.type)),t.in_stock!==null&&t.in_stock!==void 0&&(e=e.set("in_stock",String(t.in_stock))),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),this.http.get(this.apiUrl,{params:e}).pipe(M(i=>x.fromApiArray(i.data)))}getArchived(){return this.http.get(`${this.apiUrl}/archived`).pipe(M(t=>x.fromApiArray(t.data)))}search(t){let e=new Oe;return t.search&&(e=e.set("search",t.search)),t.type&&(e=e.set("type",t.type)),t.statut&&(e=e.set("statut",t.statut)),t.in_stock!==void 0&&(e=e.set("in_stock",t.in_stock.toString())),t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),this.http.get(`${this.apiUrl}/search`,{params:e}).pipe(M(i=>x.fromApiArray(i.data.produits)))}getStatistics(){return this.http.get(`${this.apiUrl}/statistics`).pipe(M(t=>t.data))}getById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(M(e=>x.fromApi(e.data)))}create(t){let o=t,{image:e}=o,i=ye(o,["image"]);return this.http.post(this.apiUrl,i).pipe(M(l=>x.fromApi(l.data)))}update(t,e){let l=e,{image:i}=l,o=ye(l,["image"]);return this.http.put(`${this.apiUrl}/${t}`,o).pipe(M(f=>x.fromApi(f.data)))}uploadProduitImage(t,e){let i=new FormData;return i.append("image",e,e.name),this.http.post(`${this.apiUrl}/${t}/image`,i).pipe(M(o=>x.fromApi(o.data)))}deleteProduitImage(t){return this.http.delete(`${this.apiUrl}/${t}/image`).pipe(M(e=>x.fromApi(e.data)))}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}updateStock(t,e){return this.http.patch(`${this.apiUrl}/${t}/stock`,e).pipe(M(i=>x.fromApi(i.data)))}changeStatus(t,e){return this.http.patch(`${this.apiUrl}/${t}/status`,e).pipe(M(i=>x.fromApi(i.data)))}archive(t){return this.http.patch(`${this.apiUrl}/${t}/archive`,{}).pipe(M(e=>x.fromApi(e.data)))}unarchive(t){return this.http.patch(`${this.apiUrl}/${t}/unarchive`,{}).pipe(M(e=>x.fromApi(e.data)))}static \u0275fac=function(e){return new(e||r)(De(Ae))};static \u0275prov=Ve({token:r,factory:r.\u0275fac,providedIn:"root"})};var Et=["dt"],Tt=()=>({"min-width":"75rem"}),It=()=>[10,20,30],Ft=()=>({width:"720px",maxWidth:"95vw"}),Vt=()=>({width:"450px"}),Dt=()=>({showDelay:800});function Lt(r,t){if(r&1&&(a(0,"span",47),c(1),n()),r&2){let e=p();s(),S(e.activeFiltersCount)}}function Rt(r,t){if(r&1&&b(0,"img",64),r&2){let e=p().$implicit;d("src",e.getImageUrl(),I)("alt",e.nom)}}function At(r,t){r&1&&(a(0,"div",65),b(1,"i",66),n())}function Wt(r,t){if(r&1){let e=h();a(0,"article",50),g("click",function(o){let l=u(e).$implicit,f=p(2);return m(f.goToEditProduit(o,l.id))}),a(1,"div",51),_(2,Rt,1,2,"img",52)(3,At,2,0,"div",53),n(),a(4,"div",54)(5,"div",55)(6,"div",56)(7,"div",57),c(8),n(),a(9,"div",58),c(10),n()(),b(11,"p-tag",59),n(),a(12,"div",60)(13,"span",61),c(14),n(),a(15,"div",62)(16,"button",63),g("click",function(o){let l=u(e).$implicit,f=p(2);return m(f.goToEditProduit(o,l.id))}),n()()()()()}if(r&2){let e=t.$implicit,i=p(2);s(2),d("ngIf",e.image_url),s(),d("ngIf",!e.image_url),s(5),S(e.code||"Sans code"),s(2),S(e.nom),s(),d("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),s(3),ee("",e.qte_stock," en stock \xB7 ",i.formatCurrency(e.prix_vente)),s(2),d("disabled",!i.canUpdate)}}function Ut(r,t){if(r&1&&(a(0,"section",48),_(1,Wt,17,9,"article",49),n()),r&2){let e=p();s(),d("ngForOf",e.mobileVisibleProduits)("ngForTrackBy",e.trackByProduitId)}}function Bt(r,t){r&1&&(a(0,"div",68),c(1,"Chargement des produits..."),n())}function Nt(r,t){if(r&1&&(a(0,"div",68),b(1,"i",69),c(2),n()),r&2){let e=p(2);s(2),V(" Aucun produit",e.activeFiltersCount>0?" pour ces filtres":" trouv\xE9",". ")}}function zt(r,t){if(r&1&&_(0,Bt,2,0,"div",67)(1,Nt,3,1,"div",67),r&2){let e=p();d("ngIf",e.loading),s(),d("ngIf",!e.loading&&!e.produits.length)}}function jt(r,t){if(r&1){let e=h();a(0,"div",70)(1,"p-button",71),g("onClick",function(){u(e);let o=p();return m(o.loadMoreMobile())}),n()()}}function qt(r,t){if(r&1){let e=h();a(0,"button",72),g("click",function(){u(e);let o=p();return m(o.goToNewProduits())}),b(1,"i",73),a(2,"span",74),c(3,"Nouveau produit"),n()()}}function Gt(r,t){if(r&1){let e=h();a(0,"div",75)(1,"p-button",76),g("onClick",function(){u(e);let o=p();return m(o.resetMobileFiltersTemp())}),n(),a(2,"p-button",77),g("onClick",function(){u(e);let o=p();return m(o.applyMobileFilters())}),n()()}r&2&&(s(),d("outlined",!0))}function Ht(r,t){if(r&1){let e=h();a(0,"p-button",80),g("onClick",function(){u(e);let o=p(2);return m(o.goToNewProduits())}),n()}if(r&2){let e=p(2);d("disabled",!e.canCreate)}}function Qt(r,t){if(r&1){let e=h();a(0,"p-button",81),g("onClick",function(){u(e);let o=p(2);return m(o.deleteSelectedProducts())}),n()}if(r&2){let e=p(2);d("disabled",!e.selectedProduits||!e.selectedProduits.length)}}function Yt(r,t){if(r&1&&_(0,Ht,1,1,"p-button",78)(1,Qt,1,1,"p-button",79),r&2){let e=p();d("ngIf",e.canCreate),s(),d("ngIf",e.canDelete)}}function Jt(r,t){if(r&1){let e=h();a(0,"p-button",82),g("onClick",function(){u(e);let o=p();return m(o.exportCSV())}),n()}}function Kt(r,t){if(r&1){let e=h();a(0,"p-button",83),g("onClick",function(){u(e);let o=p();return m(o.resetAllFilters())}),n()}r&2&&d("text",!0)}function Xt(r,t){if(r&1&&(a(0,"span",84),c(1),n()),r&2){let e=p();s(),ee(" ",e.produits.length," r\xE9sultat",e.produits.length>1?"s":""," ")}}function Zt(r,t){if(r&1){let e=h();a(0,"div",85)(1,"h5",86),c(2,"Gestion des Produits"),n(),a(3,"p-iconfield"),b(4,"p-inputicon",19),a(5,"input",87),g("input",function(o){u(e);let l=p(),f=U(57);return m(l.onGlobalFilter(f,o))}),n()()()}}function $t(r,t){r&1&&(a(0,"tr")(1,"th",88),b(2,"p-tableHeaderCheckbox"),n(),a(3,"th",89),c(4,"Image"),n(),a(5,"th",90)(6,"span",91),c(7,"Code "),b(8,"p-sortIcon",92),n()(),a(9,"th",93)(10,"span",91),c(11,"Nom "),b(12,"p-sortIcon",94),n()(),a(13,"th",95)(14,"span",91),c(15,"Type "),b(16,"p-sortIcon",96),n()(),a(17,"th",97)(18,"span",91),c(19,"Qt\xE9 "),b(20,"p-sortIcon",98),n()(),a(21,"th",99)(22,"span",91),c(23,"Status "),b(24,"p-sortIcon",100),n()(),a(25,"th",101),c(26,"Action"),n()())}function ei(r,t){if(r&1&&b(0,"img",110),r&2){let e=p().$implicit;d("src",e.getImageUrl(),I)("alt",e.nom)}}function ti(r,t){r&1&&b(0,"i",111)}function ii(r,t){if(r&1){let e=h();a(0,"p-button",112),g("click",function(){u(e);let o=p().$implicit,l=p();return m(l.deleteProduct(o))}),n()}r&2&&d("rounded",!0)("outlined",!0)}function ri(r,t){if(r&1){let e=h();a(0,"tr",102),g("dblclick",function(o){let l=u(e).$implicit,f=p();return m(f.onRowDblClick(o,l))}),a(1,"td",88),b(2,"p-tableCheckbox",103),n(),a(3,"td",89),_(4,ei,1,2,"img",104)(5,ti,1,0,"i",105),n(),a(6,"td",101),c(7),n(),a(8,"td",106),c(9),n(),a(10,"td"),c(11),n(),a(12,"td"),c(13),n(),a(14,"td"),b(15,"p-tag",107),n(),a(16,"td")(17,"button",108),g("click",function(o){let l=u(e).$implicit,f=p();return m(f.goToEditProduit(o,l.id))}),n(),_(18,ii,1,2,"p-button",109),n()()}if(r&2){let e=t.$implicit,i=p();d("tooltipOptions",B(14,Dt))("tooltipDisabled",!i.canUpdate),s(2),d("value",e),s(2),d("ngIf",e.image_url),s(),d("ngIf",!e.image_url),s(2),S(e.code),s(2),S(e.nom),s(2),S(i.getTypeLabel(e.type)),s(2),S(e.qte_stock),s(2),d("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),s(2),d("pTooltip",i.canUpdate?"Modifier":"Voir")("disabled",!i.canUpdate),s(),d("ngIf",i.canDelete)}}function ni(r,t){if(r&1){let e=h();a(0,"div",135)(1,"label",136),c(2,"Code"),n(),a(3,"input",137),C("ngModelChange",function(o){u(e);let l=p(2);return P(l.produit.code,o)||(l.produit.code=o),m(o)}),n()()}if(r&2){let e=p(2);s(3),v("ngModel",e.produit.code),d("disabled",!0)}}function oi(r,t){r&1&&(a(0,"small",138),c(1,"Type obligatoire."),n())}function ai(r,t){r&1&&(a(0,"small",138),c(1,"Nom obligatoire."),n())}function li(r,t){if(r&1){let e=h();a(0,"div")(1,"label",139),c(2,"Statut"),n(),a(3,"p-select",140),C("ngModelChange",function(o){u(e);let l=p(2);return P(l.produit.statut,o)||(l.produit.statut=o),m(o)}),n()()}if(r&2){let e=p(2);s(3),v("ngModel",e.produit.statut),d("options",e.statutOptions)}}function si(r,t){if(r&1){let e=h();_(0,ni,4,2,"div",113),a(1,"div",114)(2,"div")(3,"label",115),c(4,"Type"),n(),a(5,"p-select",116),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.type,o)||(l.produit.type=o),m(o)}),n(),_(6,oi,2,0,"small",117),n(),a(7,"div")(8,"label",118),c(9,"Nom"),n(),a(10,"input",119),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.nom,o)||(l.produit.nom=o),m(o)}),n(),_(11,ai,2,0,"small",117),n(),a(12,"div")(13,"label",120),c(14,"Description"),n(),a(15,"textarea",121),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.description,o)||(l.produit.description=o),m(o)}),n()(),_(16,li,4,2,"div",122),a(17,"div",123)(18,"div",124)(19,"label",125),c(20,"Quantit\xE9"),n(),a(21,"p-inputnumber",126),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.qte_stock,o)||(l.produit.qte_stock=o),m(o)}),n()(),a(22,"div",124)(23,"label",127),c(24,"Co\xFBt"),n(),a(25,"p-inputnumber",128),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.cout,o)||(l.produit.cout=o),m(o)}),n()()(),a(26,"div",123)(27,"div",124)(28,"label",129),c(29,"Prix achat"),n(),a(30,"p-inputnumber",130),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.prix_achat,o)||(l.produit.prix_achat=o),m(o)}),n()(),a(31,"div",124)(32,"label",131),c(33,"Prix vente"),n(),a(34,"p-inputnumber",132),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.prix_vente,o)||(l.produit.prix_vente=o),m(o)}),n()()(),a(35,"div")(36,"label",133),c(37,"Prix usine"),n(),a(38,"p-inputnumber",134),C("ngModelChange",function(o){u(e);let l=p();return P(l.produit.prix_usine,o)||(l.produit.prix_usine=o),m(o)}),n()()()}if(r&2){let e=p();d("ngIf",e.produit==null?null:e.produit.id),s(5),v("ngModel",e.produit.type),d("options",e.typeOptions),s(),d("ngIf",e.submitted&&!e.produit.type),s(4),v("ngModel",e.produit.nom),s(),d("ngIf",e.submitted&&!(e.produit.nom!=null&&e.produit.nom.trim())),s(4),v("ngModel",e.produit.description),s(),d("ngIf",e.produit==null?null:e.produit.id),s(5),v("ngModel",e.produit.qte_stock),s(4),v("ngModel",e.produit.cout),s(5),v("ngModel",e.produit.prix_achat),s(4),v("ngModel",e.produit.prix_vente),s(4),v("ngModel",e.produit.prix_usine)}}function di(r,t){if(r&1){let e=h();a(0,"p-button",141),g("click",function(){u(e);let o=p();return m(o.hideDialog())}),n(),a(1,"p-button",142),g("click",function(){u(e);let o=p();return m(o.saveProduit())}),n()}if(r&2){let e=p();d("disabled",e.saving),s(),d("disabled",e.saving)("loading",e.saving)}}var Q=class r{constructor(t,e,i,o,l,f,ir){this.router=t;this.route=e;this.produitService=i;this.messageService=o;this.confirmationService=l;this.authService=f;this.document=ir;this.canCreate=this.authService.hasPermission("produits.create"),this.canUpdate=this.authService.hasPermission("produits.update"),this.canDelete=this.authService.hasPermission("produits.delete")}produits=[];produit=new x;loading=!0;saving=!1;filterFields=["code","nom","description","type","statut","qte_stock"];produitDialog=!1;selectedProduits;submitted=!1;typeOptions=[];statutOptions=[];dt;exportColumns;cols;canCreate=!1;canUpdate=!1;canDelete=!1;mobileSearchTerm="";mobilePageSize=8;mobileVisibleCount=this.mobilePageSize;mobileBreakpoint=768;mobilePwaClass="produits-mobile-pwa";filterStatut=null;filterType=null;filterInStock=null;sortBy="created_at";sortOrder="desc";mobileFilterVisible=!1;tempFilterStatut=null;tempFilterType=null;tempFilterInStock=null;destroy$=new Me;searchSubject=new Me;ngOnInit(){this.initOptions(),this.initColumns(),this.syncMobilePwaMode(),this.searchSubject.pipe(Te(450),Ie(),Fe(this.destroy$)).subscribe(()=>{this.resetMobilePagination(),this.syncUrl(),this.loadWithFilters()});let t=this.route.snapshot.queryParams;this.filterStatut=t.statut||null,this.filterType=t.type||null,this.filterInStock=t.in_stock!==void 0?t.in_stock==="true":null,this.sortBy=t.sort_by||"created_at",this.sortOrder=t.sort_order==="asc"?"asc":"desc",t.search&&(this.mobileSearchTerm=t.search),this.loadWithFilters()}ngOnDestroy(){this.clearMobilePwaMode(),this.destroy$.next(),this.destroy$.complete()}onWindowResize(){this.syncMobilePwaMode()}loadWithFilters(){this.loading=!0;let t=this.mobileSearchTerm.trim(),e=!!t,i=!!(this.filterStatut||this.filterType||this.filterInStock!==null);(e||i?this.produitService.search(Y(k(k(k(k({},t&&{search:t}),this.filterStatut&&{statut:this.filterStatut}),this.filterType&&{type:this.filterType}),this.filterInStock!==null&&{in_stock:this.filterInStock}),{sort_by:this.sortBy,sort_order:this.sortOrder})):this.produitService.getAllFiltered({sort_by:this.sortBy,sort_order:this.sortOrder})).subscribe({next:l=>{this.produits=l,this.resetMobilePagination(),this.loading=!1},error:l=>{this.loading=!1,this.showApiError(l,"Chargement des produits impossible")}})}syncUrl(){let t={};this.mobileSearchTerm.trim()&&(t.search=this.mobileSearchTerm.trim()),this.filterStatut&&(t.statut=this.filterStatut),this.filterType&&(t.type=this.filterType),this.filterInStock!==null&&(t.in_stock=String(this.filterInStock)),this.sortBy!=="created_at"&&(t.sort_by=this.sortBy),this.sortOrder!=="desc"&&(t.sort_order=this.sortOrder),this.router.navigate([],{relativeTo:this.route,queryParams:t,replaceUrl:!0})}onDesktopFilterChange(){this.resetMobilePagination(),this.syncUrl(),this.loadWithFilters()}resetAllFilters(){this.filterStatut=null,this.filterType=null,this.filterInStock=null,this.mobileSearchTerm="",this.resetMobilePagination(),this.syncUrl(),this.loadWithFilters()}get activeFiltersCount(){return[this.filterStatut,this.filterType,this.filterInStock].filter(t=>t!==null).length}openMobileFilters(){this.tempFilterStatut=this.filterStatut,this.tempFilterType=this.filterType,this.tempFilterInStock=this.filterInStock,this.mobileFilterVisible=!0}applyMobileFilters(){this.filterStatut=this.tempFilterStatut,this.filterType=this.tempFilterType,this.filterInStock=this.tempFilterInStock,this.mobileFilterVisible=!1,this.resetMobilePagination(),this.syncUrl(),this.loadWithFilters()}resetMobileFiltersTemp(){this.tempFilterStatut=null,this.tempFilterType=null,this.tempFilterInStock=null}onMobileSearchChange(t){this.mobileVisibleCount=this.mobilePageSize,this.searchSubject.next(t)}get mobileVisibleProduits(){return this.produits.slice(0,this.mobileVisibleCount)}get canLoadMoreMobile(){return this.mobileVisibleCount<this.produits.length}loadMoreMobile(){this.mobileVisibleCount+=this.mobilePageSize}trackByProduitId(t,e){return e.id||e.code||t}exportCSV(){this.dt.exportCSV()}initOptions(){this.typeOptions=Object.entries(R).map(([t,e])=>({label:e,value:t})),this.statutOptions=Object.entries(E).map(([t,e])=>({label:e,value:t}))}initColumns(){this.cols=[{field:"code",header:"Code",customExportHeader:"Product Code"},{field:"nom",header:"Nom"},{field:"image",header:"Image"},{field:"prix_vente",header:"Prix"},{field:"type",header:"Type"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}openNew(){this.produit=new x,this.submitted=!1,this.produitDialog=!0}editProduct(t){this.produit=new x(k({},t)),this.produitDialog=!0}deleteSelectedProducts(){this.confirmationService.confirm({message:"Are you sure you want to delete the selected products?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{let t=(this.selectedProduits??[]).map(e=>e.id).filter(e=>!!e);t.length!==0&&Ee(t.map(e=>this.produitService.delete(e))).subscribe({next:()=>{this.produits=this.produits.filter(e=>!t.includes(e.id)),this.selectedProduits=null,this.messageService.add({severity:"success",summary:"Successful",detail:"Products Deleted",life:3e3})},error:e=>this.showApiError(e,"Suppression impossible")})}})}hideDialog(){this.produitDialog=!1,this.submitted=!1}deleteProduct(t){this.confirmationService.confirm({message:"Are you sure you want to delete "+(t.nom||"this product")+"?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{t.id&&this.produitService.delete(t.id).subscribe({next:()=>{this.produits=this.produits.filter(e=>e.id!==t.id),this.messageService.add({severity:"success",summary:"Successful",detail:"Product Deleted",life:3e3})},error:e=>this.showApiError(e,"Suppression impossible")})}})}getStatutSeverity(t){return t?ve[t]??ve.brouillon:ve.brouillon}getStatutLabel(t){return t?E[t]??E.brouillon:E.brouillon}getTypeLabel(t){return t?R[t]??t:"-"}formatCurrency(t){return typeof t!="number"?"-":`${new Intl.NumberFormat("fr-GN",{maximumFractionDigits:0}).format(t)} GNF`}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}saveProduit(){if(this.submitted=!0,!this.produit.nom?.trim()||!this.produit.type||this.saving)return;this.saving=!0;let t={nom:this.produit.nom.trim(),type:this.produit.type,qte_stock:this.produit.qte_stock??0,statut:this.produit.statut,cout:this.produit.cout??void 0,description:this.produit.description??void 0,prix_usine:this.produit.prix_usine??void 0,prix_vente:this.produit.prix_vente??void 0,prix_achat:this.produit.prix_achat??void 0},e=!!this.produit.id;(e?this.produitService.update(this.produit.id,t):this.produitService.create(t)).subscribe({next:()=>{this.produitDialog=!1,this.produit=new x,this.submitted=!1,this.saving=!1,this.loadWithFilters(),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:e?"Produit mis \xE0 jour":"Produit cr\xE9\xE9",life:3e3})},error:o=>{this.saving=!1,this.showApiError(o,"Sauvegarde impossible")}})}showApiError(t,e){t.status===422&&t.error?.errors?Object.values(t.error.errors).flat().forEach(o=>this.messageService.add({severity:"error",summary:"Validation",detail:o,life:5e3})):this.messageService.add({severity:"error",summary:"Erreur",detail:this.extractErrorMessage(t,e),life:5e3})}extractErrorMessage(t,e){return typeof t?.error?.message=="string"&&t.error.message.trim()?t.error.message:typeof t?.message=="string"&&t.message.trim()?t.message:e}goToNewProduits(){this.router.navigate(["/produits/produits-new"])}goHome(){this.router.navigate(["/"])}goToEditProduit(t,e){t.stopPropagation(),this.router.navigate(["/produits/produits-edit",e])}onRowDblClick(t,e){window.innerWidth<=this.mobileBreakpoint||t.target.closest('button, a, input, textarea, select, [role="button"], .p-checkbox, .p-button, .p-link')||this.router.navigate(["/produits/produits-edit",e.id])}resetMobilePagination(){this.mobileVisibleCount=this.mobilePageSize}syncMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.clearMobilePwaMode())}clearMobilePwaMode(){this.document.body.classList.remove(this.mobilePwaClass)}static \u0275fac=function(e){return new(e||r)(y(z),y(te),y(T),y(w),y(ie),y(Je),y(A))};static \u0275cmp=F({type:r,selectors:[["app-produits-liste"]],viewQuery:function(e,i){if(e&1&&K(Et,5),e&2){let o;X(o=Z())&&(i.dt=o.first)}},hostBindings:function(e,i){e&1&&g("resize",function(){return i.onWindowResize()},W)},features:[D([w,T,ie])],decls:70,vars:49,consts:[["mobileListState",""],["footer",""],["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["content",""],[1,"produits-mobile-app"],[1,"mobile-header"],["pButton","","pRipple","","icon","pi pi-arrow-left","aria-label","Retour \xE0 l'accueil",1,"p-button-rounded","p-button-text","mobile-back",3,"click"],[1,"mobile-title-wrap"],[1,"mobile-title"],[1,"mobile-subtitle"],["pButton","","pRipple","","icon","pi pi-upload","aria-label","Export",1,"p-button-rounded","p-button-text","mobile-add",3,"click"],[1,"mobile-scroll"],[1,"mobile-search-row"],[1,"mobile-search"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Rechercher un produit...",3,"ngModelChange","ngModel"],["type","button","aria-label","Filtres",1,"mobile-filter-btn",3,"click"],[1,"pi","pi-filter"],["class","mobile-filter-badge",4,"ngIf"],["class","mobile-list",4,"ngIf","ngIfElse"],["class","mobile-load-more",4,"ngIf"],["type","button","class","mobile-fab","aria-label","Nouveau produit",3,"click",4,"ngIf"],["position","right","styleClass","mobile-filter-drawer","header","Filtres",3,"visibleChange","visible"],[1,"filter-drawer-body"],[1,"filter-group"],[1,"filter-label"],["optionLabel","label","optionValue","value","placeholder","Tous les statuts","fluid","",3,"ngModelChange","ngModel","options","showClear"],["optionLabel","label","optionValue","value","placeholder","Tous les types","fluid","",3,"ngModelChange","ngModel","options","showClear"],[1,"filter-toggle-row"],[1,"filter-label","filter-label--inline"],[3,"ngModelChange","ngModel"],[1,"card","produits-desktop"],["styleClass","mb-4"],[1,"desktop-filter-bar"],["optionLabel","label","optionValue","value","placeholder","Tous les statuts","styleClass","desktop-filter-select",3,"ngModelChange","onChange","ngModel","options","showClear"],["optionLabel","label","optionValue","value","placeholder","Tous les types","styleClass","desktop-filter-select",3,"ngModelChange","onChange","ngModel","options","showClear"],[1,"desktop-filter-toggle"],[1,"desktop-filter-toggle-label"],["label","R\xE9initialiser","icon","pi pi-times","severity","secondary","size","small",3,"text","onClick",4,"ngIf"],["class","desktop-filter-count",4,"ngIf"],["dataKey","id","currentPageReportTemplate","  {first} \xE0 {last} sur {totalRecords} produits",3,"selectionChange","value","loading","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions"],[3,"visibleChange","visible","header","modal"],[1,"mobile-filter-badge"],[1,"mobile-list"],["class","mobile-produit-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mobile-produit-card",3,"click"],[1,"mobile-card-media"],["class","mobile-card-thumb",3,"src","alt",4,"ngIf"],["class","mobile-card-image-placeholder","aria-hidden","true",4,"ngIf"],[1,"mobile-card-body"],[1,"mobile-card-top"],[1,"mobile-card-main"],[1,"mobile-code"],[1,"mobile-name"],["styleClass","mobile-status-tag",3,"value","severity"],[1,"mobile-card-footer"],[1,"mobile-card-summary"],[1,"mobile-card-actions"],["pButton","","pRipple","","icon","pi pi-chevron-right",1,"p-button-rounded","p-button-text","p-button-sm","mobile-chevron-action",3,"click","disabled"],[1,"mobile-card-thumb",3,"src","alt"],["aria-hidden","true",1,"mobile-card-image-placeholder"],[1,"pi","pi-box"],["class","mobile-state",4,"ngIf"],[1,"mobile-state"],[1,"pi","pi-inbox",2,"font-size","2rem","display","block","margin-bottom","0.5rem"],[1,"mobile-load-more"],["label","Charger plus","icon","pi pi-angle-down","styleClass","mobile-load-more-btn",3,"onClick"],["type","button","aria-label","Nouveau produit",1,"mobile-fab",3,"click"],[1,"pi","pi-plus"],[1,"mobile-fab-label"],[1,"filter-drawer-footer"],["label","R\xE9initialiser","severity","secondary","styleClass","flex-1",3,"onClick","outlined"],["label","Appliquer","styleClass","flex-1",3,"onClick"],["label","Nouveau","icon","pi pi-plus","severity","secondary","class","mr-2",3,"disabled","onClick",4,"ngIf"],["severity","secondary","label","Delete","icon","pi pi-trash","outlined","",3,"disabled","onClick",4,"ngIf"],["label","Nouveau","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick","disabled"],["severity","secondary","label","Delete","icon","pi pi-trash","outlined","",3,"onClick","disabled"],["label","Export","icon","pi pi-upload","severity","secondary",3,"onClick"],["label","R\xE9initialiser","icon","pi pi-times","severity","secondary","size","small",3,"onClick","text"],[1,"desktop-filter-count"],[1,"flex","items-center","justify-between"],[1,"m-0"],["pInputText","","type","text","placeholder","Rechercher...",3,"input"],[2,"width","3rem"],[2,"width","5rem"],["pSortableColumn","code",2,"min-width","16rem"],[1,"flex","items-center","gap-2"],["field","code"],["pSortableColumn","nom",2,"min-width","16rem"],["field","nom"],["pSortableColumn","type",2,"min-width","10rem"],["field","type"],["pSortableColumn","qte_stock",2,"min-width","12rem"],["field","qte_stock"],["pSortableColumn","statut",2,"min-width","12rem"],["field","statut"],[2,"min-width","12rem"],["pTooltip","Double-cliquez pour modifier","tooltipPosition","left",1,"produit-row",3,"dblclick","tooltipOptions","tooltipDisabled"],[3,"value"],["style","width: 48px; height: 48px; object-fit: contain;","class","rounded border border-surface-200",3,"src","alt",4,"ngIf"],["class","pi pi-image text-surface-300 text-2xl",4,"ngIf"],[2,"min-width","16rem"],[3,"value","severity"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm","mr-2",3,"click","pTooltip","disabled"],["icon","pi pi-trash","severity","danger",3,"rounded","outlined","click",4,"ngIf"],[1,"rounded","border","border-surface-200",2,"width","48px","height","48px","object-fit","contain",3,"src","alt"],[1,"pi","pi-image","text-surface-300","text-2xl"],["icon","pi pi-trash","severity","danger",3,"click","rounded","outlined"],["class","mb-4",4,"ngIf"],[1,"flex","flex-col","gap-6"],["for","type",1,"block","font-bold","mb-4"],["inputId","type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","ngModel","options"],["class","text-red-500",4,"ngIf"],["for","nom",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","nom","required","","autofocus","","fluid","",3,"ngModelChange","ngModel"],["for","description",1,"block","font-bold","mb-4"],["id","description","pTextarea","","rows","3","cols","20","fluid","",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-6"],["for","qte_stock",1,"block","font-bold","mb-4"],["id","qte_stock","fluid","",3,"ngModelChange","ngModel"],["for","cout",1,"block","font-bold","mb-4"],["id","cout","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_achat",1,"block","font-bold","mb-4"],["id","prix_achat","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_vente",1,"block","font-bold","mb-4"],["id","prix_vente","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_usine",1,"block","font-bold","mb-4"],["id","prix_usine","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],[1,"mb-4"],["for","code",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","code","fluid","",3,"ngModelChange","ngModel","disabled"],[1,"text-red-500"],["for","statut",1,"block","font-bold","mb-4"],["inputId","statut","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","fluid","",3,"ngModelChange","ngModel","options"],["label","Annuler","icon","pi pi-times","text","",3,"click","disabled"],["label","Enregistrer","icon","pi pi-check",3,"click","disabled","loading"]],template:function(e,i){if(e&1){let o=h();b(0,"p-toast"),a(1,"div",9)(2,"header",10)(3,"button",11),g("click",function(){return u(o),m(i.goHome())}),n(),a(4,"div",12)(5,"h1",13),c(6,"Produits"),n(),a(7,"p",14),c(8),n()(),a(9,"button",15),g("click",function(){return u(o),m(i.exportCSV())}),n()(),a(10,"div",16)(11,"div",17)(12,"section",18)(13,"p-iconfield"),b(14,"p-inputicon",19),a(15,"input",20),C("ngModelChange",function(f){return u(o),P(i.mobileSearchTerm,f)||(i.mobileSearchTerm=f),m(f)}),g("ngModelChange",function(f){return u(o),m(i.onMobileSearchChange(f))}),n()()(),a(16,"button",21),g("click",function(){return u(o),m(i.openMobileFilters())}),b(17,"i",22),_(18,Lt,2,1,"span",23),n()(),_(19,Ut,2,2,"section",24)(20,zt,2,2,"ng-template",null,0,O)(22,jt,2,0,"div",25),n(),_(23,qt,4,0,"button",26),a(24,"p-drawer",27),C("visibleChange",function(f){return u(o),P(i.mobileFilterVisible,f)||(i.mobileFilterVisible=f),m(f)}),a(25,"div",28)(26,"div",29)(27,"label",30),c(28,"Statut"),n(),a(29,"p-select",31),C("ngModelChange",function(f){return u(o),P(i.tempFilterStatut,f)||(i.tempFilterStatut=f),m(f)}),n()(),a(30,"div",29)(31,"label",30),c(32,"Type"),n(),a(33,"p-select",32),C("ngModelChange",function(f){return u(o),P(i.tempFilterType,f)||(i.tempFilterType=f),m(f)}),n()(),a(34,"div",29)(35,"div",33)(36,"label",34),c(37,"En stock uniquement"),n(),a(38,"p-toggleswitch",35),g("ngModelChange",function(f){return u(o),m(i.tempFilterInStock=f?!0:null)}),n()()()(),_(39,Gt,3,1,"ng-template",null,1,O),n()(),a(41,"div",36)(42,"p-toolbar",37),_(43,Yt,2,2,"ng-template",null,2,O)(45,Jt,1,0,"ng-template",null,3,O),n(),a(47,"div",38)(48,"p-select",39),C("ngModelChange",function(f){return u(o),P(i.filterStatut,f)||(i.filterStatut=f),m(f)}),g("onChange",function(){return u(o),m(i.onDesktopFilterChange())}),n(),a(49,"p-select",40),C("ngModelChange",function(f){return u(o),P(i.filterType,f)||(i.filterType=f),m(f)}),g("onChange",function(){return u(o),m(i.onDesktopFilterChange())}),n(),a(50,"div",41)(51,"p-toggleswitch",35),g("ngModelChange",function(f){return u(o),i.filterInStock=f?!0:null,m(i.onDesktopFilterChange())}),n(),a(52,"span",42),c(53,"En stock"),n()(),_(54,Kt,1,1,"p-button",43)(55,Xt,2,2,"span",44),n(),a(56,"p-table",45,4),C("selectionChange",function(f){return u(o),P(i.selectedProduits,f)||(i.selectedProduits=f),m(f)}),_(58,Zt,6,0,"ng-template",null,5,O)(60,$t,27,0,"ng-template",null,6,O)(62,ri,19,15,"ng-template",null,7,O),n()(),a(64,"p-dialog",46),C("visibleChange",function(f){return u(o),P(i.produitDialog,f)||(i.produitDialog=f),m(f)}),_(65,si,39,13,"ng-template",null,8,O)(67,di,2,3,"ng-template",null,1,O),n(),b(69,"p-confirmdialog")}if(e&2){let o=U(21);s(8),ee("",i.produits.length," produit",i.produits.length>1?"s":""),s(7),v("ngModel",i.mobileSearchTerm),s(),$("mobile-filter-btn--active",i.activeFiltersCount>0),s(2),d("ngIf",i.activeFiltersCount>0),s(),d("ngIf",!i.loading&&i.mobileVisibleProduits.length)("ngIfElse",o),s(3),d("ngIf",!i.loading&&i.canLoadMoreMobile),s(),d("ngIf",i.canCreate),s(),v("visible",i.mobileFilterVisible),s(5),v("ngModel",i.tempFilterStatut),d("options",i.statutOptions)("showClear",!0),s(4),v("ngModel",i.tempFilterType),d("options",i.typeOptions)("showClear",!0),s(5),d("ngModel",i.tempFilterInStock===!0),s(10),v("ngModel",i.filterStatut),d("options",i.statutOptions)("showClear",!0),s(),v("ngModel",i.filterType),d("options",i.typeOptions)("showClear",!0),s(2),d("ngModel",i.filterInStock===!0),s(3),d("ngIf",i.activeFiltersCount>0),s(),d("ngIf",!i.loading),s(),d("value",i.produits)("loading",i.loading)("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",B(45,Tt)),v("selection",i.selectedProduits),d("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",B(46,It)),s(8),we(B(47,Ft)),v("visible",i.produitDialog),d("header",i.produit!=null&&i.produit.id?"Modifier un produit":"Nouveau produit")("modal",!0),s(5),we(B(48,Vt))}},dependencies:[L,Re,N,rt,Ze,$e,et,tt,it,ae,re,ne,We,oe,ue,ce,Ne,pe,de,q,j,ot,nt,se,le,mt,ut,fe,_e,he,be,lt,at,dt,st,Ge,qe,je,ze,ct,pt,Qe,He,Xe,Ke,ge,me],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.produits-mobile-app[_ngcontent-%COMP%]{display:none}.produits-desktop[_ngcontent-%COMP%]     .produit-row{cursor:pointer}@media screen and (max-width: 768px){[_nghost-%COMP%]{--mobile-primary: #5f6bff;--mobile-text: #334155;--mobile-muted: #7f8ca3;--mobile-card: #f9fbff;--mobile-border: #dbe2ee}.produits-desktop[_ngcontent-%COMP%]{display:none}.produits-mobile-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;height:100vh;height:100dvh;overflow:hidden;margin-top:calc(-.25rem - env(safe-area-inset-top));margin-left:-.875rem;margin-right:-.875rem;margin-bottom:calc(-.875rem - env(safe-area-inset-bottom));padding:0 .875rem env(safe-area-inset-bottom);padding-left:calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:linear-gradient(180deg,#f3f5f9,#eaedf4 58%,#e5eaf1);animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.mobile-header[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;gap:.55rem;margin:0 -.875rem;padding:calc(.5rem + env(safe-area-inset-top)) calc(.875rem + env(safe-area-inset-right)) .6rem calc(.875rem + env(safe-area-inset-left));background:var(--mobile-card);border-bottom:1px solid var(--mobile-border);box-shadow:0 1px 3px #0f172a0f;position:sticky;top:0;z-index:30}.mobile-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:.75rem;padding-bottom:calc(4rem + env(safe-area-inset-bottom))}.mobile-back[_ngcontent-%COMP%], .mobile-add[_ngcontent-%COMP%]{width:2.15rem;height:2.15rem;border-radius:999px;flex-shrink:0;color:var(--mobile-primary)!important;background:#5f6bff1a!important}.mobile-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0;text-align:center}.mobile-title[_ngcontent-%COMP%]{margin:0;font-size:1.35rem;line-height:1.1;font-weight:800;color:var(--mobile-text)}.mobile-subtitle[_ngcontent-%COMP%]{margin:.2rem 0 0;font-size:.76rem;font-weight:600;color:var(--mobile-muted)}.mobile-search[_ngcontent-%COMP%]{background:#f7f9fd;border:1.5px solid var(--mobile-border);border-radius:.95rem;padding:.35rem .55rem;box-shadow:inset 0 1px #ffffffb3}.mobile-search[_ngcontent-%COMP%]   .p-iconfield[_ngcontent-%COMP%], .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{width:100%}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{border:0;box-shadow:none;background:transparent;color:var(--mobile-text);font-size:.96rem}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]::placeholder{color:#92a0b7}.mobile-quick-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;padding:0 .15rem}.mobile-quick-actions[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{flex:1}.mobile-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.65rem;margin-top:1rem}.mobile-produit-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:1rem;padding:.9rem;box-shadow:0 10px 24px #0f172a0f;cursor:pointer;transition:box-shadow .2s ease}.mobile-produit-card[_ngcontent-%COMP%]:active{box-shadow:0 4px 12px #0f172a14}.mobile-card-media[_ngcontent-%COMP%]{flex-shrink:0}.mobile-card-thumb[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:.65rem;object-fit:contain;border:1px solid var(--mobile-border);background:#fff}.mobile-card-image-placeholder[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:.65rem;background:#eef1f6;border:1px solid var(--mobile-border);display:flex;align-items:center;justify-content:center}.mobile-card-image-placeholder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.5rem;color:#92a0b7}.mobile-card-body[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-card-top[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:.5rem;margin-bottom:.4rem}.mobile-card-main[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-code[_ngcontent-%COMP%]{margin-bottom:.1rem;font-size:.72rem;line-height:1.2;color:#8b98b0;letter-spacing:.02em;font-weight:700}.mobile-name[_ngcontent-%COMP%]{font-size:1rem;line-height:1.25;font-weight:700;color:var(--mobile-text);word-break:break-word}.mobile-card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;flex-wrap:wrap}.mobile-card-summary[_ngcontent-%COMP%]{font-size:.8rem;color:var(--mobile-muted);font-weight:600}.mobile-card-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.35rem}.mobile-chevron-action[_ngcontent-%COMP%]{width:2.05rem;height:2.05rem;color:var(--mobile-muted)!important;flex-shrink:0}.mobile-state[_ngcontent-%COMP%]{margin-top:1rem;background:#f8faff;border:1px dashed var(--mobile-border);border-radius:1rem;padding:1rem;text-align:center;color:var(--mobile-muted);font-size:.9rem}.mobile-load-more[_ngcontent-%COMP%]{padding-top:.4rem}.mobile-fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(1rem + env(safe-area-inset-bottom));right:calc(1rem + env(safe-area-inset-right));z-index:25;width:3.5rem;height:3.5rem;min-width:3.5rem;min-height:3.5rem;padding:0;border:none;border-radius:50%;background:var(--mobile-primary);color:#fff;box-shadow:0 4px 14px #5f6bff73;display:flex;align-items:center;justify-content:center;gap:.35rem;font-weight:700;font-size:.9rem;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.mobile-fab[_ngcontent-%COMP%]:active{transform:scale(.96)}.mobile-fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.35rem}.mobile-fab-label[_ngcontent-%COMP%]{display:none}}@media screen and (max-width: 768px) and (min-width: 400px){.mobile-fab[_ngcontent-%COMP%]{width:auto;height:3rem;min-height:3rem;padding:0 1.25rem;border-radius:999px}.mobile-fab-label[_ngcontent-%COMP%]{display:inline}}@media screen and (max-width: 768px){[_nghost-%COMP%]     .mobile-action-btn{width:100%;justify-content:flex-start;border:0!important;background:transparent!important;color:#4f5d79!important;padding:.35rem .45rem!important;font-weight:700;border-radius:.7rem;box-shadow:none!important}[_nghost-%COMP%]     .mobile-action-btn .p-button-icon{color:var(--mobile-primary);font-size:.95rem}[_nghost-%COMP%]     .mobile-action-btn .p-button-label{font-size:.95rem}[_nghost-%COMP%]     .mobile-status-tag{font-size:.79rem;font-weight:700;border-radius:.55rem;padding:.22rem .55rem}[_nghost-%COMP%]     .mobile-status-tag.p-tag-success{background:#d9f7e5;color:#168f4a}[_nghost-%COMP%]     .mobile-status-tag.p-tag-warn, [_nghost-%COMP%]     .mobile-status-tag.p-tag-warning{background:#ffe8d3;color:#dc6408}[_nghost-%COMP%]     .mobile-status-tag.p-tag-danger{background:#ffe3e1;color:#dd3f39}[_nghost-%COMP%]     .mobile-status-tag.p-tag-secondary{background:#e8edf6;color:#64748b}[_nghost-%COMP%]     .mobile-delete-action{width:2.05rem;height:2.05rem;border-radius:999px!important;border-color:#ffb9b4!important;color:#ef4444!important;background:#ffffffe6!important}[_nghost-%COMP%]     .mobile-delete-action .p-button-icon{font-size:.84rem}[_nghost-%COMP%]     .mobile-load-more-btn{width:100%;border-radius:999px;justify-content:center;font-weight:700;border:1px solid #cfd7ff;background:#eef2ff;color:#4f5df4}.app-dark   [_nghost-%COMP%]{--mobile-primary: var(--p-primary-400);--mobile-text: var(--p-surface-100);--mobile-muted: var(--p-surface-400);--mobile-card: var(--p-surface-800);--mobile-border: var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .produits-mobile-app[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .produits-mobile-app[_ngcontent-%COMP%]{background:var(--p-surface-950)}.app-dark[_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);box-shadow:none}.app-dark[_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]::placeholder, .app-dark   [_nghost-%COMP%]   .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]::placeholder{color:var(--p-surface-500)}.app-dark[_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%]{box-shadow:0 4px 12px #00000026}.app-dark[_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%]:active, .app-dark   [_nghost-%COMP%]   .mobile-produit-card[_ngcontent-%COMP%]:active{box-shadow:0 4px 12px #00000040}.app-dark[_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%]{background:var(--p-surface-700);border-color:var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-card-image-placeholder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .mobile-code[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-code[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);color:var(--p-surface-400)}.app-dark   [_nghost-%COMP%]     .mobile-action-btn{color:var(--p-surface-300)!important}.app-dark   [_nghost-%COMP%]     .mobile-action-btn .p-button-icon{color:var(--p-primary-400)}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-success{background:#05966933;color:#34d399}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-warn, .app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-warning{background:#d9770633;color:#fbbf24}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-danger{background:#dc262633;color:#f87171}.app-dark   [_nghost-%COMP%]     .mobile-status-tag.p-tag-secondary{background:var(--p-surface-700);color:var(--p-surface-300)}.app-dark   [_nghost-%COMP%]     .mobile-delete-action{border-color:var(--p-surface-600)!important;background:var(--p-surface-700)!important;color:#f87171!important}.app-dark   [_nghost-%COMP%]     .mobile-load-more-btn{border-color:var(--p-surface-600);background:var(--p-surface-800);color:var(--p-primary-400)}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@media screen and (max-width: 768px){.mobile-search-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.mobile-search-row[_ngcontent-%COMP%]   .mobile-search[_ngcontent-%COMP%]{flex:1}.mobile-filter-btn[_ngcontent-%COMP%]{position:relative;width:2.5rem;height:2.5rem;flex-shrink:0;border-radius:.65rem;border:1.5px solid var(--mobile-border);background:#f7f9fd;color:var(--mobile-muted);display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent;transition:background .15s ease,border-color .15s ease}.mobile-filter-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1rem}.mobile-filter-btn--active[_ngcontent-%COMP%]{background:#5f6bff1a;border-color:var(--mobile-primary);color:var(--mobile-primary)}.mobile-filter-badge[_ngcontent-%COMP%]{position:absolute;top:-.3rem;right:-.3rem;width:1.15rem;height:1.15rem;border-radius:50%;background:var(--mobile-primary);color:#fff;font-size:.62rem;font-weight:700;display:flex;align-items:center;justify-content:center;line-height:1}[_nghost-%COMP%]     .mobile-filter-drawer{width:min(320px,88vw)!important}[_nghost-%COMP%]     .mobile-filter-drawer .p-drawer-content{padding:1rem 1.25rem;overflow-y:auto}[_nghost-%COMP%]     .mobile-filter-drawer .p-drawer-footer{padding:.75rem 1.25rem 1rem;border-top:1px solid var(--mobile-border)}.filter-drawer-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.filter-label[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:#94a3b8;margin-bottom:.1rem}.filter-label--inline[_ngcontent-%COMP%]{margin-bottom:0;font-size:.85rem;text-transform:none;letter-spacing:0;color:#334155;font-weight:600}.filter-toggle-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.65rem 0;border-top:1px solid var(--mobile-border);border-bottom:1px solid var(--mobile-border)}.filter-drawer-footer[_ngcontent-%COMP%]{display:flex;gap:.75rem}.filter-drawer-footer[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{flex:1}.app-dark[_nghost-%COMP%]   .mobile-filter-btn[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-filter-btn[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .mobile-filter-btn--active[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-filter-btn--active[_ngcontent-%COMP%]{background:rgba(var(--p-primary-400-rgb, 95, 107, 255),.15);border-color:var(--p-primary-400);color:var(--p-primary-400)}.app-dark[_nghost-%COMP%]   .filter-label--inline[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .filter-label--inline[_ngcontent-%COMP%]{color:var(--p-surface-200)}.app-dark[_nghost-%COMP%]   .filter-toggle-row[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .filter-toggle-row[_ngcontent-%COMP%]{border-color:var(--p-surface-600)}.app-dark   [_nghost-%COMP%]     .mobile-filter-drawer .p-drawer-footer{border-top-color:var(--p-surface-700)}}.desktop-filter-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 0 1rem;flex-wrap:wrap;border-bottom:1px solid var(--p-surface-100);margin-bottom:.5rem}.app-dark[_nghost-%COMP%]   .desktop-filter-bar[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .desktop-filter-bar[_ngcontent-%COMP%]{border-bottom-color:var(--p-surface-700)}[_nghost-%COMP%]     .desktop-filter-select{min-width:11rem}.desktop-filter-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.desktop-filter-toggle-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--p-surface-600)}.desktop-filter-count[_ngcontent-%COMP%]{margin-left:auto;font-size:.82rem;color:var(--p-surface-400);font-weight:500}.app-dark[_nghost-%COMP%]   .desktop-filter-toggle-label[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .desktop-filter-toggle-label[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .desktop-filter-count[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .desktop-filter-count[_ngcontent-%COMP%]{color:var(--p-surface-500)}']})};var pi=["buttonEl"];function ci(r,t){if(r&1){let e=h();a(0,"button",72),g("click",function(){u(e);let o=p();return m(o.enableEditing())}),n()}}function ui(r,t){r&1&&(a(0,"div",75),b(1,"i",76),a(2,"span"),c(3,"Ajouter une photo"),n()())}function mi(r,t){if(r&1){let e=h();a(0,"button",82),g("click",function(o){u(e);let l=p(4);return m(l.removeImage(o))}),b(1,"i",83),n()}}function gi(r,t){r&1&&(a(0,"div",84),b(1,"i",85),n())}function _i(r,t){if(r&1){let e=h();a(0,"div",86)(1,"p",87),c(2,"Supprimer cette image ?"),n(),a(3,"div",88)(4,"button",89),g("click",function(o){u(e);let l=p(4);return m(l.confirmDeleteImage(o))}),n(),a(5,"button",90),g("click",function(o){u(e);let l=p(4);return m(l.cancelDeleteImage(o))}),n()()()}}function fi(r,t){if(r&1&&(a(0,"div",77),b(1,"img",78),_(2,mi,2,0,"button",79)(3,gi,2,0,"div",80)(4,_i,6,0,"div",81),n()),r&2){let e=p(3);s(),d("src",e.imagePreview||e.product.getImageUrl(),I),s(),d("ngIf",!e.fieldsDisabled&&!e.confirmingDelete&&!e.loading),s(),d("ngIf",e.loading&&e.selectedImageFile),s(),d("ngIf",e.confirmingDelete)}}function bi(r,t){if(r&1){let e=h();a(0,"div",74),g("click",function(){u(e),p();let o=U(2),l=p();return m(!l.fieldsDisabled&&o.advancedFileInput.nativeElement.click())}),_(1,ui,4,0,"div",14)(2,fi,5,4,"div",13),n()}if(r&2){let e=p(2);s(),d("ngIf",!e.imagePreview&&!e.product.image_url),s(),d("ngIf",e.imagePreview||e.product.image_url)}}function hi(r,t){if(r&1){let e=h();a(0,"div")(1,"p-fileUpload",73,0),g("onSelect",function(o){u(e);let l=p();return m(l.onUpload(o))}),_(3,bi,3,2,"ng-template",null,1,O),n()()}if(r&2){let e=p();s(),d("customUpload",!0)("multiple",!1)("showUploadButton",!1)("showCancelButton",!1)("auto",!0)("disabled",e.fieldsDisabled)}}function vi(r,t){if(r&1&&(a(0,"small",95),b(1,"i",96),c(2),n()),r&2){let e=p(2);s(2),V("",e.imageError," ")}}function Pi(r,t){if(r&1&&(a(0,"div",91)(1,"small",92),b(2,"i",93),c(3,"JPG, PNG, WebP \u2014 5 Mo max "),n(),_(4,vi,3,1,"small",94),n()),r&2){let e=p();s(4),d("ngIf",e.imageError)}}function Ci(r,t){if(r&1&&(a(0,"div",77),b(1,"img",78),n()),r&2){let e=p();s(),d("src",e.product.getImageUrl(),I)}}function xi(r,t){r&1&&(a(0,"div",75),b(1,"i",97),a(2,"span"),c(3,"Aucune image"),n()())}function yi(r,t){r&1&&(a(0,"small",98),b(1,"i",47),c(2," Stock non g\xE9r\xE9 pour les services "),n())}function Mi(r,t){r&1&&(a(0,"small",99),c(1," Nom du produit obligatoire. "),n())}function wi(r,t){r&1&&(a(0,"small",99),c(1," Obligatoire "),n())}function Oi(r,t){if(r&1){let e=h();a(0,"div",26)(1,"span",27),c(2,"Achat"),n(),a(3,"p-inputnumber",100),C("ngModelChange",function(o){u(e);let l=p();return P(l.product.prix_achat,o)||(l.product.prix_achat=o),m(o)}),n(),_(4,wi,2,0,"small",23),n()}if(r&2){let e=p();s(3),v("ngModel",e.product.prix_achat),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixAchatRequired()&&e.isPriceMissing(e.product.prix_achat)),s(),d("ngIf",e.submitted&&e.isPrixAchatRequired()&&e.isPriceMissing(e.product.prix_achat)&&e.isEditing)}}function Si(r,t){r&1&&(a(0,"small",99),c(1," Obligatoire "),n())}function ki(r,t){if(r&1){let e=h();a(0,"div",26)(1,"span",27),c(2,"Vente"),n(),a(3,"p-inputnumber",100),C("ngModelChange",function(o){u(e);let l=p();return P(l.product.prix_vente,o)||(l.product.prix_vente=o),m(o)}),n(),_(4,Si,2,0,"small",23),n()}if(r&2){let e=p();s(3),v("ngModel",e.product.prix_vente),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixVenteRequired()&&e.isPriceMissing(e.product.prix_vente)),s(),d("ngIf",e.submitted&&e.isPrixVenteRequired()&&e.isPriceMissing(e.product.prix_vente)&&e.isEditing)}}function Ei(r,t){r&1&&(a(0,"small",99),c(1," Obligatoire "),n())}function Ti(r,t){if(r&1){let e=h();a(0,"div",26)(1,"span",27),c(2,"Usine"),n(),a(3,"p-inputnumber",100),C("ngModelChange",function(o){u(e);let l=p();return P(l.product.prix_usine,o)||(l.product.prix_usine=o),m(o)}),n(),_(4,Ei,2,0,"small",23),n()}if(r&2){let e=p();s(3),v("ngModel",e.product.prix_usine),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)),s(),d("ngIf",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)&&e.isEditing)}}function Ii(r,t){r&1&&(a(0,"div",101),b(1,"i",102),c(2," Au moins un prix requis pour un service. "),n())}function Fi(r,t){if(r&1){let e=h();a(0,"div",103)(1,"button",104),g("click",function(){u(e);let o=p();return m(o.onSubmit())}),n(),a(2,"button",105),g("click",function(){u(e);let o=p();return m(o.mode==="create"?o.onCancel():o.cancelEditing())}),n()()}if(r&2){let e=p();s(),d("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),s(),d("disabled",e.loading)}}function Vi(r,t){if(r&1){let e=h();a(0,"button",106),g("click",function(){u(e);let o=p();return m(o.enableEditing())}),n()}}function Di(r,t){r&1&&(a(0,"span",99),c(1,"*"),n())}function Li(r,t){r&1&&(a(0,"span",99),c(1,"*"),n())}function Ri(r,t){r&1&&(a(0,"small",99),c(1," Nom du produit obligatoire. "),n())}function Ai(r,t){r&1&&(a(0,"small",99),c(1," Prix d'achat obligatoire pour ce type. "),n())}function Wi(r,t){if(r&1){let e=h();a(0,"div",107)(1,"p-inputnumber",108),C("ngModelChange",function(o){u(e);let l=p();return P(l.product.prix_achat,o)||(l.product.prix_achat=o),m(o)}),n(),_(2,Ai,2,0,"small",23),n()}if(r&2){let e=p();s(),v("ngModel",e.product.prix_achat),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixAchatRequired()&&e.isPriceMissing(e.product.prix_achat)),s(),d("ngIf",e.submitted&&e.isPrixAchatRequired()&&e.isPriceMissing(e.product.prix_achat)&&e.isEditing)}}function Ui(r,t){r&1&&(a(0,"small",99),c(1," Prix de vente obligatoire pour ce type. "),n())}function Bi(r,t){if(r&1){let e=h();a(0,"div",107)(1,"p-inputnumber",109),C("ngModelChange",function(o){u(e);let l=p();return P(l.product.prix_vente,o)||(l.product.prix_vente=o),m(o)}),n(),_(2,Ui,2,0,"small",23),n()}if(r&2){let e=p();s(),v("ngModel",e.product.prix_vente),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixVenteRequired()&&e.isPriceMissing(e.product.prix_vente)),s(),d("ngIf",e.submitted&&e.isPrixVenteRequired()&&e.isPriceMissing(e.product.prix_vente)&&e.isEditing)}}function Ni(r,t){r&1&&(a(0,"small",99),c(1,' Prix usine obligatoire pour "Fabricable". '),n())}function zi(r,t){if(r&1){let e=h();a(0,"div",107)(1,"p-inputnumber",110),C("ngModelChange",function(o){u(e);let l=p();return P(l.product.prix_usine,o)||(l.product.prix_usine=o),m(o)}),n(),_(2,Ni,2,0,"small",23),n()}if(r&2){let e=p();s(),v("ngModel",e.product.prix_usine),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)),s(),d("ngIf",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)&&e.isEditing)}}function ji(r,t){r&1&&(a(0,"div",111),b(1,"i",112),c(2," Pour un service, renseignez au moins un prix : achat ou vente. "),n())}function qi(r,t){r&1&&(a(0,"div",119),b(1,"i",120),a(2,"span",121),c(3,"Ajouter une image"),n(),a(4,"span",122),c(5,"Cliquez pour s\xE9lectionner"),n()())}function Gi(r,t){if(r&1){let e=h();a(0,"button",129),g("click",function(o){u(e);let l=p(4);return m(l.removeImage(o))}),b(1,"i",83),n()}}function Hi(r,t){r&1&&(a(0,"div",130),b(1,"i",131),n())}function Qi(r,t){if(r&1){let e=h();a(0,"div",132)(1,"p",133),c(2,"Supprimer cette image ?"),n(),a(3,"div",134)(4,"button",89),g("click",function(o){u(e);let l=p(4);return m(l.confirmDeleteImage(o))}),n(),a(5,"button",90),g("click",function(o){u(e);let l=p(4);return m(l.cancelDeleteImage(o))}),n()()()}}function Yi(r,t){if(r&1&&(a(0,"div",123)(1,"div",124),b(2,"img",125),_(3,Gi,2,0,"button",126)(4,Hi,2,0,"div",127)(5,Qi,6,0,"div",128),n()()),r&2){let e=p(3);s(2),d("src",e.imagePreview||e.product.getImageUrl(),I),s(),d("ngIf",!e.fieldsDisabled&&!e.confirmingDelete&&!e.loading),s(),d("ngIf",e.loading&&e.selectedImageFile),s(),d("ngIf",e.confirmingDelete)}}function Ji(r,t){if(r&1){let e=h();a(0,"div",116),g("click",function(){u(e),p();let o=U(2),l=p();return m(!l.fieldsDisabled&&o.advancedFileInput.nativeElement.click())}),_(1,qi,6,0,"div",117)(2,Yi,6,4,"div",118),n()}if(r&2){let e=p(2);s(),d("ngIf",!e.imagePreview&&!e.product.image_url),s(),d("ngIf",e.imagePreview||e.product.image_url)}}function Ki(r,t){if(r&1&&(a(0,"small",135),b(1,"i",96),c(2),n()),r&2){let e=p(2);s(2),V("",e.imageError," ")}}function Xi(r,t){if(r&1){let e=h();a(0,"div")(1,"p-fileUpload",113,2),g("onSelect",function(o){u(e);let l=p();return m(l.onUpload(o))}),_(3,Ji,3,2,"ng-template",null,1,O),n(),a(5,"small",114),b(6,"i",93),c(7,"JPG, PNG, WebP \u2014 5 Mo max "),n(),_(8,Ki,3,1,"small",115),n()}if(r&2){let e=p();s(),d("customUpload",!0)("multiple",!1)("showUploadButton",!1)("showCancelButton",!1)("auto",!0)("disabled",e.fieldsDisabled),s(7),d("ngIf",e.imageError)}}function Zi(r,t){if(r&1&&(a(0,"div",136),b(1,"img",125),n()),r&2){let e=p();s(),d("src",e.product.getImageUrl(),I)}}function $i(r,t){r&1&&(a(0,"small",137),b(1,"i",93),c(2,"Le stock n'est pas g\xE9r\xE9 pour les services. "),n())}function er(r,t){if(r&1){let e=h();a(0,"div",138)(1,"div",139)(2,"button",140),g("click",function(){u(e);let o=p();return m(o.onSubmit())}),n(),a(3,"button",141),g("click",function(){u(e);let o=p();return m(o.mode==="create"?o.onCancel():o.cancelEditing())}),n()()()}if(r&2){let e=p();s(2),d("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),s(),d("disabled",e.loading)}}var G=class r{static ALLOWED_TYPES=["image/jpeg","image/png","image/webp"];static MAX_SIZE=5*1024*1024;buttonEl;mode="create";initialData=null;loading=!1;submitForm=new J;cancel=new J;deleteImage=new J;submitted=!1;isEditing=!1;typeOptions=[{label:R.materiel,value:"materiel"},{label:R.service,value:"service"},{label:R.fabricable,value:"fabricable"},{label:R.achat_vente,value:"achat_vente"}];statutOptions=[{label:E.brouillon,value:"brouillon"},{label:E.actif,value:"actif"},{label:E.inactif,value:"inactif"},{label:E.rupture_stock,value:"rupture_stock"}];product=new x({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"actif",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null});selectedImageFile=null;imagePreview=null;imageError=null;confirmingDelete=!1;ngOnInit(){this.initialData&&(this.product=new x(this.initialData),this.imagePreview=this.initialData.image_url),this.mode==="create"&&(this.isEditing=!0)}isPrixUsineVisible(){return this.product.type==="fabricable"}isPrixUsineRequired(){return this.product.type==="fabricable"}isPrixAchatVisible(){return["materiel","service","achat_vente"].includes(this.product.type)}isPrixVenteVisible(){return["service","fabricable","achat_vente"].includes(this.product.type)}isPrixVenteRequired(){return["fabricable","achat_vente"].includes(this.product.type)}ngOnChanges(t){t.initialData?.currentValue&&(this.revokePreviewUrl(),this.product=new x(t.initialData.currentValue),this.imagePreview=t.initialData.currentValue.image_url??null,this.mode==="edit"&&(this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null,this.imageError=null,this.confirmingDelete=!1)),t.mode?.currentValue==="create"&&(this.isEditing=!0)}isPrixAchatRequired(){return["materiel","achat_vente"].includes(this.product.type)}isQteStockDisabled(){return this.product.type==="service"||this.fieldsDisabled}isValidPrice(t){return typeof t=="number"&&t>=0}isPriceMissing(t){return t==null}hasServicePrice(){return this.isValidPrice(this.product.prix_achat)||this.isValidPrice(this.product.prix_vente)}showServicePriceError(){return this.submitted&&this.isEditing&&this.product.type==="service"&&!this.hasServicePrice()}get isActifSwitch(){return this.product.statut==="actif"}onStatutToggleChange(t){this.product.statut=t?"actif":"inactif"}onTypeChange(){this.isPrixUsineVisible()||(this.product.prix_usine=null),this.isPrixAchatVisible()||(this.product.prix_achat=null),this.isPrixVenteVisible()||(this.product.prix_vente=null),this.product.type==="service"&&(this.product.qte_stock=0)}isValid(){return!(!this.product.nom?.trim()||!this.product.type||this.isPrixUsineRequired()&&!this.isValidPrice(this.product.prix_usine)||this.isPrixVenteRequired()&&!this.isValidPrice(this.product.prix_vente)||this.isPrixAchatRequired()&&!this.isValidPrice(this.product.prix_achat)||this.product.type==="service"&&!this.hasServicePrice())}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null,this.initialData?(this.product=new x(this.initialData),this.imagePreview=this.initialData.image_url):this.resetForm()}onUpload(t){if(!t?.files?.length)return;let e=t.files[0];if(this.imageError=null,!r.ALLOWED_TYPES.includes(e.type)){this.imageError="Format non support\xE9. Utilisez JPG, PNG ou WebP.";return}if(e.size>r.MAX_SIZE){this.imageError="Fichier trop volumineux. Taille max : 5 Mo.";return}this.revokePreviewUrl(),this.selectedImageFile=e,this.imagePreview=URL.createObjectURL(e)}removeImage(t){t.stopPropagation(),this.selectedImageFile?(this.revokePreviewUrl(),this.selectedImageFile=null,this.imagePreview=null,this.imageError=null):this.product.image_url&&(this.confirmingDelete=!0)}confirmDeleteImage(t){t.stopPropagation(),this.confirmingDelete=!1,this.product.image_url=null,this.imagePreview=null,this.deleteImage.emit()}cancelDeleteImage(t){t.stopPropagation(),this.confirmingDelete=!1}revokePreviewUrl(){this.imagePreview?.startsWith("blob:")&&URL.revokeObjectURL(this.imagePreview)}ngOnDestroy(){this.revokePreviewUrl()}onSubmit(){if(this.submitted=!0,!this.isValid())return;let t={nom:this.product.nom.trim(),type:this.product.type,qte_stock:this.product.qte_stock,description:this.product.description?.trim()||void 0,cout:this.product.cout??void 0};t.statut=this.product.statut,this.product.prix_usine!==null&&(t.prix_usine=this.product.prix_usine),this.product.prix_vente!==null&&(t.prix_vente=this.product.prix_vente),this.product.prix_achat!==null&&(t.prix_achat=this.product.prix_achat),this.selectedImageFile&&(t.image=this.selectedImageFile),this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}getPrixHelperText(){switch(this.product.type){case"materiel":return"Prix d'achat obligatoire";case"service":return"Pour un service, renseignez au moins un prix : achat ou vente";case"fabricable":return"Prix usine et prix de vente obligatoires";case"achat_vente":return"Prix d'achat et prix de vente obligatoires";default:return"S\xC3\xA9lectionnez un type de produit"}}resetForm(){this.revokePreviewUrl(),this.submitted=!1,this.selectedImageFile=null,this.imagePreview=null,this.imageError=null,this.product=new x({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"actif",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-produits-form"]],viewQuery:function(e,i){if(e&1&&K(pi,5),e&2){let o;X(o=Z())&&(i.buttonEl=o)}},inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel",deleteImage:"deleteImage"},features:[D([w]),Le],decls:114,vars:61,consts:[["mobileFileUploader",""],["content",""],["fileUploader",""],[1,"card","product-form"],[1,"mobile-form-container"],[1,"mobile-form-header"],["pButton","","pRipple","","icon","pi pi-arrow-left",1,"p-button-rounded","p-button-text","mobile-form-back",3,"click"],[1,"mobile-form-title-wrap"],[1,"mobile-form-title"],["pButton","","pRipple","","icon","pi pi-pencil","class","p-button-rounded p-button-text mobile-form-edit",3,"click",4,"ngIf"],[1,"mobile-image-card"],[4,"ngIf"],["class","px-3 pb-2",4,"ngIf"],["class","mobile-upload-preview",4,"ngIf"],["class","mobile-upload-placeholder",4,"ngIf"],[1,"mobile-section-card"],[1,"mobile-meta-row"],[1,"mobile-meta-field"],[1,"mobile-field-label"],["placeholder","Type","fluid","",3,"ngModelChange","onChange","options","ngModel","disabled"],["placeholder","0","fluid","",3,"ngModelChange","ngModel","showButtons","min","disabled"],["class","mobile-info-hint",4,"ngIf"],["pInputText","","type","text","placeholder","Nom du produit","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],["class","text-red-500",4,"ngIf"],[1,"mobile-price-grid"],["class","mobile-price-item",4,"ngIf"],[1,"mobile-price-item"],[1,"mobile-price-label"],["mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","min","disabled"],["class","mobile-service-alert",4,"ngIf"],[1,"mobile-section-card","mobile-status-row"],[1,"mobile-status-label"],[1,"mobile-status-value"],[1,"ml-auto",3,"ngModelChange","ngModel","disabled"],["class","mobile-bottom-actions",4,"ngIf"],[1,"desktop-form-container"],[1,"flex","justify-between","items-start","gap-4","mb-8","form-header"],[1,"block","text-surface-900","dark:text-surface-0","font-bold","text-2xl"],[1,"text-surface-500","dark:text-surface-300"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-6","flex-wrap"],[1,"col-span-12","lg:col-span-8"],[1,"form-section","mb-4"],[1,"type-selector-block"],[1,"form-field-label"],["placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","onChange","options","ngModel","disabled"],[1,"form-field-hint"],[1,"pi","pi-info-circle"],[1,"grid","grid-cols-12","gap-5","mt-4"],[1,"col-span-12"],["for","nom",1,"form-field-label"],["id","nom","pInputText","","type","text","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],[1,"prix-section-header"],[1,"flex","gap-4"],["class","flex-1 min-w-0 price-field-anim",4,"ngIf"],[1,"prix-helper-text"],["class","col-span-12 service-alert",4,"ngIf"],[1,"form-section"],[1,"section-title"],[1,"pi","pi-image","mr-2"],["class","flex justify-center mt-2",4,"ngIf"],[1,"col-span-12","lg:col-span-4","flex","flex-col","gap-y-4","mt-7"],[1,"border","border-surface-200","dark:border-surface-700","rounded"],[1,"text-surface-900","dark:text-surface-0","font-bold","block","border-b","border-surface-200","dark:border-surface-700","p-4"],[1,"p-4"],[1,"bg-surface-100","dark:bg-surface-700","py-2","px-4","flex","items-center","rounded"],[1,"text-black/90","dark:text-surface-0!","font-bold","mr-4"],[1,"text-black/60","dark:text-surface-0!","font-semibold"],["inputId","cout","mode","currency","currency","GNF","locale","fr-GN","placeholder","Co\xFBt","fluid","",3,"ngModelChange","ngModel","min","disabled"],["class","text-gray-500 block mt-2 mb-2 ml-4",4,"ngIf"],[1,"sticky","top-6","flex","flex-col","gap-4"],["class","form-section p-4",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-rounded","p-button-text","mobile-form-edit",3,"click"],["name","image","accept","image/*","styleClass","mobile-uploader",3,"onSelect","customUpload","multiple","showUploadButton","showCancelButton","auto","disabled"],[1,"mobile-upload-zone",3,"click"],[1,"mobile-upload-placeholder"],[1,"pi","pi-camera"],[1,"mobile-upload-preview"],["alt","Image du produit",3,"src"],["pButton","","pRipple","","rounded","","type","button","severity","danger","class","mobile-remove-img",3,"click",4,"ngIf"],["class","mobile-upload-loading",4,"ngIf"],["class","mobile-delete-confirm",4,"ngIf"],["pButton","","pRipple","","rounded","","type","button","severity","danger",1,"mobile-remove-img",3,"click"],[1,"pi","pi-times"],[1,"mobile-upload-loading"],[1,"pi","pi-spin","pi-spinner","text-white","text-3xl"],[1,"mobile-delete-confirm"],[1,"text-white","text-sm","font-semibold","mb-3","text-center"],[1,"flex","gap-2","justify-center"],["pButton","","type","button","severity","danger","size","small","label","Supprimer",3,"click"],["pButton","","type","button","severity","secondary","size","small","label","Annuler",3,"click"],[1,"px-3","pb-2"],[1,"block","text-center","text-surface-400"],[1,"pi","pi-info-circle","mr-1"],["class","block text-center text-red-500 mt-1",4,"ngIf"],[1,"block","text-center","text-red-500","mt-1"],[1,"pi","pi-exclamation-circle","mr-1"],[1,"pi","pi-image"],[1,"mobile-info-hint"],[1,"text-red-500"],["mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],[1,"mobile-service-alert"],[1,"pi","pi-exclamation-circle"],[1,"mobile-bottom-actions"],["pButton","","pRipple","","icon","pi pi-check",1,"mobile-btn-save",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"mobile-btn-cancel",3,"click","disabled"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn",1,"w-auto",3,"click"],[1,"flex-1","min-w-0","price-field-anim"],["inputId","prix_achat","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix d'achat","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["inputId","prix_vente","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix de vente","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["inputId","prix_usine","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix usine","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],[1,"col-span-12","service-alert"],[1,"pi","pi-exclamation-circle","mr-2"],["name","image","accept","image/*","styleClass","product-uploader border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 p-0 rounded-lg",3,"onSelect","customUpload","multiple","showUploadButton","showCancelButton","auto","disabled"],[1,"block","mt-2","text-surface-400"],["class","block mt-1 text-red-500",4,"ngIf"],[1,"w-full","py-4","upload-dropzone",3,"click"],["class","h-48 flex flex-col justify-center items-center",4,"ngIf"],["class","relative w-full flex justify-center py-3",4,"ngIf"],[1,"h-48","flex","flex-col","justify-center","items-center"],[1,"pi","pi-image","text-primary","text-4xl","mb-4"],[1,"block","font-semibold","text-surface-900","dark:text-surface-0","text-lg"],[1,"text-surface-500","text-sm","mt-1"],[1,"relative","w-full","flex","justify-center","py-3"],[1,"relative","inline-block"],["alt","Image du produit",1,"max-h-72","rounded","shadow","object-contain",3,"src"],["pButton","","pRipple","","rounded","","type","button","severity","danger","class","absolute -top-2 -right-2",3,"click",4,"ngIf"],["class","absolute inset-0 flex items-center justify-center bg-surface-0/80 dark:bg-surface-900/80 rounded",4,"ngIf"],["class","absolute inset-0 flex flex-col items-center justify-center rounded","style","background: rgba(0,0,0,0.65);",4,"ngIf"],["pButton","","pRipple","","rounded","","type","button","severity","danger",1,"absolute","-top-2","-right-2",3,"click"],[1,"absolute","inset-0","flex","items-center","justify-center","bg-surface-0/80","dark:bg-surface-900/80","rounded"],[1,"pi","pi-spin","pi-spinner","text-primary","text-3xl"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","rounded",2,"background","rgba(0,0,0,0.65)"],[1,"text-white","text-sm","font-semibold","mb-3","px-3","text-center"],[1,"flex","gap-2"],[1,"block","mt-1","text-red-500"],[1,"flex","justify-center","mt-2"],[1,"text-gray-500","block","mt-2","mb-2","ml-4"],[1,"form-section","p-4"],[1,"flex","gap-3"],["pButton","","pRipple","","icon","pi pi-check",1,"flex-1",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"flex-1",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",3)(1,"div",4)(2,"header",5)(3,"button",6),g("click",function(){return i.onCancel()}),n(),a(4,"div",7)(5,"h1",8),c(6),n()(),_(7,ci,1,0,"button",9),n(),a(8,"div",10),_(9,hi,5,6,"div",11)(10,Pi,5,1,"div",12)(11,Ci,2,1,"div",13)(12,xi,4,0,"div",14),n(),a(13,"div",15)(14,"div",16)(15,"div",17)(16,"label",18),c(17,"Type"),n(),a(18,"p-select",19),C("ngModelChange",function(l){return P(i.product.type,l)||(i.product.type=l),l}),g("onChange",function(){return i.onTypeChange()}),n()(),a(19,"div",17)(20,"label",18),c(21,"Stock"),n(),a(22,"p-inputnumber",20),C("ngModelChange",function(l){return P(i.product.qte_stock,l)||(i.product.qte_stock=l),l}),n()()(),_(23,yi,3,0,"small",21),n(),a(24,"div",15)(25,"input",22),C("ngModelChange",function(l){return P(i.product.nom,l)||(i.product.nom=l),l}),n(),_(26,Mi,2,0,"small",23),n(),a(27,"div",15)(28,"label",18),c(29,"Prix"),n(),a(30,"div",24),_(31,Oi,5,5,"div",25)(32,ki,5,5,"div",25),a(33,"div",26)(34,"span",27),c(35,"Co\xFBt"),n(),a(36,"p-inputnumber",28),C("ngModelChange",function(l){return P(i.product.cout,l)||(i.product.cout=l),l}),n()(),_(37,Ti,5,5,"div",25),n(),_(38,Ii,3,0,"div",29),n(),a(39,"div",30)(40,"span",31),c(41,"Status"),n(),a(42,"span",32),c(43),n(),a(44,"p-toggleswitch",33),g("ngModelChange",function(l){return i.onStatutToggleChange(l)}),n()(),_(45,Fi,3,4,"div",34),n(),a(46,"div",35)(47,"div",36)(48,"div")(49,"span",37),c(50),n(),a(51,"small",38),c(52," Renseignez les informations principales, les prix et le statut de publication. "),n()(),_(53,Vi,1,0,"button",39),n(),a(54,"p-fluid",40)(55,"div",41)(56,"div",42)(57,"div",43)(58,"label",44),c(59," Type de produit "),_(60,Di,2,0,"span",23),n(),a(61,"p-select",45),C("ngModelChange",function(l){return P(i.product.type,l)||(i.product.type=l),l}),g("onChange",function(){return i.onTypeChange()}),n(),a(62,"small",46),b(63,"i",47),c(64," Le type d\xE9termine les champs de prix et la gestion du stock. "),n()(),a(65,"div",48)(66,"div",49)(67,"label",50),c(68,"Nom du produit "),_(69,Li,2,0,"span",23),n(),a(70,"input",51),C("ngModelChange",function(l){return P(i.product.nom,l)||(i.product.nom=l),l}),n(),_(71,Ri,2,0,"small",23),n(),a(72,"div",49)(73,"div",52)(74,"label",44),c(75,"Prix"),n()(),a(76,"div",53),_(77,Wi,3,5,"div",54)(78,Bi,3,5,"div",54)(79,zi,3,5,"div",54),n(),a(80,"small",55),b(81,"i",47),c(82),n()(),_(83,ji,3,0,"div",56),n()(),a(84,"div",57)(85,"div",58),b(86,"i",59),c(87," Visuel du produit "),n(),_(88,Xi,9,7,"div",11)(89,Zi,2,1,"div",60),n()(),a(90,"div",61)(91,"div",62)(92,"span",63),c(93,"Etat du produit"),n(),a(94,"div",64)(95,"div",65)(96,"span",66),c(97,"Status:"),n(),a(98,"span",67),c(99),n(),a(100,"p-toggleswitch",33),g("ngModelChange",function(l){return i.onStatutToggleChange(l)}),n()()()(),a(101,"div",62)(102,"span",63),c(103,"Co\xFBt"),n(),a(104,"div",64)(105,"p-inputnumber",68),C("ngModelChange",function(l){return P(i.product.cout,l)||(i.product.cout=l),l}),n()()(),a(106,"div",62)(107,"span",63),c(108,"Quantit\xE9 en stock"),n(),a(109,"div",64)(110,"p-inputnumber",20),C("ngModelChange",function(l){return P(i.product.qte_stock,l)||(i.product.qte_stock=l),l}),n()(),_(111,$i,3,0,"small",69),n(),a(112,"div",70),_(113,er,4,4,"div",71),n()()()()()),e&2&&(s(6),V(" ",i.mode==="create"?"Nouveau produit":"D\xE9tails du produit"," "),s(),d("ngIf",i.mode==="edit"&&!i.isEditing),s(2),d("ngIf",i.isEditing),s(),d("ngIf",i.isEditing),s(),d("ngIf",!i.isEditing&&i.product.image_url),s(),d("ngIf",!i.isEditing&&!i.product.image_url),s(6),d("options",i.typeOptions),v("ngModel",i.product.type),d("disabled",i.fieldsDisabled),s(4),v("ngModel",i.product.qte_stock),d("showButtons",!0)("min",0)("disabled",i.isQteStockDisabled()),s(),d("ngIf",i.product.type==="service"),s(2),v("ngModel",i.product.nom),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())),s(),d("ngIf",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())&&i.isEditing),s(5),d("ngIf",i.isPrixAchatVisible()),s(),d("ngIf",i.isPrixVenteVisible()),s(4),v("ngModel",i.product.cout),d("min",0)("disabled",i.fieldsDisabled),s(),d("ngIf",i.isPrixUsineVisible()),s(),d("ngIf",i.showServicePriceError()),s(4),$("active",i.isActifSwitch),s(),S(i.isActifSwitch?"Actif":"Inactif"),s(),d("ngModel",i.isActifSwitch)("disabled",i.fieldsDisabled),s(),d("ngIf",i.isEditing),s(5),V(" ",i.mode==="create"?"Cr\xE9er un produit":"D\xE9tails du produit"," "),s(3),d("ngIf",i.mode==="edit"&&!i.isEditing),s(7),d("ngIf",i.isEditing),s(),d("options",i.typeOptions),v("ngModel",i.product.type),d("disabled",i.fieldsDisabled),s(8),d("ngIf",i.isEditing),s(),v("ngModel",i.product.nom),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())),s(),d("ngIf",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())&&i.isEditing),s(6),d("ngIf",i.isPrixAchatVisible()),s(),d("ngIf",i.isPrixVenteVisible()),s(),d("ngIf",i.isPrixUsineVisible()),s(3),V(" ",i.getPrixHelperText()," "),s(),d("ngIf",i.showServicePriceError()),s(5),d("ngIf",i.isEditing),s(),d("ngIf",!i.isEditing&&i.product.image_url),s(10),S(i.isActifSwitch?"Actif":"Inactif"),s(),d("ngModel",i.isActifSwitch)("disabled",i.fieldsDisabled),s(5),v("ngModel",i.product.cout),d("min",0)("disabled",i.fieldsDisabled),s(5),v("ngModel",i.product.qte_stock),d("showButtons",!0)("min",0)("disabled",i.isQteStockDisabled()),s(),d("ngIf",i.product.type==="service"),s(2),d("ngIf",i.isEditing))},dependencies:[L,N,bt,se,le,ae,re,ne,oe,_t,gt,ue,ce,fe,_e,ge,me,pe,de,ft,Be,Ue,he,be],styles:[".product-form[_ngcontent-%COMP%]   .mobile-form-container[_ngcontent-%COMP%]{display:none}.product-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--surface-200);padding-bottom:1rem}.product-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]{border:1px solid var(--surface-200);border-radius:.875rem;background:var(--surface-0);padding:1.25rem}.product-form[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-bottom:1rem;font-weight:700;color:var(--text-color)}.product-form[_ngcontent-%COMP%]   .side-title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-color);padding:1rem 1rem .875rem;border-bottom:1px solid var(--surface-200);background:color-mix(in srgb,var(--surface-50) 70%,transparent)}.product-form[_ngcontent-%COMP%]   .helper-chip[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--blue-100) 50%,transparent);border-radius:999px;padding:.35rem .7rem;font-weight:500}.product-form[_ngcontent-%COMP%]   .status-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-size:.8rem;font-weight:700;border-radius:999px;padding:.2rem .6rem}.product-form[_ngcontent-%COMP%]   .status-pill-active[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.product-form[_ngcontent-%COMP%]   .status-pill-inactive[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.product-form[_ngcontent-%COMP%]   .service-alert[_ngcontent-%COMP%]{display:flex;align-items:center;color:#991b1b;background:#fef2f2;border:1px solid #fecaca;border-radius:.5rem;padding:.65rem .8rem;font-size:.9rem}.product-form[_ngcontent-%COMP%]   .upload-dropzone[_ngcontent-%COMP%]{cursor:pointer;border-radius:.75rem;transition:background-color .2s ease}.product-form[_ngcontent-%COMP%]   .upload-dropzone[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary-50) 35%,transparent)}.product-form[_ngcontent-%COMP%]   .type-selector-block[_ngcontent-%COMP%]{padding-bottom:.75rem;border-bottom:1px solid var(--surface-200)}.product-form[_ngcontent-%COMP%]   .form-field-label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:500;color:var(--surface-900);margin-bottom:.5rem}.product-form[_ngcontent-%COMP%]   .form-field-hint[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;margin-top:.4rem;font-size:.78rem;color:#94a3b8}.product-form[_ngcontent-%COMP%]   .form-field-hint[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.7rem}.product-form[_ngcontent-%COMP%]   .prix-section-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.5rem}.product-form[_ngcontent-%COMP%]   .prix-helper-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;margin-top:.6rem;font-size:.78rem;color:#94a3b8}.product-form[_ngcontent-%COMP%]   .prix-helper-text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.7rem}.product-form[_ngcontent-%COMP%]   .price-field-anim[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_priceFieldFade .18s ease-out}@keyframes _ngcontent-%COMP%_priceFieldFade{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .type-selector-block[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .type-selector-block[_ngcontent-%COMP%]{border-bottom-color:var(--p-surface-700)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .form-field-label[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .form-field-label[_ngcontent-%COMP%]{color:var(--p-surface-0)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .form-field-hint[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .form-field-hint[_ngcontent-%COMP%], .app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .prix-helper-text[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .prix-helper-text[_ngcontent-%COMP%]{color:var(--p-surface-500)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .status-pill-active[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .status-pill-active[_ngcontent-%COMP%]{background:#05966933;color:#34d399}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .status-pill-inactive[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .status-pill-inactive[_ngcontent-%COMP%]{background:#d9770633;color:#fbbf24}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .service-alert[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .service-alert[_ngcontent-%COMP%]{background:#dc262626;border-color:var(--p-surface-600);color:#f87171}@media screen and (max-width: 768px){.product-form[_ngcontent-%COMP%]{border:0!important;border-radius:0!important;box-shadow:none!important;background:#f8f9fc!important;margin:-.5rem -.875rem calc(-.5rem - env(safe-area-inset-bottom));padding:0;min-height:100dvh}.product-form[_ngcontent-%COMP%]   .mobile-form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:calc(.75rem + env(safe-area-inset-top)) 1rem calc(5.5rem + env(safe-area-inset-bottom));animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.product-form[_ngcontent-%COMP%]   .desktop-form-container[_ngcontent-%COMP%]{display:none!important}.product-form[_ngcontent-%COMP%]   .mobile-form-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding-bottom:.25rem}.product-form[_ngcontent-%COMP%]   .mobile-form-back[_ngcontent-%COMP%], .product-form[_ngcontent-%COMP%]   .mobile-form-edit[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:999px;flex-shrink:0;color:#1e293b!important;background:transparent!important;border:0!important;box-shadow:none!important}.product-form[_ngcontent-%COMP%]   .mobile-form-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0}.product-form[_ngcontent-%COMP%]   .mobile-form-title[_ngcontent-%COMP%]{margin:0;font-size:1.15rem;font-weight:700;color:#1e293b;letter-spacing:-.01em;text-align:center}.product-form[_ngcontent-%COMP%]   .mobile-image-card[_ngcontent-%COMP%]{background:#fff;border-radius:1rem;overflow:hidden;box-shadow:0 1px 3px #0000000f,0 4px 12px #0000000a}.product-form   [_nghost-%COMP%]     .mobile-uploader{border:0!important;background:transparent!important;box-shadow:none!important}.product-form   [_nghost-%COMP%]     .mobile-uploader .p-fileupload-header{display:none}.product-form   [_nghost-%COMP%]     .mobile-uploader .p-fileupload-file-list{display:none}.product-form   [_nghost-%COMP%]     .mobile-uploader .p-fileupload-content{padding:0;border:0;min-height:auto;height:auto!important}.product-form[_ngcontent-%COMP%]   .mobile-upload-zone[_ngcontent-%COMP%]{cursor:pointer;min-height:11rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:11rem;color:#94a3b8;gap:.5rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#cbd5e1}.product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600}.product-form[_ngcontent-%COMP%]   .mobile-upload-preview[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;padding:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:12rem;width:auto;border-radius:.75rem;object-fit:contain}.product-form[_ngcontent-%COMP%]   .mobile-remove-img[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem;width:1.75rem!important;height:1.75rem!important;border-radius:999px!important}.product-form[_ngcontent-%COMP%]   .mobile-remove-img[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.7rem}.product-form[_ngcontent-%COMP%]   .mobile-upload-loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#00000073;border-radius:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-delete-confirm[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:.75rem;background:#000000a6;padding:1rem}.product-form[_ngcontent-%COMP%]   .mobile-section-card[_ngcontent-%COMP%]{background:#fff;border-radius:1rem;padding:1rem;box-shadow:0 1px 3px #0000000f,0 4px 12px #0000000a}.product-form[_ngcontent-%COMP%]   .mobile-field-label[_ngcontent-%COMP%]{display:block;font-size:.7rem;font-weight:700;color:#94a3b8;text-transform:uppercase;letter-spacing:.06em;margin-bottom:.5rem}.product-form[_ngcontent-%COMP%]   .mobile-price-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-price-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.product-form[_ngcontent-%COMP%]   .mobile-price-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:#64748b}.product-form[_ngcontent-%COMP%]   .mobile-service-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.35rem;margin-top:.6rem;padding:.5rem .65rem;background:#fef2f2;border:1px solid #fecaca;border-radius:.65rem;font-size:.8rem;color:#991b1b}.product-form[_ngcontent-%COMP%]   .mobile-meta-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}.product-form[_ngcontent-%COMP%]   .mobile-meta-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.product-form[_ngcontent-%COMP%]   .mobile-info-hint[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;margin-top:.5rem;font-size:.75rem;color:#94a3b8;font-weight:500}.product-form[_ngcontent-%COMP%]   .mobile-status-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.product-form[_ngcontent-%COMP%]   .mobile-status-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700;color:#334155}.product-form[_ngcontent-%COMP%]   .mobile-status-value[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:#94a3b8}.product-form[_ngcontent-%COMP%]   .mobile-status-value.active[_ngcontent-%COMP%]{color:#16a34a}.product-form   [_nghost-%COMP%]     .p-inputtext, .product-form   [_nghost-%COMP%]     .p-inputnumber-input, .product-form   [_nghost-%COMP%]     .p-select-label{font-size:16px!important;min-height:2.65rem}.product-form[_ngcontent-%COMP%]   .mobile-bottom-actions[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;z-index:50;display:flex;gap:.5rem;padding:.75rem 1rem calc(.75rem + env(safe-area-inset-bottom));background:#ffffffeb;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1px solid #e2e8f0}.product-form[_ngcontent-%COMP%]   .mobile-btn-save[_ngcontent-%COMP%]{flex:1;border-radius:.75rem!important;font-weight:700!important;min-height:2.75rem}.product-form[_ngcontent-%COMP%]   .mobile-btn-cancel[_ngcontent-%COMP%]{flex:0 0 auto;border-radius:.75rem!important;font-weight:600!important;min-height:2.75rem}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]{background:var(--p-surface-950)!important}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-form-back[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-form-back[_ngcontent-%COMP%], .app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-form-edit[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-form-edit[_ngcontent-%COMP%]{color:var(--p-surface-100)!important}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-form-title[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-form-title[_ngcontent-%COMP%]{color:var(--p-surface-0)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-image-card[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-image-card[_ngcontent-%COMP%]{background:var(--p-surface-800);box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-upload-placeholder[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--p-surface-500)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-section-card[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-section-card[_ngcontent-%COMP%]{background:var(--p-surface-800);box-shadow:0 1px 3px #00000026}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-field-label[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-field-label[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-price-label[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-price-label[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-service-alert[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-service-alert[_ngcontent-%COMP%]{background:#dc262626;border-color:var(--p-surface-600);color:#f87171}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-info-hint[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-info-hint[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-status-label[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-status-label[_ngcontent-%COMP%]{color:var(--p-surface-200)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-status-value[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-status-value[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-status-value.active[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-status-value.active[_ngcontent-%COMP%]{color:#34d399}.app-dark[_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-bottom-actions[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .product-form[_ngcontent-%COMP%]   .mobile-bottom-actions[_ngcontent-%COMP%]{background:#0f172aeb;border-top-color:var(--p-surface-700)}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}","[_nghost-%COMP%]     .p-fileupload-header{display:none}[_nghost-%COMP%]     .p-fileupload-file-list{display:none}[_nghost-%COMP%]     .p-fileupload-content{height:20rem}"]})};var Ce=class r{constructor(t,e,i,o){this.router=t;this.messageService=e;this.produitService=i;this.document=o}loading=!1;mobileBreakpoint=768;mobilePwaClass="produits-mobile-pwa";ngOnInit(){this.updateMobilePwaMode()}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onResize(){this.updateMobilePwaMode()}updateMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}onSubmitForm(t){this.loading=!0;let e=t.image??null;this.produitService.create(t).subscribe({next:i=>{e&&i.id?this.uploadImageAfterCreate(i,e):this.handleSuccess("Produit cr\xE9\xE9 avec succ\xE8s",i)},error:i=>this.handleError("Erreur lors de la cr\xE9ation du produit",i)})}uploadImageAfterCreate(t,e){this.produitService.uploadProduitImage(t.id,e).subscribe({next:i=>{this.handleSuccess("Produit cr\xE9\xE9 avec succ\xE8s",i)},error:()=>{this.messageService.add({severity:"warn",summary:"Attention",detail:"Produit cr\xE9\xE9, mais l'image n'a pas pu \xEAtre envoy\xE9e.",life:5e3}),this.loading=!1,this.router.navigate(["/produits/produits-edit",t.id])}})}onCancel(){this.router.navigate(["/produits"])}handleSuccess(t,e){if(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t,life:2e3}),this.loading=!1,e?.id){this.router.navigate(["/produits/produits-edit",e.id]);return}this.router.navigate(["/produits"])}handleError(t,e){let i=e?.error?.message||t;e?.status===422&&e?.error?.errors?Object.values(e.error.errors).flat().forEach(l=>{this.messageService.add({severity:"error",summary:i,detail:l,life:5e3})}):this.messageService.add({severity:"error",summary:"Erreur",detail:i,life:5e3}),this.loading=!1,console.error(e)}static \u0275fac=function(e){return new(e||r)(y(z),y(w),y(T),y(A))};static \u0275cmp=F({type:r,selectors:[["app-produits-new"]],hostBindings:function(e,i){e&1&&g("resize",function(){return i.onResize()},W)},features:[D([w])],decls:2,vars:1,consts:[["mode","create",3,"submitForm","cancel","loading"]],template:function(e,i){e&1&&(b(0,"p-toast"),a(1,"app-produits-form",0),g("submitForm",function(l){return i.onSubmitForm(l)})("cancel",function(){return i.onCancel()}),n()),e&2&&(s(),d("loading",i.loading))},dependencies:[L,G,q,j],encapsulation:2})};function tr(r,t){if(r&1){let e=h();a(0,"app-produits-form",1),g("submitForm",function(o){u(e);let l=p();return m(l.onSubmitForm(o))})("cancel",function(){u(e);let o=p();return m(o.onCancel())})("deleteImage",function(){u(e);let o=p();return m(o.onDeleteImage())}),n()}if(r&2){let e=p();d("initialData",e.initialData)("loading",e.loading)}}var xe=class r{constructor(t,e,i,o,l){this.route=t;this.router=e;this.produitService=i;this.messageService=o;this.document=l}loading=!1;produitId=null;initialData=null;mobileBreakpoint=768;mobilePwaClass="produits-mobile-pwa";ngOnInit(){this.updateMobilePwaMode();let t=this.route.snapshot.paramMap.get("id"),e=t?Number(t):NaN;if(!Number.isFinite(e)||e<=0){this.router.navigate(["/produits"]);return}this.produitId=e,this.loadProduit(e)}onSubmitForm(t){if(!this.produitId)return;this.loading=!0;let e=t.image??null;this.produitService.update(this.produitId,t).subscribe({next:i=>{e?this.uploadImageAfterUpdate(i,e):(this.initialData=i,this.loading=!1,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Produit modifi\xE9 avec succ\xE8s",life:3e3}))},error:i=>{this.loading=!1,this.showApiError(i,"Erreur lors de la modification du produit")}})}onDeleteImage(){this.produitId&&(this.loading=!0,this.produitService.deleteProduitImage(this.produitId).subscribe({next:t=>{this.initialData=t,this.loading=!1,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Image supprim\xE9e avec succ\xE8s",life:3e3})},error:t=>{this.initialData=k({},this.initialData),this.loading=!1,this.showApiError(t,"Impossible de supprimer l'image")}}))}uploadImageAfterUpdate(t,e){this.produitService.uploadProduitImage(t.id,e).subscribe({next:i=>{this.initialData=i,this.loading=!1,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Produit modifi\xE9 avec succ\xE8s",life:3e3})},error:()=>{this.initialData=t,this.loading=!1,this.messageService.add({severity:"warn",summary:"Attention",detail:"Produit modifi\xE9, mais l'image n'a pas pu \xEAtre envoy\xE9e.",life:5e3})}})}onCancel(){this.router.navigate(["/produits"])}loadProduit(t){this.loading=!0,this.produitService.getById(t).subscribe({next:e=>{this.initialData=e,this.loading=!1},error:e=>{this.loading=!1,this.showApiError(e,"Erreur lors du chargement du produit")}})}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onResize(){this.updateMobilePwaMode()}updateMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}showApiError(t,e){let i=t?.error?.message||e;this.messageService.add({severity:"error",summary:"Erreur",detail:i,life:5e3})}static \u0275fac=function(e){return new(e||r)(y(te),y(z),y(T),y(w),y(A))};static \u0275cmp=F({type:r,selectors:[["app-produits-edit"]],hostBindings:function(e,i){e&1&&g("resize",function(){return i.onResize()},W)},features:[D([w])],decls:2,vars:1,consts:[["mode","edit",3,"initialData","loading","submitForm","cancel","deleteImage",4,"ngIf"],["mode","edit",3,"submitForm","cancel","deleteImage","initialData","loading"]],template:function(e,i){e&1&&(b(0,"p-toast"),_(1,tr,1,2,"app-produits-form",0)),e&2&&(s(),d("ngIf",i.initialData))},dependencies:[L,N,G,q,j],encapsulation:2})};var eo=[{path:"",component:Q,canActivate:[H],data:{permissions:["produits.read"]}},{path:"produits",component:Q,canActivate:[H],data:{permissions:["produits.read"]}},{path:"produits-new",component:Ce,canActivate:[H],data:{permissions:["produits.create"]}},{path:"produits-edit/:id",component:xe,canActivate:[H],data:{permissions:["produits.update"]}},{path:"**",redirectTo:"/notfound"}];export{eo as default};
