import{a as Ze,b as $e}from"./chunk-6OFAV6OQ.js";import"./chunk-2BGCBJPY.js";import{a as X}from"./chunk-D5X74NB2.js";import{a as me,b as Ye}from"./chunk-JFBSWTEJ.js";import{a as R}from"./chunk-IUCT6ZC4.js";import{a as Qe}from"./chunk-2L636W5W.js";import{a as De,b as Le}from"./chunk-TNJP7QOA.js";import{a as He,b as Ge}from"./chunk-LOBJQVB7.js";import"./chunk-3HDW43E7.js";import{a as Ae,d as Ne,e as Be,f as We,k as ze}from"./chunk-KYBPPGZP.js";import"./chunk-KKEZTC3T.js";import"./chunk-QAU7W4US.js";import"./chunk-GO7AEQHW.js";import"./chunk-44MNQRCX.js";import"./chunk-FHJ3HI6Y.js";import"./chunk-MGFZT6L3.js";import{a as je,b as qe}from"./chunk-2M2YESUI.js";import"./chunk-Q737E3VB.js";import"./chunk-GVSJPEUD.js";import"./chunk-CQGFVLY5.js";import"./chunk-ZOHIMUT6.js";import"./chunk-TB7JIXSI.js";import{a as J,b as K}from"./chunk-D4ZZGRXJ.js";import"./chunk-USWDVUUM.js";import"./chunk-KHGHC55C.js";import{a as Z}from"./chunk-72QBRNRN.js";import{a as le,b as Re}from"./chunk-2EPSW4YJ.js";import"./chunk-MYGUYXAJ.js";import"./chunk-UWJ6EXCC.js";import"./chunk-NIW5LLYW.js";import{b as Ee,d as F}from"./chunk-RPS5NP6I.js";import"./chunk-TZVXXQOJ.js";import{a as U,d as Me}from"./chunk-PPJOJKS5.js";import{c as Q,e as Y}from"./chunk-P557RNKH.js";import"./chunk-PALTTDOF.js";import{c as $,d as Ve}from"./chunk-WF73AWMM.js";import"./chunk-SXW2RLBH.js";import"./chunk-LSUA6MZX.js";import"./chunk-M2LTT3HJ.js";import"./chunk-JYP5AZVX.js";import"./chunk-T7HI4VPR.js";import{a as Ie,c as ke}from"./chunk-II7RVJNR.js";import{a as q,b as Te}from"./chunk-PW7MMR7K.js";import{b as B,e as W,h as z,p as j}from"./chunk-3LUOICNH.js";import{a as Oe,b as Fe}from"./chunk-3G6KBQ3S.js";import"./chunk-D7FY7VLK.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as H,j as G}from"./chunk-IK72ORTM.js";import"./chunk-Z2XDSDL7.js";import{la as N,pa as S,ta as Pe}from"./chunk-344GK45C.js";import{j as Ue,k as O,v as E}from"./chunk-6PXXCRY5.js";import"./chunk-4O3FVBGX.js";import{$ as g,$b as x,Ab as h,Eb as be,Fb as ve,Hb as v,Ja as ne,La as he,Lb as _,Mb as d,Na as s,R as ue,Sa as oe,V as ge,Vb as L,Xb as ye,Ya as b,Yb as Ce,Zb as we,_b as p,aa as f,ac as T,bb as M,bc as xe,dc as y,ea as fe,ec as C,fc as w,gc as Se,hb as c,hc as k,ic as A,ma as _e,sc as ae,uc as se,wc as I,xb as m,yb as o,zb as n}from"./chunk-E5DLUAUS.js";import{a as D}from"./chunk-GAL4ENT6.js";var P=class r{constructor(i){this.http=i}apiUrl=`${le.apiUrl}/users`;authUrl=`${le.apiUrl}/auth`;createUser(i){return this.http.post(`${this.authUrl}/register`,i)}getUsers(i){let e=new U;return i&&(i.is_active!==void 0&&(e=e.set("is_active",i.is_active.toString())),i.search&&(e=e.set("search",i.search)),i.pays&&(e=e.set("pays",i.pays)),i.ville&&(e=e.set("ville",i.ville)),i.sort_by&&(e=e.set("sort_by",i.sort_by)),i.sort_order&&(e=e.set("sort_order",i.sort_order)),i.per_page&&(e=e.set("per_page",i.per_page.toString())),i.page&&(e=e.set("page",i.page.toString()))),this.http.get(this.apiUrl,{params:e})}getUser(i){return this.http.get(`${this.apiUrl}/${i}`)}updateUser(i,e){return this.http.put(`${this.apiUrl}/${i}`,e)}toggleUserStatus(i){return this.http.patch(`${this.apiUrl}/${i}/toggle-status`,{})}deleteUser(i){return this.http.delete(`${this.apiUrl}/${i}`)}searchUsers(i){let e=new U().set("search",i);return this.http.get(this.apiUrl,{params:e})}getActiveUsers(){let i=new U().set("is_active","true");return this.http.get(this.apiUrl,{params:i})}getInactiveUsers(){let i=new U().set("is_active","false");return this.http.get(this.apiUrl,{params:i})}getUsersByCountry(i){let e=new U().set("pays",i);return this.http.get(this.apiUrl,{params:e})}getUsersByCity(i){let e=new U().set("ville",i);return this.http.get(this.apiUrl,{params:e})}getUsersPaginated(i=1,e=10,t){let a=new U().set("page",i.toString()).set("per_page",e.toString());return t&&(t.is_active!==void 0&&(a=a.set("is_active",t.is_active.toString())),t.search&&(a=a.set("search",t.search)),t.pays&&(a=a.set("pays",t.pays)),t.ville&&(a=a.set("ville",t.ville)),t.sort_by&&(a=a.set("sort_by",t.sort_by)),t.sort_order&&(a=a.set("sort_order",t.sort_order))),this.http.get(this.apiUrl,{params:a})}sortUsers(i,e="asc"){let t=new U().set("sort_by",i||"created_at").set("sort_order",e);return this.http.get(this.apiUrl,{params:t})}static \u0275fac=function(e){return new(e||r)(ge(Me))};static \u0275prov=ue({token:r,factory:r.\u0275fac,providedIn:"root"})};var rt=()=>[10,25,50],nt=()=>["nom_complet","email","phone","reference","pays","ville"],ot=()=>({"min-width":"150px"});function at(r,i){if(r&1){let e=v();o(0,"button",37),_("click",function(a){g(e);let l=d().$implicit,u=d(2);return a.stopPropagation(),f(u.deleteUser(a,l.id))}),n()}r&2&&m("pTooltip","Supprimer")}function st(r,i){if(r&1){let e=v();o(0,"article",27),_("click",function(a){let l=g(e).$implicit,u=d(2);return f(u.goToEdit(a,l.id))}),o(1,"div",28),p(2),n(),o(3,"div",29)(4,"div",30),p(5),n(),o(6,"div",31),p(7),ae(8,"phoneFormat"),n(),o(9,"div",32),h(10,"p-tag",33),o(11,"div",34)(12,"button",35),_("click",function(a){let l=g(e).$implicit,u=d(2);return f(u.goToEdit(a,l.id))}),n(),c(13,at,1,1,"button",36),n()()()()}if(r&2){let e=i.$implicit,t=d(2);s(2),T(" ",t.getInitials(e.nom_complet)," "),s(3),x(e.nom_complet),s(2),x(e.email||se(8,8,e.phone,"INT")),s(3),m("value",e.is_active?"Actif":"Inactif")("severity",e.is_active?"success":"danger"),s(2),m("pTooltip",t.canUpdate?"Modifier":"Voir")("disabled",!t.canUpdate),s(),m("ngIf",t.canDelete)}}function lt(r,i){if(r&1&&(o(0,"section",25),c(1,st,14,11,"article",26),n()),r&2){let e=d();s(),m("ngForOf",e.mobileVisibleUsers)("ngForTrackBy",e.trackByUserId)}}function mt(r,i){r&1&&(o(0,"div",39),p(1,"Chargement..."),n())}function pt(r,i){r&1&&(o(0,"div",39),p(1,"Aucun utilisateur."),n())}function dt(r,i){if(r&1&&c(0,mt,2,0,"div",38)(1,pt,2,0,"div",38),r&2){let e=d();m("ngIf",e.loading),s(),m("ngIf",!e.loading&&!e.mobileFilteredUsers.length)}}function ct(r,i){if(r&1){let e=v();o(0,"div",40)(1,"button",41),_("click",function(){g(e);let a=d();return f(a.loadMoreMobile())}),n()()}}function ut(r,i){if(r&1){let e=v();o(0,"button",42),_("click",function(){g(e);let a=d();return f(a.navigateToCreate())}),h(1,"i",43),n()}}function gt(r,i){if(r&1){let e=v();o(0,"button",50),_("click",function(){g(e);let a=d(2);return f(a.navigateToCreate())}),n()}}function ft(r,i){if(r&1){let e=v();o(0,"div",44)(1,"p-icon-field",45),h(2,"p-inputicon",18),o(3,"input",46),_("input",function(a){g(e);let l=d(),u=L(24);return f(l.onGlobalFilter(u,a))}),n()(),o(4,"div",47)(5,"p-select",48),w("ngModelChange",function(a){g(e);let l=d();return C(l.selectedStatus,a)||(l.selectedStatus=a),f(a)}),_("onChange",function(){g(e);let a=d();return f(a.filterByStatus())}),n(),c(6,gt,1,0,"button",49),n()()}if(r&2){let e=d();s(5),Ce(A(6,ot)),m("options",e.statusOptions),y("ngModel",e.selectedStatus),m("showClear",!0),s(),m("ngIf",e.canCreate)}}function _t(r,i){r&1&&(o(0,"tr")(1,"th",51)(2,"span",52),p(3," Nom complet "),h(4,"p-sortIcon",53),n()(),o(5,"th",54)(6,"span",52),p(7," T\xE9l\xE9phone "),h(8,"p-sortIcon",55),n()(),o(9,"th",56)(10,"span",52),p(11," R\xF4le "),n()(),o(12,"th",57)(13,"span",52),p(14," Adresse "),h(15,"p-sortIcon",58),n()(),o(16,"th",59)(17,"span",52),p(18," Statut "),h(19,"p-sortIcon",60),n()(),o(20,"th",61),p(21," Actions "),n()())}function ht(r,i){if(r&1&&h(0,"p-tag",75),r&2){let e=i.$implicit,t=d(3);m("value",e)("severity",t.getRoleSeverity(e))}}function bt(r,i){if(r&1&&(be(0),c(1,ht,1,2,"p-tag",74),ve()),r&2){let e=d().$implicit;s(),m("ngForOf",e.role_names||e.roles)}}function vt(r,i){r&1&&(o(0,"span",76),p(1,"-"),n())}function yt(r,i){if(r&1){let e=v();o(0,"button",77),_("click",function(a){g(e);let l=d().$implicit,u=d();return f(u.toggleStatus(a,l.id))}),n()}if(r&2){let e=d().$implicit;ye("p-button-success",e.is_active)("p-button-danger",!e.is_active),m("icon",e.is_active?"pi pi-lock-open":"pi pi-lock")("pTooltip",e.is_active?"D\xE9sactiver":"Activer")}}function Ct(r,i){if(r&1){let e=v();o(0,"button",37),_("click",function(a){g(e);let l=d().$implicit,u=d();return f(u.deleteUser(a,l.id))}),n()}r&2&&m("pTooltip","Supprimer")}function wt(r,i){if(r&1){let e=v();o(0,"tr",62)(1,"td")(2,"div",52)(3,"div",63),p(4),n(),o(5,"div")(6,"div",64),p(7),n(),o(8,"div",65),p(9),n()()()(),o(10,"td")(11,"div",66)(12,"span",67),p(13),ae(14,"phoneFormat"),n()()(),o(15,"td"),c(16,bt,2,1,"ng-container",68)(17,vt,2,0,"ng-template",null,7,I),n(),o(19,"td")(20,"div",52),h(21,"span"),o(22,"div")(23,"div",69),p(24),n(),o(25,"div",70),p(26),n()()()(),o(27,"td"),h(28,"p-tag",71),n(),o(29,"td")(30,"div",72)(31,"button",35),_("click",function(a){let l=g(e).$implicit,u=d();return f(u.goToEdit(a,l.id))}),n(),c(32,yt,1,6,"button",73)(33,Ct,1,1,"button",36),n()()()}if(r&2){let e=i.$implicit,t=L(18),a=d();m("pSelectableRow",e),s(4),T(" ",a.getInitials(e.nom_complet)," "),s(3),x(e.nom_complet),s(2),x(e.reference),s(4),x(se(14,18,e.phone,"INT")),s(3),m("ngIf",(e.role_names==null?null:e.role_names.length)||(e.roles==null?null:e.roles.length))("ngIfElse",t),s(5),we(Se("fi fi-",e.code_pays==null?null:e.code_pays.toLowerCase()," text-xl")),s(3),x(e.ville),s(2),x(e.quartier),s(2),m("value",e.is_active?"Actif":"Inactif")("severity",e.is_active?"success":"danger"),s(3),m("pTooltip",a.canUpdate?"Modifier":"Voir")("disabled",!a.canUpdate),s(),m("ngIf",a.canUpdate),s(),m("ngIf",a.canDelete)}}function xt(r,i){r&1&&(o(0,"tr")(1,"td",78)(2,"div",79),h(3,"i",80),o(4,"span"),p(5,"Aucun utilisateur trouv\xE9"),n()()()())}var te=class r{constructor(i,e,t,a,l,u){this.userService=i;this.router=e;this.messageService=t;this.confirmationService=a;this.authService=l;this.document=u;this.canCreate=this.authService.hasPermission("users.create"),this.canUpdate=this.authService.hasPermission("users.update"),this.canDelete=this.authService.hasPermission("users.delete")}users=[];selectedUser=null;loading=!1;selectedStatus=null;mobileSearchTerm="";mobilePageSize=10;mobileVisibleCount=this.mobilePageSize;mobileBreakpoint=768;mobilePwaClass="utilisateurs-mobile-pwa";statusOptions=[{label:"Actif",value:!0},{label:"Inactif",value:!1}];mobileStatusMenuItems=[{label:"Tous les statuts",command:()=>this.applyMobileStatusFilter(null)},{label:"Actif",command:()=>this.applyMobileStatusFilter(!0)},{label:"Inactif",command:()=>this.applyMobileStatusFilter(!1)}];canCreate=!1;canUpdate=!1;canDelete=!1;ngOnInit(){this.loadUsers(),this.syncMobilePwaMode()}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onWindowResize(){this.syncMobilePwaMode()}goHome(){this.router.navigate(["/"])}onMobileSearchChange(){this.mobileVisibleCount=this.mobilePageSize}get mobileFilteredUsers(){let i=this.mobileSearchTerm.trim().toLowerCase();return i?this.users.filter(e=>e.nom_complet&&e.nom_complet.toLowerCase().includes(i)||e.email&&e.email.toLowerCase().includes(i)||e.phone&&e.phone.replace(/\s/g,"").includes(i)||e.reference&&e.reference.toLowerCase().includes(i)):this.users}get mobileVisibleUsers(){return this.mobileFilteredUsers.slice(0,this.mobileVisibleCount)}get canLoadMoreMobile(){return this.mobileVisibleCount<this.mobileFilteredUsers.length}loadMoreMobile(){this.mobileVisibleCount+=this.mobilePageSize}trackByUserId(i,e){return e.id}syncMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}loadUsers(){this.loading=!0;let i=this.selectedStatus!==null?{is_active:this.selectedStatus}:void 0;this.userService.getUsers(i).subscribe({next:e=>{e.success&&(this.users=Array.isArray(e.data)?e.data:e.data.data,this.mobileVisibleCount=this.mobilePageSize),this.loading=!1},error:e=>{console.error("Erreur lors du chargement des utilisateurs:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les utilisateurs"}),this.loading=!1}})}onGlobalFilter(i,e){i.filterGlobal(e.target.value,"contains")}filterByStatus(){this.loadUsers()}applyMobileStatusFilter(i){this.selectedStatus=i,this.loadUsers()}navigateToCreate(){this.router.navigate(["contacts/utilisateurs/new"])}onRowSelect(i){this.router.navigate(["contacts/utilisateurs/edit",i.data.id])}goToEdit(i,e){i.stopPropagation(),this.router.navigate(["contacts/utilisateurs/edit/",e])}toggleStatus(i,e){i.stopPropagation();let a=this.users.find(l=>l.id===e)?.is_active?"d\xE9sactiver":"activer";this.confirmationService.confirm({message:`Voulez-vous vraiment ${a} cet utilisateur ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui",rejectLabel:"Non",accept:()=>{this.userService.toggleUserStatus(e).subscribe({next:l=>{l.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:l.message}),this.loadUsers())},error:l=>{console.error("Erreur:",l),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de changer le statut de l'utilisateur"})}})}})}deleteUser(i,e){i.stopPropagation(),this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer cet utilisateur ? Cette action est irr\xE9versible.",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, supprimer",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.userService.deleteUser(e).subscribe({next:t=>{t.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur supprim\xE9 avec succ\xE8s"}),this.loadUsers())},error:t=>{console.error("Erreur:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'utilisateur"})}})}})}getInitials(i){if(!i)return"??";let e=i.trim().split(" ");return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():i.substring(0,2).toUpperCase()}getRoleSeverity(i){return{admin:"danger",manager:"warn",employe:"info",superviseur:"success"}[i?.toLowerCase()]||"secondary"}static \u0275fac=function(e){return new(e||r)(b(P),b(F),b(S),b(N),b(Re),b(fe))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-liste"]],hostBindings:function(e,t){e&1&&_("resize",function(){return t.onWindowResize()},he)},features:[k([S,N])],decls:33,vars:20,consts:[["statusMenu",""],["mobileListState",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["noRole",""],[1,"utilisateurs-mobile-app"],[1,"mobile-header"],["pButton","","pRipple","","icon","pi pi-arrow-left","aria-label","Retour \xE0 l'accueil",1,"p-button-rounded","p-button-text","mobile-back",3,"click"],[1,"mobile-title-wrap"],[1,"mobile-title"],[1,"mobile-subtitle"],["appendTo","body","styleClass","mobile-status-menu",3,"model","popup"],["pButton","","pRipple","","icon","pi pi-filter","aria-label","Filtrer par statut",1,"p-button-rounded","p-button-text","mobile-add",3,"click"],[1,"mobile-scroll"],[1,"mobile-search"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Nom, email, t\xE9l\xE9phone...",1,"w-full",3,"ngModelChange","ngModel"],["class","mobile-list",4,"ngIf","ngIfElse"],["class","mobile-load-more",4,"ngIf"],["type","button","class","mobile-fab","aria-label","Nouveau utilisateur",3,"click",4,"ngIf"],[1,"card","utilisateurs-desktop"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","  {first} / {last} de {totalRecords} entr\xE9es","selectionMode","single","styleClass","cursor-pointer",3,"selectionChange","onRowSelect","value","paginator","rows","showCurrentPageReport","loading","rowsPerPageOptions","globalFilterFields","selection","rowHover"],[1,"mobile-list"],["class","mobile-user-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mobile-user-card",3,"click"],["aria-hidden","true",1,"mobile-card-avatar"],[1,"mobile-card-body"],[1,"mobile-card-name"],[1,"mobile-card-meta"],[1,"mobile-card-footer"],["styleClass","mobile-status-tag",3,"value","severity"],[1,"mobile-card-actions"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","pTooltip","disabled"],["pButton","","pRipple","","icon","pi pi-trash","class","p-button-rounded p-button-text p-button-danger p-button-sm","tooltipPosition","top",3,"pTooltip","click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-danger","p-button-sm",3,"click","pTooltip"],["class","mobile-state",4,"ngIf"],[1,"mobile-state"],[1,"mobile-load-more"],["pButton","","label","Charger plus","icon","pi pi-angle-down",1,"mobile-load-more-btn",3,"click"],["type","button","aria-label","Nouveau utilisateur",1,"mobile-fab",3,"click"],[1,"pi","pi-user-plus"],[1,"flex","flex-wrap","gap-2","items-center","justify-between"],[1,"w-full","sm:w-80","order-1","sm:order-0"],["pInputText","","type","text","placeholder","Rechercher un utilisateur...",1,"w-full",3,"input"],[1,"flex","gap-2","w-full","sm:w-auto","flex-order-0","sm:flex-order-1"],["placeholder","Tous les statuts",3,"ngModelChange","onChange","options","ngModel","showClear"],["pButton","","outlined","","class","flex-shrink-0","icon","pi pi-user-plus","label","Nouveau",3,"click",4,"ngIf"],["pButton","","outlined","","icon","pi pi-user-plus","label","Nouveau",1,"flex-shrink-0",3,"click"],["pSortableColumn","nom_complet",1,"white-space-nowrap",2,"width","25%"],[1,"flex","items-center","gap-2"],["field","nom_complet"],["pSortableColumn","phone",1,"white-space-nowrap",2,"width","15%"],["field","phone"],[1,"white-space-nowrap",2,"width","12%"],["pSortableColumn","pays",1,"white-space-nowrap",2,"width","18%"],["field","pays"],["pSortableColumn","is_active",1,"white-space-nowrap",2,"width","10%"],["field","is_active"],[1,"white-space-nowrap",2,"width","10%"],[3,"pSelectableRow"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary-100","text-primary-700","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-surface-500","mt-1"],[1,"flex","items-center","gap-1"],[1,"text-surface-700"],[4,"ngIf","ngIfElse"],[1,"font-medium"],[1,"text-sm","text-surface-500"],[3,"value","severity"],[1,"flex","gap-2"],["pButton","","pRipple","","class","p-button-rounded p-button-text p-button-sm","tooltipPosition","top",3,"icon","p-button-success","p-button-danger","pTooltip","click",4,"ngIf"],["class","mr-1",3,"value","severity",4,"ngFor","ngForOf"],[1,"mr-1",3,"value","severity"],[1,"text-surface-400"],["pButton","","pRipple","","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","icon","pTooltip"],["colspan","6",1,"text-center","py-8"],[1,"flex","flex-col","items-center","gap-3","text-surface-500"],[1,"pi","pi-users","text-4xl"]],template:function(e,t){if(e&1){let a=v();h(0,"p-confirmDialog"),o(1,"div",8)(2,"header",9)(3,"button",10),_("click",function(){return g(a),f(t.goHome())}),n(),o(4,"div",11)(5,"h1",12),p(6,"Utilisateurs"),n(),o(7,"p",13),p(8),n()(),h(9,"p-menu",14,0),o(11,"button",15),_("click",function(u){g(a);let Xe=L(10);return f(Xe.toggle(u))}),n()(),o(12,"div",16)(13,"section",17)(14,"p-icon-field"),h(15,"p-inputicon",18),o(16,"input",19),w("ngModelChange",function(u){return g(a),C(t.mobileSearchTerm,u)||(t.mobileSearchTerm=u),f(u)}),_("ngModelChange",function(){return g(a),f(t.onMobileSearchChange())}),n()()(),c(17,lt,2,2,"section",20)(18,dt,2,2,"ng-template",null,1,I)(20,ct,2,0,"div",21),n(),c(21,ut,2,0,"button",22),n(),o(22,"div",23)(23,"p-table",24,2),w("selectionChange",function(u){return g(a),C(t.selectedUser,u)||(t.selectedUser=u),f(u)}),_("onRowSelect",function(u){return g(a),f(t.onRowSelect(u))}),c(25,ft,7,7,"ng-template",null,3,I)(27,_t,22,0,"ng-template",null,4,I)(29,wt,34,21,"ng-template",null,5,I)(31,xt,6,0,"ng-template",null,6,I),n()()}if(e&2){let a=L(19);s(8),xe("",t.mobileFilteredUsers.length," utilisateur",t.mobileFilteredUsers.length!==1?"s":""),s(),m("model",t.mobileStatusMenuItems)("popup",!0),s(7),y("ngModel",t.mobileSearchTerm),s(),m("ngIf",!t.loading&&t.mobileVisibleUsers.length)("ngIfElse",a),s(3),m("ngIf",!t.loading&&t.canLoadMoreMobile),s(),m("ngIf",t.canCreate),s(2),m("value",t.users)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("loading",t.loading)("rowsPerPageOptions",A(18,rt))("globalFilterFields",A(19,nt)),y("selection",t.selectedUser),m("rowHover",!0)}},dependencies:[E,Ue,O,j,B,W,z,ze,Ae,Ne,We,Be,Te,q,Y,Q,G,H,Ie,ke,qe,je,Fe,Oe,Ve,$,Ge,He,Le,De,Qe],styles:["[_nghost-%COMP%]{display:block}.utilisateurs-mobile-app[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 768px){[_nghost-%COMP%]{--mobile-primary: #5f6bff;--mobile-text: #334155;--mobile-muted: #7f8ca3;--mobile-card: #ffffff;--mobile-border: #e2e8f0}.utilisateurs-desktop[_ngcontent-%COMP%]{display:none}.utilisateurs-mobile-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;height:100vh;height:100dvh;overflow:hidden;margin-top:calc(-.25rem - env(safe-area-inset-top));margin-left:-.875rem;margin-right:-.875rem;margin-bottom:calc(-.875rem - env(safe-area-inset-bottom));padding:0 .875rem env(safe-area-inset-bottom);padding-left:calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:#f8fafc;animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.mobile-header[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;gap:.55rem;margin:0 -.875rem;padding:calc(.5rem + env(safe-area-inset-top)) calc(.875rem + env(safe-area-inset-right)) .6rem calc(.875rem + env(safe-area-inset-left));background:var(--mobile-card);border-bottom:1px solid var(--mobile-border);box-shadow:0 1px 3px #0f172a0f;position:sticky;top:0;z-index:30}.mobile-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:.75rem;padding-bottom:calc(4rem + env(safe-area-inset-bottom))}.mobile-back[_ngcontent-%COMP%], .mobile-add[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;flex-shrink:0;color:var(--mobile-primary)!important;background:#5f6bff1a!important}.mobile-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--mobile-text)}.mobile-subtitle[_ngcontent-%COMP%]{margin:.15rem 0 0;font-size:.8rem;font-weight:500;color:var(--mobile-muted)}.mobile-search[_ngcontent-%COMP%]{background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.75rem;padding:.4rem .6rem}.mobile-search[_ngcontent-%COMP%]   .p-iconfield[_ngcontent-%COMP%], .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{width:100%}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{border:0;box-shadow:none;background:transparent;font-size:.95rem}.mobile-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem;margin-top:1rem}.mobile-user-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.875rem;background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.875rem;padding:.875rem;box-shadow:0 1px 3px #0000000d;cursor:pointer;transition:box-shadow .2s ease}.mobile-user-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000014}.mobile-card-avatar[_ngcontent-%COMP%]{width:2.75rem;height:2.75rem;min-width:2.75rem;min-height:2.75rem;border-radius:50%;background:linear-gradient(135deg,var(--mobile-primary) 0%,#7c8aff 100%);color:#fff;font-size:.8rem;font-weight:700;display:flex;align-items:center;justify-content:center}.mobile-card-body[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-card-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--mobile-text);line-height:1.3}.mobile-card-meta[_ngcontent-%COMP%]{font-size:.85rem;color:var(--mobile-muted);margin-top:.2rem}.mobile-card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}.mobile-card-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.mobile-card-actions[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{width:2rem;height:2rem}[_nghost-%COMP%]     .mobile-status-tag{font-size:.75rem;padding:.2rem .5rem;border-radius:999px}.mobile-state[_ngcontent-%COMP%]{margin-top:1rem;background:var(--mobile-card);border:1px dashed var(--mobile-border);border-radius:.875rem;padding:1.5rem;text-align:center;color:var(--mobile-muted);font-size:.9rem}.mobile-load-more[_ngcontent-%COMP%]{padding-top:.5rem}.mobile-load-more-btn[_ngcontent-%COMP%]{width:100%;border-radius:999px;font-weight:600}.mobile-fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(1rem + env(safe-area-inset-bottom));right:calc(1rem + env(safe-area-inset-right));z-index:25;width:3.5rem;height:3.5rem;min-width:3.5rem;min-height:3.5rem;padding:0;border:none;border-radius:50%;background:var(--mobile-primary);color:#fff;box-shadow:0 4px 14px #5f6bff66;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.mobile-fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.35rem}.mobile-fab[_ngcontent-%COMP%]:active{transform:scale(.96)}.app-dark   [_nghost-%COMP%]{--mobile-primary: var(--p-primary-400);--mobile-text: var(--p-surface-100);--mobile-muted: var(--p-surface-400);--mobile-card: var(--p-surface-800);--mobile-border: var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .utilisateurs-mobile-app[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .utilisateurs-mobile-app[_ngcontent-%COMP%]{background:var(--p-surface-950)}.app-dark[_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .mobile-user-card[_ngcontent-%COMP%]:active, .app-dark   [_nghost-%COMP%]   .mobile-user-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000040}.app-dark[_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);color:var(--p-surface-400)}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}"]})};function Ut(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function Mt(r,i){r&1&&(o(0,"small",36),p(1," R\xF4le obligatoire. "),n())}function Et(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function Pt(r,i){r&1&&(o(0,"small",36),p(1," Nom obligatoire. "),n())}function Tt(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function It(r,i){r&1&&(o(0,"small",36),p(1," Pr\xE9nom obligatoire. "),n())}function kt(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function Ot(r,i){if(r&1&&(o(0,"div",37),h(1,"img",38),o(2,"span",39),p(3),n(),o(4,"span"),p(5),n()()),r&2){let e=i.$implicit;s(),m("src",e.flag,ne)("alt",e.name),s(2),x(e.dialCode),s(2),x(e.name)}}function Ft(r,i){if(r&1&&(o(0,"div",37),h(1,"img",38),o(2,"span",39),p(3),n(),o(4,"span"),p(5),n()()),r&2){let e=d().$implicit;s(),m("src",e.flag,ne)("alt",e.name),s(2),x(e.dialCode),s(2),x(e.name)}}function Rt(r,i){if(r&1&&c(0,Ft,6,4,"div",40),r&2){let e=i.$implicit;m("ngIf",e)}}function Vt(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function Dt(r,i){r&1&&(o(0,"small",41),p(1," T\xE9l\xE9phone obligatoire. "),n())}function Lt(r,i){if(r&1&&(o(0,"small",41),p(1),n()),r&2){let e=d();s(),T(" ",e.phoneError," ")}}function At(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function Nt(r,i){r&1&&(o(0,"small",36),p(1," Ville obligatoire. "),n())}function Bt(r,i){r&1&&(o(0,"span",36),p(1,"*"),n())}function Wt(r,i){r&1&&(o(0,"small",36),p(1," Quartier obligatoire. "),n())}function zt(r,i){if(r&1&&(o(0,"small",36),p(1),n()),r&2){let e=d(2);s(),T(" ",e.passwordError," ")}}function jt(r,i){if(r&1){let e=v();o(0,"div",12)(1,"label",42),p(2," Mot de passe "),o(3,"span",36),p(4,"*"),n()(),o(5,"p-password",43),w("ngModelChange",function(a){g(e);let l=d();return C(l.model.password,a)||(l.model.password=a),f(a)}),n(),c(6,zt,2,1,"small",10),n()}if(r&2){let e=d();s(5),y("ngModel",e.model.password),m("toggleMask",!0)("feedback",!0)("invalid",e.submitted&&!!e.passwordError)("disabled",e.fieldsDisabled),s(),m("ngIf",e.submitted&&e.passwordError&&e.isEditing)}}function qt(r,i){r&1&&(o(0,"small",36),p(1," Les mots de passe ne correspondent pas. "),n())}function Ht(r,i){if(r&1){let e=v();o(0,"div",12)(1,"label",44),p(2," Confirmer le mot de passe "),o(3,"span",36),p(4,"*"),n()(),o(5,"p-password",45),w("ngModelChange",function(a){g(e);let l=d();return C(l.model.password_confirmation,a)||(l.model.password_confirmation=a),f(a)}),n(),c(6,qt,2,0,"small",10),n()}if(r&2){let e=d();s(5),y("ngModel",e.model.password_confirmation),m("toggleMask",!0)("feedback",!1)("invalid",e.submitted&&e.model.password!==e.model.password_confirmation)("disabled",e.fieldsDisabled),s(),m("ngIf",e.submitted&&e.model.password!==e.model.password_confirmation&&e.isEditing)}}function Gt(r,i){if(r&1){let e=v();o(0,"div",46)(1,"div",47)(2,"button",48),_("click",function(){g(e);let a=d();return f(a.onSubmit())}),n(),o(3,"button",49),_("click",function(){g(e);let a=d();return f(a.onCancel())}),n()()()}if(r&2){let e=d();s(2),m("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),s(),m("disabled",e.loading)}}var V=class r{constructor(i){this.roleService=i}mode="create";initialData=null;loading=!1;submitForm=new oe;cancel=new oe;submitted=!1;isEditing=!1;model={};availableRoles=[];phoneError=null;phoneCountry="GN";passwordError=null;countries=R;ngOnInit(){this.loadRoles(),this.initializeModel()}ngOnChanges(i){if(i.initialData){let e=i.initialData;e.currentValue&&Object.keys(e.currentValue).length>0&&this.initializeModel()}}loadRoles(){this.roleService.getRoles().subscribe({next:i=>{i.success&&(this.availableRoles=i.data.map(e=>({label:e.role.name.charAt(0).toUpperCase()+e.role.name.slice(1),value:e.role.name})))},error:()=>{this.availableRoles=[{label:"Admin",value:"admin"},{label:"Manager",value:"manager"},{label:"Employ\xE9",value:"employe"}]}})}initializeModel(){this.initialData?this.model={nom:this.initialData.nom,prenom:this.initialData.prenom,phone:this.initialData.phone,email:this.initialData.email,pays:this.initialData.pays,code_pays:this.initialData.code_pays,code_phone_pays:this.initialData.code_phone_pays,ville:this.initialData.ville,quartier:this.initialData.quartier,role:this.initialData.roles?.[0],reference:this.initialData.reference}:this.model={},this.mode==="create"&&!this.model.ville?.trim()&&(this.model.ville="Conakry"),this.mode==="create"?this.isEditing=!0:this.mode==="edit"&&this.initialData&&(this.isEditing=!0),this.model.code_pays?this.phoneCountry=this.model.code_pays:this.model.phone&&this.detectPhoneCountry(this.model.phone),this.submitted=!1,this.phoneError=null,this.passwordError=null}detectPhoneCountry(i){try{let e=me(i);e&&e.country&&(this.phoneCountry=e.country)}catch{}}validatePhone(){if(!this.model.phone?.trim())return this.phoneError="T\xE9l\xE9phone obligatoire.",!1;try{if(!Ye(this.model.phone,this.phoneCountry))return this.phoneError=`Num\xE9ro invalide pour ${this.getCountryName(this.phoneCountry)}.`,!1;let e=me(this.model.phone,this.phoneCountry);return e?(this.model.phone=e.formatInternational(),this.model.code_pays=this.phoneCountry,this.model.pays=this.getCountryName(this.phoneCountry),this.phoneError=null,!0):(this.phoneError="Format de num\xE9ro invalide.",!1)}catch{return this.phoneError="Format de num\xE9ro invalide.",!1}}validatePassword(){if(this.mode==="edit"&&!this.model.password?.trim())return this.passwordError=null,!0;if(this.mode==="create"&&!this.model.password?.trim())return this.passwordError="Mot de passe obligatoire.",!1;let i=this.model.password||"";return i.length<8?(this.passwordError="Le mot de passe doit contenir au moins 8 caract\xE8res.",!1):!/[a-z]/.test(i)||!/[A-Z]/.test(i)?(this.passwordError="Le mot de passe doit contenir des majuscules et des minuscules.",!1):/[0-9]/.test(i)?this.model.password!==this.model.password_confirmation?(this.passwordError="Les mots de passe ne correspondent pas.",!1):(this.passwordError=null,!0):(this.passwordError="Le mot de passe doit contenir au moins un chiffre.",!1)}getCountryName(i){let e=this.countries.find(t=>t.code===i);return e?e.name:i}getSelectedCountryDialCode(){let i=this.countries.find(e=>e.code===this.phoneCountry);return i?i.dialCode:""}onCountryChange(){this.model.phone&&this.validatePhone()}onPhoneInput(){this.submitted&&this.validatePhone()}onPhoneBlur(){this.model.phone?.trim()&&this.validatePhone()}isValid(){return!(!this.model.role||!!!(this.model.nom?.trim()&&this.model.prenom?.trim()&&this.model.phone?.trim()&&this.model.ville?.trim()&&this.model.quartier?.trim())||!this.validatePhone()||this.mode==="create"&&!this.validatePassword())}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.phoneError=null,this.passwordError=null,this.initializeModel()}onSubmit(){this.submitted=!0,this.isValid()&&this.submitForm.emit(D({},this.model))}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}get formTitle(){if(this.mode==="create")return"Cr\xE9er un compte utilisateur";let i=this.model.reference?.trim();return i?`Modification compte utilisateur : ${i}`:"Modification compte utilisateur"}static \u0275fac=function(e){return new(e||r)(b(X))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-form"]],inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[_e],decls:64,vars:42,consts:[[1,"card","utilisateurs-form-card"],[1,"flex","justify-between","items-center","mb-6","utilisateurs-form-title"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2","utilisateurs-form-sidebar"],[1,"text-surface-900","dark:text-surface-0","font-medium","text-xl","mb-4"],[1,"m-0","p-0","text-surface-600","dark:text-surface-200","leading-normal","mr-4"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12","md:col-span-12"],["for","role",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","role","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un r\xF4le","fluid","",3,"ngModelChange","ngModel","options","disabled","invalid"],[1,"mb-6","col-span-12","md:col-span-6"],["for","email",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","email","type","email","pInputText","","fluid","","placeholder","exemple@email.com",3,"ngModelChange","ngModel","disabled"],["for","nom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","prenom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prenom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],[1,"mb-6","col-span-12"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-4"],["for","codePays",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","codePays","optionLabel","name","optionValue","code","placeholder","S\xE9lectionner un pays","fluid","",3,"ngModelChange","onCountryChange","ngModel","options","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"col-span-12","md:col-span-8"],["for","phone",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","phone","type","tel","pInputText","","fluid","","placeholder","Exemple: 622 00 00 00",3,"ngModelChange","input","blur","ngModel","invalid","disabled"],["class","text-red-500 block mt-2",4,"ngIf"],["for","ville",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","ville","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","quartier",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","quartier","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["class","mb-6 col-span-12 md:col-span-6",4,"ngIf"],["class","col-span-12 utilisateurs-form-actions",4,"ngIf"],[1,"text-red-500"],[1,"flex","items-center","gap-2"],[1,"w-5","h-auto","rounded-sm",3,"src","alt"],[1,"font-semibold","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500","block","mt-2"],["for","password",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","password","fluid","","placeholder","Min. 8 caract\xE8res, majuscules, minuscules et chiffres","promptLabel","Entrez un mot de passe","weakLabel","Faible","mediumLabel","Moyen","strongLabel","Fort",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],["for","password_confirmation",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","password_confirmation","fluid","","placeholder","Confirmez le mot de passe",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],[1,"col-span-12","utilisateurs-form-actions"],[1,"flex","flex-wrap","items-center","gap-3"],["pButton","","pRipple","","icon","pi pi-check",1,"utilisateurs-form-submit",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"utilisateurs-form-cancel",3,"click","disabled"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"span",2),p(3),n()(),o(4,"div",3)(5,"div",4),h(6,"div",5),o(7,"p",6),p(8," Renseignez les informations du compte utilisateur. "),n()(),o(9,"div",7)(10,"div",3)(11,"div",8)(12,"label",9),p(13," R\xF4le "),c(14,Ut,2,0,"span",10),n(),o(15,"p-select",11),w("ngModelChange",function(l){return C(t.model.role,l)||(t.model.role=l),l}),n(),c(16,Mt,2,0,"small",10),n(),o(17,"div",12)(18,"label",13),p(19," Email "),n(),o(20,"input",14),w("ngModelChange",function(l){return C(t.model.email,l)||(t.model.email=l),l}),n()(),o(21,"div",12)(22,"label",15),p(23," Nom "),c(24,Et,2,0,"span",10),n(),o(25,"input",16),w("ngModelChange",function(l){return C(t.model.nom,l)||(t.model.nom=l),l}),n(),c(26,Pt,2,0,"small",10),n(),o(27,"div",12)(28,"label",17),p(29," Pr\xE9nom "),c(30,Tt,2,0,"span",10),n(),o(31,"input",18),w("ngModelChange",function(l){return C(t.model.prenom,l)||(t.model.prenom=l),l}),n(),c(32,It,2,0,"small",10),n(),o(33,"div",19)(34,"div",20)(35,"div",21)(36,"label",22),p(37," Pays "),c(38,kt,2,0,"span",10),n(),o(39,"p-select",23),w("ngModelChange",function(l){return C(t.phoneCountry,l)||(t.phoneCountry=l),l}),_("onCountryChange",function(){return t.onCountryChange()}),c(40,Ot,6,4,"ng-template",24)(41,Rt,1,1,"ng-template",25),n()(),o(42,"div",26)(43,"label",27),p(44," T\xE9l\xE9phone "),c(45,Vt,2,0,"span",10),n(),o(46,"input",28),w("ngModelChange",function(l){return C(t.model.phone,l)||(t.model.phone=l),l}),_("input",function(){return t.onPhoneInput()})("blur",function(){return t.onPhoneBlur()}),n()()(),c(47,Dt,2,0,"small",29)(48,Lt,2,1,"small",29),n(),o(49,"div",12)(50,"label",30),p(51," Ville "),c(52,At,2,0,"span",10),n(),o(53,"input",31),w("ngModelChange",function(l){return C(t.model.ville,l)||(t.model.ville=l),l}),n(),c(54,Nt,2,0,"small",10),n(),o(55,"div",12)(56,"label",32),p(57," Quartier "),c(58,Bt,2,0,"span",10),n(),o(59,"input",33),w("ngModelChange",function(l){return C(t.model.quartier,l)||(t.model.quartier=l),l}),n(),c(60,Wt,2,0,"small",10),n(),c(61,jt,7,6,"div",34)(62,Ht,7,6,"div",34)(63,Gt,4,4,"div",35),n()()()()),e&2&&(s(3),T(" ",t.formTitle," "),s(11),m("ngIf",t.isEditing),s(),y("ngModel",t.model.role),m("options",t.availableRoles)("disabled",t.fieldsDisabled)("invalid",t.submitted&&!t.model.role),s(),m("ngIf",t.submitted&&!t.model.role&&t.isEditing),s(4),y("ngModel",t.model.email),m("disabled",t.fieldsDisabled),s(4),m("ngIf",t.isEditing),s(),y("ngModel",t.model.nom),m("invalid",t.submitted&&!(t.model.nom!=null&&t.model.nom.trim()))("disabled",t.fieldsDisabled),s(),m("ngIf",t.submitted&&!(t.model.nom!=null&&t.model.nom.trim())&&t.isEditing),s(4),m("ngIf",t.isEditing),s(),y("ngModel",t.model.prenom),m("invalid",t.submitted&&!(t.model.prenom!=null&&t.model.prenom.trim()))("disabled",t.fieldsDisabled),s(),m("ngIf",t.submitted&&!(t.model.prenom!=null&&t.model.prenom.trim())&&t.isEditing),s(6),m("ngIf",t.isEditing),s(),y("ngModel",t.phoneCountry),m("options",t.countries)("disabled",t.fieldsDisabled),s(6),m("ngIf",t.isEditing),s(),y("ngModel",t.model.phone),m("invalid",(t.submitted||t.phoneError)&&(!(t.model.phone!=null&&t.model.phone.trim())||!!t.phoneError))("disabled",t.fieldsDisabled),s(),m("ngIf",t.submitted&&!(t.model.phone!=null&&t.model.phone.trim())&&t.isEditing),s(),m("ngIf",t.phoneError&&(t.model.phone==null?null:t.model.phone.trim())&&t.isEditing),s(4),m("ngIf",t.isEditing),s(),y("ngModel",t.model.ville),m("invalid",t.submitted&&!(t.model.ville!=null&&t.model.ville.trim()))("disabled",t.fieldsDisabled),s(),m("ngIf",t.submitted&&!(t.model.ville!=null&&t.model.ville.trim())&&t.isEditing),s(4),m("ngIf",t.isEditing),s(),y("ngModel",t.model.quartier),m("invalid",t.submitted&&!(t.model.quartier!=null&&t.model.quartier.trim()))("disabled",t.fieldsDisabled),s(),m("ngIf",t.submitted&&!(t.model.quartier!=null&&t.model.quartier.trim())&&t.isEditing),s(),m("ngIf",t.mode==="create"),s(),m("ngIf",t.mode==="create"),s(),m("ngIf",t.isEditing))},dependencies:[E,O,$,q,Y,Q,Pe,G,H,j,B,W,z,$e,Ze],styles:[".utilisateurs-form-actions[_ngcontent-%COMP%]{margin-top:.5rem;padding-top:.5rem}.utilisateurs-form-actions[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{align-items:center}.utilisateurs-form-actions[_ngcontent-%COMP%]     .p-button{min-height:2.5rem;min-width:7rem}@media (max-width: 768px){.utilisateurs-form-title[_ngcontent-%COMP%], .utilisateurs-form-sidebar[_ngcontent-%COMP%]{display:none}.utilisateurs-form-card[_ngcontent-%COMP%]{box-shadow:none;border:none;border-radius:0;padding:0;background:transparent}.utilisateurs-form-actions[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column;width:100%}.utilisateurs-form-actions[_ngcontent-%COMP%]     .p-button{width:100%;justify-content:center;min-width:unset}}"]})};var ie=class r{constructor(i,e,t){this.userService=i;this.messageService=e;this.router=t}loading=!1;onCancel(){this.router.navigate(["contacts/utilisateurs"])}onSubmit(i){this.loading=!0;let e={nom:i.nom||"",prenom:i.prenom||"",phone:(i.phone||"").replace(/\s+/g,""),email:i.email||void 0,pays:i.pays||"Guin\xE9e",code_pays:i.code_pays||"GN",code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville||"",quartier:i.quartier||"",password:i.password||"",password_confirmation:i.password_confirmation||"",role:i.role||""};this.userService.createUser(e).subscribe({next:t=>{if(t.success){this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur cr\xE9\xE9 avec succ\xE8s"});let a=t.data?.user?.id??t.data?.id;setTimeout(()=>{a!=null?this.router.navigate(["contacts/utilisateurs/edit",a]):this.router.navigate(["contacts/utilisateurs"])},600)}this.loading=!1},error:t=>{console.error("Erreur lors de la cr\xE9ation:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Erreur lors de la cr\xE9ation de l'utilisateur"}),this.loading=!1}})}getCodePhonePays(i){let e=R.find(t=>t.code===i);return e?e.dialCode:"+224"}static \u0275fac=function(e){return new(e||r)(b(P),b(S),b(F))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-new"]],features:[k([S])],decls:2,vars:2,consts:[[3,"submitForm","cancel","mode","loading"]],template:function(e,t){e&1&&(h(0,"p-toast"),o(1,"app-utilisateurs-form",0),_("submitForm",function(l){return t.onSubmit(l)})("cancel",function(){return t.onCancel()}),n()),e&2&&(s(),m("mode","create")("loading",t.loading))},dependencies:[E,K,J,V],encapsulation:2})};function Yt(r,i){r&1&&(o(0,"div",9),h(1,"i",10),n())}function Zt(r,i){if(r&1){let e=v();o(0,"app-utilisateurs-form",11),_("submitForm",function(a){g(e);let l=d();return f(l.onSubmit(a))})("cancel",function(){g(e);let a=d();return f(a.onCancel())}),n()}if(r&2){let e=d();m("mode","edit")("initialData",e.userData)("loading",e.loading)}}var re=class r{constructor(i,e,t,a,l){this.route=i;this.router=e;this.userService=t;this.roleService=a;this.messageService=l}loading=!1;userId=null;userData=null;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");i&&(this.userId=parseInt(i,10),this.loadUser(this.userId))}loadUser(i){this.loading=!0,this.userService.getUser(i).subscribe({next:e=>{if(e.success&&e.data){let t=e.data,a={id:t.id,reference:t.reference,nom:t.nom,prenom:t.prenom,phone:t.phone,email:t.email,pays:t.pays,code_pays:t.code_pays,code_phone_pays:t.code_phone_pays,ville:t.ville,quartier:t.quartier,roles:t.role_names||t.roles,is_active:t.is_active},l=t.role_names||t.roles;!l||l.length===0?this.roleService.getUserRoles(i).subscribe({next:u=>{u.success&&u.data&&(a.roles=u.data.roles),this.userData=a,this.loading=!1},error:()=>{this.userData=a,this.loading=!1}}):(this.userData=a,this.loading=!1)}else this.loading=!1},error:e=>{console.error("Erreur lors du chargement:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors du chargement de l'utilisateur"}),this.loading=!1}})}onSubmit(i){if(!this.userId)return;this.loading=!0;let e={nom:i.nom,prenom:i.prenom,phone:(i.phone||"").replace(/\s+/g,""),email:i.email||void 0,pays:i.pays,code_pays:i.code_pays,code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville,quartier:i.quartier};this.userService.updateUser(this.userId,e).subscribe({next:t=>{t.success&&(this.userData=D(D({},this.userData),t.data),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur modifi\xE9 avec succ\xE8s"})),this.loading=!1},error:t=>{console.error("Erreur lors de la modification:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Erreur lors de la modification de l'utilisateur"}),this.loading=!1}})}onCancel(){this.router.navigate(["contacts/utilisateurs"])}getCodePhonePays(i){let e=R.find(t=>t.code===i);return e?e.dialCode:"+224"}static \u0275fac=function(e){return new(e||r)(b(Ee),b(F),b(P),b(X),b(S))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-edit"]],features:[k([S])],decls:11,vars:2,consts:[[1,"edit-page"],[1,"edit-mobile-header"],["type","button","aria-label","Retour \xE0 la liste",1,"edit-back",3,"click"],[1,"pi","pi-arrow-left"],[1,"edit-title"],[1,"edit-header-spacer"],[1,"edit-content"],["class","flex justify-center items-center h-96",4,"ngIf"],[3,"mode","initialData","loading","submitForm","cancel",4,"ngIf"],[1,"flex","justify-center","items-center","h-96"],[1,"pi","pi-spin","pi-spinner","text-4xl","text-primary"],[3,"submitForm","cancel","mode","initialData","loading"]],template:function(e,t){e&1&&(h(0,"p-toast"),o(1,"div",0)(2,"header",1)(3,"button",2),_("click",function(){return t.onCancel()}),h(4,"i",3),n(),o(5,"h1",4),p(6,"Modifier l'utilisateur"),n(),h(7,"span",5),n(),o(8,"div",6),c(9,Yt,2,0,"div",7)(10,Zt,1,3,"app-utilisateurs-form",8),n()()),e&2&&(s(9),m("ngIf",t.loading&&!t.userData),s(),m("ngIf",t.userData))},dependencies:[E,O,V,K,J],styles:["[_nghost-%COMP%]{display:block}.edit-mobile-header[_ngcontent-%COMP%]{display:none}.edit-content[_ngcontent-%COMP%]{padding:1rem}@media screen and (max-width: 768px){.edit-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;margin:calc(-.25rem - env(safe-area-inset-top)) -.875rem calc(-.875rem - env(safe-area-inset-bottom));margin-left:-.875rem;margin-right:-.875rem;padding:0;padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);padding-bottom:env(safe-area-inset-bottom);background:#fff}.edit-mobile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-shrink:0;padding:calc(.5rem + env(safe-area-inset-top)) .75rem .6rem calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:var(--surface-card);border-bottom:1px solid var(--surface-border);box-shadow:0 1px 3px #0000000f;position:sticky;top:0;z-index:25}.edit-back[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;min-width:2.25rem;border:none;border-radius:50%;background:var(--p-primary-50);color:var(--p-primary-500);display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}.edit-back[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem}.edit-title[_ngcontent-%COMP%]{flex:1;margin:0;font-size:1.15rem;font-weight:700;color:var(--text-color);min-width:0}.edit-header-spacer[_ngcontent-%COMP%]{width:2.25rem;min-width:2.25rem}.edit-content[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:.875rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom))}}"]})};var dr=[{path:"",component:te,canActivate:[Z],data:{permissions:["users.read"]}},{path:"new",component:ie,canActivate:[Z],data:{permissions:["users.create"]}},{path:"edit/:id",component:re,canActivate:[Z],data:{permissions:["users.update"]}},{path:"**",redirectTo:"/notfound"}];export{dr as default};
