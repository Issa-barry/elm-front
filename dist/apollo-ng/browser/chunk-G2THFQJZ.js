import{a as ze,b as Ge}from"./chunk-6OFAV6OQ.js";import"./chunk-2BGCBJPY.js";import{a as J}from"./chunk-CPS5ADJW.js";import{a as ne,b as qe}from"./chunk-JFBSWTEJ.js";import{a as k}from"./chunk-IUCT6ZC4.js";import{a as je}from"./chunk-2L636W5W.js";import{a as We,b as Be}from"./chunk-LOBJQVB7.js";import"./chunk-3HDW43E7.js";import{a as De,d as ke,e as Ve,f as Le,k as Ae}from"./chunk-KYBPPGZP.js";import"./chunk-KKEZTC3T.js";import"./chunk-QAU7W4US.js";import"./chunk-GO7AEQHW.js";import"./chunk-44MNQRCX.js";import"./chunk-FHJ3HI6Y.js";import"./chunk-MGFZT6L3.js";import{a as Ne,b as Oe}from"./chunk-2M2YESUI.js";import"./chunk-Q737E3VB.js";import"./chunk-GVSJPEUD.js";import"./chunk-CQGFVLY5.js";import"./chunk-ZOHIMUT6.js";import"./chunk-TB7JIXSI.js";import{a as Q,b as Z}from"./chunk-D4ZZGRXJ.js";import"./chunk-USWDVUUM.js";import"./chunk-KHGHC55C.js";import{a as G}from"./chunk-UQ2UE4DV.js";import{a as re,b as Re}from"./chunk-HYG7NLCW.js";import"./chunk-MYGUYXAJ.js";import"./chunk-UWJ6EXCC.js";import"./chunk-NIW5LLYW.js";import{b as Se,d as D}from"./chunk-BKUS5BNA.js";import"./chunk-TZVXXQOJ.js";import{a as C,d as ye}from"./chunk-PPJOJKS5.js";import{c as q,e as z}from"./chunk-P557RNKH.js";import"./chunk-PALTTDOF.js";import{c as H,d as Pe}from"./chunk-WF73AWMM.js";import"./chunk-SXW2RLBH.js";import"./chunk-LSUA6MZX.js";import"./chunk-M2LTT3HJ.js";import"./chunk-JYP5AZVX.js";import"./chunk-T7HI4VPR.js";import{a as Ie,c as Te}from"./chunk-II7RVJNR.js";import{a as j,b as Ee}from"./chunk-PW7MMR7K.js";import{b as we,e as O,h as W,p as B}from"./chunk-3LUOICNH.js";import{a as Me,b as Fe}from"./chunk-3G6KBQ3S.js";import"./chunk-D7FY7VLK.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as Ce,j as xe}from"./chunk-IK72ORTM.js";import"./chunk-Z2XDSDL7.js";import{la as N,pa as w,ta as Ue}from"./chunk-344GK45C.js";import{j as be,k as P,v as I}from"./chunk-6PXXCRY5.js";import"./chunk-4O3FVBGX.js";import{$ as f,$b as E,Ab as c,Eb as de,Fb as ue,Hb as U,Ja as ee,Lb as v,Mb as d,Na as l,R as le,Sa as te,V as pe,Vb as ie,Xb as ce,Ya as _,Yb as fe,Zb as ge,_b as m,aa as g,ac as M,bb as x,dc as b,ec as y,fc as S,gc as _e,hb as u,hc as F,ic as A,ma as me,sc as he,uc as ve,wc as R,xb as p,yb as s,zb as n}from"./chunk-E5DLUAUS.js";import{a as L}from"./chunk-GAL4ENT6.js";var T=class r{constructor(i){this.http=i}apiUrl=`${re.apiUrl}/users`;authUrl=`${re.apiUrl}/auth`;createUser(i){return this.http.post(`${this.authUrl}/register`,i)}getUsers(i){let e=new C;return i&&(i.is_active!==void 0&&(e=e.set("is_active",i.is_active.toString())),i.search&&(e=e.set("search",i.search)),i.pays&&(e=e.set("pays",i.pays)),i.ville&&(e=e.set("ville",i.ville)),i.sort_by&&(e=e.set("sort_by",i.sort_by)),i.sort_order&&(e=e.set("sort_order",i.sort_order)),i.per_page&&(e=e.set("per_page",i.per_page.toString())),i.page&&(e=e.set("page",i.page.toString()))),this.http.get(this.apiUrl,{params:e})}getUser(i){return this.http.get(`${this.apiUrl}/${i}`)}updateUser(i,e){return this.http.put(`${this.apiUrl}/${i}`,e)}toggleUserStatus(i){return this.http.patch(`${this.apiUrl}/${i}/toggle-status`,{})}deleteUser(i){return this.http.delete(`${this.apiUrl}/${i}`)}searchUsers(i){let e=new C().set("search",i);return this.http.get(this.apiUrl,{params:e})}getActiveUsers(){let i=new C().set("is_active","true");return this.http.get(this.apiUrl,{params:i})}getInactiveUsers(){let i=new C().set("is_active","false");return this.http.get(this.apiUrl,{params:i})}getUsersByCountry(i){let e=new C().set("pays",i);return this.http.get(this.apiUrl,{params:e})}getUsersByCity(i){let e=new C().set("ville",i);return this.http.get(this.apiUrl,{params:e})}getUsersPaginated(i=1,e=10,t){let o=new C().set("page",i.toString()).set("per_page",e.toString());return t&&(t.is_active!==void 0&&(o=o.set("is_active",t.is_active.toString())),t.search&&(o=o.set("search",t.search)),t.pays&&(o=o.set("pays",t.pays)),t.ville&&(o=o.set("ville",t.ville)),t.sort_by&&(o=o.set("sort_by",t.sort_by)),t.sort_order&&(o=o.set("sort_order",t.sort_order))),this.http.get(this.apiUrl,{params:o})}sortUsers(i,e="asc"){let t=new C().set("sort_by",i||"created_at").set("sort_order",e);return this.http.get(this.apiUrl,{params:t})}static \u0275fac=function(e){return new(e||r)(pe(ye))};static \u0275prov=le({token:r,factory:r.\u0275fac,providedIn:"root"})};var Ke=()=>[10,25,50],Xe=()=>["nom_complet","email","phone","reference","pays","ville"],Ye=()=>({"min-width":"150px"});function $e(r,i){if(r&1){let e=U();s(0,"button",15),v("click",function(){f(e);let o=d(2);return g(o.navigateToCreate())}),n()}}function et(r,i){if(r&1){let e=U();s(0,"div",8)(1,"p-icon-field",9),c(2,"p-inputicon",10),s(3,"input",11),v("input",function(o){f(e);let a=d(),h=ie(3);return g(a.onGlobalFilter(h,o))}),n()(),s(4,"div",12)(5,"p-select",13),S("ngModelChange",function(o){f(e);let a=d();return y(a.selectedStatus,o)||(a.selectedStatus=o),g(o)}),v("onChange",function(){f(e);let o=d();return g(o.filterByStatus())}),n(),u(6,$e,1,0,"button",14),n()()}if(r&2){let e=d();l(5),fe(A(6,Ye)),p("options",e.statusOptions),b("ngModel",e.selectedStatus),p("showClear",!0),l(),p("ngIf",e.canCreate)}}function tt(r,i){r&1&&(s(0,"tr")(1,"th",16)(2,"span",17),m(3," Nom complet "),c(4,"p-sortIcon",18),n()(),s(5,"th",19)(6,"span",17),m(7," T\xE9l\xE9phone "),c(8,"p-sortIcon",20),n()(),s(9,"th",21)(10,"span",17),m(11," R\xF4le "),n()(),s(12,"th",22)(13,"span",17),m(14," Adresse "),c(15,"p-sortIcon",23),n()(),s(16,"th",24)(17,"span",17),m(18," Statut "),c(19,"p-sortIcon",25),n()(),s(20,"th",26),m(21," Actions "),n()())}function it(r,i){if(r&1&&c(0,"p-tag",42),r&2){let e=i.$implicit,t=d(3);p("value",e)("severity",t.getRoleSeverity(e))}}function rt(r,i){if(r&1&&(de(0),u(1,it,1,2,"p-tag",41),ue()),r&2){let e=d().$implicit;l(),p("ngForOf",e.role_names||e.roles)}}function nt(r,i){r&1&&(s(0,"span",43),m(1,"-"),n())}function st(r,i){if(r&1){let e=U();s(0,"button",44),v("click",function(o){f(e);let a=d().$implicit,h=d();return g(h.toggleStatus(o,a.id))}),n()}if(r&2){let e=d().$implicit;ce("p-button-success",e.is_active)("p-button-danger",!e.is_active),p("icon",e.is_active?"pi pi-lock-open":"pi pi-lock")("pTooltip",e.is_active?"D\xE9sactiver":"Activer")}}function ot(r,i){if(r&1){let e=U();s(0,"button",45),v("click",function(o){f(e);let a=d().$implicit,h=d();return g(h.deleteUser(o,a.id))}),n()}r&2&&p("pTooltip","Supprimer")}function at(r,i){if(r&1){let e=U();s(0,"tr",27)(1,"td")(2,"div",17)(3,"div",28),m(4),n(),s(5,"div")(6,"div",29),m(7),n(),s(8,"div",30),m(9),n()()()(),s(10,"td")(11,"div",31)(12,"span",32),m(13),he(14,"phoneFormat"),n()()(),s(15,"td"),u(16,rt,2,1,"ng-container",33)(17,nt,2,0,"ng-template",null,5,R),n(),s(19,"td")(20,"div",17),c(21,"span"),s(22,"div")(23,"div",34),m(24),n(),s(25,"div",35),m(26),n()()()(),s(27,"td"),c(28,"p-tag",36),n(),s(29,"td")(30,"div",37)(31,"button",38),v("click",function(o){let a=f(e).$implicit,h=d();return g(h.goToEdit(o,a.id))}),n(),u(32,st,1,6,"button",39)(33,ot,1,1,"button",40),n()()()}if(r&2){let e=i.$implicit,t=ie(18),o=d();p("pSelectableRow",e),l(4),M(" ",o.getInitials(e.nom_complet)," "),l(3),E(e.nom_complet),l(2),E(e.reference),l(4),E(ve(14,18,e.phone,"INT")),l(3),p("ngIf",(e.role_names==null?null:e.role_names.length)||(e.roles==null?null:e.roles.length))("ngIfElse",t),l(5),ge(_e("fi fi-",e.code_pays==null?null:e.code_pays.toLowerCase()," text-xl")),l(3),E(e.ville),l(2),E(e.quartier),l(2),p("value",e.is_active?"Actif":"Inactif")("severity",e.is_active?"success":"danger"),l(3),p("pTooltip",o.canUpdate?"Modifier":"Voir")("disabled",!o.canUpdate),l(),p("ngIf",o.canUpdate),l(),p("ngIf",o.canDelete)}}function lt(r,i){r&1&&(s(0,"tr")(1,"td",46)(2,"div",47),c(3,"i",48),s(4,"span"),m(5,"Aucun utilisateur trouv\xE9"),n()()()())}var X=class r{constructor(i,e,t,o,a){this.userService=i;this.router=e;this.messageService=t;this.confirmationService=o;this.authService=a;this.canCreate=this.authService.hasPermission("users.create"),this.canUpdate=this.authService.hasPermission("users.update"),this.canDelete=this.authService.hasPermission("users.delete")}users=[];selectedUser=null;loading=!1;selectedStatus=null;statusOptions=[{label:"Actif",value:!0},{label:"Inactif",value:!1}];canCreate=!1;canUpdate=!1;canDelete=!1;ngOnInit(){this.loadUsers()}loadUsers(){this.loading=!0;let i=this.selectedStatus!==null?{is_active:this.selectedStatus}:void 0;this.userService.getUsers(i).subscribe({next:e=>{e.success&&(this.users=Array.isArray(e.data)?e.data:e.data.data),this.loading=!1},error:e=>{console.error("Erreur lors du chargement des utilisateurs:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les utilisateurs"}),this.loading=!1}})}onGlobalFilter(i,e){i.filterGlobal(e.target.value,"contains")}filterByStatus(){this.loadUsers()}navigateToCreate(){this.router.navigate(["contacts/utilisateurs/new"])}onRowSelect(i){this.router.navigate(["contacts/utilisateurs/edit",i.data.id])}goToEdit(i,e){i.stopPropagation(),this.router.navigate(["contacts/utilisateurs/edit/",e])}toggleStatus(i,e){i.stopPropagation();let o=this.users.find(a=>a.id===e)?.is_active?"d\xE9sactiver":"activer";this.confirmationService.confirm({message:`Voulez-vous vraiment ${o} cet utilisateur ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui",rejectLabel:"Non",accept:()=>{this.userService.toggleUserStatus(e).subscribe({next:a=>{a.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:a.message}),this.loadUsers())},error:a=>{console.error("Erreur:",a),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de changer le statut de l'utilisateur"})}})}})}deleteUser(i,e){i.stopPropagation(),this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer cet utilisateur ? Cette action est irr\xE9versible.",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, supprimer",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.userService.deleteUser(e).subscribe({next:t=>{t.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur supprim\xE9 avec succ\xE8s"}),this.loadUsers())},error:t=>{console.error("Erreur:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'utilisateur"})}})}})}getInitials(i){if(!i)return"??";let e=i.trim().split(" ");return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():i.substring(0,2).toUpperCase()}getRoleSeverity(i){return{admin:"danger",manager:"warn",employe:"info",superviseur:"success"}[i?.toLowerCase()]||"secondary"}static \u0275fac=function(e){return new(e||r)(_(T),_(D),_(w),_(N),_(Re))};static \u0275cmp=x({type:r,selectors:[["app-utilisateurs-liste"]],features:[F([w,N])],decls:12,vars:11,consts:[["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["noRole",""],[1,"card"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","  {first} / {last} de {totalRecords} entr\xE9es","selectionMode","single","styleClass","cursor-pointer",3,"selectionChange","onRowSelect","value","paginator","rows","showCurrentPageReport","loading","rowsPerPageOptions","globalFilterFields","selection","rowHover"],[1,"flex","flex-wrap","gap-2","items-center","justify-between"],[1,"w-full","sm:w-80","order-1","sm:order-0"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher un utilisateur...",1,"w-full",3,"input"],[1,"flex","gap-2","w-full","sm:w-auto","flex-order-0","sm:flex-order-1"],["placeholder","Tous les statuts",3,"ngModelChange","onChange","options","ngModel","showClear"],["pButton","","outlined","","class","flex-shrink-0","icon","pi pi-user-plus","label","Nouveau",3,"click",4,"ngIf"],["pButton","","outlined","","icon","pi pi-user-plus","label","Nouveau",1,"flex-shrink-0",3,"click"],["pSortableColumn","nom_complet",1,"white-space-nowrap",2,"width","25%"],[1,"flex","items-center","gap-2"],["field","nom_complet"],["pSortableColumn","phone",1,"white-space-nowrap",2,"width","15%"],["field","phone"],[1,"white-space-nowrap",2,"width","12%"],["pSortableColumn","pays",1,"white-space-nowrap",2,"width","18%"],["field","pays"],["pSortableColumn","is_active",1,"white-space-nowrap",2,"width","10%"],["field","is_active"],[1,"white-space-nowrap",2,"width","10%"],[3,"pSelectableRow"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary-100","text-primary-700","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-surface-500","mt-1"],[1,"flex","items-center","gap-1"],[1,"text-surface-700"],[4,"ngIf","ngIfElse"],[1,"font-medium"],[1,"text-sm","text-surface-500"],[3,"value","severity"],[1,"flex","gap-2"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","pTooltip","disabled"],["pButton","","pRipple","","class","p-button-rounded p-button-text p-button-sm","tooltipPosition","top",3,"icon","p-button-success","p-button-danger","pTooltip","click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","class","p-button-rounded p-button-text p-button-danger p-button-sm","tooltipPosition","top",3,"pTooltip","click",4,"ngIf"],["class","mr-1",3,"value","severity",4,"ngFor","ngForOf"],[1,"mr-1",3,"value","severity"],[1,"text-surface-400"],["pButton","","pRipple","","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","icon","pTooltip"],["pButton","","pRipple","","icon","pi pi-trash","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-danger","p-button-sm",3,"click","pTooltip"],["colspan","6",1,"text-center","py-8"],[1,"flex","flex-col","items-center","gap-3","text-surface-500"],[1,"pi","pi-users","text-4xl"]],template:function(e,t){if(e&1){let o=U();c(0,"p-confirmDialog"),s(1,"div",6)(2,"p-table",7,0),S("selectionChange",function(h){return f(o),y(t.selectedUser,h)||(t.selectedUser=h),g(h)}),v("onRowSelect",function(h){return f(o),g(t.onRowSelect(h))}),u(4,et,7,7,"ng-template",null,1,R)(6,tt,22,0,"ng-template",null,2,R)(8,at,34,21,"ng-template",null,3,R)(10,lt,6,0,"ng-template",null,4,R),n()()}e&2&&(l(2),p("value",t.users)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("loading",t.loading)("rowsPerPageOptions",A(9,Ke))("globalFilterFields",A(10,Xe)),b("selection",t.selectedUser),p("rowHover",!0))},dependencies:[I,be,P,B,O,W,Ae,De,ke,Le,Ve,Ee,j,z,q,Ie,Te,Oe,Ne,Fe,Me,Pe,H,Be,We,je],encapsulation:2})};function mt(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function dt(r,i){r&1&&(s(0,"small",35),m(1," R\xF4le obligatoire. "),n())}function ut(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function ct(r,i){r&1&&(s(0,"small",35),m(1," Nom obligatoire. "),n())}function ft(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function gt(r,i){r&1&&(s(0,"small",35),m(1," Pr\xE9nom obligatoire. "),n())}function _t(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function ht(r,i){if(r&1&&(s(0,"div",36),c(1,"img",37),s(2,"span",38),m(3),n(),s(4,"span"),m(5),n()()),r&2){let e=i.$implicit;l(),p("src",e.flag,ee)("alt",e.name),l(2),E(e.dialCode),l(2),E(e.name)}}function vt(r,i){if(r&1&&(s(0,"div",36),c(1,"img",37),s(2,"span",38),m(3),n(),s(4,"span"),m(5),n()()),r&2){let e=d().$implicit;l(),p("src",e.flag,ee)("alt",e.name),l(2),E(e.dialCode),l(2),E(e.name)}}function bt(r,i){if(r&1&&u(0,vt,6,4,"div",39),r&2){let e=i.$implicit;p("ngIf",e)}}function yt(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function St(r,i){r&1&&(s(0,"small",40),m(1," T\xE9l\xE9phone obligatoire. "),n())}function Ut(r,i){if(r&1&&(s(0,"small",40),m(1),n()),r&2){let e=d();l(),M(" ",e.phoneError," ")}}function wt(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function Et(r,i){r&1&&(s(0,"small",35),m(1," Ville obligatoire. "),n())}function Ct(r,i){r&1&&(s(0,"span",35),m(1,"*"),n())}function xt(r,i){r&1&&(s(0,"small",35),m(1," Quartier obligatoire. "),n())}function It(r,i){if(r&1&&(s(0,"small",35),m(1),n()),r&2){let e=d(2);l(),M(" ",e.passwordError," ")}}function Tt(r,i){if(r&1){let e=U();s(0,"div",8)(1,"label",41),m(2," Mot de passe "),s(3,"span",35),m(4,"*"),n()(),s(5,"p-password",42),S("ngModelChange",function(o){f(e);let a=d();return y(a.model.password,o)||(a.model.password=o),g(o)}),n(),u(6,It,2,1,"small",10),n()}if(r&2){let e=d();l(5),b("ngModel",e.model.password),p("toggleMask",!0)("feedback",!0)("invalid",e.submitted&&!!e.passwordError)("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&e.passwordError&&e.isEditing)}}function Mt(r,i){r&1&&(s(0,"small",35),m(1," Les mots de passe ne correspondent pas. "),n())}function Ft(r,i){if(r&1){let e=U();s(0,"div",8)(1,"label",43),m(2," Confirmer le mot de passe "),s(3,"span",35),m(4,"*"),n()(),s(5,"p-password",44),S("ngModelChange",function(o){f(e);let a=d();return y(a.model.password_confirmation,o)||(a.model.password_confirmation=o),g(o)}),n(),u(6,Mt,2,0,"small",10),n()}if(r&2){let e=d();l(5),b("ngModel",e.model.password_confirmation),p("toggleMask",!0)("feedback",!1)("invalid",e.submitted&&e.model.password!==e.model.password_confirmation)("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&e.model.password!==e.model.password_confirmation&&e.isEditing)}}function Rt(r,i){if(r&1){let e=U();s(0,"div",45)(1,"button",46),v("click",function(){f(e);let o=d();return g(o.onSubmit())}),n(),s(2,"button",47),v("click",function(){f(e);let o=d();return g(o.onCancel())}),n()()}if(r&2){let e=d();l(),p("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),l(),p("disabled",e.loading)}}var V=class r{constructor(i){this.roleService=i}mode="create";initialData=null;loading=!1;submitForm=new te;cancel=new te;submitted=!1;isEditing=!1;model={};availableRoles=[];phoneError=null;phoneCountry="GN";passwordError=null;countries=k;ngOnInit(){this.loadRoles(),this.initializeModel()}ngOnChanges(i){if(i.initialData){let e=i.initialData;e.currentValue&&Object.keys(e.currentValue).length>0&&this.initializeModel()}}loadRoles(){this.roleService.getRoles().subscribe({next:i=>{i.success&&(this.availableRoles=i.data.map(e=>({label:e.role.name.charAt(0).toUpperCase()+e.role.name.slice(1),value:e.role.name})))},error:()=>{this.availableRoles=[{label:"Admin",value:"admin"},{label:"Manager",value:"manager"},{label:"Employ\xE9",value:"employe"}]}})}initializeModel(){this.initialData?this.model={nom:this.initialData.nom,prenom:this.initialData.prenom,phone:this.initialData.phone,email:this.initialData.email,pays:this.initialData.pays,code_pays:this.initialData.code_pays,code_phone_pays:this.initialData.code_phone_pays,ville:this.initialData.ville,quartier:this.initialData.quartier,role:this.initialData.roles?.[0],reference:this.initialData.reference}:this.model={},this.mode==="create"&&!this.model.ville?.trim()&&(this.model.ville="Conakry"),this.mode==="create"?this.isEditing=!0:this.mode==="edit"&&this.initialData&&(this.isEditing=!0),this.model.code_pays?this.phoneCountry=this.model.code_pays:this.model.phone&&this.detectPhoneCountry(this.model.phone),this.submitted=!1,this.phoneError=null,this.passwordError=null}detectPhoneCountry(i){try{let e=ne(i);e&&e.country&&(this.phoneCountry=e.country)}catch{}}validatePhone(){if(!this.model.phone?.trim())return this.phoneError="T\xE9l\xE9phone obligatoire.",!1;try{if(!qe(this.model.phone,this.phoneCountry))return this.phoneError=`Num\xE9ro invalide pour ${this.getCountryName(this.phoneCountry)}.`,!1;let e=ne(this.model.phone,this.phoneCountry);return e?(this.model.phone=e.formatInternational(),this.model.code_pays=this.phoneCountry,this.model.pays=this.getCountryName(this.phoneCountry),this.phoneError=null,!0):(this.phoneError="Format de num\xE9ro invalide.",!1)}catch{return this.phoneError="Format de num\xE9ro invalide.",!1}}validatePassword(){if(this.mode==="edit"&&!this.model.password?.trim())return this.passwordError=null,!0;if(this.mode==="create"&&!this.model.password?.trim())return this.passwordError="Mot de passe obligatoire.",!1;let i=this.model.password||"";return i.length<8?(this.passwordError="Le mot de passe doit contenir au moins 8 caract\xE8res.",!1):!/[a-z]/.test(i)||!/[A-Z]/.test(i)?(this.passwordError="Le mot de passe doit contenir des majuscules et des minuscules.",!1):/[0-9]/.test(i)?this.model.password!==this.model.password_confirmation?(this.passwordError="Les mots de passe ne correspondent pas.",!1):(this.passwordError=null,!0):(this.passwordError="Le mot de passe doit contenir au moins un chiffre.",!1)}getCountryName(i){let e=this.countries.find(t=>t.code===i);return e?e.name:i}getSelectedCountryDialCode(){let i=this.countries.find(e=>e.code===this.phoneCountry);return i?i.dialCode:""}onCountryChange(){this.model.phone&&this.validatePhone()}onPhoneInput(){this.submitted&&this.validatePhone()}onPhoneBlur(){this.model.phone?.trim()&&this.validatePhone()}isValid(){return!(!this.model.role||!!!(this.model.nom?.trim()&&this.model.prenom?.trim()&&this.model.phone?.trim()&&this.model.ville?.trim()&&this.model.quartier?.trim())||!this.validatePhone()||this.mode==="create"&&!this.validatePassword())}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.phoneError=null,this.passwordError=null,this.initializeModel()}onSubmit(){this.submitted=!0,this.isValid()&&this.submitForm.emit(L({},this.model))}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}get formTitle(){if(this.mode==="create")return"Cr\xE9er un compte utilisateur";let i=this.model.reference?.trim();return i?`Modification compte utilisateur : ${i}`:"Modification compte utilisateur"}static \u0275fac=function(e){return new(e||r)(_(J))};static \u0275cmp=x({type:r,selectors:[["app-utilisateurs-form"]],inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[me],decls:63,vars:42,consts:[[1,"card"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2"],[1,"text-surface-900","dark:text-surface-0","font-medium","text-xl","mb-4"],[1,"m-0","p-0","text-surface-600","dark:text-surface-200","leading-normal","mr-4"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12","md:col-span-6"],["for","role",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","role","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un r\xF4le","fluid","",3,"ngModelChange","ngModel","options","disabled","invalid"],["for","email",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","email","type","email","pInputText","","fluid","","placeholder","exemple@email.com",3,"ngModelChange","ngModel","disabled"],["for","nom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","prenom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prenom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],[1,"mb-6","col-span-12"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-4"],["for","codePays",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","codePays","optionLabel","name","optionValue","code","placeholder","S\xE9lectionner un pays","fluid","",3,"ngModelChange","onChange","ngModel","options","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"col-span-12","md:col-span-8"],["for","phone",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","phone","type","tel","pInputText","","fluid","","placeholder","Exemple: 622 00 00 00",3,"ngModelChange","input","blur","ngModel","invalid","disabled"],["class","text-red-500 block mt-2",4,"ngIf"],["for","ville",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","ville","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","quartier",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","quartier","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["class","mb-6 col-span-12 md:col-span-6",4,"ngIf"],["class","col-span-12 flex gap-2",4,"ngIf"],[1,"text-red-500"],[1,"flex","items-center","gap-2"],[1,"w-5","h-auto","rounded-sm",3,"src","alt"],[1,"font-semibold","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500","block","mt-2"],["for","password",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","password","fluid","","placeholder","Min. 8 caract\xE8res, majuscules, minuscules et chiffres","promptLabel","Entrez un mot de passe","weakLabel","Faible","mediumLabel","Moyen","strongLabel","Fort",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],["for","password_confirmation",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","password_confirmation","fluid","","placeholder","Confirmez le mot de passe",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],[1,"col-span-12","flex","gap-2"],["pButton","","pRipple","","icon","pi pi-check",1,"w-auto",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"w-auto",3,"click","disabled"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"div",1)(2,"span",2),m(3),n()(),s(4,"div",3)(5,"div",4),c(6,"div",5)(7,"p",6),n(),s(8,"div",7)(9,"div",3)(10,"div",8)(11,"label",9),m(12," R\xF4le "),u(13,mt,2,0,"span",10),n(),s(14,"p-select",11),S("ngModelChange",function(a){return y(t.model.role,a)||(t.model.role=a),a}),n(),u(15,dt,2,0,"small",10),n(),s(16,"div",8)(17,"label",12),m(18," Email "),n(),s(19,"input",13),S("ngModelChange",function(a){return y(t.model.email,a)||(t.model.email=a),a}),n()(),s(20,"div",8)(21,"label",14),m(22," Nom "),u(23,ut,2,0,"span",10),n(),s(24,"input",15),S("ngModelChange",function(a){return y(t.model.nom,a)||(t.model.nom=a),a}),n(),u(25,ct,2,0,"small",10),n(),s(26,"div",8)(27,"label",16),m(28," Pr\xE9nom "),u(29,ft,2,0,"span",10),n(),s(30,"input",17),S("ngModelChange",function(a){return y(t.model.prenom,a)||(t.model.prenom=a),a}),n(),u(31,gt,2,0,"small",10),n(),s(32,"div",18)(33,"div",19)(34,"div",20)(35,"label",21),m(36," Pays "),u(37,_t,2,0,"span",10),n(),s(38,"p-select",22),S("ngModelChange",function(a){return y(t.phoneCountry,a)||(t.phoneCountry=a),a}),v("onChange",function(){return t.onCountryChange()}),u(39,ht,6,4,"ng-template",23)(40,bt,1,1,"ng-template",24),n()(),s(41,"div",25)(42,"label",26),m(43," T\xE9l\xE9phone "),u(44,yt,2,0,"span",10),n(),s(45,"input",27),S("ngModelChange",function(a){return y(t.model.phone,a)||(t.model.phone=a),a}),v("input",function(){return t.onPhoneInput()})("blur",function(){return t.onPhoneBlur()}),n()()(),u(46,St,2,0,"small",28)(47,Ut,2,1,"small",28),n(),s(48,"div",8)(49,"label",29),m(50," Ville "),u(51,wt,2,0,"span",10),n(),s(52,"input",30),S("ngModelChange",function(a){return y(t.model.ville,a)||(t.model.ville=a),a}),n(),u(53,Et,2,0,"small",10),n(),s(54,"div",8)(55,"label",31),m(56," Quartier "),u(57,Ct,2,0,"span",10),n(),s(58,"input",32),S("ngModelChange",function(a){return y(t.model.quartier,a)||(t.model.quartier=a),a}),n(),u(59,xt,2,0,"small",10),n(),u(60,Tt,7,6,"div",33)(61,Ft,7,6,"div",33)(62,Rt,3,4,"div",34),n()()()()),e&2&&(l(3),M(" ",t.formTitle," "),l(10),p("ngIf",t.isEditing),l(),b("ngModel",t.model.role),p("options",t.availableRoles)("disabled",t.fieldsDisabled)("invalid",t.submitted&&!t.model.role),l(),p("ngIf",t.submitted&&!t.model.role&&t.isEditing),l(4),b("ngModel",t.model.email),p("disabled",t.fieldsDisabled),l(4),p("ngIf",t.isEditing),l(),b("ngModel",t.model.nom),p("invalid",t.submitted&&!(t.model.nom!=null&&t.model.nom.trim()))("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&!(t.model.nom!=null&&t.model.nom.trim())&&t.isEditing),l(4),p("ngIf",t.isEditing),l(),b("ngModel",t.model.prenom),p("invalid",t.submitted&&!(t.model.prenom!=null&&t.model.prenom.trim()))("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&!(t.model.prenom!=null&&t.model.prenom.trim())&&t.isEditing),l(6),p("ngIf",t.isEditing),l(),b("ngModel",t.phoneCountry),p("options",t.countries)("disabled",t.fieldsDisabled),l(6),p("ngIf",t.isEditing),l(),b("ngModel",t.model.phone),p("invalid",(t.submitted||t.phoneError)&&(!(t.model.phone!=null&&t.model.phone.trim())||!!t.phoneError))("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&!(t.model.phone!=null&&t.model.phone.trim())&&t.isEditing),l(),p("ngIf",t.phoneError&&(t.model.phone==null?null:t.model.phone.trim())&&t.isEditing),l(4),p("ngIf",t.isEditing),l(),b("ngModel",t.model.ville),p("invalid",t.submitted&&!(t.model.ville!=null&&t.model.ville.trim()))("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&!(t.model.ville!=null&&t.model.ville.trim())&&t.isEditing),l(4),p("ngIf",t.isEditing),l(),b("ngModel",t.model.quartier),p("invalid",t.submitted&&!(t.model.quartier!=null&&t.model.quartier.trim()))("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&!(t.model.quartier!=null&&t.model.quartier.trim())&&t.isEditing),l(),p("ngIf",t.mode==="create"),l(),p("ngIf",t.mode==="create"),l(),p("ngIf",t.isEditing))},dependencies:[I,P,H,j,z,q,Ue,xe,Ce,B,we,O,W,Ge,ze],encapsulation:2})};var Y=class r{constructor(i,e,t){this.userService=i;this.messageService=e;this.router=t}loading=!1;onSubmit(i){this.loading=!0;let e={nom:i.nom||"",prenom:i.prenom||"",phone:(i.phone||"").replace(/\s+/g,""),email:i.email||void 0,pays:i.pays||"Guin\xE9e",code_pays:i.code_pays||"GN",code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville||"",quartier:i.quartier||"",password:i.password||"",password_confirmation:i.password_confirmation||"",role:i.role||""};this.userService.createUser(e).subscribe({next:t=>{if(t.success){this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur cr\xE9\xE9 avec succ\xE8s"});let o=t.data?.user;setTimeout(()=>{this.router.navigate(["contacts/utilisateurs/edit",o?.id||""])},1500)}this.loading=!1},error:t=>{console.error("Erreur lors de la cr\xE9ation:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Erreur lors de la cr\xE9ation de l'utilisateur"}),this.loading=!1}})}getCodePhonePays(i){let e=k.find(t=>t.code===i);return e?e.dialCode:"+224"}static \u0275fac=function(e){return new(e||r)(_(T),_(w),_(D))};static \u0275cmp=x({type:r,selectors:[["app-utilisateurs-new"]],features:[F([w])],decls:2,vars:2,consts:[[3,"submitForm","mode","loading"]],template:function(e,t){e&1&&(c(0,"p-toast"),s(1,"app-utilisateurs-form",0),v("submitForm",function(a){return t.onSubmit(a)}),n()),e&2&&(l(),p("mode","create")("loading",t.loading))},dependencies:[I,Z,Q,V],encapsulation:2})};function Dt(r,i){r&1&&(s(0,"div",3),c(1,"i",4),n())}function kt(r,i){if(r&1){let e=U();s(0,"app-utilisateurs-form",5),v("submitForm",function(o){f(e);let a=d();return g(a.onSubmit(o))})("cancel",function(){f(e);let o=d();return g(o.onCancel())}),n()}if(r&2){let e=d();p("mode","edit")("initialData",e.userData)("loading",e.loading)}}var $=class r{constructor(i,e,t,o,a){this.route=i;this.router=e;this.userService=t;this.roleService=o;this.messageService=a}loading=!1;userId=null;userData=null;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");i&&(this.userId=parseInt(i,10),this.loadUser(this.userId))}loadUser(i){this.loading=!0,this.userService.getUser(i).subscribe({next:e=>{if(e.success&&e.data){let t=e.data,o={id:t.id,reference:t.reference,nom:t.nom,prenom:t.prenom,phone:t.phone,email:t.email,pays:t.pays,code_pays:t.code_pays,code_phone_pays:t.code_phone_pays,ville:t.ville,quartier:t.quartier,roles:t.role_names||t.roles,is_active:t.is_active},a=t.role_names||t.roles;!a||a.length===0?this.roleService.getUserRoles(i).subscribe({next:h=>{h.success&&h.data&&(o.roles=h.data.roles),this.userData=o,this.loading=!1},error:()=>{this.userData=o,this.loading=!1}}):(this.userData=o,this.loading=!1)}else this.loading=!1},error:e=>{console.error("Erreur lors du chargement:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors du chargement de l'utilisateur"}),this.loading=!1}})}onSubmit(i){if(!this.userId)return;this.loading=!0;let e={nom:i.nom,prenom:i.prenom,phone:(i.phone||"").replace(/\s+/g,""),email:i.email||void 0,pays:i.pays,code_pays:i.code_pays,code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville,quartier:i.quartier};this.userService.updateUser(this.userId,e).subscribe({next:t=>{t.success&&(this.userData=L(L({},this.userData),t.data),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur modifi\xE9 avec succ\xE8s"})),this.loading=!1},error:t=>{console.error("Erreur lors de la modification:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:t.error?.message||"Erreur lors de la modification de l'utilisateur"}),this.loading=!1}})}onCancel(){this.router.navigate(["contacts/utilisateurs"])}getCodePhonePays(i){let e=k.find(t=>t.code===i);return e?e.dialCode:"+224"}static \u0275fac=function(e){return new(e||r)(_(Se),_(D),_(T),_(J),_(w))};static \u0275cmp=x({type:r,selectors:[["app-utilisateurs-edit"]],features:[F([w])],decls:4,vars:2,consts:[[1,"p-4"],["class","flex justify-center items-center h-96",4,"ngIf"],[3,"mode","initialData","loading","submitForm","cancel",4,"ngIf"],[1,"flex","justify-center","items-center","h-96"],[1,"pi","pi-spin","pi-spinner","text-4xl","text-primary"],[3,"submitForm","cancel","mode","initialData","loading"]],template:function(e,t){e&1&&(c(0,"p-toast"),s(1,"div",0),u(2,Dt,2,0,"div",1)(3,kt,1,3,"app-utilisateurs-form",2),n()),e&2&&(l(2),p("ngIf",t.loading&&!t.userData),l(),p("ngIf",t.userData))},dependencies:[I,P,V,Z,Q],encapsulation:2})};var Qi=[{path:"",component:X,canActivate:[G],data:{permissions:["users.read"]}},{path:"new",component:Y,canActivate:[G],data:{permissions:["users.create"]}},{path:"edit/:id",component:$,canActivate:[G],data:{permissions:["users.update"]}},{path:"**",redirectTo:"/notfound"}];export{Qi as default};
