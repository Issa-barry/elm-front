import{b as nt}from"./chunk-HR2J67SV.js";import{a as Ae}from"./chunk-NFEXRSGN.js";import{a as Re,b as Le}from"./chunk-XLX4KHCH.js";import{b as He}from"./chunk-LK4T7DDW.js";import{a as tt,b as it}from"./chunk-G5UZ4UZ3.js";import"./chunk-ZPYPMY5H.js";import"./chunk-CATOJVYP.js";import{b as rt}from"./chunk-H4R3XQVS.js";import{a as Ke,b as Ye}from"./chunk-DHO5ZECZ.js";import{a as Xe,b as Ze}from"./chunk-ZWTNMQUT.js";import{a as ze,b as Je}from"./chunk-XMGAWN6O.js";import{a as ne,b as oe}from"./chunk-FCSZSTKZ.js";import"./chunk-62XMJ7OZ.js";import{a as $e,b as et}from"./chunk-NXMTA3Z5.js";import{d as G}from"./chunk-22WVEZDH.js";import"./chunk-6UNS6ATT.js";import"./chunk-VBF7BBWX.js";import{a as We,d as Ne,e as Oe,h as Be,i as qe,k as je}from"./chunk-KL27V2YF.js";import"./chunk-DKGKIQYD.js";import"./chunk-6R56UM77.js";import"./chunk-C76D6YHB.js";import"./chunk-L2T5JW7K.js";import"./chunk-C35SDHAO.js";import"./chunk-IENEWIOW.js";import{b as ee,c as te}from"./chunk-V7HYCLOH.js";import"./chunk-GCJYWVBV.js";import"./chunk-PZUT5QF4.js";import{c as ie,d as re}from"./chunk-QK2KLPR7.js";import"./chunk-IQ3I63NM.js";import"./chunk-KAT22IHP.js";import"./chunk-2MYVVGAW.js";import"./chunk-VRCAH26M.js";import"./chunk-4O43JDMY.js";import"./chunk-LNM7OC6P.js";import{a as Ge,b as Qe}from"./chunk-BFGT4G5C.js";import"./chunk-D3EQSYXL.js";import{b as Ue}from"./chunk-FR7DTH2N.js";import"./chunk-E6N6EGUJ.js";import"./chunk-2PEJZBD7.js";import{a as Ie,b as Fe,c as Ve,d as De}from"./chunk-BDIOYTKC.js";import{a as J,b as X}from"./chunk-H5W5OS5D.js";import{b as H,e as K,h as Y,m as we,o as z}from"./chunk-CRGNDKCR.js";import"./chunk-BGXPLMJT.js";import{a as Pe,c as Se}from"./chunk-CSKRJUWU.js";import"./chunk-UWIKY6DF.js";import{c as ke,d as Me,e as $}from"./chunk-CYEUP4PV.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import"./chunk-UAZ37PIZ.js";import{i as Te,j as Z}from"./chunk-ZN2HQ4SK.js";import{a as Ce,b as Ee}from"./chunk-SEL7WNEU.js";import{la as Q,pa as C}from"./chunk-6ETCFPPD.js";import{i as ye,k as q,u as j}from"./chunk-6PDKYY6Q.js";import"./chunk-4O3FVBGX.js";import{$ as c,$b as _e,Ab as xe,Bb as ve,Gb as v,Ja as pe,Kb as y,Lb as p,Ma as s,Pb as D,Qb as R,R as be,Ra as ce,Rb as L,Ub as B,V as he,Xa as T,Xb as me,Zb as u,_b as I,aa as m,ab as k,cc as b,dc as h,ec as x,gb as _,gc as U,hc as A,o as S,u as ge,wb as d,wc as w,xb as a,yb as o,zb as g}from"./chunk-KCZYDF4B.js";import{a as V,b as O,c as ue}from"./chunk-GAL4ENT6.js";var F={materiel:"Mat\xE9riel",service:"Service",fabricable:"Fabricable",achat_vente:"Achat/Vente"},E={brouillon:"Brouillon",actif:"Actif",inactif:"Inactif",archive:"Archiv\xE9",rupture_stock:"Rupture de stock"},ae={brouillon:"secondary",actif:"success",inactif:"danger",archive:"danger",rupture_stock:"warn"};var f=class n{id=0;nom="";code="";prix_usine=null;prix_vente=null;prix_achat=null;qte_stock=0;cout=null;statut="brouillon";type="materiel";in_stock=!0;is_archived=!1;archived_at=null;description=null;image_url=null;created_by=null;updated_by=null;deleted_by=null;archived_by=null;created_at="";updated_at="";deleted_at=null;creator;updater;archiver;deleter;created_by_name;updated_by_name;archived_by_name;deleted_by_name;constructor(t){t&&Object.assign(this,t)}getImageUrl(t="assets/demo/images/no-product.png"){return this.image_url?this.image_url.startsWith("http://")||this.image_url.startsWith("https://")?this.image_url:`assets/demo/images/produits/${this.image_url}`:t}formatPrix(t,e="GNF"){return`${(typeof t=="number"?t:0).toLocaleString("fr-FR")} ${e}`}static fromApi(t){return new n(O(V({},t),{prix_usine:t?.prix_usine!==null&&t?.prix_usine!==void 0?Number(t.prix_usine):null,prix_vente:t?.prix_vente!==null&&t?.prix_vente!==void 0?Number(t.prix_vente):null,prix_achat:t?.prix_achat!==null&&t?.prix_achat!==void 0?Number(t.prix_achat):null,cout:t?.cout!==null&&t?.cout!==void 0?Number(t.cout):null}))}static fromApiArray(t){return t.map(e=>n.fromApi(e))}};var M=class n{constructor(t){this.http=t}apiUrl=`${Ae.apiUrl}/produits`;getAll(){return this.http.get(this.apiUrl).pipe(S(t=>f.fromApiArray(t.data)))}getArchived(){return this.http.get(`${this.apiUrl}/archived`).pipe(S(t=>f.fromApiArray(t.data)))}search(t){let e=new Pe;return t.search&&(e=e.set("search",t.search)),t.type&&(e=e.set("type",t.type)),t.statut&&(e=e.set("statut",t.statut)),t.in_stock!==void 0&&(e=e.set("in_stock",t.in_stock.toString())),t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),this.http.get(`${this.apiUrl}/search`,{params:e}).pipe(S(i=>O(V({},i),{data:f.fromApiArray(i.data)})))}getStatistics(){return this.http.get(`${this.apiUrl}/statistics`).pipe(S(t=>t.data))}getById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(S(e=>f.fromApi(e.data)))}create(t){if(t.image){let l=this.toFormData(t);return this.http.post(this.apiUrl,l).pipe(S(P=>f.fromApi(P.data)))}let r=t,{image:e}=r,i=ue(r,["image"]);return this.http.post(this.apiUrl,i).pipe(S(l=>f.fromApi(l.data)))}update(t,e){if(e.image){let P=this.toFormData(e);return P.append("_method","PUT"),this.http.post(`${this.apiUrl}/${t}`,P).pipe(S(at=>f.fromApi(at.data)))}let l=e,{image:i}=l,r=ue(l,["image"]);return this.http.put(`${this.apiUrl}/${t}`,r).pipe(S(P=>f.fromApi(P.data)))}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}updateStock(t,e){return this.http.patch(`${this.apiUrl}/${t}/stock`,e).pipe(S(i=>f.fromApi(i.data)))}changeStatus(t,e){return this.http.patch(`${this.apiUrl}/${t}/status`,e).pipe(S(i=>f.fromApi(i.data)))}archive(t){return this.http.patch(`${this.apiUrl}/${t}/archive`,{}).pipe(S(e=>f.fromApi(e.data)))}unarchive(t){return this.http.patch(`${this.apiUrl}/${t}/unarchive`,{}).pipe(S(e=>f.fromApi(e.data)))}toFormData(t){let e=new FormData;return t.nom&&e.append("nom",t.nom),t.type&&e.append("type",t.type),t.qte_stock!==void 0&&t.qte_stock!==null&&e.append("qte_stock",t.qte_stock.toString()),t.prix_usine!==void 0&&t.prix_usine!==null&&e.append("prix_usine",t.prix_usine.toString()),t.prix_vente!==void 0&&t.prix_vente!==null&&e.append("prix_vente",t.prix_vente.toString()),t.prix_achat!==void 0&&t.prix_achat!==null&&e.append("prix_achat",t.prix_achat.toString()),t.statut&&e.append("statut",t.statut),t.description&&e.append("description",t.description),t.cout!==void 0&&t.cout!==null&&e.append("cout",t.cout.toString()),t.image instanceof File&&e.append("image",t.image,t.image.name),console.log("FormData content:"),e.forEach((i,r)=>{console.log(`  ${r}:`,i)}),e}static \u0275fac=function(e){return new(e||n)(he(Se))};static \u0275prov=be({token:n,factory:n.\u0275fac,providedIn:"root"})};var gt=["dt"],bt=()=>({"min-width":"75rem"}),ht=()=>[10,20,30],xt=()=>({width:"720px",maxWidth:"95vw"}),vt=()=>({width:"450px"});function yt(n,t){if(n&1){let e=v();a(0,"p-button",12),y("onClick",function(){c(e);let r=p();return m(r.goToNewProduits())}),o(),a(1,"p-button",13),y("onClick",function(){c(e);let r=p();return m(r.deleteSelectedProducts())}),o()}if(n&2){let e=p();s(),d("disabled",!e.selectedProduits||!e.selectedProduits.length)}}function Pt(n,t){if(n&1){let e=v();a(0,"p-button",14),y("onClick",function(){c(e);let r=p();return m(r.exportCSV())}),o()}}function St(n,t){if(n&1){let e=v();a(0,"div",15)(1,"h5",16),u(2,"Manage Products"),o(),a(3,"p-iconfield"),g(4,"p-inputicon",17),a(5,"input",18),y("input",function(r){c(e);let l=p(),P=B(8);return m(l.onGlobalFilter(P,r))}),o()()()}}function wt(n,t){n&1&&(a(0,"tr")(1,"th",19),g(2,"p-tableHeaderCheckbox"),o(),a(3,"th",20)(4,"span",21),u(5,"Code "),g(6,"p-sortIcon",22),o()(),a(7,"th",23)(8,"span",21),u(9,"Nom "),g(10,"p-sortIcon",24),o()(),a(11,"th",25)(12,"span",21),u(13,"Type "),g(14,"p-sortIcon",26),o()(),a(15,"th",27)(16,"span",21),u(17,"Qt\xE9 "),g(18,"p-sortIcon",28),o()(),a(19,"th",29)(20,"span",21),u(21,"Status "),g(22,"p-sortIcon",30),o()(),a(23,"th",31),u(24,"Action"),o()())}function Ct(n,t){if(n&1){let e=v();a(0,"tr")(1,"td",19),g(2,"p-tableCheckbox",32),o(),a(3,"td",31),u(4),o(),a(5,"td",33),u(6),o(),a(7,"td"),u(8),o(),a(9,"td"),u(10),o(),a(11,"td"),g(12,"p-tag",34),o(),a(13,"td")(14,"p-button",35),y("click",function(){let r=c(e).$implicit,l=p();return m(l.editProduct(r))}),o(),a(15,"p-button",36),y("click",function(){let r=c(e).$implicit,l=p();return m(l.deleteProduct(r))}),o()()()}if(n&2){let e=t.$implicit,i=p();s(2),d("value",e),s(2),I(e.code),s(2),I(e.nom),s(2),I(e.type),s(2),I(e.qte_stock),s(2),d("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),s(2),d("rounded",!0)("outlined",!0),s(),d("rounded",!0)("outlined",!0)}}function Et(n,t){if(n&1){let e=v();a(0,"div",59)(1,"label",60),u(2,"Code"),o(),a(3,"input",61),x("ngModelChange",function(r){c(e);let l=p(2);return h(l.produit.code,r)||(l.produit.code=r),m(r)}),o()()}if(n&2){let e=p(2);s(3),b("ngModel",e.produit.code),d("disabled",!0)}}function Tt(n,t){n&1&&(a(0,"small",62),u(1,"Type obligatoire."),o())}function kt(n,t){n&1&&(a(0,"small",62),u(1,"Nom obligatoire."),o())}function Mt(n,t){if(n&1){let e=v();a(0,"div")(1,"label",63),u(2,"Statut"),o(),a(3,"p-select",64),x("ngModelChange",function(r){c(e);let l=p(2);return h(l.produit.statut,r)||(l.produit.statut=r),m(r)}),o()()}if(n&2){let e=p(2);s(3),b("ngModel",e.produit.statut),d("options",e.statutOptions)}}function It(n,t){if(n&1){let e=v();_(0,Et,4,2,"div",37),a(1,"div",38)(2,"div")(3,"label",39),u(4,"Type"),o(),a(5,"p-select",40),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.type,r)||(l.produit.type=r),m(r)}),o(),_(6,Tt,2,0,"small",41),o(),a(7,"div")(8,"label",42),u(9,"Nom"),o(),a(10,"input",43),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.nom,r)||(l.produit.nom=r),m(r)}),o(),_(11,kt,2,0,"small",41),o(),a(12,"div")(13,"label",44),u(14,"Description"),o(),a(15,"textarea",45),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.description,r)||(l.produit.description=r),m(r)}),o()(),_(16,Mt,4,2,"div",46),a(17,"div",47)(18,"div",48)(19,"label",49),u(20,"Quantit\xE9"),o(),a(21,"p-inputnumber",50),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.qte_stock,r)||(l.produit.qte_stock=r),m(r)}),o()(),a(22,"div",48)(23,"label",51),u(24,"Co\xFBt"),o(),a(25,"p-inputnumber",52),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.cout,r)||(l.produit.cout=r),m(r)}),o()()(),a(26,"div",47)(27,"div",48)(28,"label",53),u(29,"Prix achat"),o(),a(30,"p-inputnumber",54),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.prix_achat,r)||(l.produit.prix_achat=r),m(r)}),o()(),a(31,"div",48)(32,"label",55),u(33,"Prix vente"),o(),a(34,"p-inputnumber",56),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.prix_vente,r)||(l.produit.prix_vente=r),m(r)}),o()()(),a(35,"div")(36,"label",57),u(37,"Prix usine"),o(),a(38,"p-inputnumber",58),x("ngModelChange",function(r){c(e);let l=p();return h(l.produit.prix_usine,r)||(l.produit.prix_usine=r),m(r)}),o()()()}if(n&2){let e=p();d("ngIf",e.produit==null?null:e.produit.id),s(5),b("ngModel",e.produit.type),d("options",e.typeOptions),s(),d("ngIf",e.submitted&&!e.produit.type),s(4),b("ngModel",e.produit.nom),s(),d("ngIf",e.submitted&&!(e.produit.nom!=null&&e.produit.nom.trim())),s(4),b("ngModel",e.produit.description),s(),d("ngIf",e.produit==null?null:e.produit.id),s(5),b("ngModel",e.produit.qte_stock),s(4),b("ngModel",e.produit.cout),s(5),b("ngModel",e.produit.prix_achat),s(4),b("ngModel",e.produit.prix_vente),s(4),b("ngModel",e.produit.prix_usine)}}function Ft(n,t){if(n&1){let e=v();a(0,"p-button",65),y("click",function(){c(e);let r=p();return m(r.hideDialog())}),o(),a(1,"p-button",66),y("click",function(){c(e);let r=p();return m(r.saveProduit())}),o()}}var W=class n{constructor(t,e,i,r){this.router=t;this.produitService=e;this.messageService=i;this.confirmationService=r}produits=[];produit=new f;loading=!0;filterFields=["code","nom","description","type","statut","qte_stock"];produitDialog=!1;selectedProduits;submitted=!1;typeOptions=[];statutOptions=[];dt;exportColumns;cols;exportCSV(){this.dt.exportCSV()}ngOnInit(){this.initOptions(),this.initColumns(),this.loadProduits()}loadProduits(){this.produitService.getAll().subscribe({next:t=>{this.produits=t,this.loading=!1,console.log(this.produits)},error:t=>{console.error("Erreur lors du chargement des produits :",t),this.loading=!1}})}initOptions(){this.typeOptions=Object.entries(F).map(([t,e])=>({label:e,value:t})),this.statutOptions=Object.entries(E).map(([t,e])=>({label:e,value:t}))}initColumns(){this.cols=[{field:"code",header:"Code",customExportHeader:"Product Code"},{field:"nom",header:"Nom"},{field:"image",header:"Image"},{field:"prix_vente",header:"Prix"},{field:"type",header:"Type"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}openNew(){this.produit=new f,this.submitted=!1,this.produitDialog=!0}editProduct(t){this.produit=new f(V({},t)),this.produitDialog=!0}deleteSelectedProducts(){this.confirmationService.confirm({message:"Are you sure you want to delete the selected products?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{let t=(this.selectedProduits??[]).map(e=>e.id).filter(e=>!!e);t.length!==0&&ge(t.map(e=>this.produitService.delete(e))).subscribe({next:()=>{this.produits=this.produits.filter(e=>!t.includes(e.id)),this.selectedProduits=null,this.messageService.add({severity:"success",summary:"Successful",detail:"Products Deleted",life:3e3})},error:e=>{console.error("Erreur lors de la suppression des produits :",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Suppression impossible.",life:3e3})}})}})}hideDialog(){this.produitDialog=!1,this.submitted=!1}deleteProduct(t){this.confirmationService.confirm({message:"Are you sure you want to delete "+(t.nom||"this product")+"?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{t.id&&this.produitService.delete(t.id).subscribe({next:()=>{this.produits=this.produits.filter(e=>e.id!==t.id),this.messageService.add({severity:"success",summary:"Successful",detail:"Product Deleted",life:3e3})},error:e=>{console.error("Erreur lors de la suppression du produit :",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Suppression impossible.",life:3e3})}})}})}getSeverity(t){switch(t){case"INSTOCK":return"success";case"LOWSTOCK":return"warn";case"OUTOFSTOCK":return"danger";default:return"info"}}getStatutSeverity(t){return t?ae[t]??ae.brouillon:ae.brouillon}getStatutLabel(t){return t?E[t]??E.brouillon:E.brouillon}saveProduit(){if(this.submitted=!0,!this.produit.nom?.trim()||!this.produit.type)return;let t={nom:this.produit.nom.trim(),type:this.produit.type,qte_stock:this.produit.qte_stock??0,statut:this.produit.statut,cout:this.produit.cout??void 0,description:this.produit.description??void 0,prix_usine:this.produit.prix_usine??void 0,prix_vente:this.produit.prix_vente??void 0,prix_achat:this.produit.prix_achat??void 0},e=!!this.produit.id;(e?this.produitService.update(this.produit.id,t):this.produitService.create(t)).subscribe({next:()=>{this.produitDialog=!1,this.produit=new f,this.submitted=!1,this.loadProduits(),this.messageService.add({severity:"success",summary:"Successful",detail:e?"Product Updated":"Product Created",life:3e3})},error:r=>{console.error("Erreur lors de la sauvegarde du produit :",r),this.messageService.add({severity:"error",summary:"Erreur",detail:"Sauvegarde impossible.",life:3e3})}})}goToNewProduits(){this.router.navigate(["/produits/produits-new"])}static \u0275fac=function(e){return new(e||n)(T(G),T(M),T(C),T(Q))};static \u0275cmp=k({type:n,selectors:[["app-produits-liste"]],viewQuery:function(e,i){if(e&1&&D(gt,5),e&2){let r;R(r=L())&&(i.dt=r.first)}},features:[U([C,M,Q])],decls:21,vars:22,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["content",""],["footer",""],[1,"card"],["styleClass","mb-12"],["dataKey","id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} produits",3,"selectionChange","value","loading","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions"],[3,"visibleChange","visible","header","modal"],["label","Nouveau","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick"],["severity","secondary","label","Delete","icon","pi pi-trash","outlined","",3,"onClick","disabled"],["label","Export","icon","pi pi-upload","severity","secondary",3,"onClick"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Search...",3,"input"],[2,"width","3rem"],["pSortableColumn","code",2,"min-width","16rem"],[1,"flex","items-center","gap-2"],["field","code"],["pSortableColumn","nom",2,"min-width","16rem"],["field","nom"],["pSortableColumn","type",2,"min-width","10rem"],["field","type"],["pSortableColumn","qte_stock",2,"min-width","12rem"],["field","qte_stock"],["pSortableColumn","statut",2,"min-width","12rem"],["field","statut"],[2,"min-width","12rem"],[3,"value"],[2,"min-width","16rem"],[3,"value","severity"],["icon","pi pi-pencil",1,"mr-2",3,"click","rounded","outlined"],["icon","pi pi-trash","severity","danger",3,"click","rounded","outlined"],["class","mb-4",4,"ngIf"],[1,"flex","flex-col","gap-6"],["for","type",1,"block","font-bold","mb-4"],["inputId","type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","ngModel","options"],["class","text-red-500",4,"ngIf"],["for","nom",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","nom","required","","autofocus","","fluid","",3,"ngModelChange","ngModel"],["for","description",1,"block","font-bold","mb-4"],["id","description","pTextarea","","rows","3","cols","20","fluid","",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-6"],["for","qte_stock",1,"block","font-bold","mb-4"],["id","qte_stock","fluid","",3,"ngModelChange","ngModel"],["for","cout",1,"block","font-bold","mb-4"],["id","cout","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_achat",1,"block","font-bold","mb-4"],["id","prix_achat","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_vente",1,"block","font-bold","mb-4"],["id","prix_vente","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_usine",1,"block","font-bold","mb-4"],["id","prix_usine","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],[1,"mb-4"],["for","code",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","code","fluid","",3,"ngModelChange","ngModel","disabled"],[1,"text-red-500"],["for","statut",1,"block","font-bold","mb-4"],["inputId","statut","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","fluid","",3,"ngModelChange","ngModel","options"],["label","Annuler","icon","pi pi-times","text","",3,"click"],["label","Enregistrer","icon","pi pi-check",3,"click"]],template:function(e,i){if(e&1){let r=v();g(0,"p-toast"),a(1,"div",8)(2,"p-toolbar",9),_(3,yt,2,1,"ng-template",null,0,w)(5,Pt,1,0,"ng-template",null,1,w),o(),a(7,"p-table",10,2),x("selectionChange",function(P){return c(r),h(i.selectedProduits,P)||(i.selectedProduits=P),m(P)}),_(9,St,6,0,"ng-template",null,3,w)(11,wt,25,0,"ng-template",null,4,w)(13,Ct,16,11,"ng-template",null,5,w),o()(),a(15,"p-dialog",11),x("visibleChange",function(P){return c(r),h(i.produitDialog,P)||(i.produitDialog=P),m(P)}),_(16,It,39,13,"ng-template",null,6,w)(18,Ft,2,0,"ng-template",null,7,w),o(),g(20,"p-confirmdialog")}e&2&&(s(7),d("value",i.produits)("loading",i.loading)("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",A(18,bt)),b("selection",i.selectedProduits),d("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",A(19,ht)),s(8),me(A(20,xt)),b("visible",i.produitDialog),d("header",i.produit!=null&&i.produit.id?"Modifier un produit":"Nouveau produit")("modal",!0),s(5),me(A(21,vt)))},dependencies:[j,q,je,We,Ne,Oe,Be,qe,z,H,K,we,Y,$,Me,Z,oe,ne,Ye,Ke,He,X,J,et,$e,re,ie,Ue,te,ee,Je,ze,Qe,Ge,De,Ve,Fe,Ie,Ze,Xe],encapsulation:2})};var Vt=["buttonEl"];function Dt(n,t){if(n&1){let e=v();a(0,"button",33),y("click",function(){c(e);let r=p();return m(r.enableEditing())}),o()}}function Rt(n,t){n&1&&(a(0,"span",34),u(1,"*"),o())}function Lt(n,t){n&1&&(a(0,"small",34),u(1," Type de produit obligatoire. "),o())}function Ut(n,t){if(n&1&&(a(0,"small",35),g(1,"i",36),u(2),o()),n&2){let e=p();s(2),_e("",e.getPrixHelperText()," ")}}function At(n,t){n&1&&(a(0,"span",34),u(1,"*"),o())}function Wt(n,t){n&1&&(a(0,"small",34),u(1," Nom du produit obligatoire. "),o())}function Nt(n,t){n&1&&(a(0,"span",34),u(1,"*"),o())}function Ot(n,t){n&1&&(a(0,"small",34),u(1,' Prix usine obligatoire pour "Fabricable". '),o())}function Bt(n,t){if(n&1){let e=v();a(0,"div",37)(1,"label",38),u(2," Prix usine (GNF) "),_(3,Nt,2,0,"span",11),o(),a(4,"p-inputnumber",39),x("ngModelChange",function(r){c(e);let l=p();return h(l.product.prix_usine,r)||(l.product.prix_usine=r),m(r)}),o(),_(5,Ot,2,0,"small",11),o()}if(n&2){let e=p();s(3),d("ngIf",e.isEditing&&e.isPrixUsineRequired()),s(),b("ngModel",e.product.prix_usine),d("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixUsineRequired()&&!e.product.prix_usine),s(),d("ngIf",e.submitted&&e.isPrixUsineRequired()&&!e.product.prix_usine&&e.isEditing)}}function qt(n,t){n&1&&(a(0,"span",34),u(1,"*"),o())}function jt(n,t){n&1&&(a(0,"small",34),u(1," Prix d'achat obligatoire pour ce type. "),o())}function Gt(n,t){if(n&1){let e=v();a(0,"div",40)(1,"label",41),u(2," Prix achat (GNF) "),_(3,qt,2,0,"span",11),o(),a(4,"p-inputnumber",42),x("ngModelChange",function(r){c(e);let l=p();return h(l.product.prix_achat,r)||(l.product.prix_achat=r),m(r)}),o(),_(5,jt,2,0,"small",11),o()}if(n&2){let e=p();d("ngClass",e.isPrixUsineVisible()?"lg:col-span-4":"lg:col-span-6"),s(3),d("ngIf",e.isEditing&&e.isPrixAchatRequired()),s(),b("ngModel",e.product.prix_achat),d("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixAchatRequired()&&!e.product.prix_achat),s(),d("ngIf",e.submitted&&e.isPrixAchatRequired()&&!e.product.prix_achat&&e.isEditing)}}function Qt(n,t){n&1&&(a(0,"span",34),u(1,"*"),o())}function Ht(n,t){n&1&&(a(0,"small",34),u(1," Prix de vente obligatoire pour ce type. "),o())}function Kt(n,t){if(n&1){let e=v();a(0,"div",40)(1,"label",43),u(2," Prix vente (GNF) "),_(3,Qt,2,0,"span",11),o(),a(4,"p-inputnumber",44),x("ngModelChange",function(r){c(e);let l=p();return h(l.product.prix_vente,r)||(l.product.prix_vente=r),m(r)}),o(),_(5,Ht,2,0,"small",11),o()}if(n&2){let e=p();d("ngClass",e.isPrixUsineVisible()?"lg:col-span-4":"lg:col-span-6"),s(3),d("ngIf",e.isEditing&&e.isPrixVenteRequired()),s(),b("ngModel",e.product.prix_vente),d("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixVenteRequired()&&!e.product.prix_vente),s(),d("ngIf",e.submitted&&e.isPrixVenteRequired()&&!e.product.prix_vente&&e.isEditing)}}function Yt(n,t){n&1&&(a(0,"div",51),g(1,"i",52),a(2,"span",53),u(3,"Ajouter une image"),o(),a(4,"span",54),u(5,"Cliquez pour s\xE9lectionner"),o()())}function zt(n,t){if(n&1){let e=v();a(0,"button",59),y("click",function(r){c(e);let l=p(4);return m(l.removeImage(r))}),g(1,"i",60),o()}}function Jt(n,t){if(n&1&&(a(0,"div",55)(1,"div",56),g(2,"img",57),_(3,zt,2,0,"button",58),o()()),n&2){let e=p(3);s(2),d("src",e.imagePreview||e.product.getImageUrl(),pe),s(),d("ngIf",!e.fieldsDisabled)}}function Xt(n,t){if(n&1){let e=v();a(0,"div",48),y("click",function(){c(e),p();let r=B(4),l=p();return m(!l.fieldsDisabled&&r.advancedFileInput.nativeElement.click())}),_(1,Yt,6,0,"div",49)(2,Jt,4,2,"div",50),o()}if(n&2){let e=p(2);s(),d("ngIf",!e.imagePreview&&!e.product.image_url),s(),d("ngIf",e.imagePreview||e.product.image_url)}}function Zt(n,t){if(n&1){let e=v();a(0,"div",45)(1,"label",46),u(2," Image du produit "),o(),a(3,"p-fileUpload",47,0),y("onSelect",function(r){c(e);let l=p();return m(l.onUpload(r))}),_(5,Xt,3,2,"ng-template",null,1,w),o()()}if(n&2){let e=p();s(3),d("customUpload",!0)("multiple",!1)("showUploadButton",!1)("showCancelButton",!1)("auto",!0)("disabled",e.fieldsDisabled)}}function $t(n,t){if(n&1&&(a(0,"div",45)(1,"label",46),u(2," Image du produit "),o(),a(3,"div",61),g(4,"img",57),o()()),n&2){let e=p();s(4),d("src",e.product.getImageUrl(),pe)}}function ei(n,t){if(n&1&&(a(0,"div",25)(1,"span",26),u(2," Statut "),o(),a(3,"div",28)(4,"div",29)(5,"span",62),u(6,"Statut:"),o(),a(7,"span",63),u(8),o()()()()),n&2){let e=p();s(8),I(e.product.statut)}}function ti(n,t){n&1&&(a(0,"span",64),u(1," (non applicable) "),o())}function ii(n,t){n&1&&(a(0,"small",65),g(1,"i",36),u(2,"Le stock n'est pas g\xE9r\xE9 pour les services. "),o())}function ri(n,t){if(n&1){let e=v();a(0,"div",66)(1,"button",67),y("click",function(){c(e);let r=p();return m(r.onSubmit())}),o(),a(2,"button",68),y("click",function(){c(e);let r=p();return m(r.mode==="create"?r.onCancel():r.cancelEditing())}),o()()}if(n&2){let e=p();s(),d("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),s(),d("disabled",e.loading)}}var N=class n{buttonEl;mode="create";initialData=null;loading=!1;submitForm=new ce;cancel=new ce;submitted=!1;isEditing=!1;typeOptions=[{label:F.materiel,value:"materiel"},{label:F.service,value:"service"},{label:F.fabricable,value:"fabricable"},{label:F.achat_vente,value:"achat_vente"}];statutOptions=[{label:E.brouillon,value:"brouillon"},{label:E.actif,value:"actif"},{label:E.inactif,value:"inactif"},{label:E.rupture_stock,value:"rupture_stock"}];product=new f({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"brouillon",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null});selectedImageFile=null;imagePreview=null;ngOnInit(){this.initialData&&(this.product=new f(this.initialData),this.imagePreview=this.initialData.image_url),this.mode==="create"&&(this.isEditing=!0)}isPrixUsineVisible(){return this.product.type==="fabricable"}isPrixUsineRequired(){return this.product.type==="fabricable"}isPrixVenteVisible(){return["service","fabricable","achat_vente"].includes(this.product.type)}isPrixVenteRequired(){return["service","fabricable","achat_vente"].includes(this.product.type)}isPrixAchatVisible(){return["materiel","achat_vente"].includes(this.product.type)}isPrixAchatRequired(){return["materiel","achat_vente"].includes(this.product.type)}isQteStockDisabled(){return this.product.type==="service"||this.fieldsDisabled}isPositive(t){return typeof t=="number"&&t>0}onTypeChange(){this.isPrixUsineVisible()||(this.product.prix_usine=null),this.isPrixVenteVisible()||(this.product.prix_vente=null),this.isPrixAchatVisible()||(this.product.prix_achat=null),this.product.type==="service"&&(this.product.qte_stock=0)}isValid(){return!(!this.product.nom?.trim()||!this.product.type||this.isPrixUsineRequired()&&!this.isPositive(this.product.prix_usine)||this.isPrixVenteRequired()&&!this.isPositive(this.product.prix_vente)||this.isPrixAchatRequired()&&!this.isPositive(this.product.prix_achat))}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null,this.initialData?(this.product=new f(this.initialData),this.imagePreview=this.initialData.image_url):this.resetForm()}onUpload(t){if(t?.files?.length){let e=t.files[0];this.selectedImageFile=e;let i=new FileReader;i.onload=r=>this.imagePreview=r.target.result,i.readAsDataURL(e)}}removeImage(t){t.stopPropagation(),this.selectedImageFile=null,this.imagePreview=null,this.product.image_url=null}onSubmit(){if(this.submitted=!0,!this.isValid())return;let t={nom:this.product.nom.trim(),type:this.product.type,qte_stock:this.product.qte_stock,description:this.product.description?.trim()||void 0,cout:this.product.cout??void 0};this.mode==="edit"&&(t.statut=this.product.statut),this.product.prix_usine!==null&&(t.prix_usine=this.product.prix_usine),this.product.prix_vente!==null&&(t.prix_vente=this.product.prix_vente),this.product.prix_achat!==null&&(t.prix_achat=this.product.prix_achat),this.selectedImageFile&&(t.image=this.selectedImageFile),console.log("DTO:",t),this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}getPrixHelperText(){switch(this.product.type){case"materiel":return"Prix d'achat obligatoire";case"service":return"Prix de vente obligatoire (stock d\xE9sactiv\xE9)";case"fabricable":return"Prix usine et prix de vente obligatoires";case"achat_vente":return"Prix d'achat et prix de vente obligatoires";default:return"S\xE9lectionnez un type de produit"}}resetForm(){this.submitted=!1,this.selectedImageFile=null,this.imagePreview=null,this.product=new f({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"brouillon",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-produits-form"]],viewQuery:function(e,i){if(e&1&&D(Vt,5),e&2){let r;R(r=L())&&(i.buttonEl=r)}},inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[U([C])],decls:41,vars:29,consts:[["fileUploader",""],["content",""],[1,"card"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-4","flex-wrap"],[1,"col-span-12","lg:col-span-8"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12"],[1,"mb-3","text-surface-900","dark:text-surface-0","font-bold","block"],["class","text-red-500",4,"ngIf"],["optionLabel","label","optionValue","value","placeholder","S\xE9lectionner le type","fluid","",3,"ngModelChange","onChange","options","ngModel","disabled","invalid"],["class","text-blue-600 block mt-1",4,"ngIf"],[1,"col-span-12","mb-3"],["for","nom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nom","pInputText","","type","text","placeholder","Ex: iPhone 15 Pro","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],["class","col-span-12 lg:col-span-4",4,"ngIf"],["class","col-span-12",3,"ngClass",4,"ngIf"],["class","col-span-12 mt-4",4,"ngIf"],[1,"col-span-12","lg:col-span-4","flex","flex-col","gap-y-4","mt-8"],["class","border border-surface-200 dark:border-surface-700 rounded",4,"ngIf"],[1,"border","border-surface-200","dark:border-surface-700","flex","justify-between","items-center","px-4","rounded"],[1,"text-surface-900","dark:text-surface-0","font-bold","p-4"],[3,"ngModelChange","ngModel","disabled"],[1,"border","border-surface-200","dark:border-surface-700","rounded"],[1,"text-surface-900","dark:text-surface-0","font-bold","block","border-b","border-surface-200","dark:border-surface-700","p-4"],["class","text-sm font-normal text-gray-500",4,"ngIf"],[1,"p-4"],[1,"bg-surface-100","dark:bg-surface-700","py-2","px-4","flex","items-center","rounded"],["placeholder","0","fluid","",3,"ngModelChange","ngModel","showButtons","min","disabled"],["class","text-gray-500 block mt-2",4,"ngIf"],["class","flex gap-2",4,"ngIf"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn",1,"w-auto",3,"click"],[1,"text-red-500"],[1,"text-blue-600","block","mt-1"],[1,"pi","pi-info-circle","mr-1"],[1,"col-span-12","lg:col-span-4"],["for","prix_usine",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["inputId","prix_usine","mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],[1,"col-span-12",3,"ngClass"],["for","prix_achat",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["inputId","prix_achat","mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],["for","prix_vente",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["inputId","prix_vente","mode","currency","currency","GNF","locale","fr-GN","placeholder","0","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],[1,"col-span-12","mt-4"],[1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["name","image","accept","image/*","styleClass","border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 p-0 rounded",3,"onSelect","customUpload","multiple","showUploadButton","showCancelButton","auto","disabled"],[1,"w-full","py-4",2,"cursor","pointer",3,"click"],["class","h-40 flex flex-col justify-center items-center",4,"ngIf"],["class","relative w-full flex justify-center",4,"ngIf"],[1,"h-40","flex","flex-col","justify-center","items-center"],[1,"pi","pi-image","text-primary","text-4xl","mb-4"],[1,"block","font-semibold","text-surface-900","dark:text-surface-0","text-lg"],[1,"text-surface-500","text-sm","mt-1"],[1,"relative","w-full","flex","justify-center"],[1,"relative"],["alt","Image du produit",1,"max-h-60","rounded","shadow","object-contain",3,"src"],["pButton","","pRipple","","rounded","","type","button","severity","danger","class","absolute -top-2 -right-2",3,"click",4,"ngIf"],["pButton","","pRipple","","rounded","","type","button","severity","danger",1,"absolute","-top-2","-right-2",3,"click"],[1,"pi","pi-times"],[1,"flex","justify-center"],[1,"text-black/90","dark:text-surface-0","font-bold","mr-4"],[1,"text-black/60","dark:text-surface-0","font-semibold"],[1,"text-sm","font-normal","text-gray-500"],[1,"text-gray-500","block","mt-2"],[1,"flex","gap-2"],["pButton","","pRipple","","icon","pi pi-check",1,"flex-1",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"flex-1",3,"click","disabled"]],template:function(e,i){e&1&&(a(0,"div",2)(1,"div",3)(2,"span",4),u(3),o(),_(4,Dt,1,0,"button",5),o(),a(5,"p-fluid",6)(6,"div",7)(7,"div",8)(8,"div",9)(9,"label",10),u(10," Type de produit "),_(11,Rt,2,0,"span",11),o(),a(12,"p-select",12),x("ngModelChange",function(l){return h(i.product.type,l)||(i.product.type=l),l}),y("onChange",function(){return i.onTypeChange()}),o(),_(13,Lt,2,0,"small",11)(14,Ut,3,1,"small",13),o(),a(15,"div",14)(16,"label",15),u(17," Nom du produit "),_(18,At,2,0,"span",11),o(),a(19,"input",16),x("ngModelChange",function(l){return h(i.product.nom,l)||(i.product.nom=l),l}),o(),_(20,Wt,2,0,"small",11),o(),_(21,Bt,6,5,"div",17)(22,Gt,6,6,"div",18)(23,Kt,6,6,"div",18)(24,Zt,7,6,"div",19)(25,$t,5,1,"div",19),o()(),a(26,"div",20),_(27,ei,9,1,"div",21),a(28,"div",22)(29,"span",23),u(30,"En stock"),o(),a(31,"p-toggleswitch",24),x("ngModelChange",function(l){return h(i.product.in_stock,l)||(i.product.in_stock=l),l}),o()(),a(32,"div",25)(33,"span",26),u(34," Quantit\xE9 en stock "),_(35,ti,2,0,"span",27),o(),a(36,"div",28)(37,"div",29)(38,"p-inputnumber",30),x("ngModelChange",function(l){return h(i.product.qte_stock,l)||(i.product.qte_stock=l),l}),o()(),_(39,ii,3,0,"small",31),o()(),_(40,ri,3,4,"div",32),o()()()),e&2&&(s(3),_e(" ",i.mode==="create"?"Cr\xE9er un produit":"D\xE9tails du produit"," "),s(),d("ngIf",i.mode==="edit"&&!i.isEditing),s(7),d("ngIf",i.isEditing),s(),d("options",i.typeOptions),b("ngModel",i.product.type),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!i.product.type),s(),d("ngIf",i.submitted&&!i.product.type&&i.isEditing),s(),d("ngIf",i.product.type&&i.isEditing),s(4),d("ngIf",i.isEditing),s(),b("ngModel",i.product.nom),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())),s(),d("ngIf",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())&&i.isEditing),s(),d("ngIf",i.isPrixUsineVisible()),s(),d("ngIf",i.isPrixAchatVisible()),s(),d("ngIf",i.isPrixVenteVisible()),s(),d("ngIf",i.isEditing),s(),d("ngIf",!i.isEditing&&i.product.image_url),s(2),d("ngIf",i.mode==="edit"),s(4),b("ngModel",i.product.in_stock),d("disabled",i.fieldsDisabled),s(4),d("ngIf",i.product.type==="service"),s(3),b("ngModel",i.product.qte_stock),d("showButtons",!0)("min",0)("disabled",i.isQteStockDisabled()),s(),d("ngIf",i.product.type==="service"),s(),d("ngIf",i.isEditing))},dependencies:[j,ye,q,nt,X,J,z,H,K,Y,it,tt,$,ke,re,ie,Le,Re,Z,Te,rt,Ee,Ce,te,ee],styles:["[_nghost-%COMP%]     .p-fileupload-header{display:none}[_nghost-%COMP%]     .p-fileupload-file-list{display:none}[_nghost-%COMP%]     .p-fileupload-content{height:20rem}"]})};var se=class n{constructor(t,e,i){this.router=t;this.messageService=e;this.produitService=i}produitForm;loading=!1;onSubmitForm(t){this.loading=!0,this.produitService.create(t).subscribe({next:()=>this.handleSuccess("Produit cr\xE9\xE9 avec succ\xE8s"),error:e=>this.handleError("Erreur lors de la cr\xE9ation du produit",e)})}onCancel(){this.router.navigate(["/produits"])}handleSuccess(t){this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t,life:3e3}),this.loading=!1,this.resetForm()}handleError(t,e){this.messageService.add({severity:"error",summary:"Erreur",detail:t,life:5e3}),this.loading=!1,console.error(e)}resetForm(){this.produitForm?.resetForm()}static \u0275fac=function(e){return new(e||n)(T(G),T(C),T(M))};static \u0275cmp=k({type:n,selectors:[["app-produits-new"]],viewQuery:function(e,i){if(e&1&&D(N,5),e&2){let r;R(r=L())&&(i.produitForm=r.first)}},features:[U([C])],decls:2,vars:1,consts:[["mode","create",3,"submitForm","cancel","loading"]],template:function(e,i){e&1&&(g(0,"p-toast"),a(1,"app-produits-form",0),y("submitForm",function(l){return i.onSubmitForm(l)})("cancel",function(){return i.onCancel()}),o()),e&2&&(s(),d("loading",i.loading))},dependencies:[N,oe,ne],encapsulation:2})};var de=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-produits-edit"]],decls:2,vars:0,template:function(e,i){e&1&&(xe(0,"p"),u(1,"produits-edit works!"),ve())},encapsulation:2})};var Br=[{path:"",component:W},{path:"produits",component:W},{path:"produits-new",component:se},{path:"produits/:id/edit",component:de},{path:"**",redirectTo:"/notfound"}];export{Br as default};
