import{a as Qe,b as $}from"./chunk-27QB2YEV.js";import{a as Ge}from"./chunk-2KKMT53Y.js";import{a as Ee,b as Ie}from"./chunk-TAZC2MVD.js";import{a as Oe,b as ze}from"./chunk-72N52MDZ.js";import"./chunk-QZW26AKA.js";import{a as Ke}from"./chunk-5L5Z7R33.js";import{a as Z}from"./chunk-JWF72WUB.js";import{a as Ue,b as qe}from"./chunk-JPW6ZAFI.js";import{a as Fe,b as Ve}from"./chunk-GKSDJ35N.js";import{a as Ae,d as Ne,e as De,k as We}from"./chunk-5SU3VX4I.js";import"./chunk-FSPVSKSZ.js";import"./chunk-UNI73J4N.js";import"./chunk-PLHOD4D2.js";import"./chunk-4CBX77DK.js";import{b as Re,c as Te}from"./chunk-7NAAWXSB.js";import"./chunk-XVRWV2XV.js";import{a as je,b as Be}from"./chunk-LBJBWH2H.js";import"./chunk-JNNIOAIW.js";import"./chunk-VQVZZS7K.js";import"./chunk-D6JQVQWY.js";import"./chunk-EB4NKW3M.js";import"./chunk-MHNPKBVZ.js";import{a as Le,b as Y}from"./chunk-XG7KTEHV.js";import"./chunk-4D2WW7CC.js";import"./chunk-CFBWG52G.js";import{b as X}from"./chunk-CYMODEE3.js";import"./chunk-SIZMBHAK.js";import"./chunk-QICZJIV6.js";import"./chunk-Y2GJFJSJ.js";import{d as ye,j as H}from"./chunk-7G5MAEGV.js";import"./chunk-OAY6NCLF.js";import"./chunk-64S7HSEB.js";import{d as C,e as E}from"./chunk-BOPQ6VBP.js";import"./chunk-QO7YANFN.js";import"./chunk-BR4KK4GE.js";import"./chunk-W5YXJREM.js";import"./chunk-VSD657XK.js";import"./chunk-TYSRPQOK.js";import"./chunk-Y2OLWBL2.js";import"./chunk-Z2X2BPAP.js";import{a as we,b as be,c as Me,d as Se}from"./chunk-F4Z36YAX.js";import{a as j,b as B}from"./chunk-OVLHBJZG.js";import{b as V,e as I,h as R,j as xe,m as Pe,p as T}from"./chunk-4JYGVSAH.js";import{a as ke,b as Ce}from"./chunk-W6DWJODJ.js";import"./chunk-6FAG7IWX.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import"./chunk-MUZL2WG3.js";import"./chunk-G5FZIH5E.js";import{la as J,pa as w}from"./chunk-5CRI5L3F.js";import{i as he,k,v as S}from"./chunk-PVTSUL7D.js";import"./chunk-4O3FVBGX.js";import{A as D,Ab as i,Bb as a,Cb as c,Gb as pe,Hb as ce,Jb as W,Nb as f,Ob as u,Pa as o,Sb as ue,Tb as fe,Ub as ge,Yb as ve,Zb as _e,_a as h,_b as G,ac as d,ba as x,bc as M,ca as P,cc as U,db as b,fc as g,gc as v,hc as _,jb as y,jc as L,k as N,ka as de,kc as F,u as Q,yc as q,zb as m}from"./chunk-WZ5FQRRG.js";import"./chunk-GAL4ENT6.js";function Ye(n,r){if(n&1&&(i(0,"div",12),d(1),a()),n&2){let t=u();o(),M(t.errorMessage)}}function Ze(n,r){if(n&1&&(i(0,"div",13),d(1),a()),n&2){let t=u();o(),M(t.successMessage)}}var ee=class n{constructor(r,t){this.parametresService=r;this.messageService=t}loading=!1;saving=!1;errorMessage="";successMessage="";idRouleauPacking="";prixRouleauDefaut=0;idRouleauParam;prixRouleauParam;produitRouleauKey="produit_rouleau_id";legacyProduitRouleauKey="id_rouleau_packing";ngOnInit(){this.loadPackingParametres()}loadPackingParametres(){this.loading=!0,this.errorMessage="",this.parametresService.getParametres("packing").subscribe({next:r=>{let t=r.data.parametres??[];this.idRouleauParam=t.find(e=>e.cle===this.produitRouleauKey)??t.find(e=>e.cle===this.legacyProduitRouleauKey),this.prixRouleauParam=t.find(e=>e.cle==="prix_rouleau_defaut"),this.idRouleauPacking=this.idRouleauParam?.valeur?.toString()??"",this.prixRouleauDefaut=Number(this.prixRouleauParam?.valeur??0)||0,this.loading=!1},error:()=>{this.errorMessage="Impossible de charger les parametres.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.loading=!1}})}savePackingParametres(){if(this.errorMessage="",this.successMessage="",!this.idRouleauParam||!this.prixRouleauParam){this.errorMessage="Parametres packing introuvables (produit_rouleau_id / prix_rouleau_defaut).",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3});return}let r=Number(this.idRouleauPacking);if(!Number.isFinite(r)){this.errorMessage='Le champ "ID du produit rouleau" doit etre numerique.',this.messageService.add({severity:"warn",summary:"Validation",detail:this.errorMessage,life:3e3});return}this.saving=!0,Q([this.parametresService.updateParametre(this.idRouleauParam.id,{valeur:r}).pipe(D(()=>N(null))),this.parametresService.updateParametre(this.prixRouleauParam.id,{valeur:Number(this.prixRouleauDefaut||0)}).pipe(D(()=>N(null)))]).subscribe({next:t=>{t.some(l=>l===null)?(this.errorMessage="Une ou plusieurs mises a jour ont echoue.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3})):(this.successMessage="Parametres mis a jour avec succes.",this.messageService.add({severity:"success",summary:"Succes",detail:this.successMessage,life:3e3})),this.saving=!1},error:()=>{this.errorMessage="Erreur lors de la sauvegarde.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.saving=!1}})}static \u0275fac=function(t){return new(t||n)(h(Z),h(w))};static \u0275cmp=b({type:n,selectors:[["app-parametres-packing"]],features:[L([w])],decls:17,vars:8,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"flex","gap-12","flex-col-reverse","md:flex-row"],[1,"flex-auto","flex","flex-col","gap-6"],[1,"flex","flex-col","gap-2"],["for","produit_rouleau_id",1,"text-surface-900","dark:text-surface-0"],["id","produit_rouleau_id","type","number","min","0","step","1","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","prix_rouleau_defaut",1,"text-surface-900","dark:text-surface-0"],["id","prix_rouleau_defaut","type","number","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),d(2,"Parametres Packing"),a(),y(3,Ye,2,1,"div",2)(4,Ze,2,1,"div",3),i(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),d(9,"ID du produit rouleau (packing)"),a(),i(10,"input",8),_("ngModelChange",function(s){return v(e.idRouleauPacking,s)||(e.idRouleauPacking=s),s}),a()(),i(11,"div",6)(12,"label",9),d(13,"Prix par defaut du rouleau de packing"),a(),i(14,"input",10),_("ngModelChange",function(s){return v(e.prixRouleauDefaut,s)||(e.prixRouleauDefaut=s),s}),a()()()(),i(15,"div")(16,"p-button",11),f("onClick",function(){return e.savePackingParametres()}),a()()()),t&2&&(o(3),m("ngIf",e.errorMessage),o(),m("ngIf",e.successMessage),o(6),g("ngModel",e.idRouleauPacking),m("disabled",e.loading||e.saving),o(4),g("ngModel",e.prixRouleauDefaut),m("disabled",e.loading||e.saving),o(2),m("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[S,k,T,V,xe,I,Pe,R,E,C,$,B,j,Y,H],encapsulation:2})};function et(n,r){if(n&1&&(i(0,"div",18),d(1),a()),n&2){let t=u();o(),M(t.errorMessage)}}function tt(n,r){if(n&1&&(i(0,"div",19),d(1),a()),n&2){let t=u();o(),M(t.successMessage)}}var se=class n{constructor(r,t){this.authService=r;this.messageService=t}loading=!1;saving=!1;profileLoaded=!1;errorMessage="";successMessage="";form={nom:"",prenom:"",email:"",ville:"",quartier:""};ngOnInit(){this.loadProfile()}loadProfile(){this.loading=!0,this.profileLoaded=!1,this.errorMessage="",this.successMessage="",this.authService.me().subscribe({next:r=>{let t=this.extractUserFromPayload(r?.data)??this.authService.currentUser();if(!t){this.errorMessage="Impossible de charger le profile.",this.pushMessage("error","Erreur",this.errorMessage),this.loading=!1;return}this.applyUserToForm(t),this.profileLoaded=!0,this.loading=!1},error:()=>{let r=this.authService.currentUser();if(r){this.applyUserToForm(r),this.profileLoaded=!0,this.loading=!1;return}this.errorMessage="Impossible de charger le profile.",this.pushMessage("error","Erreur",this.errorMessage),this.loading=!1}})}saveProfile(){if(this.loading||this.saving||!this.profileLoaded)return;this.errorMessage="",this.successMessage="";let r=this.buildUpdatePayload();this.saving=!0,this.authService.updateProfile(r).subscribe({next:t=>{let e=this.extractUserFromPayload(t?.data)??this.authService.currentUser();e&&this.applyUserToForm(e),this.successMessage=t?.message||"Profil mis a jour avec succes.",this.pushMessage("success","Succes",this.successMessage),this.saving=!1},error:t=>{this.errorMessage=this.extractErrorMessage(t),this.pushMessage("error","Erreur",this.errorMessage),this.saving=!1}})}buildUpdatePayload(){let r=this.form.nom.trim(),t=this.form.prenom.trim(),e=this.form.email.trim(),l=this.form.ville.trim(),s=this.form.quartier.trim(),p={};return r.length>0&&(p.nom=r),t.length>0&&(p.prenom=t),p.email=e.length>0?e:null,l.length>0&&(p.ville=l),s.length>0&&(p.quartier=s),p}applyUserToForm(r){this.form={nom:r.nom??"",prenom:r.prenom??"",email:r.email??"",ville:r.ville??"",quartier:r.quartier??""}}extractUserFromPayload(r){if(!r||typeof r!="object")return null;let t=r.user??r;return!t||typeof t!="object"?null:t}extractErrorMessage(r){let t=r?.error?.errors;if(t&&typeof t=="object"){for(let e of Object.values(t))if(Array.isArray(e)){let l=e.find(s=>typeof s=="string");if(typeof l=="string"&&l.trim().length>0)return l}}return typeof r?.error?.message=="string"&&r.error.message.trim().length>0?r.error.message:"Erreur lors de la mise a jour du profile."}pushMessage(r,t,e){this.messageService.add({severity:r,summary:t,detail:e,life:3e3})}static \u0275fac=function(t){return new(t||n)(h(X),h(w))};static \u0275cmp=b({type:n,selectors:[["app-parametres-profile"]],decls:28,vars:14,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"flex","flex-col","gap-2"],["for","profile_nom",1,"text-surface-900","dark:text-surface-0"],["id","profile_nom","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_prenom",1,"text-surface-900","dark:text-surface-0"],["id","profile_prenom","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],[1,"flex","flex-col","gap-2","md:col-span-2"],["for","profile_email",1,"text-surface-900","dark:text-surface-0"],["id","profile_email","type","email","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_ville",1,"text-surface-900","dark:text-surface-0"],["id","profile_ville","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_quartier",1,"text-surface-900","dark:text-surface-0"],["id","profile_quartier","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),d(2,"Parametres Profile"),a(),y(3,et,2,1,"div",2)(4,tt,2,1,"div",3),i(5,"div",4)(6,"div",5)(7,"label",6),d(8,"Nom"),a(),i(9,"input",7),_("ngModelChange",function(s){return v(e.form.nom,s)||(e.form.nom=s),s}),a()(),i(10,"div",5)(11,"label",8),d(12,"Prenom"),a(),i(13,"input",9),_("ngModelChange",function(s){return v(e.form.prenom,s)||(e.form.prenom=s),s}),a()(),i(14,"div",10)(15,"label",11),d(16,"Email"),a(),i(17,"input",12),_("ngModelChange",function(s){return v(e.form.email,s)||(e.form.email=s),s}),a()(),i(18,"div",5)(19,"label",13),d(20,"Ville"),a(),i(21,"input",14),_("ngModelChange",function(s){return v(e.form.ville,s)||(e.form.ville=s),s}),a()(),i(22,"div",5)(23,"label",15),d(24,"Quartier"),a(),i(25,"input",16),_("ngModelChange",function(s){return v(e.form.quartier,s)||(e.form.quartier=s),s}),a()()(),i(26,"div")(27,"p-button",17),f("onClick",function(){return e.saveProfile()}),a()()()),t&2&&(o(3),m("ngIf",e.errorMessage),o(),m("ngIf",e.successMessage),o(5),g("ngModel",e.form.nom),m("disabled",e.loading||e.saving),o(4),g("ngModel",e.form.prenom),m("disabled",e.loading||e.saving),o(4),g("ngModel",e.form.email),m("disabled",e.loading||e.saving),o(4),g("ngModel",e.form.ville),m("disabled",e.loading||e.saving),o(4),g("ngModel",e.form.quartier),m("disabled",e.loading||e.saving),o(2),m("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[S,k,T,V,I,R,E,C,B,j],encapsulation:2})};function rt(n,r){if(n&1&&(i(0,"small",13),d(1),a()),n&2){let t=u();o(),M(t.fieldErrors.current_password)}}function it(n,r){if(n&1&&(i(0,"small",13),d(1),a()),n&2){let t=u();o(),M(t.fieldErrors.new_password)}}function at(n,r){if(n&1&&(i(0,"small",13),d(1),a()),n&2){let t=u();o(),M(t.fieldErrors.new_password_confirmation)}}var oe=class n{constructor(r,t){this.authService=r;this.messageService=t}saving=!1;fieldErrors={};form={current_password:"",new_password:"",new_password_confirmation:""};changePassword(){if(this.fieldErrors={},!this.form.current_password){this.fieldErrors.current_password="Le mot de passe actuel est obligatoire";return}if(!this.form.new_password){this.fieldErrors.new_password="Le nouveau mot de passe est obligatoire";return}if(this.form.new_password.length<8){this.fieldErrors.new_password="Le mot de passe doit contenir au moins 8 caract\xE8res";return}if(this.form.new_password!==this.form.new_password_confirmation){this.fieldErrors.new_password_confirmation="Les mots de passe ne correspondent pas";return}let r={current_password:this.form.current_password,new_password:this.form.new_password,new_password_confirmation:this.form.new_password_confirmation};this.saving=!0,this.authService.changePassword(r).subscribe({next:t=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t?.message||"Mot de passe modifi\xE9 avec succ\xE8s",life:3e3}),this.form={current_password:"",new_password:"",new_password_confirmation:""},this.saving=!1},error:t=>{let e=t?.error?.errors;if(e&&typeof e=="object")for(let[l,s]of Object.entries(e))Array.isArray(s)&&s.length>0&&(this.fieldErrors[l]=s[0]);this.messageService.add({severity:"error",summary:"Erreur",detail:this.extractErrorMessage(t),life:5e3}),this.saving=!1}})}extractErrorMessage(r){let t=r?.error?.errors;if(t&&typeof t=="object"){for(let e of Object.values(t))if(Array.isArray(e)){let l=e.find(s=>typeof s=="string");if(typeof l=="string"&&l.trim().length>0)return l}}return typeof r?.error?.message=="string"&&r.error.message.trim().length>0?r.error.message:"Erreur lors du changement de mot de passe"}static \u0275fac=function(t){return new(t||n)(h(X),h(w))};static \u0275cmp=b({type:n,selectors:[["app-parametres-auth"]],decls:23,vars:17,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],[1,"grid","grid-cols-1","gap-6",2,"max-width","500px"],[1,"flex","flex-col","gap-2"],["for","current_password",1,"text-surface-900","dark:text-surface-0"],["id","current_password","styleClass","w-full","inputStyleClass","w-full",3,"ngModelChange","ngModel","toggleMask","feedback","disabled"],["class","text-red-500",4,"ngIf"],["for","new_password",1,"text-surface-900","dark:text-surface-0"],["id","new_password","styleClass","w-full","inputStyleClass","w-full","promptLabel","Entrez un mot de passe","weakLabel","Faible","mediumLabel","Moyen","strongLabel","Fort",3,"ngModelChange","ngModel","toggleMask","feedback","disabled"],[1,"text-surface-500"],["for","new_password_confirmation",1,"text-surface-900","dark:text-surface-0"],["id","new_password_confirmation","styleClass","w-full","inputStyleClass","w-full",3,"ngModelChange","ngModel","toggleMask","feedback","disabled"],["label","Modifier le mot de passe","icon","pi pi-key",3,"onClick","loading","disabled"],[1,"text-red-500"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),d(2,"Changer le mot de passe"),a(),i(3,"div",2)(4,"div",3)(5,"label",4),d(6,"Mot de passe actuel"),a(),i(7,"p-password",5),_("ngModelChange",function(s){return v(e.form.current_password,s)||(e.form.current_password=s),s}),a(),y(8,rt,2,1,"small",6),a(),i(9,"div",3)(10,"label",7),d(11,"Nouveau mot de passe"),a(),i(12,"p-password",8),_("ngModelChange",function(s){return v(e.form.new_password,s)||(e.form.new_password=s),s}),a(),i(13,"small",9),d(14,"Min. 8 caract\xE8res, majuscule, minuscule et chiffre"),a(),y(15,it,2,1,"small",6),a(),i(16,"div",3)(17,"label",10),d(18,"Confirmer le nouveau mot de passe"),a(),i(19,"p-password",11),_("ngModelChange",function(s){return v(e.form.new_password_confirmation,s)||(e.form.new_password_confirmation=s),s}),a(),y(20,at,2,1,"small",6),a()(),i(21,"div")(22,"p-button",12),f("onClick",function(){return e.changePassword()}),a()()()),t&2&&(o(7),g("ngModel",e.form.current_password),m("toggleMask",!0)("feedback",!1)("disabled",e.saving),o(),m("ngIf",e.fieldErrors.current_password),o(4),g("ngModel",e.form.new_password),m("toggleMask",!0)("feedback",!0)("disabled",e.saving),o(3),m("ngIf",e.fieldErrors.new_password),o(4),g("ngModel",e.form.new_password_confirmation),m("toggleMask",!0)("feedback",!1)("disabled",e.saving),o(),m("ngIf",e.fieldErrors.new_password_confirmation),o(2),m("loading",e.saving)("disabled",e.saving))},dependencies:[S,k,T,I,R,E,C,ze,Oe],encapsulation:2})};var st=["dt"],ot=()=>({borderRadius:"2rem"}),nt=()=>["role.name"],lt=()=>[5,10],Je=()=>({width:"450px"});function mt(n,r){n&1&&(i(0,"tr")(1,"th",17)(2,"span",18),d(3,"Nom "),c(4,"p-sortIcon",19),a()(),i(5,"th",20)(6,"span",18),d(7,"Date de cr\xE9ation "),c(8,"p-sortIcon",21),a()(),i(9,"th",22)(10,"span",23),d(11,"Permissions"),a()(),c(12,"th",24),a())}function dt(n,r){if(n&1){let t=W();i(0,"tr")(1,"td",25)(2,"div",26)(3,"span",27),c(4,"i",28),a(),i(5,"span",29),d(6),a()()(),i(7,"td",30),d(8),a(),i(9,"td",31),c(10,"p-tag",32),a(),i(11,"td")(12,"div",33)(13,"p-button",34),f("click",function(l){let s=x(t).$implicit;return u().deleteRole(s),P(l.stopPropagation())}),a(),i(14,"p-button",35),f("click",function(){let l=x(t).$implicit,s=u();return P(s.editRole(l))}),a()()()()}if(n&2){let t=r.$implicit,e=u();o(3),ve("background","var(--p-primary-50)")("color","var(--p-primary-600)"),o(3),M(t.role.name),o(2),U(" ",e.formatDate(t.role.created_at)," "),o(2),m("value",e.countPermissions(t)+" permissions"),o(3),m("text",!0)("rounded",!0),o(),m("text",!0)("rounded",!0)}}function pt(n,r){n&1&&(i(0,"tr")(1,"td",36)(2,"div",37),c(3,"i",38),i(4,"span",39),d(5,"Aucun r\xF4le trouv\xE9"),a()()()())}function ct(n,r){if(n&1){let t=W();i(0,"p-button",40),f("click",function(){x(t);let l=u();return P(l.createDialog=!1)}),a(),i(1,"p-button",41),f("click",function(){x(t);let l=u();return P(l.createRole())}),a()}if(n&2){let t=u();m("text",!0)("disabled",t.creating),o(),m("disabled",t.creating||!t.newRoleName.trim())("loading",t.creating)}}var ne=class n{constructor(r,t,e,l){this.roleService=r;this.messageService=t;this.confirmationService=e;this.router=l}roles=de([]);loading=!1;createDialog=!1;newRoleName="";creating=!1;dt;ngOnInit(){this.loadRoles()}loadRoles(){this.loading=!0,this.roleService.getRoles().subscribe({next:r=>{let t=r?.data,e=Array.isArray(t)?t:Array.isArray(t?.roles)?t.roles:Array.isArray(t?.data)?t.data:[];this.roles.set(e.map(l=>this.normalizeRoleItem(l))),this.loading=!1},error:r=>{this.messageService.add({severity:"error",summary:"Erreur",detail:r?.error?.message||"Impossible de charger les r\xF4les",life:5e3}),this.loading=!1}})}countPermissions(r){return r.modules.reduce((t,e)=>t+Ge.filter(l=>e.permissions[l]).length,0)}onFilterGlobal(r){let t=r.target;t&&this.dt.filterGlobal(t.value,"contains")}openCreateDialog(){this.newRoleName="",this.createDialog=!0}createRole(){!this.newRoleName.trim()||this.creating||(this.creating=!0,this.roleService.createRole({name:this.newRoleName.trim()}).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"R\xF4le cr\xE9\xE9 avec succ\xE8s",life:3e3}),this.createDialog=!1,this.creating=!1,this.loadRoles()},error:r=>{this.messageService.add({severity:"error",summary:"Erreur",detail:r?.error?.message||"Impossible de cr\xE9er le r\xF4le",life:5e3}),this.creating=!1}}))}editRole(r){this.router.navigate(["/roles/edit",r.role.id])}deleteRole(r){if(r.role.name==="admin"){this.messageService.add({severity:"warn",summary:"Attention",detail:"Le r\xF4le admin ne peut pas \xEAtre supprim\xE9",life:3e3});return}this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir supprimer le r\xF4le "${r.role.name}" ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.roleService.deleteRole(r.role.id).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"R\xF4le supprim\xE9",life:3e3}),this.loadRoles()},error:t=>{this.messageService.add({severity:"error",summary:"Erreur",detail:t?.error?.message||"Impossible de supprimer le r\xF4le",life:5e3})}})}})}formatDate(r){return r?new Date(r).toLocaleDateString("fr-FR"):""}normalizeRoleItem(r){if(r?.role&&Array.isArray(r?.modules))return r;let t={id:Number(r?.id??0),name:String(r?.name??""),created_at:String(r?.created_at??"")},e=Array.isArray(r?.permissions)?r.permissions.map(p=>typeof p=="string"?p:p?.name).filter(p=>typeof p=="string"&&p.includes(".")):[],l=new Map;e.forEach(p=>{let[A,me]=p.split(".");!A||!me||(l.has(A)||l.set(A,new Set),l.get(A)?.add(me))});let s=Array.from(l.entries()).map(([p,A])=>({module:p,permissions:{create:A.has("create"),read:A.has("read"),update:A.has("update"),delete:A.has("delete")}}));return{role:t,modules:s}}static \u0275fac=function(t){return new(t||n)(h(Ke),h(w),h(J),h(ye))};static \u0275cmp=b({type:n,selectors:[["app-parametres-roles-permissions"]],viewQuery:function(t,e){if(t&1&&ue(st,5),t&2){let l;fe(l=ge())&&(e.dt=l.first)}},features:[L([J])],decls:26,vars:22,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],["footer",""],[1,"flex","flex-col","gap-6"],[1,"flex","flex-col","md:flex-row","md:items-start","md:justify-between","mb-4"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-semibold","mb-4","md:mb-0"],[1,"inline-flex","items-center","gap-2"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher...",1,"w-full",3,"input"],["icon","pi pi-plus","rounded","","pTooltip","Ajouter un r\xF4le",3,"click"],["responsiveLayout","scroll","dataKey","role.id",3,"value","paginator","rows","globalFilterFields","rowHover","loading","showCurrentPageReport","rowsPerPageOptions"],["header","Nouveau r\xF4le",3,"visibleChange","visible","modal"],[1,"flex","flex-col","gap-4","pt-2"],["for","roleName",1,"block","font-bold","mb-2"],["pInputText","","id","roleName","placeholder","Ex: editeur, manager...",1,"w-full",3,"ngModelChange","keydown.enter","ngModel"],["pSortableColumn","role.name"],[1,"flex","items-center","gap-2"],["field","role.name"],["pSortableColumn","role.created_at"],["field","role.created_at"],[1,"text-center"],[1,"flex","items-center","justify-center","gap-2"],[2,"width","8rem"],[2,"min-width","10rem"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","justify-center","w-9","h-9","rounded-lg","text-sm","flex-shrink-0"],[1,"pi","pi-shield"],[1,"font-semibold","text-surface-800","dark:text-surface-100","capitalize"],[1,"text-surface-500",2,"min-width","8rem"],[1,"text-center",2,"min-width","8rem"],["severity","info",3,"value"],[1,"flex","items-center","justify-end","gap-1"],["icon","pi pi-trash","severity","danger","pTooltip","Supprimer",3,"click","text","rounded"],["icon","pi pi-pencil","severity","secondary","pTooltip","Modifier",3,"click","text","rounded"],["colspan","4"],[1,"flex","flex-col","items-center","gap-3","py-12","text-surface-300"],[1,"pi","pi-shield","text-4xl"],[1,"text-sm"],["label","Annuler","icon","pi pi-times",3,"click","text","disabled"],["label","Cr\xE9er","icon","pi pi-check",3,"click","disabled","loading"]],template:function(t,e){if(t&1){let l=W();i(0,"div",5)(1,"div",6)(2,"div",7),d(3," R\xF4les & Permissions "),a(),i(4,"div",8)(5,"p-iconfield"),c(6,"p-inputicon",9),i(7,"input",10),f("input",function(p){return x(l),P(e.onFilterGlobal(p))}),a()(),i(8,"p-button",11),f("click",function(){return x(l),P(e.openCreateDialog())}),a()()(),i(9,"p-table",12,0),y(11,mt,13,0,"ng-template",null,1,q)(13,dt,15,11,"ng-template",null,2,q)(15,pt,6,0,"ng-template",null,3,q),a()(),i(17,"p-dialog",13),_("visibleChange",function(p){return x(l),v(e.createDialog,p)||(e.createDialog=p),P(p)}),i(18,"div",14)(19,"div")(20,"label",15),d(21,"Nom du r\xF4le"),a(),i(22,"input",16),_("ngModelChange",function(p){return x(l),v(e.newRoleName,p)||(e.newRoleName=p),P(p)}),f("keydown.enter",function(){return x(l),P(e.createRole())}),a()()(),y(23,ct,2,4,"ng-template",null,4,q),a(),c(25,"p-confirmdialog")}t&2&&(o(7),G(F(17,ot)),o(2),m("value",e.roles())("paginator",!0)("rows",5)("globalFilterFields",F(18,nt))("rowHover",!0)("loading",e.loading)("showCurrentPageReport",!1)("rowsPerPageOptions",F(19,lt)),o(8),G(F(20,Je)),g("visible",e.createDialog),m("modal",!0),o(5),g("ngModel",e.newRoleName),o(3),G(F(21,Je)))},dependencies:[S,T,V,I,R,We,Ae,Ne,De,E,C,B,j,Ve,Fe,Be,je,Se,Me,be,we,qe,Ue,Ce,ke],encapsulation:2})};function ut(n,r){n&1&&(i(0,"div",4),c(1,"i",5),d(2," Chargement des param\xE8tres\u2026 "),a())}function ft(n,r){if(n&1&&(i(0,"span",17),d(1),a()),n&2){let t=u(2);o(),U(" ",t.stockActivesParam==null?null:t.stockActivesParam.description," ")}}function gt(n,r){if(n&1&&(i(0,"span",17),d(1),a()),n&2){let t=u(2);o(),U(" ",t.cooldownParam==null?null:t.cooldownParam.description," ")}}function vt(n,r){if(n&1){let t=W();pe(0),i(1,"div",6)(2,"div",7)(3,"p",8),d(4," Alertes automatiques envoy\xE9es aux admins pour les ruptures de stock sur les produits critiques. "),a()(),i(5,"div",9)(6,"div",10)(7,"span",11),d(8," Activer les notifications de rupture de stock "),a(),y(9,ft,2,1,"span",12),a(),i(10,"p-toggleswitch",13),_("ngModelChange",function(l){x(t);let s=u();return v(s.stockActives,l)||(s.stockActives=l),P(l)}),a()(),i(11,"div",14)(12,"div",10)(13,"span",11),d(14," D\xE9lai entre notifications (minutes) "),a(),y(15,gt,2,1,"span",12),a(),i(16,"p-inputnumber",15),_("ngModelChange",function(l){x(t);let s=u();return v(s.cooldownMins,l)||(s.cooldownMins=l),P(l)}),a()()(),i(17,"div")(18,"p-button",16),f("onClick",function(){x(t);let l=u();return P(l.save())}),a()(),ce()}if(n&2){let t=u();o(9),m("ngIf",t.stockActivesParam==null?null:t.stockActivesParam.description),o(),g("ngModel",t.stockActives),m("disabled",t.saving),o(),_e("opacity-50",!t.stockActives),o(4),m("ngIf",t.cooldownParam==null?null:t.cooldownParam.description),o(),g("ngModel",t.cooldownMins),m("min",0)("step",5)("showButtons",!0)("disabled",t.saving||!t.stockActives),o(2),m("loading",t.saving)("disabled",t.saving)}}var le=class n{constructor(r,t){this.parametresService=r;this.messageService=t}loading=!1;saving=!1;stockActives=!1;cooldownMins=60;stockActivesParam;cooldownParam;ngOnInit(){this.load()}load(){this.loading=!0,this.parametresService.getParametres("general").subscribe({next:r=>{let t=r.data.parametres??[];this.stockActivesParam=t.find(e=>e.cle==="notifications_stock_actives"),this.cooldownParam=t.find(e=>e.cle==="notifications_stock_cooldown_minutes"),this.stockActives=!!this.stockActivesParam?.valeur,this.cooldownMins=Number(this.cooldownParam?.valeur??60)||60,this.loading=!1},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les param\xE8tres de notification.",life:4e3}),this.loading=!1}})}save(){if(!this.stockActivesParam||!this.cooldownParam){this.messageService.add({severity:"error",summary:"Erreur",detail:"Param\xE8tres introuvables. Rechargez la page.",life:4e3});return}if(this.cooldownMins<0){this.messageService.add({severity:"warn",summary:"Validation",detail:"Le d\xE9lai entre notifications ne peut pas \xEAtre n\xE9gatif.",life:4e3});return}this.saving=!0,Q([this.parametresService.updateParametre(this.stockActivesParam.id,{valeur:this.stockActives}).pipe(D(()=>N(null))),this.parametresService.updateParametre(this.cooldownParam.id,{valeur:Math.floor(this.cooldownMins)}).pipe(D(()=>N(null)))]).subscribe({next:r=>{r.some(e=>e===null)?this.messageService.add({severity:"error",summary:"Erreur",detail:"Une ou plusieurs mises \xE0 jour ont \xE9chou\xE9.",life:4e3}):this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Param\xE8tres de notification enregistr\xE9s.",life:3e3}),this.saving=!1},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la sauvegarde.",life:4e3}),this.saving=!1}})}static \u0275fac=function(t){return new(t||n)(h(Z),h(w))};static \u0275cmp=b({type:n,selectors:[["app-parametres-notifications"]],decls:5,vars:2,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-surface-400 text-sm flex items-center gap-2",4,"ngIf"],[4,"ngIf"],[1,"text-surface-400","text-sm","flex","items-center","gap-2"],[1,"pi","pi-spin","pi-spinner"],[1,"border","border-surface-200","dark:border-surface-700","rounded-xl","overflow-hidden"],[1,"bg-surface-50","dark:bg-surface-800","px-6","py-4","border-b","border-surface-200","dark:border-surface-700"],[1,"m-0","text-sm","text-surface-500","dark:text-surface-300"],[1,"flex","items-start","justify-between","gap-6","px-6","py-5","border-b","border-surface-200","dark:border-surface-700"],[1,"flex","flex-col","gap-1"],[1,"text-surface-900","dark:text-surface-0","font-medium"],["class","text-sm text-surface-500 dark:text-surface-400",4,"ngIf"],[3,"ngModelChange","ngModel","disabled"],[1,"flex","items-start","justify-between","gap-6","px-6","py-5"],["buttonLayout","horizontal","decrementButtonIcon","pi pi-minus","incrementButtonIcon","pi pi-plus","inputStyleClass","w-20 text-center",3,"ngModelChange","ngModel","min","step","showButtons","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-sm","text-surface-500","dark:text-surface-400"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),d(2," Notifications de stock "),a(),y(3,ut,3,0,"div",2)(4,vt,19,13,"ng-container",3),a()),t&2&&(o(3),m("ngIf",e.loading),o(),m("ngIf",!e.loading))},dependencies:[S,k,T,I,R,E,C,Te,Re,Ie,Ee],styles:[".opacity-50[_ngcontent-%COMP%]{transition:opacity .2s ease;pointer-events:none}"]})};function _t(n,r){n&1&&c(0,"app-parametres-profile")}function ht(n,r){n&1&&c(0,"app-parametres-auth")}function yt(n,r){n&1&&c(0,"app-parametres-packing")}function xt(n,r){n&1&&c(0,"app-parametres-roles-permissions")}function Pt(n,r){n&1&&c(0,"app-parametres-notifications")}var K=class n{activeSection="profile";setActiveSection(r){this.activeSection=r}onSectionClick(r,t){r.preventDefault(),r.stopPropagation(),this.setActiveSection(t)}isActive(r){return this.activeSection===r}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=b({type:n,selectors:[["app-parametres-liste"]],features:[L([w])],decls:42,vars:15,consts:[[1,"rounded-t-3xl","bg-surface-0","dark:bg-surface-900","flex-auto","py-6","lg:py-8","px-8","lg:px-20"],[1,"flex","flex-col","w-full","pb-8","gap-2"],[1,"mt-0","text-surface-900","dark:text-surface-0","font-medium","text-2xl","leading-tight"],[1,"mt-0","text-surface-500","dark:text-surface-300","leading-tight"],[1,"grid","grid-cols-12","gap-4","py-6","lg:py-8"],[1,"col-span-12","lg:col-span-2"],[1,"list-none","m-0","p-0","hidden","lg:flex","flex-col","justify-start"],[1,"-ml-[2px]",3,"ngClass"],["href","#",1,"w-full","text-left","flex","items-center","py-3","px-4","font-medium","transition-colors","hover:text-primary",3,"click","ngClass"],[1,"pi","pi-user","mr-2","text-base!","leading-normal!"],[1,"pi","pi-lock","mr-2","text-base!","leading-normal!"],[1,"pi","pi-cog","mr-2","text-base!","leading-normal!"],[1,"pi","pi-shield","mr-2","text-base!","leading-normal!"],[1,"pi","pi-bell","mr-2","text-base!","leading-normal!"],[1,"col-span-12","lg:col-span-10","xl:col-span-10","bg-surface-0","dark:bg-surface-900","p-8","rounded-2xl","flex-auto"],[4,"ngIf"]],template:function(t,e){t&1&&(c(0,"p-toast"),i(1,"div",0)(2,"div",1)(3,"h2",2),d(4,"Parametres"),a(),i(5,"p",3),d(6,"Gestion des parametres de l'application"),a()(),c(7,"p-divider"),i(8,"div",4)(9,"div",5)(10,"ul",6)(11,"li",7)(12,"a",8),f("click",function(s){return e.onSectionClick(s,"profile")}),c(13,"i",9),i(14,"span"),d(15,"Profile"),a()()(),i(16,"li",7)(17,"a",8),f("click",function(s){return e.onSectionClick(s,"auth")}),c(18,"i",10),i(19,"span"),d(20,"Authentification"),a()()(),i(21,"li",7)(22,"a",8),f("click",function(s){return e.onSectionClick(s,"packing")}),c(23,"i",11),i(24,"span"),d(25,"Packing"),a()()(),i(26,"li",7)(27,"a",8),f("click",function(s){return e.onSectionClick(s,"roles")}),c(28,"i",12),i(29,"span"),d(30,"R\xF4les & Permissions"),a()()(),i(31,"li",7)(32,"a",8),f("click",function(s){return e.onSectionClick(s,"notifications")}),c(33,"i",13),i(34,"span"),d(35,"Notifications"),a()()()()(),i(36,"div",14),y(37,_t,1,0,"app-parametres-profile",15)(38,ht,1,0,"app-parametres-auth",15)(39,yt,1,0,"app-parametres-packing",15)(40,xt,1,0,"app-parametres-roles-permissions",15)(41,Pt,1,0,"app-parametres-notifications",15),a()()()),t&2&&(o(11),m("ngClass",e.isActive("profile")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),m("ngClass",e.isActive("profile")?"text-primary":"text-surface-700 dark:text-surface-200"),o(4),m("ngClass",e.isActive("auth")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),m("ngClass",e.isActive("auth")?"text-primary":"text-surface-700 dark:text-surface-200"),o(4),m("ngClass",e.isActive("packing")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),m("ngClass",e.isActive("packing")?"text-primary":"text-surface-700 dark:text-surface-200"),o(4),m("ngClass",e.isActive("roles")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),m("ngClass",e.isActive("roles")?"text-primary":"text-surface-700 dark:text-surface-200"),o(4),m("ngClass",e.isActive("notifications")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),m("ngClass",e.isActive("notifications")?"text-primary":"text-surface-700 dark:text-surface-200"),o(5),m("ngIf",e.isActive("profile")),o(),m("ngIf",e.isActive("auth")),o(),m("ngIf",e.isActive("packing")),o(),m("ngIf",e.isActive("roles")),o(),m("ngIf",e.isActive("notifications")))},dependencies:[S,he,k,oe,$,Qe,Y,Le,H,ee,se,ne,le],encapsulation:2})};var zr=[{path:"",component:K,data:{breadcrumb:"Param\xE8tres"}},{path:"parametres",component:K,data:{breadcrumb:"Param\xE8tres"}}];export{zr as default};
