import{b as nt}from"./chunk-A5VEUBRW.js";import"./chunk-DPE5ICRY.js";import{a as ot}from"./chunk-TAU45F3L.js";import{a as at,b as rt}from"./chunk-S5TDSCG5.js";import{a as je}from"./chunk-SUWPPEDH.js";import{a as qe,b as Ye}from"./chunk-IMZITBI5.js";import{a as J}from"./chunk-3J34NKPR.js";import{b as tt}from"./chunk-6MAGWI7U.js";import{a as it}from"./chunk-2L636W5W.js";import{a as $e,b as et}from"./chunk-LOBJQVB7.js";import{a as Je,b as Xe}from"./chunk-3HDW43E7.js";import{a as ze,d as He,e as Qe,k as Ke}from"./chunk-KYBPPGZP.js";import"./chunk-KKEZTC3T.js";import{a as Q,b as Ue}from"./chunk-QAU7W4US.js";import"./chunk-GO7AEQHW.js";import"./chunk-44MNQRCX.js";import{b as K,c as Ge}from"./chunk-FHJ3HI6Y.js";import"./chunk-MGFZT6L3.js";import{b as Ze}from"./chunk-2M2YESUI.js";import"./chunk-Q737E3VB.js";import"./chunk-GVSJPEUD.js";import"./chunk-CQGFVLY5.js";import"./chunk-ZOHIMUT6.js";import"./chunk-TB7JIXSI.js";import{a as q,b as Y}from"./chunk-D4ZZGRXJ.js";import"./chunk-USWDVUUM.js";import"./chunk-KHGHC55C.js";import{a as O}from"./chunk-UQ2UE4DV.js";import{a as Ne,b as Be}from"./chunk-HYG7NLCW.js";import"./chunk-MYGUYXAJ.js";import"./chunk-UWJ6EXCC.js";import"./chunk-NIW5LLYW.js";import{d as Se}from"./chunk-BKUS5BNA.js";import"./chunk-TZVXXQOJ.js";import{a as I,d as ye}from"./chunk-PPJOJKS5.js";import{d as De,e as Te}from"./chunk-P557RNKH.js";import"./chunk-PALTTDOF.js";import{c as H,d as We}from"./chunk-WF73AWMM.js";import"./chunk-SXW2RLBH.js";import"./chunk-LSUA6MZX.js";import"./chunk-M2LTT3HJ.js";import"./chunk-JYP5AZVX.js";import"./chunk-T7HI4VPR.js";import{a as Re,b as Fe,c as Le,d as Oe}from"./chunk-II7RVJNR.js";import{a as we,b as Ee}from"./chunk-PW7MMR7K.js";import{e as U,h as G,p as z}from"./chunk-3LUOICNH.js";import{a as Ve,b as Ae}from"./chunk-3G6KBQ3S.js";import"./chunk-D7FY7VLK.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as Me,j as Ie}from"./chunk-IK72ORTM.js";import"./chunk-Z2XDSDL7.js";import{la as j,pa as D,ta as Ce}from"./chunk-344GK45C.js";import{i as N,k as B,r as Pe,s as ve,v as W}from"./chunk-6PXXCRY5.js";import"./chunk-4O3FVBGX.js";import{$ as g,$b as S,Ab as m,Bb as ce,Cb as de,Hb as P,Lb as b,Mb as d,Na as s,Qb as me,R as se,Rb as ue,Sa as te,Sb as ge,V as le,Vb as _e,Wb as fe,Xb as be,Ya as v,Yb as ie,_b as l,aa as _,ac as y,bb as C,bc as w,cc as he,dc as h,ec as k,fc as x,hb as u,hc as A,ia as pe,ic as L,lc as ke,sc as E,tc as xe,u as oe,uc as R,wc as M,xb as p,yb as a,zb as r}from"./chunk-E5DLUAUS.js";import{a as ae,b as re}from"./chunk-GAL4ENT6.js";var st={a_valider:"\xC0 valider",valide:"Valid\xE9",annule:"Annul\xE9"},lt={a_valider:"warn",valide:"success",annule:"danger"};var F=class n{constructor(t){this.http=t}apiUrl=`${Ne.apiUrl}/packings`;getPackings(t){let e=new I;return t&&(t.prestataire_id&&(e=e.set("prestataire_id",t.prestataire_id.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.non_payes&&(e=e.set("non_payes",t.non_payes.toString())),t.search&&(e=e.set("search",t.search)),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.page&&(e=e.set("page",t.page.toString()))),this.http.get(this.apiUrl,{params:e})}getPacking(t){return this.http.get(`${this.apiUrl}/${t}`)}createPacking(t){return this.http.post(this.apiUrl,t)}updatePacking(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}changeStatut(t,e){return this.http.patch(`${this.apiUrl}/${t}/statut`,e)}deletePacking(t){return this.http.delete(`${this.apiUrl}/${t}`)}searchPackings(t){let e=new I().set("search",t);return this.http.get(this.apiUrl,{params:e})}getPackingsByPrestataire(t){let e=new I().set("prestataire_id",t.toString());return this.http.get(this.apiUrl,{params:e})}getPackingsByStatut(t){let e=new I().set("statut",t);return this.http.get(this.apiUrl,{params:e})}getPackingsNonPayes(){let t=new I().set("non_payes","true");return this.http.get(this.apiUrl,{params:t})}getPackingsByPeriode(t,e){let i=new I().set("date_debut",t).set("date_fin",e);return this.http.get(this.apiUrl,{params:i})}getPackingsPaginated(t=1,e=10,i){let o=new I().set("page",t.toString()).set("per_page",e.toString());return i&&(i.prestataire_id&&(o=o.set("prestataire_id",i.prestataire_id.toString())),i.statut&&(o=o.set("statut",i.statut)),i.date_debut&&(o=o.set("date_debut",i.date_debut)),i.date_fin&&(o=o.set("date_fin",i.date_fin)),i.non_payes&&(o=o.set("non_payes",i.non_payes.toString())),i.search&&(o=o.set("search",i.search)),i.sort_by&&(o=o.set("sort_by",i.sort_by)),i.sort_order&&(o=o.set("sort_order",i.sort_order))),this.http.get(this.apiUrl,{params:o})}static \u0275fac=function(e){return new(e||n)(le(ye))};static \u0275prov=se({token:n,factory:n.\u0275fac,providedIn:"root"})};var _t=["dt"],ft=()=>({"min-width":"65rem"}),bt=()=>[10,20,30],ht=()=>({width:"750px"}),kt=()=>({width:"450px"}),xt=(n,t,e)=>({"status-badge--warn":n,"status-badge--success":t,"status-badge--danger":e});function Pt(n,t){if(n&1){let e=P();a(0,"p-button",32),b("onClick",function(){g(e);let o=d(2);return _(o.openNew())}),r()}}function vt(n,t){if(n&1&&u(0,Pt,1,0,"p-button",31),n&2){let e=d();p("ngIf",e.canCreate)}}function yt(n,t){if(n&1){let e=P();a(0,"p-button",38),b("onClick",function(){g(e);let o=d(2);return _(o.clearDateFilters())}),r()}n&2&&p("outlined",!0)("rounded",!0)}function St(n,t){if(n&1){let e=P();a(0,"div",33)(1,"p-select",34),x("ngModelChange",function(o){g(e);let c=d();return k(c.filterStatut,o)||(c.filterStatut=o),_(o)}),b("onChange",function(){g(e);let o=d();return _(o.onDateFilter())}),r(),a(2,"p-datepicker",35),x("ngModelChange",function(o){g(e);let c=d();return k(c.filterDateRange,o)||(c.filterDateRange=o),_(o)}),b("onSelect",function(){g(e);let o=d();return _(o.onDateRangeSelect())}),r(),u(3,yt,1,2,"p-button",36),a(4,"p-button",37),b("onClick",function(){g(e);let o=d();return _(o.exportCSV())}),r()()}if(n&2){let e=d();s(),h("ngModel",e.filterStatut),p("options",e.statuses)("showClear",!0),s(),h("ngModel",e.filterDateRange),p("showIcon",!0)("readonlyInput",!0),s(),p("ngIf",e.filterDateRange||e.filterStatut)}}function Ct(n,t){if(n&1){let e=P();a(0,"div",39)(1,"h5",40),l(2,"Gestion des Packings"),r(),a(3,"p-iconfield"),m(4,"p-inputicon",41),a(5,"input",42),b("input",function(o){g(e);let c=d(),f=_e(8);return _(c.onGlobalFilter(f,o))}),r()()()}}function wt(n,t){n&1&&(a(0,"tr")(1,"th",43)(2,"span",44),l(3,"Prestataire "),m(4,"p-sortIcon",45),r()(),a(5,"th")(6,"span",44),l(7,"T\xE9l\xE9phone"),r()(),a(8,"th",46)(9,"span",44),l(10,"Date "),m(11,"p-sortIcon",47),r()(),a(12,"th",48)(13,"span",49),l(14,"Rouleaux "),m(15,"p-sortIcon",50),r()(),a(16,"th",51)(17,"span",49),l(18,"Montant "),m(19,"p-sortIcon",52),r()(),a(20,"th",53)(21,"span",54),l(22,"Statut "),m(23,"p-sortIcon",55),r()(),m(24,"th",56),r())}function Et(n,t){if(n&1&&(a(0,"div",65)(1,"span",66),l(2),r(),a(3,"span",67),l(4),r()()),n&2){let e,i=d().$implicit;s(),fe("background","var(--p-primary-50)")("color","var(--p-primary-600)"),s(),y(" ",i.prestataire.nom==null||(e=i.prestataire.nom.charAt(0))==null?null:e.toUpperCase()," "),s(2),w("",i.prestataire.nom," ",i.prestataire.prenom)}}function Mt(n,t){if(n&1&&(a(0,"span"),l(1),E(2,"phoneFormat"),r()),n&2){let e=d().$implicit;s(),S(R(2,1,e.prestataire.phone,"INT"))}}function It(n,t){if(n&1){let e=P();a(0,"p-button",68),b("click",function(){g(e);let o=d().$implicit,c=d();return _(c.editPacking(o))}),r()}n&2&&p("text",!0)("rounded",!0)}function Dt(n,t){if(n&1){let e=P();a(0,"tr",57),b("dblclick",function(){let o=g(e).$implicit,c=d();return _(c.canUpdate&&c.editPacking(o))}),a(1,"td"),u(2,Et,5,7,"div",58),r(),a(3,"td",59),u(4,Mt,3,4,"span",60),r(),a(5,"td",59),l(6),r(),a(7,"td",61),l(8),r(),a(9,"td",61),l(10),r(),a(11,"td",62)(12,"span",63),l(13),r()(),a(14,"td",62),u(15,It,1,2,"p-button",64),r()()}if(n&2){let e=t.$implicit,i=d();s(2),p("ngIf",e.prestataire),s(2),p("ngIf",e.prestataire),s(2),S(i.formatDateDisplay(e.date)),s(2),S(e.nb_rouleaux),s(2),S(i.formatCurrency(e.montant)),s(2),p("ngClass",ke(8,xt,e.statut==="a_valider",e.statut==="valide",e.statut==="annule")),s(),y(" ",i.getStatutLabel(e.statut)," "),s(2),p("ngIf",i.canUpdate)}}function Tt(n,t){n&1&&(a(0,"tr")(1,"td",69)(2,"div",70),m(3,"i",71),a(4,"span"),l(5,"Aucun packing trouv\xE9"),r()()()())}function Rt(n,t){n&1&&m(0,"p-skeleton",72)}function Ft(n,t){if(n&1&&(a(0,"div",33),m(1,"i",76),a(2,"span"),l(3),r()()),n&2){let e=t.$implicit;s(3),he("",e.prenom," ",e.nom," - ",e.phone)}}function Lt(n,t){if(n&1&&(a(0,"div",33),m(1,"i",76),a(2,"span"),l(3),r()()),n&2){let e=d().$implicit;s(3),w("",e.prenom," ",e.nom)}}function Ot(n,t){if(n&1&&u(0,Lt,4,2,"div",77),n&2){let e=t.$implicit;p("ngIf",e)}}function Vt(n,t){if(n&1){let e=P();a(0,"p-select",73),x("ngModelChange",function(o){g(e);let c=d();return k(c.selectedPrestataire,o)||(c.selectedPrestataire=o),_(o)}),u(1,Ft,4,3,"ng-template",74)(2,Ot,1,1,"ng-template",75),r()}if(n&2){let e=d();h("ngModel",e.selectedPrestataire),p("options",e.prestataires)("filter",!0)}}function At(n,t){n&1&&(a(0,"small",78),l(1,"Le prestataire est requis."),r())}function Nt(n,t){n&1&&m(0,"p-skeleton",72)}function Bt(n,t){if(n&1){let e=P();a(0,"p-inputnumber",79),x("ngModelChange",function(o){g(e);let c=d();return k(c.packing.prix_par_rouleau,o)||(c.packing.prix_par_rouleau=o),_(o)}),b("onInput",function(){g(e);let o=d();return _(o.calculateMontant())}),r()}if(n&2){let e=d();h("ngModel",e.packing.prix_par_rouleau),p("min",0)}}function Wt(n,t){if(n&1){let e=P();a(0,"p-button",80),b("click",function(){g(e);let o=d();return _(o.hideDialog())}),r(),a(1,"p-button",81),b("click",function(){g(e);let o=d();return _(o.savePacking())}),r()}if(n&2){let e=d();p("disabled",e.saving),s(),p("disabled",e.saving||e.dialogLoading)("loading",e.saving)}}var V=class n{constructor(t,e,i,o,c,f){this.packingService=t;this.prestataireService=e;this.parametresService=i;this.messageService=o;this.confirmationService=c;this.authService=f;this.canCreate=this.authService.hasPermission("packings.create"),this.canUpdate=this.authService.hasPermission("packings.update"),this.canDelete=this.authService.hasPermission("packings.delete")}filterFields=["reference","prestataire.nom","prestataire.prenom","prestataire.phone","statut","montant"];packingDialog=!1;packings=pe([]);packing={};selectedPackings=null;submitted=!1;loading=!1;saving=!1;dialogLoading=!1;filterDateRange=null;filterStatut=null;prixRouleauDefaut=0;prestataires=[];filteredPrestataires=[];selectedPrestataire=null;statuses=[{label:"\xC0 valider",value:"a_valider"},{label:"Valid\xE9",value:"valide"},{label:"Annul\xE9",value:"annule"}];canCreate=!1;canUpdate=!1;canDelete=!1;dt;exportColumns;cols;ngOnInit(){this.loadPackings(),this.loadPrestataires(),this.loadPrixRouleauDefaut(),this.initColumns()}initColumns(){this.cols=[{field:"reference",header:"R\xE9f\xE9rence"},{field:"prestataire",header:"Prestataire"},{field:"date",header:"Date"},{field:"nb_rouleaux",header:"Rouleaux"},{field:"montant",header:"Montant"},{field:"statut",header:"Statut"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}onDateRangeSelect(){this.filterDateRange&&this.filterDateRange[1]&&this.loadPackings()}onDateFilter(){this.loadPackings()}clearDateFilters(){this.filterDateRange=null,this.filterStatut=null,this.loadPackings()}loadPackings(){this.loading=!0;let t={};this.filterDateRange?.[0]&&(t.date_debut=this.formatDate(this.filterDateRange[0])),this.filterDateRange?.[1]&&(t.date_fin=this.formatDate(this.filterDateRange[1])),this.filterStatut&&(t.statut=this.filterStatut),this.packingService.getPackings(Object.keys(t).length?t:void 0).subscribe({next:e=>{let i="data"in e&&Array.isArray(e.data)?e.data:e.data?.data||[];this.packings.set(i),this.loading=!1,console.log(e)},error:e=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les packings",life:3e3}),this.loading=!1}})}loadPrixRouleauDefaut(){this.parametresService.getPrixRouleauDefaut().subscribe({next:t=>{this.prixRouleauDefaut=t},error:()=>{this.prixRouleauDefaut=0}})}loadPrestataires(){this.prestataireService.getActivePrestataires().subscribe({next:t=>{this.prestataires=t.data.filter(e=>e.type==="machiniste")},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires",life:3e3})}})}filterPrestataire(t){let e=t.query.toLowerCase();this.filteredPrestataires=this.prestataires.filter(i=>i.nom.toLowerCase().includes(e)||i.prenom.toLowerCase().includes(e)||i.phone.includes(e))}exportCSV(){this.dt.exportCSV()}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}openNew(){this.selectedPrestataire=null,this.submitted=!1,this.packingDialog=!0,this.dialogLoading=!0,oe({prixRouleauDefaut:this.parametresService.getPrixRouleauDefaut(),prestataires:this.prestataireService.getActivePrestataires()}).subscribe({next:({prixRouleauDefaut:t,prestataires:e})=>{this.prixRouleauDefaut=t,this.prestataires=e.data.filter(i=>i.type==="machiniste"),this.packing={statut:"valide",date:new Date,nb_rouleaux:0,prix_par_rouleau:this.prixRouleauDefaut,montant:0},this.dialogLoading=!1},error:()=>{this.packing={statut:"valide",date:new Date,nb_rouleaux:0,prix_par_rouleau:this.prixRouleauDefaut,montant:0},this.dialogLoading=!1}})}editPacking(t){this.packing=re(ae({},t),{date:t.date?new Date(t.date):void 0}),this.selectedPrestataire=t.prestataire||null,this.packingDialog=!0}deletePacking(t){this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir supprimer le packing ${t.reference} ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.packingService.deletePacking(t.id).subscribe({next:()=>{this.packings.set(this.packings().filter(e=>e.id!==t.id)),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing supprim\xE9",life:3e3})},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer le packing",life:3e3})}})}})}deleteSelectedPackings(){this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer les packings s\xE9lectionn\xE9s ?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.selectedPackings?.forEach(t=>{this.packingService.deletePacking(t.id).subscribe()}),this.packings.set(this.packings().filter(t=>!this.selectedPackings?.includes(t))),this.selectedPackings=null,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packings supprim\xE9s",life:3e3})}})}hideDialog(){this.packingDialog=!1,this.submitted=!1}savePacking(){if(this.submitted=!0,!this.selectedPrestataire||this.saving)return;this.saving=!0;let t={prestataire_id:this.selectedPrestataire.id,date:this.formatDate(this.packing.date),nb_rouleaux:this.packing.nb_rouleaux||0,prix_par_rouleau:this.packing.prix_par_rouleau||0,statut:this.packing.statut,notes:this.packing.notes??void 0};this.packing.id?this.packingService.updatePacking(this.packing.id,t).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing mis \xE0 jour",life:3e3}),this.packingDialog=!1,this.packing={},this.saving=!1,this.loadPackings()},error:e=>{this.showApiError(e,"Impossible de mettre \xE0 jour le packing"),this.saving=!1}}):this.packingService.createPacking(t).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing cr\xE9\xE9",life:3e3}),this.packingDialog=!1,this.packing={},this.saving=!1,this.loadPackings()},error:e=>{this.showApiError(e,"Impossible de cr\xE9er le packing"),this.saving=!1}})}calculateMontant(){this.packing.nb_rouleaux&&this.packing.prix_par_rouleau&&(this.packing.montant=this.packing.nb_rouleaux*this.packing.prix_par_rouleau)}formatDate(t){return t?typeof t=="string"?t:new Date(t).toISOString().split("T")[0]:""}getStatutLabel(t){return st[t]||t}getStatutSeverity(t){return lt[t]||"info"}formatCurrency(t){return new Intl.NumberFormat("fr-FR",{style:"decimal",minimumFractionDigits:0}).format(t)+" GNF"}formatDateDisplay(t){return t?new Date(t).toLocaleDateString("fr-FR"):""}showApiError(t,e){let i=t.error?.message||e;t.status===422&&t.error?.errors?Object.values(t.error.errors).flat().forEach(c=>{this.messageService.add({severity:"error",summary:i,detail:c,life:5e3})}):this.messageService.add({severity:"error",summary:i,detail:"",life:5e3})}static \u0275fac=function(e){return new(e||n)(v(F),v(J),v(ot),v(D),v(j),v(Be))};static \u0275cmp=C({type:n,selectors:[["app-packing-liste"]],viewQuery:function(e,i){if(e&1&&me(_t,5),e&2){let o;ue(o=ge())&&(i.dt=o.first)}},features:[A([D,j])],decls:51,vars:34,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["footer",""],[1,"card"],["styleClass","mb-12"],["dataKey","id","currentPageReportTemplate","  {first} \xE0 {last} sur {totalRecords} packings",3,"selectionChange","value","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions","loading"],[3,"visibleChange","visible","header","modal"],[1,"flex","flex-col","gap-6"],["for","prestataire",1,"block","font-bold","mb-4"],["height","2.6rem","styleClass","w-full",4,"ngIf"],["optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full",3,"ngModel","options","filter","ngModelChange",4,"ngIf"],["class","text-red-500",4,"ngIf"],["for","date",1,"block","font-bold","mb-4"],["dateFormat","dd/mm/yy","inputStyleClass","w-full","styleClass","w-full",3,"ngModelChange","ngModel","showIcon"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-6"],["for","nb_rouleaux",1,"block","font-bold","mb-4"],["id","nb_rouleaux","styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],["for","prix_par_rouleau",1,"block","font-bold","mb-4"],["id","prix_par_rouleau","styleClass","w-full",3,"ngModel","min","ngModelChange","onInput",4,"ngIf"],["for","statut",1,"block","font-bold","mb-4"],["optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","styleClass","w-full",3,"ngModelChange","ngModel","options"],[1,"flex","justify-between","items-center","p-4","mt-4","bg-surface-100","rounded-lg"],[1,"font-bold","text-lg"],[1,"text-2xl","font-semibold","text-primary"],[1,"mt-4"],["label","Ajouter packing","icon","pi pi-plus","severity","secondary","class","mr-2",3,"onClick",4,"ngIf"],["label","Ajouter packing","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick"],[1,"flex","items-center","gap-2"],["optionLabel","label","optionValue","value","placeholder","Statut","styleClass","w-40",3,"ngModelChange","onChange","ngModel","options","showClear"],["selectionMode","range","dateFormat","dd/mm/yy","placeholder","P\xE9riode","inputStyleClass","w-full","styleClass","w-56",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput"],["icon","pi pi-filter-slash","severity","secondary","pTooltip","Effacer les filtres",3,"outlined","rounded","onClick",4,"ngIf"],["label","Export","icon","pi pi-download","severity","secondary",3,"onClick"],["icon","pi pi-filter-slash","severity","secondary","pTooltip","Effacer les filtres",3,"onClick","outlined","rounded"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Rechercher...",3,"input"],["pSortableColumn","prestataire.nom"],[1,"col-header"],["field","prestataire.nom"],["pSortableColumn","date"],["field","date"],["pSortableColumn","nb_rouleaux",1,"text-right"],[1,"col-header","justify-end"],["field","nb_rouleaux"],["pSortableColumn","montant",1,"text-right"],["field","montant"],["pSortableColumn","statut",1,"text-center"],[1,"col-header","justify-center"],["field","statut"],[1,"text-center",2,"width","5rem"],[1,"table-row",3,"dblclick"],["class","cell-prestataire",4,"ngIf"],[1,"cell-secondary","cell-bold"],[4,"ngIf"],[1,"text-right","cell-mono","cell-bold"],[1,"text-center"],[1,"status-badge",3,"ngClass"],["icon","pi pi-arrow-right","severity","secondary","pTooltip","Modifier",3,"text","rounded","click",4,"ngIf"],[1,"cell-prestataire"],[1,"cell-prestataire__avatar"],[1,"cell-prestataire__name"],["icon","pi pi-arrow-right","severity","secondary","pTooltip","Modifier",3,"click","text","rounded"],["colspan","7"],[1,"empty-state"],[1,"pi","pi-inbox"],["height","2.6rem","styleClass","w-full"],["optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full",3,"ngModelChange","ngModel","options","filter"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"pi","pi-user","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500"],["id","prix_par_rouleau","styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],["label","Annuler","icon","pi pi-times","text","",1,"mt-4",3,"click","disabled"],["label","Enregistrer","icon","pi pi-check",1,"mt-4",3,"click","disabled","loading"]],template:function(e,i){if(e&1){let o=P();m(0,"p-toast"),a(1,"div",8)(2,"p-toolbar",9),u(3,vt,1,1,"ng-template",null,0,M)(5,St,5,7,"ng-template",null,1,M),r(),a(7,"p-table",10,2),x("selectionChange",function(f){return g(o),k(i.selectedPackings,f)||(i.selectedPackings=f),_(f)}),u(9,Ct,6,0,"ng-template",null,3,M)(11,wt,25,0,"ng-template",null,4,M)(13,Dt,16,12,"ng-template",null,5,M)(15,Tt,6,0,"ng-template",null,6,M),r()(),a(17,"p-dialog",11),x("visibleChange",function(f){return g(o),k(i.packingDialog,f)||(i.packingDialog=f),_(f)}),a(18,"div",12)(19,"div")(20,"label",13),l(21,"Prestataire (Machiniste)"),r(),u(22,Rt,1,0,"p-skeleton",14)(23,Vt,3,3,"p-select",15)(24,At,2,0,"small",16),r(),a(25,"div")(26,"label",17),l(27,"Date"),r(),a(28,"p-datepicker",18),x("ngModelChange",function(f){return g(o),k(i.packing.date,f)||(i.packing.date=f),_(f)}),r()(),a(29,"div",19)(30,"div",20)(31,"label",21),l(32,"Nombre de rouleaux"),r(),a(33,"p-inputnumber",22),x("ngModelChange",function(f){return g(o),k(i.packing.nb_rouleaux,f)||(i.packing.nb_rouleaux=f),_(f)}),b("onInput",function(){return g(o),_(i.calculateMontant())}),r()(),a(34,"div",20)(35,"label",23),l(36,"Prix du rouleau (GNF)"),r(),u(37,Nt,1,0,"p-skeleton",14)(38,Bt,1,2,"p-inputnumber",24),r()(),a(39,"div")(40,"label",25),l(41,"Statut"),r(),a(42,"p-select",26),x("ngModelChange",function(f){return g(o),k(i.packing.statut,f)||(i.packing.statut=f),_(f)}),r()(),a(43,"div",27)(44,"span",28),l(45,"Montant total"),r(),a(46,"span",29),l(47),r()()(),u(48,Wt,2,3,"ng-template",30,7,M),r(),m(50,"p-confirmdialog")}e&2&&(s(7),p("value",i.packings())("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",L(30,ft)),h("selection",i.selectedPackings),p("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",L(31,bt))("loading",i.loading),s(10),ie(L(32,ht)),h("visible",i.packingDialog),p("header",i.packing!=null&&i.packing.id?"D\xE9tails du packing":"Nouveau packing")("modal",!0),s(5),p("ngIf",i.dialogLoading),s(),p("ngIf",!i.dialogLoading),s(),p("ngIf",i.submitted&&!i.selectedPrestataire&&!i.dialogLoading),s(4),h("ngModel",i.packing.date),p("showIcon",!0),s(5),h("ngModel",i.packing.nb_rouleaux),p("min",0),s(4),p("ngIf",i.dialogLoading),s(),p("ngIf",!i.dialogLoading),s(4),h("ngModel",i.packing.statut),p("options",i.statuses),s(5),S(i.formatCurrency(i.packing.montant||0)),s(3),ie(L(33,kt)))},dependencies:[W,N,B,Ke,ze,Ce,He,Qe,z,U,G,Te,De,Ie,Y,q,Ye,qe,Ee,we,We,H,Ge,K,Xe,Je,Ze,Oe,Le,Fe,Re,et,$e,Ue,Q,nt,tt,Ae,Ve,rt,at,it],styles:[".tableau-card[_ngcontent-%COMP%]{border-radius:14px!important;box-shadow:0 1px 3px #0000000a!important;overflow:hidden}[_nghost-%COMP%]     .p-datatable .p-datatable-caption{padding:1.5rem 1.75rem 1.75rem;border-bottom:1px solid var(--p-surface-100);margin-bottom:0}.table-caption[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1.5rem;flex-wrap:wrap}.table-caption__filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.table-caption__actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{padding:1rem 1.25rem}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:1.1rem 1.25rem}.col-header[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.03em;color:var(--p-surface-500)}.table-row[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s ease}.cell-prestataire[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.cell-prestataire__avatar[_ngcontent-%COMP%]{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;flex-shrink:0}.cell-prestataire__name[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem;color:var(--p-surface-800)}.cell-secondary[_ngcontent-%COMP%]{color:var(--p-surface-600);font-size:.9rem}.cell-mono[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums;font-size:.9rem}.cell-success[_ngcontent-%COMP%]{color:#059669}.cell-bold[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-800)}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:20px;font-size:.78rem;font-weight:600;letter-spacing:.01em}.status-badge--warn[_ngcontent-%COMP%]{background:#fffbeb;color:#d97706}.status-badge--success[_ngcontent-%COMP%]{background:#ecfdf5;color:#059669}.status-badge--danger[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.75rem;padding:3rem 0;color:var(--p-surface-300)}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem}.empty-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem}.dark[_nghost-%COMP%]   .cell-prestataire__name[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .cell-prestataire__name[_ngcontent-%COMP%], .dark[_nghost-%COMP%]   .cell-bold[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .cell-bold[_ngcontent-%COMP%]{color:var(--p-surface-100)}.dark[_nghost-%COMP%]   .col-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .col-header[_ngcontent-%COMP%]{color:var(--p-surface-400)}.dark[_nghost-%COMP%]   .status-badge--danger[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .status-badge--danger[_ngcontent-%COMP%]{background:#dc26261f}.dark[_nghost-%COMP%]   .status-badge--warn[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .status-badge--warn[_ngcontent-%COMP%]{background:#d977061f}.dark[_nghost-%COMP%]   .status-badge--success[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .status-badge--success[_ngcontent-%COMP%]{background:#0596691f}.dark   [_nghost-%COMP%]     .p-datatable .p-datatable-caption{border-bottom-color:var(--p-surface-700)}"]})};function jt(n,t){if(n&1){let e=P();a(0,"button",34),b("click",function(){g(e);let o=d();return _(o.enableEditing())}),m(1,"i",35),l(2," Modifier "),r()}}function Ut(n,t){n&1&&(a(0,"span",36),l(1,"*"),r())}function Gt(n,t){if(n&1&&(a(0,"div",25)(1,"div",37),m(2,"i",38),r(),a(3,"div")(4,"div",39),l(5),r(),a(6,"div",40),l(7),r()()()),n&2){let e=t.$implicit;s(5),w("",e.prenom," ",e.nom),s(2),S(e.phone)}}function zt(n,t){if(n&1&&(a(0,"div",42),m(1,"i",38),a(2,"span"),l(3),r()()),n&2){let e=d().$implicit;s(3),w("",e.prenom," ",e.nom)}}function Ht(n,t){if(n&1&&u(0,zt,4,2,"div",41),n&2){let e=t.$implicit;p("ngIf",e)}}function Qt(n,t){n&1&&(a(0,"small",36),l(1," Veuillez s\xE9lectionnez un machiniste "),r())}function Kt(n,t){n&1&&(a(0,"span",36),l(1,"*"),r())}function qt(n,t){if(n&1&&(a(0,"small",43),l(1),r()),n&2){let e=d();s(),y(" ",e.dateError," ")}}function Yt(n,t){n&1&&(a(0,"span",36),l(1,"*"),r())}function Jt(n,t){n&1&&(a(0,"small",36),l(1," Le nombre de rouleaux doit \xEAtre sup\xE9rieur \xE0 0 "),r())}function Xt(n,t){n&1&&(a(0,"span",36),l(1,"*"),r())}function Zt(n,t){n&1&&(a(0,"small",36),l(1," Le prix unitaire doit \xEAtre sup\xE9rieur \xE0 0 "),r())}function $t(n,t){if(n&1&&(a(0,"div",44),m(1,"i",45),l(2),E(3,"number"),r()),n&2){let e=d();s(2),w(" ",e.model.nb_rouleaux," rouleaux \xD7 ",R(3,2,e.model.prix_par_rouleau,"1.0-0")," GNF ")}}function ei(n,t){n&1&&(a(0,"div",46),m(1,"i",47),l(2," Entrez la quantit\xE9 et le prix unitaire pour calculer le montant "),r())}function ti(n,t){if(n&1&&(a(0,"div",48)(1,"div",49)(2,"div",50),m(3,"i",51),a(4,"span",52),l(5,"R\xE9capitulatif"),r()(),a(6,"div",53)(7,"div",54)(8,"div",55),m(9,"i",56),a(10,"div",57)(11,"div",28),l(12,"Prestataire"),r(),a(13,"div",58),l(14),r(),a(15,"div",59),l(16),r()()(),a(17,"div",55),m(18,"i",60),a(19,"div",57)(20,"div",28),l(21,"Date"),r(),a(22,"div",61),l(23),E(24,"date"),r()()()(),a(25,"div",54)(26,"div",55),m(27,"i",62),a(28,"div",57)(29,"div",28),l(30,"Quantit\xE9"),r(),a(31,"div",63),l(32),r()()(),a(33,"div",55),m(34,"i",64),a(35,"div",57)(36,"div",28),l(37,"Prix unitaire"),r(),a(38,"div",61),l(39),E(40,"number"),r()()(),a(41,"div",65),m(42,"i",66),a(43,"div",57)(44,"div",28),l(45,"Montant total"),r(),a(46,"div",67),l(47),E(48,"number"),r()()()()()()()),n&2){let e,i,o=d();s(14),w(" ",(e=o.getSelectedPrestataire())==null?null:e.prenom," ",(e=o.getSelectedPrestataire())==null?null:e.nom," "),s(2),y(" ",(i=o.getSelectedPrestataire())==null?null:i.phone," "),s(7),y(" ",R(24,7,o.model.date,"dd/MM/yyyy")," "),s(9),y(" ",o.model.nb_rouleaux," rouleaux "),s(7),y(" ",R(40,10,o.model.prix_par_rouleau,"1.0-0")," GNF "),s(8),y(" ",R(48,13,o.model.montant,"1.0-0")," GNF ")}}function ii(n,t){if(n&1&&(a(0,"span"),l(1),r()),n&2){let e=d(2);s(),S(e.mode==="create"?"Enregistrer":"Sauvegarder")}}function ni(n,t){n&1&&(a(0,"span"),l(1,"Enregistrement..."),r())}function ai(n,t){if(n&1){let e=P();a(0,"div",68)(1,"button",69),b("click",function(){g(e);let o=d();return _(o.onSubmit())}),m(2,"i",70),u(3,ii,2,1,"span",71)(4,ni,2,0,"span",71),r(),a(5,"button",72),b("click",function(){g(e);let o=d();return _(o.mode==="create"?o.onCancel():o.cancelEditing())}),m(6,"i",73),l(7," Annuler "),r()()}if(n&2){let e=d();s(),p("disabled",!e.isValid()||e.loading),s(),be("mr-2",!e.loading),p("ngClass",e.loading?"pi-spin pi-spinner":"pi-check"),s(),p("ngIf",!e.loading),s(),p("ngIf",e.loading),s(),p("disabled",e.loading)}}var T=class{id;prestataire_id;prestataire;reference;date;nb_rouleaux=0;prix_par_rouleau=0;montant=0;statut="valide";notes;constructor(t){t&&(this.id=t.id,this.prestataire_id=t.prestataire_id,this.prestataire=t.prestataire,this.reference=t.reference,this.date=t.date?new Date(t.date):null,this.nb_rouleaux=t.nb_rouleaux||0,this.prix_par_rouleau=t.prix_par_rouleau||0,this.montant=t.montant||0,this.statut=t.statut||"valide",this.notes=t.notes)}calculateMontant(){this.montant=this.nb_rouleaux*this.prix_par_rouleau}},Z=class n{mode="create";initialData=null;prestataires=[];loading=!1;submitForm=new te;cancel=new te;submitted=!1;isEditing=!1;model=new T;minDate=new Date;dateError=null;ngOnInit(){this.model=this.initialData?new T(this.initialData):new T,this.mode==="create"&&(this.isEditing=!0,this.model.date||(this.model.date=new Date))}onPrixOrQuantityChange(){this.model.nb_rouleaux&&this.model.prix_par_rouleau&&this.model.calculateMontant()}validateDate(){return this.model.date?(this.dateError=null,!0):(this.dateError="Date obligatoire.",!1)}onDateChange(){this.submitted&&this.validateDate()}onDateBlur(){this.model.date&&this.validateDate()}getPrestataireLabel(t){return`${t.prenom} ${t.nom} - ${t.phone}`}getSelectedPrestataire(){return this.filteredPrestataires.find(t=>t.id===this.model.prestataire_id)}get filteredPrestataires(){let t=this.model.prestataire_id;return(this.prestataires??[]).filter(e=>t&&e.id===t?!0:e.type==="machiniste")}isValid(){return!(this.model.prestataire_id&&this.model.date&&this.model.nb_rouleaux&&this.model.nb_rouleaux>0&&this.model.prix_par_rouleau&&this.model.prix_par_rouleau>0)?!1:this.validateDate()}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.dateError=null,this.model=this.initialData?new T(this.initialData):new T}resetForm(){this.submitted=!1,this.dateError=null,this.model=new T}formatDate(t){return t?(typeof t=="string"?new Date(t):t).toISOString().split("T")[0]:""}onSubmit(){if(this.submitted=!0,!this.isValid())return;this.model.calculateMontant();let t={prestataire_id:this.model.prestataire_id,date:this.formatDate(this.model.date),nb_rouleaux:this.model.nb_rouleaux,prix_par_rouleau:this.model.prix_par_rouleau,statut:this.model.statut,notes:this.model.notes??void 0};this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}hasErrors(){return!!this.dateError}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-packing-from"]],inputs:{mode:"mode",initialData:"initialData",prestataires:"prestataires",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},decls:53,vars:34,consts:[[1,"card"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],["pButton","","pRipple","","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12"],["for","prestataire",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","prestataire","optionLabel","nom","optionValue","id","placeholder","S\xE9lectionnez un machiniste","filterBy","nom,prenom,phone","fluid","",3,"ngModelChange","ngModel","options","filter","showClear","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"mb-6","col-span-12","md:col-span-6"],["for","date",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","date","dateFormat","dd/mm/yy","placeholder","S\xE9lectionnez la date","fluid","",3,"ngModelChange","onSelect","onBlur","ngModel","showIcon","disabled"],["class","text-red-500 block mt-1",4,"ngIf"],[1,"mb-6","col-span-12","grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-6"],["for","nbRouleaux",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nbRouleaux","placeholder","Entrez le nombre","mode","decimal","fluid","",3,"ngModelChange","ngModel","showButtons","min","max","useGrouping","disabled"],["for","prixRouleau",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prixRouleau","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix par rouleau","fluid","",3,"ngModelChange","ngModel","min","disabled"],[1,"bg-gradient-to-r","from-primary/10","to-primary/5","border-l-4","border-primary","rounded-lg","p-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-full","bg-primary/20","flex","items-center","justify-center"],[1,"pi","pi-money-bill","text-primary","text-xl"],[1,"text-xs","text-surface-600","dark:text-surface-400","mb-1"],[1,"text-3xl","font-bold","text-primary"],["class","text-sm text-surface-600 dark:text-surface-300 mt-3 flex items-center gap-2",4,"ngIf"],["class","text-sm text-surface-500 dark:text-surface-400 mt-3 italic",4,"ngIf"],["class","col-span-12 mb-6",4,"ngIf"],["class","col-span-12 flex gap-2 mb-4",4,"ngIf"],["pButton","","pRipple","","severity","warn",1,"w-auto",3,"click"],[1,"pi","pi-pencil","mr-2"],[1,"text-red-500"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary/10"],[1,"pi","pi-user","text-primary"],[1,"font-medium"],[1,"text-sm","text-surface-500"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500","block","mt-1"],[1,"text-sm","text-surface-600","dark:text-surface-300","mt-3","flex","items-center","gap-2"],[1,"pi","pi-calculator","text-surface-500"],[1,"text-sm","text-surface-500","dark:text-surface-400","mt-3","italic"],[1,"pi","pi-info-circle","mr-2"],[1,"col-span-12","mb-6"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-5"],[1,"flex","items-center","gap-2","mb-4"],[1,"pi","pi-info-circle","text-blue-600","dark:text-blue-400","text-lg"],[1,"font-bold","text-blue-900","dark:text-blue-100","text-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"space-y-3"],[1,"flex","items-start","gap-3"],[1,"pi","pi-user","text-blue-600","mt-1"],[1,"flex-1"],[1,"font-semibold","text-surface-900","dark:text-surface-0"],[1,"text-sm","text-surface-500","dark:text-surface-400"],[1,"pi","pi-calendar","text-blue-600","mt-1"],[1,"font-medium","text-surface-900","dark:text-surface-0"],[1,"pi","pi-box","text-blue-600","mt-1"],[1,"font-bold","text-primary","text-xl"],[1,"pi","pi-tag","text-blue-600","mt-1"],[1,"flex","items-start","gap-3","pt-3","border-t","border-blue-200","dark:border-blue-700"],[1,"pi","pi-wallet","text-blue-600","mt-1"],[1,"font-bold","text-primary","text-2xl"],[1,"col-span-12","flex","gap-2","mb-4"],["pButton","","pRipple","",1,"w-auto",3,"click","disabled"],[1,"pi",3,"ngClass"],[4,"ngIf"],["pButton","","pRipple","","severity","secondary",1,"w-auto",3,"click","disabled"],[1,"pi","pi-times","mr-2"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"span",2),l(3),r(),u(4,jt,3,0,"button",3),r(),a(5,"div",4),m(6,"div",5),a(7,"div",6)(8,"div",4)(9,"div",7)(10,"label",8),l(11," Prestataire "),u(12,Ut,2,0,"span",9),l(13," (Machiniste) "),r(),a(14,"p-select",10),x("ngModelChange",function(c){return k(i.model.prestataire_id,c)||(i.model.prestataire_id=c),c}),u(15,Gt,8,3,"ng-template",11)(16,Ht,1,1,"ng-template",12),r(),u(17,Qt,2,0,"small",9),r(),a(18,"div",13)(19,"label",14),l(20," Date "),u(21,Kt,2,0,"span",9),r(),a(22,"p-datepicker",15),x("ngModelChange",function(c){return k(i.model.date,c)||(i.model.date=c),c}),b("onSelect",function(){return i.onDateChange()})("onBlur",function(){return i.onDateBlur()}),r(),u(23,qt,2,1,"small",16),r(),a(24,"div",17)(25,"div",18)(26,"label",19),l(27," Nombre de rouleaux "),u(28,Yt,2,0,"span",9),r(),a(29,"p-inputnumber",20),x("ngModelChange",function(c){return k(i.model.nb_rouleaux,c)||(i.model.nb_rouleaux=c),c}),b("ngModelChange",function(){return i.onPrixOrQuantityChange()}),r(),u(30,Jt,2,0,"small",9),r(),a(31,"div",18)(32,"label",21),l(33," Prix unitaire (GNF) "),u(34,Xt,2,0,"span",9),r(),a(35,"p-inputnumber",22),x("ngModelChange",function(c){return k(i.model.prix_par_rouleau,c)||(i.model.prix_par_rouleau=c),c}),b("ngModelChange",function(){return i.onPrixOrQuantityChange()}),r(),u(36,Zt,2,0,"small",9),r()(),a(37,"div",7)(38,"div",23)(39,"div",24)(40,"div",25)(41,"div",26),m(42,"i",27),r(),a(43,"div")(44,"div",28),l(45," Montant total "),r(),a(46,"div",29),l(47),E(48,"money"),r()()()(),u(49,$t,4,5,"div",30)(50,ei,3,0,"div",31),r()(),u(51,ti,49,16,"div",32)(52,ai,8,7,"div",33),r()()()()),e&2&&(s(3),y(" ",i.mode==="create"?"Nouveau packing":"D\xE9tails du packing"," "),s(),p("ngIf",i.mode==="edit"&&!i.isEditing),s(8),p("ngIf",i.isEditing),s(2),h("ngModel",i.model.prestataire_id),p("options",i.filteredPrestataires)("filter",!0)("showClear",!0)("disabled",i.fieldsDisabled),s(3),p("ngIf",i.submitted&&!i.model.prestataire_id&&i.isEditing),s(4),p("ngIf",i.isEditing),s(),h("ngModel",i.model.date),p("showIcon",!0)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&i.dateError&&i.isEditing),s(5),p("ngIf",i.isEditing),s(),h("ngModel",i.model.nb_rouleaux),p("showButtons",!0)("min",1)("max",9999)("useGrouping",!1)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&(!i.model.nb_rouleaux||i.model.nb_rouleaux<1)&&i.isEditing),s(4),p("ngIf",i.isEditing),s(),h("ngModel",i.model.prix_par_rouleau),p("min",0)("disabled",i.fieldsDisabled),s(),p("ngIf",i.submitted&&(!i.model.prix_par_rouleau||i.model.prix_par_rouleau<=0)&&i.isEditing),s(11),y(" ",xe(48,32,i.model.montant)," "),s(2),p("ngIf",i.model.nb_rouleaux&&i.model.prix_par_rouleau),s(),p("ngIf",!i.model.nb_rouleaux||!i.model.prix_par_rouleau),s(),p("ngIf",i.model.prestataire_id&&i.model.date&&i.model.nb_rouleaux&&i.model.prix_par_rouleau&&!i.hasErrors()),s(),p("ngIf",i.isEditing))},dependencies:[W,N,B,z,U,G,Q,H,K,Me,ve,Pe,je],encapsulation:2})};var $=class n{constructor(t,e,i,o){this.prestataireService=t;this.packingService=e;this.messageService=i;this.router=o}prestataires=[];loading=!1;ngOnInit(){this.loadPrestataires()}loadPrestataires(){this.loading=!0,this.prestataireService.getPrestataires().subscribe({next:t=>{this.prestataires=this.extractPrestataires(t),this.loading=!1},error:t=>{console.error("Erreur lors du chargement des prestataires :",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires",life:3e3}),this.loading=!1}})}extractPrestataires(t){let e=t?.data;return Array.isArray(e)?e:e&&Array.isArray(e.data)?e.data:[]}onSubmit(t){this.loading=!0,this.packingService.createPacking(t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing cr\xE9\xE9 avec succ\xE8s",life:3e3}),this.loading=!1,setTimeout(()=>{this.router.navigate(["/packings/packings-liste"])},1e3)},error:e=>{console.error("Erreur lors de la cr\xE9ation du packing :",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le packing",life:3e3}),this.loading=!1}})}onCancel(){this.router.navigate(["/packings/packings-liste"])}static \u0275fac=function(e){return new(e||n)(v(J),v(F),v(D),v(Se))};static \u0275cmp=C({type:n,selectors:[["app-packing-new"]],features:[A([D])],decls:2,vars:3,consts:[[3,"submitForm","cancel","mode","prestataires","loading"]],template:function(e,i){e&1&&(m(0,"p-toast"),a(1,"app-packing-from",0),b("submitForm",function(c){return i.onSubmit(c)})("cancel",function(){return i.onCancel()}),r()),e&2&&(s(),p("mode","create")("prestataires",i.prestataires)("loading",i.loading))},dependencies:[Z,Y,q],encapsulation:2})};var ee=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-packing-edit"]],decls:2,vars:0,template:function(e,i){e&1&&(ce(0,"p"),l(1,"packing-edit works!"),de())},encapsulation:2})};var Dn=[{path:"",component:V,canActivate:[O],data:{permissions:["packings.read"]}},{path:"packings",component:V,canActivate:[O],data:{permissions:["packings.read"]}},{path:"packings-new",component:$,canActivate:[O],data:{permissions:["packings.create"]}},{path:"packings-edit/:id",component:ee,canActivate:[O],data:{permissions:["packings.update"]}},{path:"**",redirectTo:"/notfound"}];export{Dn as default};
