import{a as J,b as U}from"./chunk-GF4G56P5.js";import{a as q}from"./chunk-YJJVWJSQ.js";import{a as A,b as G}from"./chunk-QFEFJCNI.js";import"./chunk-RLRCSE6J.js";import"./chunk-4SCZYFYR.js";import{e as L,j as D}from"./chunk-H5BNHAT7.js";import"./chunk-Q3QYWOBT.js";import"./chunk-26DLLJPL.js";import"./chunk-IQPGUH4V.js";import{a as B,b as K}from"./chunk-ROFMEOOL.js";import{b as w,e as T,h as N,j as F,m as W,p as j}from"./chunk-AQNIYYGH.js";import"./chunk-YU5WWNZ3.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{d as V,e as O}from"./chunk-FXG7SSDN.js";import"./chunk-C3BTHMVA.js";import"./chunk-D772OSYX.js";import"./chunk-N4GWINB2.js";import{pa as c}from"./chunk-DRU5BJUS.js";import{k as I,v as C}from"./chunk-3CNM3VZD.js";import"./chunk-4O3FVBGX.js";import{Kb as k,Lb as v,Ma as o,Xa as x,Zb as a,_b as h,ab as _,cc as P,dc as y,ec as M,gb as S,gc as R,hc as E,k as g,u as b,wb as u,xb as r,yb as i,z as f,zb as m}from"./chunk-U3BUAVLN.js";import"./chunk-GAL4ENT6.js";var z=()=>["/roles"];function H(l,s){if(l&1&&(r(0,"div",28),a(1),i()),l&2){let t=v();o(),h(t.errorMessage)}}function Q(l,s){if(l&1&&(r(0,"div",29),a(1),i()),l&2){let t=v();o(),h(t.successMessage)}}var d=class l{constructor(s,t){this.parametresService=s;this.messageService=t}loading=!1;saving=!1;errorMessage="";successMessage="";idRouleauPacking="";prixRouleauDefaut=0;idRouleauParam;prixRouleauParam;produitRouleauKey="produit_rouleau_id";legacyProduitRouleauKey="id_rouleau_packing";ngOnInit(){this.loadPackingParametres()}loadPackingParametres(){this.loading=!0,this.errorMessage="",this.parametresService.getParametres("packing").subscribe({next:s=>{let t=s.data.parametres??[];this.idRouleauParam=t.find(e=>e.cle===this.produitRouleauKey)??t.find(e=>e.cle===this.legacyProduitRouleauKey),this.prixRouleauParam=t.find(e=>e.cle==="prix_rouleau_defaut"),this.idRouleauPacking=this.idRouleauParam?.valeur?.toString()??"",this.prixRouleauDefaut=Number(this.prixRouleauParam?.valeur??0)||0,this.loading=!1},error:()=>{this.errorMessage="Impossible de charger les parametres.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.loading=!1}})}savePackingParametres(){if(this.errorMessage="",this.successMessage="",!this.idRouleauParam||!this.prixRouleauParam){this.errorMessage="Parametres packing introuvables (produit_rouleau_id / prix_rouleau_defaut).",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3});return}let s=Number(this.idRouleauPacking);if(!Number.isFinite(s)){this.errorMessage='Le champ "ID du produit rouleau" doit etre numerique.',this.messageService.add({severity:"warn",summary:"Validation",detail:this.errorMessage,life:3e3});return}this.saving=!0,b([this.parametresService.updateParametre(this.idRouleauParam.id,{valeur:s}).pipe(f(()=>g(null))),this.parametresService.updateParametre(this.prixRouleauParam.id,{valeur:Number(this.prixRouleauDefaut||0)}).pipe(f(()=>g(null)))]).subscribe({next:t=>{t.some(p=>p===null)?(this.errorMessage="Une ou plusieurs mises a jour ont echoue.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3})):(this.successMessage="Parametres mis a jour avec succes.",this.messageService.add({severity:"success",summary:"Succes",detail:this.successMessage,life:3e3})),this.saving=!1},error:()=>{this.errorMessage="Erreur lors de la sauvegarde.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.saving=!1}})}static \u0275fac=function(t){return new(t||l)(x(q),x(c))};static \u0275cmp=_({type:l,selectors:[["app-parametres-liste"]],features:[R([c])],decls:44,vars:10,consts:[[1,"rounded-t-3xl","bg-surface-0","dark:bg-surface-900","flex-auto","py-6","lg:py-8","px-8","lg:px-20"],[1,"flex","flex-col","w-full","pb-8","gap-2"],[1,"mt-0","text-surface-900","dark:text-surface-0","font-medium","text-2xl","leading-tight"],[1,"mt-0","text-surface-500","dark:text-surface-300","leading-tight"],[1,"grid","grid-cols-12","gap-4","py-6","lg:py-8"],[1,"col-span-12","lg:col-span-2"],[1,"list-none","m-0","p-0","hidden","lg:flex","flex-col","justify-start"],[1,"border-l-2","border-surface-200","dark:border-surface-700","-ml-[2px]"],[1,"flex","items-center","py-3","px-4","text-surface-700","dark:text-surface-200","font-medium"],[1,"pi","pi-user","mr-2","text-base!","leading-normal!"],[1,"border-l-2","border-primary","-ml-[2px]"],[1,"flex","items-center","py-3","px-4","text-primary","font-medium"],[1,"pi","pi-cog","mr-2","text-base!","leading-normal!"],[1,"flex","items-center","py-3","px-4","text-surface-700","dark:text-surface-200","font-medium","hover:text-primary","transition-colors",3,"routerLink"],[1,"pi","pi-shield","mr-2","text-base!","leading-normal!"],[1,"col-span-12","lg:col-span-10","xl:col-span-10","bg-surface-0","dark:bg-surface-900","p-8","rounded-2xl","flex-auto"],[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"flex","gap-12","flex-col-reverse","md:flex-row"],[1,"flex-auto","flex","flex-col","gap-6"],[1,"flex","flex-col","gap-2"],["for","produit_rouleau_id",1,"text-surface-900","dark:text-surface-0"],["id","produit_rouleau_id","type","number","min","0","step","1","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","prix_rouleau_defaut",1,"text-surface-900","dark:text-surface-0"],["id","prix_rouleau_defaut","type","number","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(t,e){t&1&&(m(0,"p-toast"),r(1,"div",0)(2,"div",1)(3,"h2",2),a(4,"Parametres"),i(),r(5,"p",3),a(6,"Gestion des parametres de l'application"),i()(),m(7,"p-divider"),r(8,"div",4)(9,"div",5)(10,"ul",6)(11,"li",7)(12,"a",8),m(13,"i",9),r(14,"span"),a(15,"General"),i()()(),r(16,"li",10)(17,"a",11),m(18,"i",12),r(19,"span"),a(20,"Packing"),i()()(),r(21,"li",7)(22,"a",13),m(23,"i",14),r(24,"span"),a(25,"R\xF4les & Permissions"),i()()()()(),r(26,"div",15)(27,"div",16)(28,"div",17),a(29,"Parametres Packing"),i(),S(30,H,2,1,"div",18)(31,Q,2,1,"div",19),r(32,"div",20)(33,"div",21)(34,"div",22)(35,"label",23),a(36,"ID du produit rouleau (packing)"),i(),r(37,"input",24),M("ngModelChange",function(n){return y(e.idRouleauPacking,n)||(e.idRouleauPacking=n),n}),i()(),r(38,"div",22)(39,"label",25),a(40,"Prix par defaut du rouleau de packing"),i(),r(41,"input",26),M("ngModelChange",function(n){return y(e.prixRouleauDefaut,n)||(e.prixRouleauDefaut=n),n}),i()()()(),r(42,"div")(43,"p-button",27),k("onClick",function(){return e.savePackingParametres()}),i()()()()()()),t&2&&(o(22),u("routerLink",E(9,z)),o(8),u("ngIf",e.errorMessage),o(),u("ngIf",e.successMessage),o(6),P("ngModel",e.idRouleauPacking),u("disabled",e.loading||e.saving),o(4),P("ngModel",e.prixRouleauDefaut),u("disabled",e.loading||e.saving),o(2),u("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[C,I,j,w,F,T,W,N,O,V,U,J,K,B,G,A,D,L],encapsulation:2})};var Pe=[{path:"",component:d,data:{breadcrumb:"Param\xE8tres"}},{path:"parametres",component:d,data:{breadcrumb:"Param\xE8tres"}}];export{Pe as default};
