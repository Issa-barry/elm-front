import{a as Fe,b as Le}from"./chunk-F33A36BI.js";import"./chunk-OUOBJSFA.js";import{a as We,b as z}from"./chunk-2RRFE6AH.js";import{a as je,b as Ve}from"./chunk-UQWTVZW6.js";import{a as Ne}from"./chunk-ATSLMLAG.js";import{a as Ae,b as De}from"./chunk-4GZDNROL.js";import{a as Ee,b as Re}from"./chunk-DHJWLZNQ.js";import{a as Ie,b as Te}from"./chunk-YPRURME4.js";import{a as be,d as Me,e as Se,k as ke}from"./chunk-JIY4JMHE.js";import"./chunk-WFYDMA2Q.js";import"./chunk-JB2CRUIP.js";import"./chunk-AKUMWKOH.js";import{a as Ce,b as Q}from"./chunk-7GJBPOT6.js";import"./chunk-Y5JACZJ2.js";import"./chunk-GENO2AML.js";import"./chunk-NSCA45XW.js";import"./chunk-2EZOXPCA.js";import"./chunk-2RI3M3JA.js";import"./chunk-YYLPR3GR.js";import"./chunk-A7HHAFIK.js";import"./chunk-S77G5XB5.js";import"./chunk-74P3RONA.js";import"./chunk-YG7LP6WD.js";import{b as K}from"./chunk-7AOJUWB4.js";import"./chunk-NQP2NLT3.js";import"./chunk-WJT44AOU.js";import"./chunk-TPNAGKMW.js";import{d as fe,j as q}from"./chunk-3PAKMIDN.js";import"./chunk-LJTUVZ5Q.js";import"./chunk-KDHKK32X.js";import{d as T,e as A}from"./chunk-KT3B5SP3.js";import"./chunk-E3FSYXNL.js";import"./chunk-JYKZ76SI.js";import"./chunk-KYPIGX3A.js";import"./chunk-LWCLQ6M5.js";import"./chunk-E3SRFFWQ.js";import"./chunk-U3UB2P3Z.js";import"./chunk-5TJW5VIF.js";import{a as _e,b as he,c as ye,d as xe}from"./chunk-GN6RJQ7L.js";import{a as F,b as L}from"./chunk-JRNNJ6SL.js";import{b as W,e as E,h as R,j as ge,m as ve,p as I}from"./chunk-WX7SVATX.js";import{a as we,b as Pe}from"./chunk-2ABO2AXS.js";import"./chunk-YBEZL4R2.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import"./chunk-BMS6JNLC.js";import"./chunk-JMQBCY5U.js";import{la as O,pa as w}from"./chunk-PUR6U5O3.js";import{i as ce,k as C,v as S}from"./chunk-4C25TOQ5.js";import"./chunk-4O3FVBGX.js";import{$ as P,$b as ue,Gb as U,Kb as c,Lb as f,Ma as n,Pb as le,Qb as me,Rb as pe,Vb as de,Xa as h,Xb as B,Zb as p,_b as x,aa as b,ab as M,cc as g,dc as v,ec as _,gb as y,gc as D,hc as N,ia as ne,k as $,u as oe,vc as j,wb as m,xb as i,yb as s,z as ee,zb as u}from"./chunk-DXANH7IG.js";import"./chunk-GAL4ENT6.js";function qe(l,r){if(l&1&&(i(0,"div",12),p(1),s()),l&2){let t=f();n(),x(t.errorMessage)}}function Oe(l,r){if(l&1&&(i(0,"div",13),p(1),s()),l&2){let t=f();n(),x(t.successMessage)}}var G=class l{constructor(r,t){this.parametresService=r;this.messageService=t}loading=!1;saving=!1;errorMessage="";successMessage="";idRouleauPacking="";prixRouleauDefaut=0;idRouleauParam;prixRouleauParam;produitRouleauKey="produit_rouleau_id";legacyProduitRouleauKey="id_rouleau_packing";ngOnInit(){this.loadPackingParametres()}loadPackingParametres(){this.loading=!0,this.errorMessage="",this.parametresService.getParametres("packing").subscribe({next:r=>{let t=r.data.parametres??[];this.idRouleauParam=t.find(e=>e.cle===this.produitRouleauKey)??t.find(e=>e.cle===this.legacyProduitRouleauKey),this.prixRouleauParam=t.find(e=>e.cle==="prix_rouleau_defaut"),this.idRouleauPacking=this.idRouleauParam?.valeur?.toString()??"",this.prixRouleauDefaut=Number(this.prixRouleauParam?.valeur??0)||0,this.loading=!1},error:()=>{this.errorMessage="Impossible de charger les parametres.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.loading=!1}})}savePackingParametres(){if(this.errorMessage="",this.successMessage="",!this.idRouleauParam||!this.prixRouleauParam){this.errorMessage="Parametres packing introuvables (produit_rouleau_id / prix_rouleau_defaut).",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3});return}let r=Number(this.idRouleauPacking);if(!Number.isFinite(r)){this.errorMessage='Le champ "ID du produit rouleau" doit etre numerique.',this.messageService.add({severity:"warn",summary:"Validation",detail:this.errorMessage,life:3e3});return}this.saving=!0,oe([this.parametresService.updateParametre(this.idRouleauParam.id,{valeur:r}).pipe(ee(()=>$(null))),this.parametresService.updateParametre(this.prixRouleauParam.id,{valeur:Number(this.prixRouleauDefaut||0)}).pipe(ee(()=>$(null)))]).subscribe({next:t=>{t.some(o=>o===null)?(this.errorMessage="Une ou plusieurs mises a jour ont echoue.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3})):(this.successMessage="Parametres mis a jour avec succes.",this.messageService.add({severity:"success",summary:"Succes",detail:this.successMessage,life:3e3})),this.saving=!1},error:()=>{this.errorMessage="Erreur lors de la sauvegarde.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.saving=!1}})}static \u0275fac=function(t){return new(t||l)(h(Ne),h(w))};static \u0275cmp=M({type:l,selectors:[["app-parametres-packing"]],features:[D([w])],decls:17,vars:8,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"flex","gap-12","flex-col-reverse","md:flex-row"],[1,"flex-auto","flex","flex-col","gap-6"],[1,"flex","flex-col","gap-2"],["for","produit_rouleau_id",1,"text-surface-900","dark:text-surface-0"],["id","produit_rouleau_id","type","number","min","0","step","1","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","prix_rouleau_defaut",1,"text-surface-900","dark:text-surface-0"],["id","prix_rouleau_defaut","type","number","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),p(2,"Parametres Packing"),s(),y(3,qe,2,1,"div",2)(4,Oe,2,1,"div",3),i(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),p(9,"ID du produit rouleau (packing)"),s(),i(10,"input",8),_("ngModelChange",function(a){return v(e.idRouleauPacking,a)||(e.idRouleauPacking=a),a}),s()(),i(11,"div",6)(12,"label",9),p(13,"Prix par defaut du rouleau de packing"),s(),i(14,"input",10),_("ngModelChange",function(a){return v(e.prixRouleauDefaut,a)||(e.prixRouleauDefaut=a),a}),s()()()(),i(15,"div")(16,"p-button",11),c("onClick",function(){return e.savePackingParametres()}),s()()()),t&2&&(n(3),m("ngIf",e.errorMessage),n(),m("ngIf",e.successMessage),n(6),g("ngModel",e.idRouleauPacking),m("disabled",e.loading||e.saving),n(4),g("ngModel",e.prixRouleauDefaut),m("disabled",e.loading||e.saving),n(2),m("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[S,C,I,W,ge,E,ve,R,A,T,z,L,F,Q,q],encapsulation:2})};function Qe(l,r){if(l&1&&(i(0,"div",18),p(1),s()),l&2){let t=f();n(),x(t.errorMessage)}}function ze(l,r){if(l&1&&(i(0,"div",19),p(1),s()),l&2){let t=f();n(),x(t.successMessage)}}var X=class l{constructor(r,t){this.authService=r;this.messageService=t}loading=!1;saving=!1;profileLoaded=!1;errorMessage="";successMessage="";form={nom:"",prenom:"",email:"",ville:"",quartier:""};ngOnInit(){this.loadProfile()}loadProfile(){this.loading=!0,this.profileLoaded=!1,this.errorMessage="",this.successMessage="",this.authService.me().subscribe({next:r=>{let t=this.extractUserFromPayload(r?.data)??this.authService.currentUser();if(!t){this.errorMessage="Impossible de charger le profile.",this.pushMessage("error","Erreur",this.errorMessage),this.loading=!1;return}this.applyUserToForm(t),this.profileLoaded=!0,this.loading=!1},error:()=>{let r=this.authService.currentUser();if(r){this.applyUserToForm(r),this.profileLoaded=!0,this.loading=!1;return}this.errorMessage="Impossible de charger le profile.",this.pushMessage("error","Erreur",this.errorMessage),this.loading=!1}})}saveProfile(){if(this.loading||this.saving||!this.profileLoaded)return;this.errorMessage="",this.successMessage="";let r=this.buildUpdatePayload();this.saving=!0,this.authService.updateProfile(r).subscribe({next:t=>{let e=this.extractUserFromPayload(t?.data)??this.authService.currentUser();e&&this.applyUserToForm(e),this.successMessage=t?.message||"Profil mis a jour avec succes.",this.pushMessage("success","Succes",this.successMessage),this.saving=!1},error:t=>{this.errorMessage=this.extractErrorMessage(t),this.pushMessage("error","Erreur",this.errorMessage),this.saving=!1}})}buildUpdatePayload(){let r=this.form.nom.trim(),t=this.form.prenom.trim(),e=this.form.email.trim(),o=this.form.ville.trim(),a=this.form.quartier.trim(),d={};return r.length>0&&(d.nom=r),t.length>0&&(d.prenom=t),d.email=e.length>0?e:null,o.length>0&&(d.ville=o),a.length>0&&(d.quartier=a),d}applyUserToForm(r){this.form={nom:r.nom??"",prenom:r.prenom??"",email:r.email??"",ville:r.ville??"",quartier:r.quartier??""}}extractUserFromPayload(r){if(!r||typeof r!="object")return null;let t=r.user??r;return!t||typeof t!="object"?null:t}extractErrorMessage(r){let t=r?.error?.errors;if(t&&typeof t=="object"){for(let e of Object.values(t))if(Array.isArray(e)){let o=e.find(a=>typeof a=="string");if(typeof o=="string"&&o.trim().length>0)return o}}return typeof r?.error?.message=="string"&&r.error.message.trim().length>0?r.error.message:"Erreur lors de la mise a jour du profile."}pushMessage(r,t,e){this.messageService.add({severity:r,summary:t,detail:e,life:3e3})}static \u0275fac=function(t){return new(t||l)(h(K),h(w))};static \u0275cmp=M({type:l,selectors:[["app-parametres-profile"]],decls:28,vars:14,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"flex","flex-col","gap-2"],["for","profile_nom",1,"text-surface-900","dark:text-surface-0"],["id","profile_nom","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_prenom",1,"text-surface-900","dark:text-surface-0"],["id","profile_prenom","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],[1,"flex","flex-col","gap-2","md:col-span-2"],["for","profile_email",1,"text-surface-900","dark:text-surface-0"],["id","profile_email","type","email","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_ville",1,"text-surface-900","dark:text-surface-0"],["id","profile_ville","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_quartier",1,"text-surface-900","dark:text-surface-0"],["id","profile_quartier","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),p(2,"Parametres Profile"),s(),y(3,Qe,2,1,"div",2)(4,ze,2,1,"div",3),i(5,"div",4)(6,"div",5)(7,"label",6),p(8,"Nom"),s(),i(9,"input",7),_("ngModelChange",function(a){return v(e.form.nom,a)||(e.form.nom=a),a}),s()(),i(10,"div",5)(11,"label",8),p(12,"Prenom"),s(),i(13,"input",9),_("ngModelChange",function(a){return v(e.form.prenom,a)||(e.form.prenom=a),a}),s()(),i(14,"div",10)(15,"label",11),p(16,"Email"),s(),i(17,"input",12),_("ngModelChange",function(a){return v(e.form.email,a)||(e.form.email=a),a}),s()(),i(18,"div",5)(19,"label",13),p(20,"Ville"),s(),i(21,"input",14),_("ngModelChange",function(a){return v(e.form.ville,a)||(e.form.ville=a),a}),s()(),i(22,"div",5)(23,"label",15),p(24,"Quartier"),s(),i(25,"input",16),_("ngModelChange",function(a){return v(e.form.quartier,a)||(e.form.quartier=a),a}),s()()(),i(26,"div")(27,"p-button",17),c("onClick",function(){return e.saveProfile()}),s()()()),t&2&&(n(3),m("ngIf",e.errorMessage),n(),m("ngIf",e.successMessage),n(5),g("ngModel",e.form.nom),m("disabled",e.loading||e.saving),n(4),g("ngModel",e.form.prenom),m("disabled",e.loading||e.saving),n(4),g("ngModel",e.form.email),m("disabled",e.loading||e.saving),n(4),g("ngModel",e.form.ville),m("disabled",e.loading||e.saving),n(4),g("ngModel",e.form.quartier),m("disabled",e.loading||e.saving),n(2),m("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[S,C,I,W,E,R,A,T,L,F],encapsulation:2})};function Ge(l,r){if(l&1&&(i(0,"small",13),p(1),s()),l&2){let t=f();n(),x(t.fieldErrors.current_password)}}function He(l,r){if(l&1&&(i(0,"small",13),p(1),s()),l&2){let t=f();n(),x(t.fieldErrors.new_password)}}function Je(l,r){if(l&1&&(i(0,"small",13),p(1),s()),l&2){let t=f();n(),x(t.fieldErrors.new_password_confirmation)}}var Y=class l{constructor(r,t){this.authService=r;this.messageService=t}saving=!1;fieldErrors={};form={current_password:"",new_password:"",new_password_confirmation:""};changePassword(){if(this.fieldErrors={},!this.form.current_password){this.fieldErrors.current_password="Le mot de passe actuel est obligatoire";return}if(!this.form.new_password){this.fieldErrors.new_password="Le nouveau mot de passe est obligatoire";return}if(this.form.new_password.length<8){this.fieldErrors.new_password="Le mot de passe doit contenir au moins 8 caract\xE8res";return}if(this.form.new_password!==this.form.new_password_confirmation){this.fieldErrors.new_password_confirmation="Les mots de passe ne correspondent pas";return}let r={current_password:this.form.current_password,new_password:this.form.new_password,new_password_confirmation:this.form.new_password_confirmation};this.saving=!0,this.authService.changePassword(r).subscribe({next:t=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t?.message||"Mot de passe modifi\xE9 avec succ\xE8s",life:3e3}),this.form={current_password:"",new_password:"",new_password_confirmation:""},this.saving=!1},error:t=>{let e=t?.error?.errors;if(e&&typeof e=="object")for(let[o,a]of Object.entries(e))Array.isArray(a)&&a.length>0&&(this.fieldErrors[o]=a[0]);this.messageService.add({severity:"error",summary:"Erreur",detail:this.extractErrorMessage(t),life:5e3}),this.saving=!1}})}extractErrorMessage(r){let t=r?.error?.errors;if(t&&typeof t=="object"){for(let e of Object.values(t))if(Array.isArray(e)){let o=e.find(a=>typeof a=="string");if(typeof o=="string"&&o.trim().length>0)return o}}return typeof r?.error?.message=="string"&&r.error.message.trim().length>0?r.error.message:"Erreur lors du changement de mot de passe"}static \u0275fac=function(t){return new(t||l)(h(K),h(w))};static \u0275cmp=M({type:l,selectors:[["app-parametres-auth"]],decls:23,vars:17,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],[1,"grid","grid-cols-1","gap-6",2,"max-width","500px"],[1,"flex","flex-col","gap-2"],["for","current_password",1,"text-surface-900","dark:text-surface-0"],["id","current_password","styleClass","w-full","inputStyleClass","w-full",3,"ngModelChange","ngModel","toggleMask","feedback","disabled"],["class","text-red-500",4,"ngIf"],["for","new_password",1,"text-surface-900","dark:text-surface-0"],["id","new_password","styleClass","w-full","inputStyleClass","w-full","promptLabel","Entrez un mot de passe","weakLabel","Faible","mediumLabel","Moyen","strongLabel","Fort",3,"ngModelChange","ngModel","toggleMask","feedback","disabled"],[1,"text-surface-500"],["for","new_password_confirmation",1,"text-surface-900","dark:text-surface-0"],["id","new_password_confirmation","styleClass","w-full","inputStyleClass","w-full",3,"ngModelChange","ngModel","toggleMask","feedback","disabled"],["label","Modifier le mot de passe","icon","pi pi-key",3,"onClick","loading","disabled"],[1,"text-red-500"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1),p(2,"Changer le mot de passe"),s(),i(3,"div",2)(4,"div",3)(5,"label",4),p(6,"Mot de passe actuel"),s(),i(7,"p-password",5),_("ngModelChange",function(a){return v(e.form.current_password,a)||(e.form.current_password=a),a}),s(),y(8,Ge,2,1,"small",6),s(),i(9,"div",3)(10,"label",7),p(11,"Nouveau mot de passe"),s(),i(12,"p-password",8),_("ngModelChange",function(a){return v(e.form.new_password,a)||(e.form.new_password=a),a}),s(),i(13,"small",9),p(14,"Min. 8 caract\xE8res, majuscule, minuscule et chiffre"),s(),y(15,He,2,1,"small",6),s(),i(16,"div",3)(17,"label",10),p(18,"Confirmer le nouveau mot de passe"),s(),i(19,"p-password",11),_("ngModelChange",function(a){return v(e.form.new_password_confirmation,a)||(e.form.new_password_confirmation=a),a}),s(),y(20,Je,2,1,"small",6),s()(),i(21,"div")(22,"p-button",12),c("onClick",function(){return e.changePassword()}),s()()()),t&2&&(n(7),g("ngModel",e.form.current_password),m("toggleMask",!0)("feedback",!1)("disabled",e.saving),n(),m("ngIf",e.fieldErrors.current_password),n(4),g("ngModel",e.form.new_password),m("toggleMask",!0)("feedback",!0)("disabled",e.saving),n(3),m("ngIf",e.fieldErrors.new_password),n(4),g("ngModel",e.form.new_password_confirmation),m("toggleMask",!0)("feedback",!1)("disabled",e.saving),n(),m("ngIf",e.fieldErrors.new_password_confirmation),n(2),m("loading",e.saving)("disabled",e.saving))},dependencies:[S,C,I,E,R,A,T,Le,Fe],encapsulation:2})};var Xe=["dt"],Ye=()=>({borderRadius:"2rem"}),Ze=()=>["role.name"],$e=()=>[5,10],Be=()=>({width:"450px"});function et(l,r){l&1&&(i(0,"tr")(1,"th",17)(2,"span",18),p(3,"Nom "),u(4,"p-sortIcon",19),s()(),i(5,"th",20)(6,"span",18),p(7,"Date de cr\xE9ation "),u(8,"p-sortIcon",21),s()(),i(9,"th",22)(10,"span",23),p(11,"Permissions"),s()(),u(12,"th",24),s())}function tt(l,r){if(l&1){let t=U();i(0,"tr")(1,"td",25)(2,"div",26)(3,"span",27),u(4,"i",28),s(),i(5,"span",29),p(6),s()()(),i(7,"td",30),p(8),s(),i(9,"td",31),u(10,"p-tag",32),s(),i(11,"td")(12,"div",33)(13,"p-button",34),c("click",function(o){let a=P(t).$implicit;return f().deleteRole(a),b(o.stopPropagation())}),s(),i(14,"p-button",35),c("click",function(){let o=P(t).$implicit,a=f();return b(a.editRole(o))}),s()()()()}if(l&2){let t=r.$implicit,e=f();n(3),de("background","var(--p-primary-50)")("color","var(--p-primary-600)"),n(3),x(t.role.name),n(2),ue(" ",e.formatDate(t.role.created_at)," "),n(2),m("value",e.countPermissions(t)+" permissions"),n(3),m("text",!0)("rounded",!0),n(),m("text",!0)("rounded",!0)}}function rt(l,r){l&1&&(i(0,"tr")(1,"td",36)(2,"div",37),u(3,"i",38),i(4,"span",39),p(5,"Aucun r\xF4le trouv\xE9"),s()()()())}function it(l,r){if(l&1){let t=U();i(0,"p-button",40),c("click",function(){P(t);let o=f();return b(o.createDialog=!1)}),s(),i(1,"p-button",41),c("click",function(){P(t);let o=f();return b(o.createRole())}),s()}if(l&2){let t=f();m("text",!0)("disabled",t.creating),n(),m("disabled",t.creating||!t.newRoleName.trim())("loading",t.creating)}}var Z=class l{constructor(r,t,e,o){this.roleService=r;this.messageService=t;this.confirmationService=e;this.router=o}roles=ne([]);loading=!1;createDialog=!1;newRoleName="";creating=!1;dt;ngOnInit(){this.loadRoles()}loadRoles(){this.loading=!0,this.roleService.getRoles().subscribe({next:r=>{let t=r?.data,e=Array.isArray(t)?t:Array.isArray(t?.roles)?t.roles:Array.isArray(t?.data)?t.data:[];this.roles.set(e.map(o=>this.normalizeRoleItem(o))),this.loading=!1},error:r=>{this.messageService.add({severity:"error",summary:"Erreur",detail:r?.error?.message||"Impossible de charger les r\xF4les",life:5e3}),this.loading=!1}})}countPermissions(r){return r.modules.reduce((t,e)=>t+je.filter(o=>e.permissions[o]).length,0)}onFilterGlobal(r){let t=r.target;t&&this.dt.filterGlobal(t.value,"contains")}openCreateDialog(){this.newRoleName="",this.createDialog=!0}createRole(){!this.newRoleName.trim()||this.creating||(this.creating=!0,this.roleService.createRole({name:this.newRoleName.trim()}).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"R\xF4le cr\xE9\xE9 avec succ\xE8s",life:3e3}),this.createDialog=!1,this.creating=!1,this.loadRoles()},error:r=>{this.messageService.add({severity:"error",summary:"Erreur",detail:r?.error?.message||"Impossible de cr\xE9er le r\xF4le",life:5e3}),this.creating=!1}}))}editRole(r){this.router.navigate(["/roles/edit",r.role.id])}deleteRole(r){if(r.role.name==="admin"){this.messageService.add({severity:"warn",summary:"Attention",detail:"Le r\xF4le admin ne peut pas \xEAtre supprim\xE9",life:3e3});return}this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir supprimer le r\xF4le "${r.role.name}" ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.roleService.deleteRole(r.role.id).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"R\xF4le supprim\xE9",life:3e3}),this.loadRoles()},error:t=>{this.messageService.add({severity:"error",summary:"Erreur",detail:t?.error?.message||"Impossible de supprimer le r\xF4le",life:5e3})}})}})}formatDate(r){return r?new Date(r).toLocaleDateString("fr-FR"):""}normalizeRoleItem(r){if(r?.role&&Array.isArray(r?.modules))return r;let t={id:Number(r?.id??0),name:String(r?.name??""),created_at:String(r?.created_at??"")},e=Array.isArray(r?.permissions)?r.permissions.map(d=>typeof d=="string"?d:d?.name).filter(d=>typeof d=="string"&&d.includes(".")):[],o=new Map;e.forEach(d=>{let[k,se]=d.split(".");!k||!se||(o.has(k)||o.set(k,new Set),o.get(k)?.add(se))});let a=Array.from(o.entries()).map(([d,k])=>({module:d,permissions:{create:k.has("create"),read:k.has("read"),update:k.has("update"),delete:k.has("delete")}}));return{role:t,modules:a}}static \u0275fac=function(t){return new(t||l)(h(Ve),h(w),h(O),h(fe))};static \u0275cmp=M({type:l,selectors:[["app-parametres-roles-permissions"]],viewQuery:function(t,e){if(t&1&&le(Xe,5),t&2){let o;me(o=pe())&&(e.dt=o.first)}},features:[D([O])],decls:26,vars:22,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],["footer",""],[1,"flex","flex-col","gap-6"],[1,"flex","flex-col","md:flex-row","md:items-start","md:justify-between","mb-4"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-semibold","mb-4","md:mb-0"],[1,"inline-flex","items-center","gap-2"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Rechercher...",1,"w-full",3,"input"],["icon","pi pi-plus","rounded","","pTooltip","Ajouter un r\xF4le",3,"click"],["responsiveLayout","scroll","dataKey","role.id",3,"value","paginator","rows","globalFilterFields","rowHover","loading","showCurrentPageReport","rowsPerPageOptions"],["header","Nouveau r\xF4le",3,"visibleChange","visible","modal"],[1,"flex","flex-col","gap-4","pt-2"],["for","roleName",1,"block","font-bold","mb-2"],["pInputText","","id","roleName","placeholder","Ex: editeur, manager...",1,"w-full",3,"ngModelChange","keydown.enter","ngModel"],["pSortableColumn","role.name"],[1,"flex","items-center","gap-2"],["field","role.name"],["pSortableColumn","role.created_at"],["field","role.created_at"],[1,"text-center"],[1,"flex","items-center","justify-center","gap-2"],[2,"width","8rem"],[2,"min-width","10rem"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","justify-center","w-9","h-9","rounded-lg","text-sm","flex-shrink-0"],[1,"pi","pi-shield"],[1,"font-semibold","text-surface-800","dark:text-surface-100","capitalize"],[1,"text-surface-500",2,"min-width","8rem"],[1,"text-center",2,"min-width","8rem"],["severity","info",3,"value"],[1,"flex","items-center","justify-end","gap-1"],["icon","pi pi-trash","severity","danger","pTooltip","Supprimer",3,"click","text","rounded"],["icon","pi pi-pencil","severity","secondary","pTooltip","Modifier",3,"click","text","rounded"],["colspan","4"],[1,"flex","flex-col","items-center","gap-3","py-12","text-surface-300"],[1,"pi","pi-shield","text-4xl"],[1,"text-sm"],["label","Annuler","icon","pi pi-times",3,"click","text","disabled"],["label","Cr\xE9er","icon","pi pi-check",3,"click","disabled","loading"]],template:function(t,e){if(t&1){let o=U();i(0,"div",5)(1,"div",6)(2,"div",7),p(3," R\xF4les & Permissions "),s(),i(4,"div",8)(5,"p-iconfield"),u(6,"p-inputicon",9),i(7,"input",10),c("input",function(d){return P(o),b(e.onFilterGlobal(d))}),s()(),i(8,"p-button",11),c("click",function(){return P(o),b(e.openCreateDialog())}),s()()(),i(9,"p-table",12,0),y(11,et,13,0,"ng-template",null,1,j)(13,tt,15,11,"ng-template",null,2,j)(15,rt,6,0,"ng-template",null,3,j),s()(),i(17,"p-dialog",13),_("visibleChange",function(d){return P(o),v(e.createDialog,d)||(e.createDialog=d),b(d)}),i(18,"div",14)(19,"div")(20,"label",15),p(21,"Nom du r\xF4le"),s(),i(22,"input",16),_("ngModelChange",function(d){return P(o),v(e.newRoleName,d)||(e.newRoleName=d),b(d)}),c("keydown.enter",function(){return P(o),b(e.createRole())}),s()()(),y(23,it,2,4,"ng-template",null,4,j),s(),u(25,"p-confirmdialog")}t&2&&(n(7),B(N(17,Ye)),n(2),m("value",e.roles())("paginator",!0)("rows",5)("globalFilterFields",N(18,Ze))("rowHover",!0)("loading",e.loading)("showCurrentPageReport",!1)("rowsPerPageOptions",N(19,$e)),n(8),B(N(20,Be)),g("visible",e.createDialog),m("modal",!0),n(5),g("ngModel",e.newRoleName),n(3),B(N(21,Be)))},dependencies:[S,I,W,E,R,ke,be,Me,Se,A,T,L,F,Re,Ee,Te,Ie,xe,ye,he,_e,De,Ae,Pe,we],encapsulation:2})};function at(l,r){l&1&&u(0,"app-parametres-profile")}function st(l,r){l&1&&u(0,"app-parametres-auth")}function ot(l,r){l&1&&u(0,"app-parametres-packing")}function nt(l,r){l&1&&u(0,"app-parametres-roles-permissions")}var V=class l{activeSection="profile";setActiveSection(r){this.activeSection=r}onSectionClick(r,t){r.preventDefault(),r.stopPropagation(),this.setActiveSection(t)}isActive(r){return this.activeSection===r}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=M({type:l,selectors:[["app-parametres-liste"]],features:[D([w])],decls:36,vars:12,consts:[[1,"rounded-t-3xl","bg-surface-0","dark:bg-surface-900","flex-auto","py-6","lg:py-8","px-8","lg:px-20"],[1,"flex","flex-col","w-full","pb-8","gap-2"],[1,"mt-0","text-surface-900","dark:text-surface-0","font-medium","text-2xl","leading-tight"],[1,"mt-0","text-surface-500","dark:text-surface-300","leading-tight"],[1,"grid","grid-cols-12","gap-4","py-6","lg:py-8"],[1,"col-span-12","lg:col-span-2"],[1,"list-none","m-0","p-0","hidden","lg:flex","flex-col","justify-start"],[1,"-ml-[2px]",3,"ngClass"],["href","#",1,"w-full","text-left","flex","items-center","py-3","px-4","font-medium","transition-colors","hover:text-primary",3,"click","ngClass"],[1,"pi","pi-user","mr-2","text-base!","leading-normal!"],[1,"pi","pi-lock","mr-2","text-base!","leading-normal!"],[1,"pi","pi-cog","mr-2","text-base!","leading-normal!"],[1,"pi","pi-shield","mr-2","text-base!","leading-normal!"],[1,"col-span-12","lg:col-span-10","xl:col-span-10","bg-surface-0","dark:bg-surface-900","p-8","rounded-2xl","flex-auto"],[4,"ngIf"]],template:function(t,e){t&1&&(u(0,"p-toast"),i(1,"div",0)(2,"div",1)(3,"h2",2),p(4,"Parametres"),s(),i(5,"p",3),p(6,"Gestion des parametres de l'application"),s()(),u(7,"p-divider"),i(8,"div",4)(9,"div",5)(10,"ul",6)(11,"li",7)(12,"a",8),c("click",function(a){return e.onSectionClick(a,"profile")}),u(13,"i",9),i(14,"span"),p(15,"Profile"),s()()(),i(16,"li",7)(17,"a",8),c("click",function(a){return e.onSectionClick(a,"auth")}),u(18,"i",10),i(19,"span"),p(20,"Authentification"),s()()(),i(21,"li",7)(22,"a",8),c("click",function(a){return e.onSectionClick(a,"packing")}),u(23,"i",11),i(24,"span"),p(25,"Packing"),s()()(),i(26,"li",7)(27,"a",8),c("click",function(a){return e.onSectionClick(a,"roles")}),u(28,"i",12),i(29,"span"),p(30,"R\xF4les & Permissions"),s()()()()(),i(31,"div",13),y(32,at,1,0,"app-parametres-profile",14)(33,st,1,0,"app-parametres-auth",14)(34,ot,1,0,"app-parametres-packing",14)(35,nt,1,0,"app-parametres-roles-permissions",14),s()()()),t&2&&(n(11),m("ngClass",e.isActive("profile")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),n(),m("ngClass",e.isActive("profile")?"text-primary":"text-surface-700 dark:text-surface-200"),n(4),m("ngClass",e.isActive("auth")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),n(),m("ngClass",e.isActive("auth")?"text-primary":"text-surface-700 dark:text-surface-200"),n(4),m("ngClass",e.isActive("packing")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),n(),m("ngClass",e.isActive("packing")?"text-primary":"text-surface-700 dark:text-surface-200"),n(4),m("ngClass",e.isActive("roles")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),n(),m("ngClass",e.isActive("roles")?"text-primary":"text-surface-700 dark:text-surface-200"),n(5),m("ngIf",e.isActive("profile")),n(),m("ngIf",e.isActive("auth")),n(),m("ngIf",e.isActive("packing")),n(),m("ngIf",e.isActive("roles")))},dependencies:[S,ce,C,Y,z,We,Q,Ce,q,G,X,Z],encapsulation:2})};var xr=[{path:"",component:V,data:{breadcrumb:"Param\xE8tres"}},{path:"parametres",component:V,data:{breadcrumb:"Param\xE8tres"}}];export{xr as default};
