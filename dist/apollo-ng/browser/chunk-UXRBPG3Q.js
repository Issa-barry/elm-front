import{a as $e,b as et,c as tt,d as it,e as nt}from"./chunk-QCC7THWH.js";import{a as Je,b as Xe}from"./chunk-E33UJ4ID.js";import"./chunk-FNQY6KT7.js";import{a as X}from"./chunk-WR5FPTVZ.js";import{a as le,b as Ze}from"./chunk-JFBSWTEJ.js";import{a as D}from"./chunk-IUCT6ZC4.js";import{a as Qe}from"./chunk-RBVPKEFY.js";import{a as Ve,b as Ae}from"./chunk-Q54L3CHG.js";import{a as Ge,b as Ye}from"./chunk-KMRV2N6M.js";import"./chunk-H4KISS4Y.js";import{a as Ne,d as Be,e as je,f as ze,k as qe}from"./chunk-FAOFKJXD.js";import"./chunk-3QIGOFE4.js";import{a as We}from"./chunk-VY5FRMVP.js";import"./chunk-VA5GRZBG.js";import"./chunk-OXRSOWZ3.js";import"./chunk-SXELAHNQ.js";import"./chunk-FI2CF337.js";import{a as Ke,b as He}from"./chunk-VSQCQ24J.js";import"./chunk-V7GDW42M.js";import"./chunk-STL3P7XI.js";import"./chunk-KNGMUWFG.js";import"./chunk-OTOT72YN.js";import"./chunk-6U2WNUGO.js";import{a as Z,b as J}from"./chunk-HF32A2CA.js";import"./chunk-FTQB7FTX.js";import"./chunk-44T26ZS7.js";import{a as Y}from"./chunk-PH5LLDEG.js";import{a as se,b as Re}from"./chunk-AYOHQ7P3.js";import"./chunk-YMFRS67F.js";import"./chunk-IFIPOOEL.js";import"./chunk-4TQIXGP4.js";import{b as Te,d as O}from"./chunk-VQUDGCBD.js";import"./chunk-S2XX7DX2.js";import{a as U,d as Me}from"./chunk-NORXBCZV.js";import{c as H,e as G}from"./chunk-T3MKQJWS.js";import"./chunk-4FGKRRQA.js";import{c as Q,d as Le}from"./chunk-R3ZMZYQP.js";import"./chunk-XSJCRAZB.js";import"./chunk-GYVBNXO5.js";import"./chunk-OSUQ7URW.js";import"./chunk-VWZJRGWP.js";import"./chunk-7N4JNZOK.js";import{a as Ie,c as Fe}from"./chunk-2HOTGEAR.js";import{a as z,b as ke}from"./chunk-AZ5YUZOD.js";import{b as W,e as N,h as B,p as j}from"./chunk-M7MSZX5F.js";import{a as Oe,b as De}from"./chunk-NNASGCWH.js";import"./chunk-WQPC23GX.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as q,j as K}from"./chunk-RUBANO5L.js";import"./chunk-F23BEZGE.js";import{la as A,pa as S,ta as Pe}from"./chunk-LL554BBV.js";import{j as Ue,k as F,v as T}from"./chunk-4WY7URSD.js";import"./chunk-4O3FVBGX.js";import{$b as d,Ab as r,Bb as _,Fb as ve,Gb as ye,Ib as C,Ka as ne,Ma as be,Mb as u,Nb as c,Oa as l,S as ge,Ta as re,W as _e,Wb as L,Yb as xe,Za as x,Zb as Ce,_b as we,aa as f,ac as w,ba as h,bc as E,cb as M,cc as Ee,ec as b,fa as fe,fc as v,gc as y,hc as Se,ib as m,ic as I,jc as V,na as he,tc as ae,vc as oe,xc as k,yb as p,zb as a}from"./chunk-VV6362ZN.js";import{a as ce,b as ue}from"./chunk-GAL4ENT6.js";var P=class n{constructor(i){this.http=i}apiUrl=`${se.apiUrl}/users`;authUrl=`${se.apiUrl}/auth`;createUser(i){return this.http.post(`${this.authUrl}/register`,i)}getUsers(i){let t=new U;return i&&(i.is_active!==void 0&&(t=t.set("is_active",i.is_active.toString())),i.search&&(t=t.set("search",i.search)),i.pays&&(t=t.set("pays",i.pays)),i.ville&&(t=t.set("ville",i.ville)),i.sort_by&&(t=t.set("sort_by",i.sort_by)),i.sort_order&&(t=t.set("sort_order",i.sort_order)),i.per_page&&(t=t.set("per_page",i.per_page.toString())),i.page&&(t=t.set("page",i.page.toString()))),this.http.get(this.apiUrl,{params:t})}getUser(i){return this.http.get(`${this.apiUrl}/${i}`)}updateUser(i,t){return this.http.put(`${this.apiUrl}/${i}`,t)}toggleUserStatus(i){return this.http.patch(`${this.apiUrl}/${i}/toggle-status`,{})}deleteUser(i){return this.http.delete(`${this.apiUrl}/${i}`)}searchUsers(i){let t=new U().set("search",i);return this.http.get(this.apiUrl,{params:t})}getActiveUsers(){let i=new U().set("is_active","true");return this.http.get(this.apiUrl,{params:i})}getInactiveUsers(){let i=new U().set("is_active","false");return this.http.get(this.apiUrl,{params:i})}getUsersByCountry(i){let t=new U().set("pays",i);return this.http.get(this.apiUrl,{params:t})}getUsersByCity(i){let t=new U().set("ville",i);return this.http.get(this.apiUrl,{params:t})}getUsersPaginated(i=1,t=10,e){let o=new U().set("page",i.toString()).set("per_page",t.toString());return e&&(e.is_active!==void 0&&(o=o.set("is_active",e.is_active.toString())),e.search&&(o=o.set("search",e.search)),e.pays&&(o=o.set("pays",e.pays)),e.ville&&(o=o.set("ville",e.ville)),e.sort_by&&(o=o.set("sort_by",e.sort_by)),e.sort_order&&(o=o.set("sort_order",e.sort_order))),this.http.get(this.apiUrl,{params:o})}sortUsers(i,t="asc"){let e=new U().set("sort_by",i||"created_at").set("sort_order",t);return this.http.get(this.apiUrl,{params:e})}static \u0275fac=function(t){return new(t||n)(_e(Me))};static \u0275prov=ge({token:n,factory:n.\u0275fac,providedIn:"root"})};var ct=()=>[10,25,50],ut=()=>["nom_complet","email","phone","reference","pays","ville"],gt=()=>({"min-width":"150px"});function _t(n,i){if(n&1){let t=C();a(0,"button",37),u("click",function(o){f(t);let s=c().$implicit,g=c(2);return o.stopPropagation(),h(g.deleteUser(o,s.id))}),r()}n&2&&p("pTooltip","Supprimer")}function ft(n,i){if(n&1){let t=C();a(0,"article",27),u("click",function(o){let s=f(t).$implicit,g=c(2);return h(g.goToEdit(o,s.id))}),a(1,"div",28),d(2),r(),a(3,"div",29)(4,"div",30),d(5),r(),a(6,"div",31),d(7),ae(8,"phoneFormat"),r(),a(9,"div",32),_(10,"p-tag",33),a(11,"div",34)(12,"button",35),u("click",function(o){let s=f(t).$implicit,g=c(2);return h(g.goToEdit(o,s.id))}),r(),m(13,_t,1,1,"button",36),r()()()()}if(n&2){let t=i.$implicit,e=c(2);l(2),E(" ",e.getInitials(t.nom_complet)," "),l(3),w(t.nom_complet),l(2),w(t.email||oe(8,8,t.phone,"INT")),l(3),p("value",t.is_active?"Actif":"Inactif")("severity",t.is_active?"success":"danger"),l(2),p("pTooltip",e.canUpdate?"Modifier":"Voir")("disabled",!e.canUpdate),l(),p("ngIf",e.canDelete)}}function ht(n,i){if(n&1&&(a(0,"section",25),m(1,ft,14,11,"article",26),r()),n&2){let t=c();l(),p("ngForOf",t.mobileVisibleUsers)("ngForTrackBy",t.trackByUserId)}}function bt(n,i){n&1&&(a(0,"div",39),d(1,"Chargement..."),r())}function vt(n,i){n&1&&(a(0,"div",39),d(1,"Aucun utilisateur."),r())}function yt(n,i){if(n&1&&m(0,bt,2,0,"div",38)(1,vt,2,0,"div",38),n&2){let t=c();p("ngIf",t.loading),l(),p("ngIf",!t.loading&&!t.mobileFilteredUsers.length)}}function xt(n,i){if(n&1){let t=C();a(0,"div",40)(1,"button",41),u("click",function(){f(t);let o=c();return h(o.loadMoreMobile())}),r()()}}function Ct(n,i){if(n&1){let t=C();a(0,"button",42),u("click",function(){f(t);let o=c();return h(o.navigateToCreate())}),_(1,"i",43),r()}}function wt(n,i){if(n&1){let t=C();a(0,"button",50),u("click",function(){f(t);let o=c(2);return h(o.navigateToCreate())}),r()}}function Et(n,i){if(n&1){let t=C();a(0,"div",44)(1,"p-icon-field",45),_(2,"p-inputicon",18),a(3,"input",46),u("input",function(o){f(t);let s=c(),g=L(24);return h(s.onGlobalFilter(g,o))}),r()(),a(4,"div",47)(5,"p-select",48),y("ngModelChange",function(o){f(t);let s=c();return v(s.selectedStatus,o)||(s.selectedStatus=o),h(o)}),u("onChange",function(){f(t);let o=c();return h(o.filterByStatus())}),r(),m(6,wt,1,0,"button",49),r()()}if(n&2){let t=c();l(5),Ce(V(6,gt)),p("options",t.statusOptions),b("ngModel",t.selectedStatus),p("showClear",!0),l(),p("ngIf",t.canCreate)}}function St(n,i){n&1&&(a(0,"tr")(1,"th",51)(2,"span",52),d(3," Nom complet "),_(4,"p-sortIcon",53),r()(),a(5,"th",54)(6,"span",52),d(7," T\xE9l\xE9phone "),_(8,"p-sortIcon",55),r()(),a(9,"th",56)(10,"span",52),d(11," R\xF4le "),r()(),a(12,"th",57)(13,"span",52),d(14," Adresse "),_(15,"p-sortIcon",58),r()(),a(16,"th",59)(17,"span",52),d(18," Statut "),_(19,"p-sortIcon",60),r()(),a(20,"th",61),d(21," Actions "),r()())}function Ut(n,i){if(n&1&&_(0,"p-tag",75),n&2){let t=i.$implicit,e=c(3);p("value",t)("severity",e.getRoleSeverity(t))}}function Mt(n,i){if(n&1&&(ve(0),m(1,Ut,1,2,"p-tag",74),ye()),n&2){let t=c().$implicit;l(),p("ngForOf",t.role_names||t.roles)}}function Tt(n,i){n&1&&(a(0,"span",76),d(1,"-"),r())}function Pt(n,i){if(n&1){let t=C();a(0,"button",77),u("click",function(o){f(t);let s=c().$implicit,g=c();return h(g.toggleStatus(o,s.id))}),r()}if(n&2){let t=c().$implicit;xe("p-button-success",t.is_active)("p-button-danger",!t.is_active),p("icon",t.is_active?"pi pi-lock-open":"pi pi-lock")("pTooltip",t.is_active?"D\xE9sactiver":"Activer")}}function kt(n,i){if(n&1){let t=C();a(0,"button",37),u("click",function(o){f(t);let s=c().$implicit,g=c();return h(g.deleteUser(o,s.id))}),r()}n&2&&p("pTooltip","Supprimer")}function It(n,i){if(n&1){let t=C();a(0,"tr",62)(1,"td")(2,"div",52)(3,"div",63),d(4),r(),a(5,"div")(6,"div",64),d(7),r(),a(8,"div",65),d(9),r()()()(),a(10,"td")(11,"div",66)(12,"span",67),d(13),ae(14,"phoneFormat"),r()()(),a(15,"td"),m(16,Mt,2,1,"ng-container",68)(17,Tt,2,0,"ng-template",null,7,k),r(),a(19,"td")(20,"div",52),_(21,"span"),a(22,"div")(23,"div",69),d(24),r(),a(25,"div",70),d(26),r()()()(),a(27,"td"),_(28,"p-tag",71),r(),a(29,"td")(30,"div",72)(31,"button",35),u("click",function(o){let s=f(t).$implicit,g=c();return h(g.goToEdit(o,s.id))}),r(),m(32,Pt,1,6,"button",73)(33,kt,1,1,"button",36),r()()()}if(n&2){let t=i.$implicit,e=L(18),o=c();p("pSelectableRow",t),l(4),E(" ",o.getInitials(t.nom_complet)," "),l(3),w(t.nom_complet),l(2),w(t.reference),l(4),w(oe(14,18,t.phone,"INT")),l(3),p("ngIf",(t.role_names==null?null:t.role_names.length)||(t.roles==null?null:t.roles.length))("ngIfElse",e),l(5),we(Se("fi fi-",t.code_pays==null?null:t.code_pays.toLowerCase()," text-xl")),l(3),w(t.ville),l(2),w(t.quartier),l(2),p("value",t.is_active?"Actif":"Inactif")("severity",t.is_active?"success":"danger"),l(3),p("pTooltip",o.canUpdate?"Modifier":"Voir")("disabled",!o.canUpdate),l(),p("ngIf",o.canUpdate),l(),p("ngIf",o.canDelete)}}function Ft(n,i){n&1&&(a(0,"tr")(1,"td",78)(2,"div",79),_(3,"i",80),a(4,"span"),d(5,"Aucun utilisateur trouv\xE9"),r()()()())}var ee=class n{constructor(i,t,e,o,s,g){this.userService=i;this.router=t;this.messageService=e;this.confirmationService=o;this.authService=s;this.document=g;this.canCreate=this.authService.hasPermission("users.create"),this.canUpdate=this.authService.hasPermission("users.update"),this.canDelete=this.authService.hasPermission("users.delete")}users=[];selectedUser=null;loading=!1;selectedStatus=null;mobileSearchTerm="";mobilePageSize=10;mobileVisibleCount=this.mobilePageSize;mobileBreakpoint=768;mobilePwaClass="utilisateurs-mobile-pwa";statusOptions=[{label:"Actif",value:!0},{label:"Inactif",value:!1}];mobileStatusMenuItems=[{label:"Tous les statuts",command:()=>this.applyMobileStatusFilter(null)},{label:"Actif",command:()=>this.applyMobileStatusFilter(!0)},{label:"Inactif",command:()=>this.applyMobileStatusFilter(!1)}];canCreate=!1;canUpdate=!1;canDelete=!1;ngOnInit(){this.loadUsers(),this.syncMobilePwaMode()}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onWindowResize(){this.syncMobilePwaMode()}goHome(){this.router.navigate(["/"])}onMobileSearchChange(){this.mobileVisibleCount=this.mobilePageSize}get mobileFilteredUsers(){let i=this.mobileSearchTerm.trim().toLowerCase();return i?this.users.filter(t=>t.nom_complet&&t.nom_complet.toLowerCase().includes(i)||t.email&&t.email.toLowerCase().includes(i)||t.phone&&t.phone.replace(/\s/g,"").includes(i)||t.reference&&t.reference.toLowerCase().includes(i)):this.users}get mobileVisibleUsers(){return this.mobileFilteredUsers.slice(0,this.mobileVisibleCount)}get canLoadMoreMobile(){return this.mobileVisibleCount<this.mobileFilteredUsers.length}loadMoreMobile(){this.mobileVisibleCount+=this.mobilePageSize}trackByUserId(i,t){return t.id}syncMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}loadUsers(){this.loading=!0;let i=this.selectedStatus!==null?{is_active:this.selectedStatus}:void 0;this.userService.getUsers(i).subscribe({next:t=>{t.success&&(this.users=Array.isArray(t.data)?t.data:t.data.data,this.mobileVisibleCount=this.mobilePageSize),this.loading=!1},error:t=>{console.error("Erreur lors du chargement des utilisateurs:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les utilisateurs"}),this.loading=!1}})}onGlobalFilter(i,t){i.filterGlobal(t.target.value,"contains")}filterByStatus(){this.loadUsers()}applyMobileStatusFilter(i){this.selectedStatus=i,this.loadUsers()}navigateToCreate(){this.router.navigate(["contacts/utilisateurs/new"])}onRowSelect(i){this.router.navigate(["contacts/utilisateurs/edit",i.data.id])}goToEdit(i,t){i.stopPropagation(),this.router.navigate(["contacts/utilisateurs/edit/",t])}toggleStatus(i,t){i.stopPropagation();let o=this.users.find(s=>s.id===t)?.is_active?"d\xE9sactiver":"activer";this.confirmationService.confirm({message:`Voulez-vous vraiment ${o} cet utilisateur ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui",rejectLabel:"Non",accept:()=>{this.userService.toggleUserStatus(t).subscribe({next:s=>{s.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:s.message}),this.loadUsers())},error:s=>{console.error("Erreur:",s),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de changer le statut de l'utilisateur"})}})}})}deleteUser(i,t){i.stopPropagation(),this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer cet utilisateur ? Cette action est irr\xE9versible.",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, supprimer",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.userService.deleteUser(t).subscribe({next:e=>{e.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur supprim\xE9 avec succ\xE8s"}),this.loadUsers())},error:e=>{console.error("Erreur:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'utilisateur"})}})}})}getInitials(i){if(!i)return"??";let t=i.trim().split(" ");return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():i.substring(0,2).toUpperCase()}getRoleSeverity(i){return{admin:"danger",manager:"warn",employe:"info",superviseur:"success"}[i?.toLowerCase()]||"secondary"}static \u0275fac=function(t){return new(t||n)(x(P),x(O),x(S),x(A),x(Re),x(fe))};static \u0275cmp=M({type:n,selectors:[["app-utilisateurs-liste"]],hostBindings:function(t,e){t&1&&u("resize",function(){return e.onWindowResize()},be)},features:[I([S,A])],decls:33,vars:20,consts:[["statusMenu",""],["mobileListState",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["noRole",""],[1,"utilisateurs-mobile-app"],[1,"mobile-header"],["pButton","","pRipple","","icon","pi pi-arrow-left","aria-label","Retour \xE0 l'accueil",1,"p-button-rounded","p-button-text","mobile-back",3,"click"],[1,"mobile-title-wrap"],[1,"mobile-title"],[1,"mobile-subtitle"],["appendTo","body","styleClass","mobile-status-menu",3,"model","popup"],["pButton","","pRipple","","icon","pi pi-filter","aria-label","Filtrer par statut",1,"p-button-rounded","p-button-text","mobile-add",3,"click"],[1,"mobile-scroll"],[1,"mobile-search"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Nom, email, t\xE9l\xE9phone...",1,"w-full",3,"ngModelChange","ngModel"],["class","mobile-list",4,"ngIf","ngIfElse"],["class","mobile-load-more",4,"ngIf"],["type","button","class","mobile-fab","aria-label","Nouveau utilisateur",3,"click",4,"ngIf"],[1,"card","utilisateurs-desktop"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","  {first} / {last} de {totalRecords} entr\xE9es","selectionMode","single","styleClass","cursor-pointer",3,"selectionChange","onRowSelect","value","paginator","rows","showCurrentPageReport","loading","rowsPerPageOptions","globalFilterFields","selection","rowHover"],[1,"mobile-list"],["class","mobile-user-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mobile-user-card",3,"click"],["aria-hidden","true",1,"mobile-card-avatar"],[1,"mobile-card-body"],[1,"mobile-card-name"],[1,"mobile-card-meta"],[1,"mobile-card-footer"],["styleClass","mobile-status-tag",3,"value","severity"],[1,"mobile-card-actions"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","pTooltip","disabled"],["pButton","","pRipple","","icon","pi pi-trash","class","p-button-rounded p-button-text p-button-danger p-button-sm","tooltipPosition","top",3,"pTooltip","click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-danger","p-button-sm",3,"click","pTooltip"],["class","mobile-state",4,"ngIf"],[1,"mobile-state"],[1,"mobile-load-more"],["pButton","","label","Charger plus","icon","pi pi-angle-down",1,"mobile-load-more-btn",3,"click"],["type","button","aria-label","Nouveau utilisateur",1,"mobile-fab",3,"click"],[1,"pi","pi-user-plus"],[1,"flex","flex-wrap","gap-2","items-center","justify-between"],[1,"w-full","sm:w-80","order-1","sm:order-0"],["pInputText","","type","text","placeholder","Rechercher un utilisateur...",1,"w-full",3,"input"],[1,"flex","gap-2","w-full","sm:w-auto","flex-order-0","sm:flex-order-1"],["placeholder","Tous les statuts",3,"ngModelChange","onChange","options","ngModel","showClear"],["pButton","","outlined","","class","flex-shrink-0","icon","pi pi-user-plus","label","Nouveau",3,"click",4,"ngIf"],["pButton","","outlined","","icon","pi pi-user-plus","label","Nouveau",1,"flex-shrink-0",3,"click"],["pSortableColumn","nom_complet",1,"white-space-nowrap",2,"width","25%"],[1,"flex","items-center","gap-2"],["field","nom_complet"],["pSortableColumn","phone",1,"white-space-nowrap",2,"width","15%"],["field","phone"],[1,"white-space-nowrap",2,"width","12%"],["pSortableColumn","pays",1,"white-space-nowrap",2,"width","18%"],["field","pays"],["pSortableColumn","is_active",1,"white-space-nowrap",2,"width","10%"],["field","is_active"],[1,"white-space-nowrap",2,"width","10%"],[3,"pSelectableRow"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary-100","text-primary-700","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-surface-500","mt-1"],[1,"flex","items-center","gap-1"],[1,"text-surface-700"],[4,"ngIf","ngIfElse"],[1,"font-medium"],[1,"text-sm","text-surface-500"],[3,"value","severity"],[1,"flex","gap-2"],["pButton","","pRipple","","class","p-button-rounded p-button-text p-button-sm","tooltipPosition","top",3,"icon","p-button-success","p-button-danger","pTooltip","click",4,"ngIf"],["class","mr-1",3,"value","severity",4,"ngFor","ngForOf"],[1,"mr-1",3,"value","severity"],[1,"text-surface-400"],["pButton","","pRipple","","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","icon","pTooltip"],["colspan","6",1,"text-center","py-8"],[1,"flex","flex-col","items-center","gap-3","text-surface-500"],[1,"pi","pi-users","text-4xl"]],template:function(t,e){if(t&1){let o=C();_(0,"p-confirmDialog"),a(1,"div",8)(2,"header",9)(3,"button",10),u("click",function(){return f(o),h(e.goHome())}),r(),a(4,"div",11)(5,"h1",12),d(6,"Utilisateurs"),r(),a(7,"p",13),d(8),r()(),_(9,"p-menu",14,0),a(11,"button",15),u("click",function(g){f(o);let lt=L(10);return h(lt.toggle(g))}),r()(),a(12,"div",16)(13,"section",17)(14,"p-icon-field"),_(15,"p-inputicon",18),a(16,"input",19),y("ngModelChange",function(g){return f(o),v(e.mobileSearchTerm,g)||(e.mobileSearchTerm=g),h(g)}),u("ngModelChange",function(){return f(o),h(e.onMobileSearchChange())}),r()()(),m(17,ht,2,2,"section",20)(18,yt,2,2,"ng-template",null,1,k)(20,xt,2,0,"div",21),r(),m(21,Ct,2,0,"button",22),r(),a(22,"div",23)(23,"p-table",24,2),y("selectionChange",function(g){return f(o),v(e.selectedUser,g)||(e.selectedUser=g),h(g)}),u("onRowSelect",function(g){return f(o),h(e.onRowSelect(g))}),m(25,Et,7,7,"ng-template",null,3,k)(27,St,22,0,"ng-template",null,4,k)(29,It,34,21,"ng-template",null,5,k)(31,Ft,6,0,"ng-template",null,6,k),r()()}if(t&2){let o=L(19);l(8),Ee("",e.mobileFilteredUsers.length," utilisateur",e.mobileFilteredUsers.length!==1?"s":""),l(),p("model",e.mobileStatusMenuItems)("popup",!0),l(7),b("ngModel",e.mobileSearchTerm),l(),p("ngIf",!e.loading&&e.mobileVisibleUsers.length)("ngIfElse",o),l(3),p("ngIf",!e.loading&&e.canLoadMoreMobile),l(),p("ngIf",e.canCreate),l(2),p("value",e.users)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("loading",e.loading)("rowsPerPageOptions",V(18,ct))("globalFilterFields",V(19,ut)),b("selection",e.selectedUser),p("rowHover",!0)}},dependencies:[T,Ue,F,j,W,N,B,qe,Ne,Be,ze,je,ke,z,G,H,K,q,Ie,Fe,He,Ke,De,Oe,Le,Q,Ye,Ge,Ae,Ve,Qe],styles:["[_nghost-%COMP%]{display:block}.utilisateurs-mobile-app[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 768px){[_nghost-%COMP%]{--mobile-primary: #5f6bff;--mobile-text: #334155;--mobile-muted: #7f8ca3;--mobile-card: #ffffff;--mobile-border: #e2e8f0}.utilisateurs-desktop[_ngcontent-%COMP%]{display:none}.utilisateurs-mobile-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;height:100vh;height:100dvh;overflow:hidden;margin-top:calc(-.25rem - env(safe-area-inset-top));margin-left:-.875rem;margin-right:-.875rem;margin-bottom:calc(-.875rem - env(safe-area-inset-bottom));padding:0 .875rem env(safe-area-inset-bottom);padding-left:calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:#f8fafc;animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.mobile-header[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;gap:.55rem;margin:0 -.875rem;padding:calc(.5rem + env(safe-area-inset-top)) calc(.875rem + env(safe-area-inset-right)) .6rem calc(.875rem + env(safe-area-inset-left));background:var(--mobile-card);border-bottom:1px solid var(--mobile-border);box-shadow:0 1px 3px #0f172a0f;position:sticky;top:0;z-index:30}.mobile-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:.75rem;padding-bottom:calc(4rem + env(safe-area-inset-bottom))}.mobile-back[_ngcontent-%COMP%], .mobile-add[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;flex-shrink:0;color:var(--mobile-primary)!important;background:#5f6bff1a!important}.mobile-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0;text-align:center}.mobile-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--mobile-text)}.mobile-subtitle[_ngcontent-%COMP%]{margin:.15rem 0 0;font-size:.8rem;font-weight:500;color:var(--mobile-muted)}.mobile-search[_ngcontent-%COMP%]{background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.75rem;padding:.4rem .6rem}.mobile-search[_ngcontent-%COMP%]   .p-iconfield[_ngcontent-%COMP%], .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{width:100%}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{border:0;box-shadow:none;background:transparent;font-size:.95rem}.mobile-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem;margin-top:1rem}.mobile-user-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.875rem;background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.875rem;padding:.875rem;box-shadow:0 1px 3px #0000000d;cursor:pointer;transition:box-shadow .2s ease}.mobile-user-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000014}.mobile-card-avatar[_ngcontent-%COMP%]{width:2.75rem;height:2.75rem;min-width:2.75rem;min-height:2.75rem;border-radius:50%;background:linear-gradient(135deg,var(--mobile-primary) 0%,#7c8aff 100%);color:#fff;font-size:.8rem;font-weight:700;display:flex;align-items:center;justify-content:center}.mobile-card-body[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-card-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--mobile-text);line-height:1.3}.mobile-card-meta[_ngcontent-%COMP%]{font-size:.85rem;color:var(--mobile-muted);margin-top:.2rem}.mobile-card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}.mobile-card-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.mobile-card-actions[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{width:2rem;height:2rem}[_nghost-%COMP%]     .mobile-status-tag{font-size:.75rem;padding:.2rem .5rem;border-radius:999px}.mobile-state[_ngcontent-%COMP%]{margin-top:1rem;background:var(--mobile-card);border:1px dashed var(--mobile-border);border-radius:.875rem;padding:1.5rem;text-align:center;color:var(--mobile-muted);font-size:.9rem}.mobile-load-more[_ngcontent-%COMP%]{padding-top:.5rem}.mobile-load-more-btn[_ngcontent-%COMP%]{width:100%;border-radius:999px;font-weight:600}.mobile-fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(1rem + env(safe-area-inset-bottom));right:calc(1rem + env(safe-area-inset-right));z-index:25;width:3.5rem;height:3.5rem;min-width:3.5rem;min-height:3.5rem;padding:0;border:none;border-radius:50%;background:var(--mobile-primary);color:#fff;box-shadow:0 4px 14px #5f6bff66;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.mobile-fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.35rem}.mobile-fab[_ngcontent-%COMP%]:active{transform:scale(.96)}.app-dark   [_nghost-%COMP%]{--mobile-primary: var(--p-primary-400);--mobile-text: var(--p-surface-100);--mobile-muted: var(--p-surface-400);--mobile-card: var(--p-surface-800);--mobile-border: var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .utilisateurs-mobile-app[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .utilisateurs-mobile-app[_ngcontent-%COMP%]{background:var(--p-surface-950)}.app-dark[_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .mobile-user-card[_ngcontent-%COMP%]:active, .app-dark   [_nghost-%COMP%]   .mobile-user-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000040}.app-dark[_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);color:var(--p-surface-400)}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}"]})};var ot={M:"M.",Mme:"Mme",Mlle:"Mlle"},st={cni:"Carte nationale d'identit\xE9",passeport:"Passeport",permis:"Permis de conduire",carte_sejour:"Carte de s\xE9jour"};function Dt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function Rt(n,i){n&1&&(a(0,"small",64),d(1," Type de compte obligatoire. "),r())}function Lt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function Vt(n,i){n&1&&(a(0,"small",64),d(1," R\xF4le obligatoire. "),r())}function At(n,i){if(n&1){let t=C();a(0,"div",8)(1,"label",65),d(2," R\xF4le "),m(3,Lt,2,0,"span",10),r(),a(4,"p-select",66),y("ngModelChange",function(o){f(t);let s=c();return v(s.model.role,o)||(s.model.role=o),h(o)}),r(),m(5,Vt,2,0,"small",10),r()}if(n&2){let t=c();l(3),p("ngIf",t.isEditing),l(),b("ngModel",t.model.role),p("options",t.filteredRoles)("disabled",t.fieldsDisabled)("invalid",t.submitted&&!t.model.role),l(),p("ngIf",t.submitted&&!t.model.role&&t.isEditing)}}function Wt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function Nt(n,i){n&1&&(a(0,"small",64),d(1," Nom obligatoire. "),r())}function Bt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function jt(n,i){n&1&&(a(0,"small",64),d(1," Pr\xE9nom obligatoire. "),r())}function zt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function qt(n,i){if(n&1&&(a(0,"div",67),_(1,"img",68),a(2,"span",69),d(3),r(),a(4,"span"),d(5),r()()),n&2){let t=i.$implicit;l(),p("src",t.flag,ne)("alt",t.name),l(2),w(t.dialCode),l(2),w(t.name)}}function Kt(n,i){if(n&1&&(a(0,"div",67),_(1,"img",68),a(2,"span",69),d(3),r(),a(4,"span"),d(5),r()()),n&2){let t=c().$implicit;l(),p("src",t.flag,ne)("alt",t.name),l(2),w(t.dialCode),l(2),w(t.name)}}function Ht(n,i){if(n&1&&m(0,Kt,6,4,"div",70),n&2){let t=i.$implicit;p("ngIf",t)}}function Gt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function Yt(n,i){n&1&&(a(0,"small",71),d(1," T\xE9l\xE9phone obligatoire. "),r())}function Qt(n,i){if(n&1&&(a(0,"small",71),d(1),r()),n&2){let t=c();l(),E(" ",t.phoneError," ")}}function Zt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function Jt(n,i){n&1&&(a(0,"small",64),d(1," Ville obligatoire. "),r())}function Xt(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function $t(n,i){n&1&&(a(0,"small",64),d(1," Quartier obligatoire. "),r())}function ei(n,i){if(n&1&&(a(0,"small",64),d(1),r()),n&2){let t=c(2);l(),E(" ",t.passwordError," ")}}function ti(n,i){if(n&1){let t=C();a(0,"div",13)(1,"label",72),d(2," Mot de passe "),a(3,"span",64),d(4,"*"),r()(),a(5,"p-password",73),y("ngModelChange",function(o){f(t);let s=c();return v(s.model.password,o)||(s.model.password=o),h(o)}),r(),m(6,ei,2,1,"small",10),r()}if(n&2){let t=c();l(5),b("ngModel",t.model.password),p("toggleMask",!0)("feedback",!0)("invalid",t.submitted&&!!t.passwordError)("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&t.passwordError&&t.isEditing)}}function ii(n,i){n&1&&(a(0,"small",64),d(1," Les mots de passe ne correspondent pas. "),r())}function ni(n,i){if(n&1){let t=C();a(0,"div",13)(1,"label",74),d(2," Confirmer le mot de passe "),a(3,"span",64),d(4,"*"),r()(),a(5,"p-password",75),y("ngModelChange",function(o){f(t);let s=c();return v(s.model.password_confirmation,o)||(s.model.password_confirmation=o),h(o)}),r(),m(6,ii,2,0,"small",10),r()}if(n&2){let t=c();l(5),b("ngModel",t.model.password_confirmation),p("toggleMask",!0)("feedback",!1)("invalid",t.submitted&&t.model.password!==t.model.password_confirmation)("disabled",t.fieldsDisabled),l(),p("ngIf",t.submitted&&t.model.password!==t.model.password_confirmation&&t.isEditing)}}function ri(n,i){n&1&&(a(0,"span",76),d(1," Obligatoire "),r())}function ai(n,i){n&1&&(a(0,"span",77),d(1,"(optionnel)"),r())}function oi(n,i){n&1&&(a(0,"small",78),d(1," Tous les champs ci-dessous sont requis. "),r())}function si(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function li(n,i){if(n&1&&(a(0,"small",79),d(1),r()),n&2){let t=c();l(),E(" ",t.kycErrors.piece_numero," ")}}function pi(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function di(n,i){if(n&1&&(a(0,"small",79),d(1),r()),n&2){let t=c();l(),E(" ",t.kycErrors.piece_pays," ")}}function mi(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function ci(n,i){if(n&1&&(a(0,"small",79),d(1),r()),n&2){let t=c();l(),E(" ",t.kycErrors.piece_delivree_le," ")}}function ui(n,i){n&1&&(a(0,"span",64),d(1,"*"),r())}function gi(n,i){if(n&1&&(a(0,"small",79),d(1),r()),n&2){let t=c();l(),E(" ",t.kycErrors.piece_expire_le," ")}}function _i(n,i){if(n&1&&(a(0,"div",80)(1,"small",81),_(2,"i",82),d(3),r()()),n&2){let t=c();l(3),E(" ",t.kycErrors.dates," ")}}function fi(n,i){if(n&1){let t=C();a(0,"div",83)(1,"div",84)(2,"button",85),u("click",function(){f(t);let o=c();return h(o.onSubmit())}),r(),a(3,"button",86),u("click",function(){f(t);let o=c();return h(o.onCancel())}),r()()()}if(n&2){let t=c();l(2),p("label",t.mode==="create"?"Enregistrer":"Sauvegarder")("loading",t.loading)("disabled",!t.isValid()||t.loading),l(),p("disabled",t.loading)}}var R=class n{constructor(i){this.roleService=i}mode="create";initialData=null;loading=!1;submitForm=new re;cancel=new re;submitted=!1;isEditing=!1;model={};dateNaissanceObj=null;today=new Date;userTypeOptions=[{label:"Staff",value:"staff"},{label:"Client",value:"client"},{label:"Prestataire",value:"prestataire"},{label:"Investisseur",value:"investisseur"}];civiliteOptions=Object.entries(ot).map(([i,t])=>({label:t,value:i}));STAFF_ROLES=["admin","manager","comptable","agent_vente","employe"];availableRoles=[];pieceTypeOptions=Object.entries(st).map(([i,t])=>({label:t,value:i}));phoneError=null;phoneCountry="GN";passwordError=null;kycErrors={};countries=D;ngOnInit(){this.loadRoles(),this.initializeModel()}ngOnChanges(i){if(i.initialData){let t=i.initialData;t.currentValue&&Object.keys(t.currentValue).length>0&&this.initializeModel()}}loadRoles(){this.roleService.getRoles().subscribe({next:i=>{i.success&&(this.availableRoles=i.data.map(t=>({label:t.role.name.charAt(0).toUpperCase()+t.role.name.slice(1),value:t.role.name})))},error:()=>{this.availableRoles=[{label:"Admin",value:"admin"},{label:"Manager",value:"manager"},{label:"Employ\xE9",value:"employe"}]}})}get filteredRoles(){return this.model.type==="staff"?this.availableRoles.filter(i=>this.STAFF_ROLES.includes(i.value)):[]}get isRoleSelectable(){return this.model.type==="staff"}onTypeChange(){this.model.type&&(this.model.type==="staff"?this.model.role=void 0:this.model.role=this.model.type)}get isKycActive(){return!!this.model.piece_type}onPieceTypeChange(){this.model.piece_type?this.submitted&&this.setKycErrors():(this.model.piece_numero=void 0,this.model.piece_pays=void 0,this.model.piece_delivree_le=void 0,this.model.piece_expire_le=void 0,this.kycErrors={})}onKycFieldChange(){this.submitted&&this.isKycActive&&this.setKycErrors()}checkKyc(){if(!this.model.piece_type)return!0;if(!this.model.piece_numero?.trim()||!this.model.piece_pays||!this.model.piece_delivree_le||!this.model.piece_expire_le)return!1;let i=new Date;i.setHours(23,59,59,999);let t=new Date(this.model.piece_delivree_le);return!(t>i||new Date(this.model.piece_expire_le)<=t)}setKycErrors(){if(this.kycErrors={},!!this.model.piece_type){if(this.model.piece_numero?.trim()||(this.kycErrors.piece_numero="Num\xE9ro de pi\xE8ce obligatoire."),this.model.piece_pays||(this.kycErrors.piece_pays="Pays de d\xE9livrance obligatoire."),!this.model.piece_delivree_le)this.kycErrors.piece_delivree_le="Date de d\xE9livrance obligatoire.";else{let i=new Date;i.setHours(23,59,59,999),new Date(this.model.piece_delivree_le)>i&&(this.kycErrors.piece_delivree_le="La date de d\xE9livrance ne peut pas \xEAtre dans le futur.")}if(this.model.piece_expire_le||(this.kycErrors.piece_expire_le="Date d'expiration obligatoire."),this.model.piece_delivree_le&&this.model.piece_expire_le){let i=new Date(this.model.piece_delivree_le);new Date(this.model.piece_expire_le)<=i&&(this.kycErrors.dates="La date d'expiration doit \xEAtre post\xE9rieure \xE0 la date de d\xE9livrance.")}}}initializeModel(){this.initialData?(this.model={nom:this.initialData.nom,prenom:this.initialData.prenom,phone:this.initialData.phone,email:this.initialData.email,pays:this.initialData.pays,code_pays:this.initialData.code_pays,code_phone_pays:this.initialData.code_phone_pays,ville:this.initialData.ville??void 0,quartier:this.initialData.quartier??void 0,type:this.initialData.type,role:this.initialData.role_names?.[0]??this.initialData.roles?.[0],reference:this.initialData.reference,civilite:this.initialData.civilite??void 0,piece_type:this.initialData.piece_type??void 0,piece_numero:this.initialData.piece_numero??void 0,piece_delivree_le:this.initialData.piece_delivree_le??void 0,piece_expire_le:this.initialData.piece_expire_le??void 0,piece_pays:this.initialData.piece_pays??void 0},this.dateNaissanceObj=this.initialData.date_naissance?new Date(this.initialData.date_naissance):null):(this.model={},this.dateNaissanceObj=null),this.mode==="create"&&!this.model.ville?.trim()&&(this.model.ville="Conakry"),this.mode==="create"?this.isEditing=!0:this.mode==="edit"&&this.initialData&&(this.isEditing=!0),this.model.code_pays?this.phoneCountry=this.model.code_pays:this.model.phone&&this.detectPhoneCountry(this.model.phone),this.submitted=!1,this.phoneError=null,this.passwordError=null,this.kycErrors={}}detectPhoneCountry(i){try{let t=le(i);t&&t.country&&(this.phoneCountry=t.country)}catch{}}validatePhone(){if(!this.model.phone?.trim())return this.phoneError="T\xE9l\xE9phone obligatoire.",!1;try{if(!Ze(this.model.phone,this.phoneCountry))return this.phoneError=`Num\xE9ro invalide pour ${this.getCountryName(this.phoneCountry)}.`,!1;let t=le(this.model.phone,this.phoneCountry);return t?(this.model.phone=t.formatInternational(),this.model.code_pays=this.phoneCountry,this.model.pays=this.getCountryName(this.phoneCountry),this.phoneError=null,!0):(this.phoneError="Format de num\xE9ro invalide.",!1)}catch{return this.phoneError="Format de num\xE9ro invalide.",!1}}validatePassword(){if(this.mode==="edit"&&!this.model.password?.trim())return this.passwordError=null,!0;if(this.mode==="create"&&!this.model.password?.trim())return this.passwordError="Mot de passe obligatoire.",!1;let i=this.model.password||"";return i.length<8?(this.passwordError="Le mot de passe doit contenir au moins 8 caract\xE8res.",!1):!/[a-z]/.test(i)||!/[A-Z]/.test(i)?(this.passwordError="Le mot de passe doit contenir des majuscules et des minuscules.",!1):/[0-9]/.test(i)?this.model.password!==this.model.password_confirmation?(this.passwordError="Les mots de passe ne correspondent pas.",!1):(this.passwordError=null,!0):(this.passwordError="Le mot de passe doit contenir au moins un chiffre.",!1)}formatDate(i){return i?i.toISOString().split("T")[0]:null}getCountryName(i){let t=this.countries.find(e=>e.code===i);return t?t.name:i}getSelectedCountryDialCode(){let i=this.countries.find(t=>t.code===this.phoneCountry);return i?i.dialCode:""}onCountryChange(){this.model.phone&&this.validatePhone()}onPhoneInput(){this.submitted&&this.validatePhone()}onPhoneBlur(){this.model.phone?.trim()&&this.validatePhone()}isValid(){return!(!this.model.type||!this.model.role||!!!(this.model.nom?.trim()&&this.model.prenom?.trim()&&this.model.phone?.trim()&&this.model.ville?.trim()&&this.model.quartier?.trim())||!this.validatePhone()||this.mode==="create"&&!this.validatePassword()||!this.checkKyc())}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.phoneError=null,this.passwordError=null,this.kycErrors={},this.initializeModel()}onSubmit(){this.submitted=!0,this.setKycErrors(),this.isValid()&&this.submitForm.emit(ue(ce({},this.model),{date_naissance:this.formatDate(this.dateNaissanceObj)??void 0}))}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}get formTitle(){if(this.mode==="create")return"Cr\xE9er un compte utilisateur";let i=this.model.reference?.trim();return i?`Modification compte utilisateur : ${i}`:"Modification compte utilisateur"}static \u0275fac=function(t){return new(t||n)(x(X))};static \u0275cmp=M({type:n,selectors:[["app-utilisateurs-form"]],inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[he],decls:114,vars:81,consts:[[1,"card","utilisateurs-form-card"],[1,"flex","justify-between","items-center","mb-6","utilisateurs-form-title"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2","utilisateurs-form-sidebar"],[1,"text-surface-900","dark:text-surface-0","font-medium","text-xl","mb-4"],[1,"m-0","p-0","text-surface-600","dark:text-surface-200","leading-normal","mr-4"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12","md:col-span-12"],["for","type",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","onChange","ngModel","options","disabled","invalid"],["class","mb-6 col-span-12 md:col-span-12",4,"ngIf"],[1,"mb-6","col-span-12","md:col-span-6"],["for","email",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","email","type","email","pInputText","","fluid","","placeholder","exemple@email.com",3,"ngModelChange","ngModel","disabled"],[1,"mb-6","col-span-12","md:col-span-3"],["for","civilite",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","civilite","optionLabel","label","optionValue","value","placeholder","\u2014","fluid","",3,"ngModelChange","ngModel","options","disabled","showClear"],["for","date_naissance",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","date_naissance","dateFormat","dd/mm/yy","placeholder","jj/mm/aaaa","fluid","",3,"ngModelChange","ngModel","showIcon","disabled","maxDate"],["for","nom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","prenom",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prenom","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],[1,"mb-6","col-span-12"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-4"],["for","codePays",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","codePays","optionLabel","name","optionValue","code","placeholder","S\xE9lectionner un pays","fluid","",3,"ngModelChange","onCountryChange","ngModel","options","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"col-span-12","md:col-span-8"],["for","phone",1,"font-medium","text-surface-900","dark:text-surface-0","mb-3","block"],["id","phone","type","tel","pInputText","","fluid","","placeholder","Exemple: 622 00 00 00",3,"ngModelChange","input","blur","ngModel","invalid","disabled"],["class","text-red-500 block mt-2",4,"ngIf"],["for","ville",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","ville","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["for","quartier",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","quartier","type","text","pInputText","","fluid","",3,"ngModelChange","ngModel","invalid","disabled"],["class","mb-6 col-span-12 md:col-span-6",4,"ngIf"],[1,"col-span-12","mb-2"],["value","piece"],[1,"flex","items-center","gap-2","font-medium","text-surface-700","dark:text-surface-200"],[1,"pi","pi-id-card","text-sm"],["class","text-xs font-semibold px-1.5 py-0.5 rounded","style","background: #fff7ed; color: #c2410c;",4,"ngIf"],["class","text-xs font-normal text-surface-400",4,"ngIf"],[1,"grid","grid-cols-12","gap-4","pt-2"],[1,"mb-4","col-span-12","md:col-span-6"],["for","piece_type",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","piece_type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","onChange","ngModel","options","disabled","showClear"],["class","text-surface-500 dark:text-surface-400 block mt-1",4,"ngIf"],["for","piece_numero",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","piece_numero","type","text","pInputText","","fluid","","placeholder","Ex: GN-123456789",3,"ngModelChange","ngModel","disabled","invalid"],["class","text-red-500 block mt-1",4,"ngIf"],[1,"mb-4","col-span-12","md:col-span-4"],["for","piece_pays",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","piece_pays","optionLabel","name","optionValue","code","placeholder","S\xE9lectionner un pays","fluid","",3,"ngModelChange","onChange","ngModel","options","disabled","showClear","invalid"],["for","piece_delivree_le",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","piece_delivree_le","type","date","pInputText","","fluid","",3,"ngModelChange","change","ngModel","disabled","invalid"],["for","piece_expire_le",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","piece_expire_le","type","date","pInputText","","fluid","",3,"ngModelChange","change","ngModel","disabled","invalid"],["class","col-span-12 -mt-2",4,"ngIf"],["class","col-span-12 utilisateurs-form-actions",4,"ngIf"],[1,"text-red-500"],["for","role",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","role","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un r\xF4le","fluid","",3,"ngModelChange","ngModel","options","disabled","invalid"],[1,"flex","items-center","gap-2"],[1,"w-5","h-auto","rounded-sm",3,"src","alt"],[1,"font-semibold","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500","block","mt-2"],["for","password",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","password","fluid","","placeholder","Min. 8 caract\xE8res, majuscules, minuscules et chiffres","promptLabel","Entrez un mot de passe","weakLabel","Faible","mediumLabel","Moyen","strongLabel","Fort",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],["for","password_confirmation",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","password_confirmation","fluid","","placeholder","Confirmez le mot de passe",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],[1,"text-xs","font-semibold","px-1.5","py-0.5","rounded",2,"background","#fff7ed","color","#c2410c"],[1,"text-xs","font-normal","text-surface-400"],[1,"text-surface-500","dark:text-surface-400","block","mt-1"],[1,"text-red-500","block","mt-1"],[1,"col-span-12","-mt-2"],[1,"text-red-500","flex","items-center","gap-1"],[1,"pi","pi-exclamation-triangle","text-xs"],[1,"col-span-12","utilisateurs-form-actions"],[1,"flex","flex-wrap","items-center","gap-3"],["pButton","","pRipple","","icon","pi pi-check",1,"utilisateurs-form-submit",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"utilisateurs-form-cancel",3,"click","disabled"]],template:function(t,e){t&1&&(a(0,"div",0)(1,"div",1)(2,"span",2),d(3),r()(),a(4,"div",3)(5,"div",4),_(6,"div",5),a(7,"p",6),d(8," Renseignez les informations du compte utilisateur. "),r()(),a(9,"div",7)(10,"div",3)(11,"div",8)(12,"label",9),d(13," Type de compte "),m(14,Dt,2,0,"span",10),r(),a(15,"p-select",11),y("ngModelChange",function(s){return v(e.model.type,s)||(e.model.type=s),s}),u("onChange",function(){return e.onTypeChange()}),r(),m(16,Rt,2,0,"small",10),r(),m(17,At,6,6,"div",12),a(18,"div",13)(19,"label",14),d(20," Email "),r(),a(21,"input",15),y("ngModelChange",function(s){return v(e.model.email,s)||(e.model.email=s),s}),r()(),a(22,"div",16)(23,"label",17),d(24," Civilit\xE9 "),r(),a(25,"p-select",18),y("ngModelChange",function(s){return v(e.model.civilite,s)||(e.model.civilite=s),s}),r()(),a(26,"div",16)(27,"label",19),d(28," Date de naissance "),r(),a(29,"p-datepicker",20),y("ngModelChange",function(s){return v(e.dateNaissanceObj,s)||(e.dateNaissanceObj=s),s}),r()(),a(30,"div",13)(31,"label",21),d(32," Nom "),m(33,Wt,2,0,"span",10),r(),a(34,"input",22),y("ngModelChange",function(s){return v(e.model.nom,s)||(e.model.nom=s),s}),r(),m(35,Nt,2,0,"small",10),r(),a(36,"div",13)(37,"label",23),d(38," Pr\xE9nom "),m(39,Bt,2,0,"span",10),r(),a(40,"input",24),y("ngModelChange",function(s){return v(e.model.prenom,s)||(e.model.prenom=s),s}),r(),m(41,jt,2,0,"small",10),r(),a(42,"div",25)(43,"div",26)(44,"div",27)(45,"label",28),d(46," Pays "),m(47,zt,2,0,"span",10),r(),a(48,"p-select",29),y("ngModelChange",function(s){return v(e.phoneCountry,s)||(e.phoneCountry=s),s}),u("onCountryChange",function(){return e.onCountryChange()}),m(49,qt,6,4,"ng-template",30)(50,Ht,1,1,"ng-template",31),r()(),a(51,"div",32)(52,"label",33),d(53," T\xE9l\xE9phone "),m(54,Gt,2,0,"span",10),r(),a(55,"input",34),y("ngModelChange",function(s){return v(e.model.phone,s)||(e.model.phone=s),s}),u("input",function(){return e.onPhoneInput()})("blur",function(){return e.onPhoneBlur()}),r()()(),m(56,Yt,2,0,"small",35)(57,Qt,2,1,"small",35),r(),a(58,"div",13)(59,"label",36),d(60," Ville "),m(61,Zt,2,0,"span",10),r(),a(62,"input",37),y("ngModelChange",function(s){return v(e.model.ville,s)||(e.model.ville=s),s}),r(),m(63,Jt,2,0,"small",10),r(),a(64,"div",13)(65,"label",38),d(66," Quartier "),m(67,Xt,2,0,"span",10),r(),a(68,"input",39),y("ngModelChange",function(s){return v(e.model.quartier,s)||(e.model.quartier=s),s}),r(),m(69,$t,2,0,"small",10),r(),m(70,ti,7,6,"div",40)(71,ni,7,6,"div",40),a(72,"div",41)(73,"p-accordion")(74,"p-accordion-panel",42)(75,"p-accordion-header")(76,"span",43),_(77,"i",44),d(78," Pi\xE8ce d'identit\xE9 "),m(79,ri,2,0,"span",45)(80,ai,2,0,"span",46),r()(),a(81,"p-accordion-content")(82,"div",47)(83,"div",48)(84,"label",49),d(85," Type de pi\xE8ce "),r(),a(86,"p-select",50),y("ngModelChange",function(s){return v(e.model.piece_type,s)||(e.model.piece_type=s),s}),u("onChange",function(){return e.onPieceTypeChange()}),r(),m(87,oi,2,0,"small",51),r(),a(88,"div",48)(89,"label",52),d(90," Num\xE9ro de pi\xE8ce "),m(91,si,2,0,"span",10),r(),a(92,"input",53),y("ngModelChange",function(s){return v(e.model.piece_numero,s)||(e.model.piece_numero=s),s}),u("ngModelChange",function(){return e.onKycFieldChange()}),r(),m(93,li,2,1,"small",54),r(),a(94,"div",55)(95,"label",56),d(96," Pays de d\xE9livrance "),m(97,pi,2,0,"span",10),r(),a(98,"p-select",57),y("ngModelChange",function(s){return v(e.model.piece_pays,s)||(e.model.piece_pays=s),s}),u("onChange",function(){return e.onKycFieldChange()}),r(),m(99,di,2,1,"small",54),r(),a(100,"div",55)(101,"label",58),d(102," D\xE9livr\xE9e le "),m(103,mi,2,0,"span",10),r(),a(104,"input",59),y("ngModelChange",function(s){return v(e.model.piece_delivree_le,s)||(e.model.piece_delivree_le=s),s}),u("change",function(){return e.onKycFieldChange()}),r(),m(105,ci,2,1,"small",54),r(),a(106,"div",55)(107,"label",60),d(108," Expire le "),m(109,ui,2,0,"span",10),r(),a(110,"input",61),y("ngModelChange",function(s){return v(e.model.piece_expire_le,s)||(e.model.piece_expire_le=s),s}),u("change",function(){return e.onKycFieldChange()}),r(),m(111,gi,2,1,"small",54),r(),m(112,_i,4,1,"div",62),r()()()()(),m(113,fi,4,4,"div",63),r()()()()),t&2&&(l(3),E(" ",e.formTitle," "),l(11),p("ngIf",e.isEditing),l(),b("ngModel",e.model.type),p("options",e.userTypeOptions)("disabled",e.fieldsDisabled)("invalid",e.submitted&&!e.model.type),l(),p("ngIf",e.submitted&&!e.model.type&&e.isEditing),l(),p("ngIf",e.isRoleSelectable),l(4),b("ngModel",e.model.email),p("disabled",e.fieldsDisabled),l(4),b("ngModel",e.model.civilite),p("options",e.civiliteOptions)("disabled",e.fieldsDisabled)("showClear",!0),l(4),b("ngModel",e.dateNaissanceObj),p("showIcon",!0)("disabled",e.fieldsDisabled)("maxDate",e.today),l(4),p("ngIf",e.isEditing),l(),b("ngModel",e.model.nom),p("invalid",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim()))("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim())&&e.isEditing),l(4),p("ngIf",e.isEditing),l(),b("ngModel",e.model.prenom),p("invalid",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim()))("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim())&&e.isEditing),l(6),p("ngIf",e.isEditing),l(),b("ngModel",e.phoneCountry),p("options",e.countries)("disabled",e.fieldsDisabled),l(6),p("ngIf",e.isEditing),l(),b("ngModel",e.model.phone),p("invalid",(e.submitted||e.phoneError)&&(!(e.model.phone!=null&&e.model.phone.trim())||!!e.phoneError))("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&!(e.model.phone!=null&&e.model.phone.trim())&&e.isEditing),l(),p("ngIf",e.phoneError&&(e.model.phone==null?null:e.model.phone.trim())&&e.isEditing),l(4),p("ngIf",e.isEditing),l(),b("ngModel",e.model.ville),p("invalid",e.submitted&&!(e.model.ville!=null&&e.model.ville.trim()))("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&!(e.model.ville!=null&&e.model.ville.trim())&&e.isEditing),l(4),p("ngIf",e.isEditing),l(),b("ngModel",e.model.quartier),p("invalid",e.submitted&&!(e.model.quartier!=null&&e.model.quartier.trim()))("disabled",e.fieldsDisabled),l(),p("ngIf",e.submitted&&!(e.model.quartier!=null&&e.model.quartier.trim())&&e.isEditing),l(),p("ngIf",e.mode==="create"),l(),p("ngIf",e.mode==="create"),l(8),p("ngIf",e.isKycActive),l(),p("ngIf",!e.isKycActive),l(6),b("ngModel",e.model.piece_type),p("options",e.pieceTypeOptions)("disabled",e.fieldsDisabled)("showClear",!0),l(),p("ngIf",e.isKycActive),l(4),p("ngIf",e.isKycActive),l(),b("ngModel",e.model.piece_numero),p("disabled",e.fieldsDisabled)("invalid",!!e.kycErrors.piece_numero),l(),p("ngIf",e.kycErrors.piece_numero),l(4),p("ngIf",e.isKycActive),l(),b("ngModel",e.model.piece_pays),p("options",e.countries)("disabled",e.fieldsDisabled)("showClear",!0)("invalid",!!e.kycErrors.piece_pays),l(),p("ngIf",e.kycErrors.piece_pays),l(4),p("ngIf",e.isKycActive),l(),b("ngModel",e.model.piece_delivree_le),p("disabled",e.fieldsDisabled)("invalid",!!e.kycErrors.piece_delivree_le),l(),p("ngIf",e.kycErrors.piece_delivree_le),l(4),p("ngIf",e.isKycActive),l(),b("ngModel",e.model.piece_expire_le),p("disabled",e.fieldsDisabled)("invalid",!!e.kycErrors.piece_expire_le||!!e.kycErrors.dates),l(),p("ngIf",e.kycErrors.piece_expire_le),l(),p("ngIf",e.kycErrors.dates),l(),p("ngIf",e.isEditing))},dependencies:[T,F,Q,z,G,H,Pe,K,q,j,W,N,B,Xe,Je,nt,it,$e,et,tt,We],styles:[".utilisateurs-form-actions[_ngcontent-%COMP%]{margin-top:.5rem;padding-top:.5rem}.utilisateurs-form-actions[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{align-items:center}.utilisateurs-form-actions[_ngcontent-%COMP%]     .p-button{min-height:2.5rem;min-width:7rem}@media (max-width: 768px){.utilisateurs-form-title[_ngcontent-%COMP%], .utilisateurs-form-sidebar[_ngcontent-%COMP%]{display:none}.utilisateurs-form-card[_ngcontent-%COMP%]{box-shadow:none;border:none;border-radius:0;padding:0;background:transparent}.utilisateurs-form-actions[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column;width:100%}.utilisateurs-form-actions[_ngcontent-%COMP%]     .p-button{width:100%;justify-content:center;min-width:unset}}"]})};var te=class n{constructor(i,t,e){this.userService=i;this.messageService=t;this.router=e}loading=!1;onCancel(){this.router.navigate(["contacts/utilisateurs"])}onSubmit(i){this.loading=!0;let t={nom:i.nom||"",prenom:i.prenom||"",phone:(i.phone||"").replace(/\s+/g,""),email:i.email||void 0,pays:i.pays||"Guin\xE9e",code_pays:i.code_pays||"GN",code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville||"",quartier:i.quartier||"",password:i.password||"",password_confirmation:i.password_confirmation||"",type:i.type??"staff",role:i.role||"",civilite:i.civilite||void 0,date_naissance:i.date_naissance||void 0,piece_type:i.piece_type||void 0,piece_numero:i.piece_numero||void 0,piece_delivree_le:i.piece_delivree_le||void 0,piece_expire_le:i.piece_expire_le||void 0,piece_pays:i.piece_pays||void 0};this.userService.createUser(t).subscribe({next:e=>{if(e.success){this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur cr\xE9\xE9 avec succ\xE8s"});let o=e.data?.user?.id??e.data?.id;setTimeout(()=>{o!=null?this.router.navigate(["contacts/utilisateurs/edit",o]):this.router.navigate(["contacts/utilisateurs"])},600)}this.loading=!1},error:e=>{console.error("Erreur lors de la cr\xE9ation:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Erreur lors de la cr\xE9ation de l'utilisateur"}),this.loading=!1}})}getCodePhonePays(i){let t=D.find(e=>e.code===i);return t?t.dialCode:"+224"}static \u0275fac=function(t){return new(t||n)(x(P),x(S),x(O))};static \u0275cmp=M({type:n,selectors:[["app-utilisateurs-new"]],features:[I([S])],decls:10,vars:2,consts:[[1,"edit-page"],[1,"edit-mobile-header"],["type","button","aria-label","Retour \xE0 la liste",1,"edit-back",3,"click"],[1,"pi","pi-arrow-left"],[1,"edit-title"],[1,"edit-header-spacer"],[1,"edit-content"],[3,"submitForm","cancel","mode","loading"]],template:function(t,e){t&1&&(_(0,"p-toast"),a(1,"div",0)(2,"header",1)(3,"button",2),u("click",function(){return e.onCancel()}),_(4,"i",3),r(),a(5,"h1",4),d(6,"Nouvel utilisateur"),r(),_(7,"span",5),r(),a(8,"div",6)(9,"app-utilisateurs-form",7),u("submitForm",function(s){return e.onSubmit(s)})("cancel",function(){return e.onCancel()}),r()()()),t&2&&(l(9),p("mode","create")("loading",e.loading))},dependencies:[T,J,Z,R],styles:["[_nghost-%COMP%]{display:block}.edit-mobile-header[_ngcontent-%COMP%]{display:none}.edit-content[_ngcontent-%COMP%]{padding:1rem}@media screen and (max-width: 768px){.edit-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;margin:calc(-.25rem - env(safe-area-inset-top)) -.875rem calc(-.875rem - env(safe-area-inset-bottom));margin-left:-.875rem;margin-right:-.875rem;padding:0;padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);padding-bottom:env(safe-area-inset-bottom);background:#fff}.edit-mobile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-shrink:0;padding:calc(.5rem + env(safe-area-inset-top)) .75rem .6rem calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:var(--surface-card);border-bottom:1px solid var(--surface-border);box-shadow:0 1px 3px #0000000f;position:sticky;top:0;z-index:25}.edit-back[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;min-width:2.25rem;border:none;border-radius:50%;background:var(--p-primary-50);color:var(--p-primary-500);display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}.edit-back[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem}.edit-title[_ngcontent-%COMP%]{flex:1;margin:0;font-size:1.15rem;font-weight:700;color:var(--text-color);min-width:0;text-align:center}.edit-header-spacer[_ngcontent-%COMP%]{width:2.25rem;min-width:2.25rem}.edit-content[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:.875rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom))}}"]})};function bi(n,i){n&1&&(a(0,"div",9),_(1,"i",10),r())}function vi(n,i){if(n&1){let t=C();a(0,"app-utilisateurs-form",11),u("submitForm",function(o){f(t);let s=c();return h(s.onSubmit(o))})("cancel",function(){f(t);let o=c();return h(o.onCancel())}),r()}if(n&2){let t=c();p("mode","edit")("initialData",t.userData)("loading",t.loading)}}var ie=class n{constructor(i,t,e,o,s){this.route=i;this.router=t;this.userService=e;this.roleService=o;this.messageService=s}loading=!1;userId=null;userData=null;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");i&&(this.userId=parseInt(i,10),this.loadUser(this.userId))}loadUser(i){this.loading=!0,this.userService.getUser(i).subscribe({next:t=>{if(t.success&&t.data){let e=t.data,o={id:e.id,reference:e.reference,nom:e.nom,prenom:e.prenom,phone:e.phone,email:e.email,pays:e.pays,code_pays:e.code_pays,code_phone_pays:e.code_phone_pays,ville:e.ville,quartier:e.quartier,type:e.type,roles:e.role_names||e.roles,role_names:e.role_names,is_active:e.is_active,civilite:e.civilite,date_naissance:e.date_naissance,piece_type:e.piece_type,piece_numero:e.piece_numero,piece_delivree_le:e.piece_delivree_le,piece_expire_le:e.piece_expire_le,piece_pays:e.piece_pays},s=e.role_names||e.roles;!s||s.length===0?this.roleService.getUserRoles(i).subscribe({next:g=>{g.success&&g.data&&(o.roles=g.data.roles),this.userData=o,this.loading=!1},error:()=>{this.userData=o,this.loading=!1}}):(this.userData=o,this.loading=!1)}else this.loading=!1},error:t=>{console.error("Erreur lors du chargement:",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors du chargement de l'utilisateur"}),this.loading=!1}})}onSubmit(i){if(!this.userId)return;this.loading=!0;let t={nom:i.nom,prenom:i.prenom,phone:(i.phone||"").replace(/\s+/g,""),email:i.email||void 0,pays:i.pays,code_pays:i.code_pays,code_phone_pays:this.getCodePhonePays(i.code_pays||"GN"),ville:i.ville,quartier:i.quartier,type:i.type,role:i.role,civilite:i.civilite||null,date_naissance:i.date_naissance||null,piece_type:i.piece_type||null,piece_numero:i.piece_numero||null,piece_delivree_le:i.piece_delivree_le||null,piece_expire_le:i.piece_expire_le||null,piece_pays:i.piece_pays||null};this.userService.updateUser(this.userId,t).subscribe({next:e=>{e.success?(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur modifi\xE9 avec succ\xE8s"}),this.loadUser(this.userId)):this.loading=!1},error:e=>{console.error("Erreur lors de la modification:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:e.error?.message||"Erreur lors de la modification de l'utilisateur"}),this.loading=!1}})}onCancel(){this.router.navigate(["contacts/utilisateurs"])}getCodePhonePays(i){let t=D.find(e=>e.code===i);return t?t.dialCode:"+224"}static \u0275fac=function(t){return new(t||n)(x(Te),x(O),x(P),x(X),x(S))};static \u0275cmp=M({type:n,selectors:[["app-utilisateurs-edit"]],features:[I([S])],decls:11,vars:2,consts:[[1,"edit-page"],[1,"edit-mobile-header"],["type","button","aria-label","Retour \xE0 la liste",1,"edit-back",3,"click"],[1,"pi","pi-arrow-left"],[1,"edit-title"],[1,"edit-header-spacer"],[1,"edit-content"],["class","flex justify-center items-center h-96",4,"ngIf"],[3,"mode","initialData","loading","submitForm","cancel",4,"ngIf"],[1,"flex","justify-center","items-center","h-96"],[1,"pi","pi-spin","pi-spinner","text-4xl","text-primary"],[3,"submitForm","cancel","mode","initialData","loading"]],template:function(t,e){t&1&&(_(0,"p-toast"),a(1,"div",0)(2,"header",1)(3,"button",2),u("click",function(){return e.onCancel()}),_(4,"i",3),r(),a(5,"h1",4),d(6,"Modifier l'utilisateur"),r(),_(7,"span",5),r(),a(8,"div",6),m(9,bi,2,0,"div",7)(10,vi,1,3,"app-utilisateurs-form",8),r()()),t&2&&(l(9),p("ngIf",e.loading&&!e.userData),l(),p("ngIf",e.userData))},dependencies:[T,F,R,J,Z],styles:["[_nghost-%COMP%]{display:block}.edit-mobile-header[_ngcontent-%COMP%]{display:none}.edit-content[_ngcontent-%COMP%]{padding:1rem}@media screen and (max-width: 768px){.edit-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;margin:calc(-.25rem - env(safe-area-inset-top)) -.875rem calc(-.875rem - env(safe-area-inset-bottom));margin-left:-.875rem;margin-right:-.875rem;padding:0;padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);padding-bottom:env(safe-area-inset-bottom);background:#fff}.edit-mobile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-shrink:0;padding:calc(.5rem + env(safe-area-inset-top)) .75rem .6rem calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:var(--surface-card);border-bottom:1px solid var(--surface-border);box-shadow:0 1px 3px #0000000f;position:sticky;top:0;z-index:25}.edit-back[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;min-width:2.25rem;border:none;border-radius:50%;background:var(--p-primary-50);color:var(--p-primary-500);display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}.edit-back[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem}.edit-title[_ngcontent-%COMP%]{flex:1;margin:0;font-size:1.15rem;font-weight:700;color:var(--text-color);min-width:0;text-align:center}.edit-header-spacer[_ngcontent-%COMP%]{width:2.25rem;min-width:2.25rem}.edit-content[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:.875rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom))}}"]})};var qn=[{path:"",component:ee,canActivate:[Y],data:{permissions:["users.read"]}},{path:"new",component:te,canActivate:[Y],data:{permissions:["users.create"]}},{path:"edit/:id",component:ie,canActivate:[Y],data:{permissions:["users.update"]}},{path:"**",redirectTo:"/notfound"}];export{qn as default};
