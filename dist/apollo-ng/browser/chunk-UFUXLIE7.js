import{b as at}from"./chunk-R4ESLALY.js";import{a as Ae,b as Le}from"./chunk-4XVPC7FC.js";import{b as Ke}from"./chunk-ILATF2XR.js";import{a as rt,b as nt}from"./chunk-35JCJIOK.js";import"./chunk-EUXA6TGD.js";import"./chunk-ADFBMQVB.js";import{b as ot}from"./chunk-IM6CZ2WX.js";import{a as Ye,b as Je}from"./chunk-CVH73O44.js";import{a as $e,b as et}from"./chunk-XDXU5A6L.js";import{a as Xe,b as Ze}from"./chunk-R3EAI2YQ.js";import{a as L,b as U}from"./chunk-QFEFJCNI.js";import"./chunk-RLRCSE6J.js";import{a as tt,b as it}from"./chunk-CUJPLDCB.js";import"./chunk-4NSD52R5.js";import{a as Ne}from"./chunk-4SCZYFYR.js";import{b as we,d as A}from"./chunk-H5BNHAT7.js";import"./chunk-Q3QYWOBT.js";import{a as ze,b as He}from"./chunk-ZSMYH3SO.js";import{a as We,d as Be,e as qe,h as je,i as Ge,k as Qe}from"./chunk-566VITEB.js";import"./chunk-PFQBBUG2.js";import"./chunk-ZKOS3DIQ.js";import"./chunk-TF3WUBGP.js";import"./chunk-CIG3UH2L.js";import"./chunk-LKI2OA3Y.js";import"./chunk-LLIVY2RR.js";import{b as ne,c as oe}from"./chunk-ACCAPG7B.js";import"./chunk-GQZMGDXE.js";import"./chunk-EMSXNTNI.js";import"./chunk-CAPWCZXM.js";import"./chunk-EJ36MVS3.js";import"./chunk-N7WUB32N.js";import{c as ae,d as se}from"./chunk-4OYOH73G.js";import"./chunk-E7ZA2RP6.js";import"./chunk-NFFITYYI.js";import"./chunk-QKYHST3S.js";import"./chunk-26DLLJPL.js";import{b as Ue}from"./chunk-CKLQ5QYB.js";import"./chunk-LEXXM723.js";import{a as Se,c as Ce}from"./chunk-PR732LFS.js";import"./chunk-YPI3USWF.js";import{a as ke,b as Fe,c as De,d as Ve}from"./chunk-E2A55PMK.js";import{a as Z,b as $}from"./chunk-ROFMEOOL.js";import{b as K,e as Y,h as J,n as Ee,p as X}from"./chunk-AQNIYYGH.js";import{a as Re,b as Oe}from"./chunk-UEYH4F7Z.js";import"./chunk-YU5WWNZ3.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{c as ie,d as Ie,e as re}from"./chunk-FXG7SSDN.js";import"./chunk-C3BTHMVA.js";import{i as ee,j as te}from"./chunk-D772OSYX.js";import{a as Me,b as Te}from"./chunk-N4GWINB2.js";import{la as H,pa as w}from"./chunk-DRU5BJUS.js";import{k as R,v as O}from"./chunk-3CNM3VZD.js";import"./chunk-4O3FVBGX.js";import{$ as c,$b as Pe,Gb as P,Ja as me,Kb as h,Lb as u,Ma as l,Pb as j,Qb as G,R as ve,Ra as ge,Rb as Q,Ub as z,V as xe,Xa as C,Xb as _e,Zb as p,_b as F,aa as m,ab as I,cc as b,dc as v,ec as x,gb as f,gc as k,hc as W,ma as ye,o as S,u as be,wb as d,wc as E,xb as o,yb as n,zb as _}from"./chunk-U3BUAVLN.js";import{a as V,b as q,c as ce}from"./chunk-GAL4ENT6.js";var D={materiel:"Mat\xE9riel",service:"Service",fabricable:"Fabricable",achat_vente:"Achat/Vente"},M={brouillon:"Brouillon",actif:"Actif",inactif:"Inactif",archive:"Archiv\xE9",rupture_stock:"Rupture de stock"},le={brouillon:"secondary",actif:"success",inactif:"danger",archive:"danger",rupture_stock:"warn"};var g=class s{id=0;nom="";code="";prix_usine=null;prix_vente=null;prix_achat=null;qte_stock=0;cout=null;statut="brouillon";type="materiel";in_stock=!0;is_archived=!1;archived_at=null;description=null;image_url=null;created_by=null;updated_by=null;deleted_by=null;archived_by=null;created_at="";updated_at="";deleted_at=null;creator;updater;archiver;deleter;created_by_name;updated_by_name;archived_by_name;deleted_by_name;constructor(t){t&&Object.assign(this,t)}getImageUrl(t="assets/demo/images/no-product.png"){return this.image_url?this.image_url.startsWith("http://")||this.image_url.startsWith("https://")?this.image_url:`assets/demo/images/produits/${this.image_url}`:t}formatPrix(t,e="GNF"){return`${(typeof t=="number"?t:0).toLocaleString("fr-FR")} ${e}`}static fromApi(t){return new s(q(V({},t),{prix_usine:t?.prix_usine!==null&&t?.prix_usine!==void 0?Number(t.prix_usine):null,prix_vente:t?.prix_vente!==null&&t?.prix_vente!==void 0?Number(t.prix_vente):null,prix_achat:t?.prix_achat!==null&&t?.prix_achat!==void 0?Number(t.prix_achat):null,cout:t?.cout!==null&&t?.cout!==void 0?Number(t.cout):null}))}static fromApiArray(t){return t.map(e=>s.fromApi(e))}};var T=class s{constructor(t){this.http=t}apiUrl=`${Ne.apiUrl}/produits`;getAll(){return this.http.get(this.apiUrl).pipe(S(t=>g.fromApiArray(t.data)))}getArchived(){return this.http.get(`${this.apiUrl}/archived`).pipe(S(t=>g.fromApiArray(t.data)))}search(t){let e=new Se;return t.search&&(e=e.set("search",t.search)),t.type&&(e=e.set("type",t.type)),t.statut&&(e=e.set("statut",t.statut)),t.in_stock!==void 0&&(e=e.set("in_stock",t.in_stock.toString())),t.page&&(e=e.set("page",t.page.toString())),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),this.http.get(`${this.apiUrl}/search`,{params:e}).pipe(S(i=>q(V({},i),{data:g.fromApiArray(i.data)})))}getStatistics(){return this.http.get(`${this.apiUrl}/statistics`).pipe(S(t=>t.data))}getById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(S(e=>g.fromApi(e.data)))}create(t){if(t.image){let a=this.toFormData(t);return this.http.post(this.apiUrl,a).pipe(S(y=>g.fromApi(y.data)))}let r=t,{image:e}=r,i=ce(r,["image"]);return this.http.post(this.apiUrl,i).pipe(S(a=>g.fromApi(a.data)))}update(t,e){if(e.image){let y=this.toFormData(e);return y.append("_method","PUT"),this.http.post(`${this.apiUrl}/${t}`,y).pipe(S(pt=>g.fromApi(pt.data)))}let a=e,{image:i}=a,r=ce(a,["image"]);return this.http.put(`${this.apiUrl}/${t}`,r).pipe(S(y=>g.fromApi(y.data)))}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}updateStock(t,e){return this.http.patch(`${this.apiUrl}/${t}/stock`,e).pipe(S(i=>g.fromApi(i.data)))}changeStatus(t,e){return this.http.patch(`${this.apiUrl}/${t}/status`,e).pipe(S(i=>g.fromApi(i.data)))}archive(t){return this.http.patch(`${this.apiUrl}/${t}/archive`,{}).pipe(S(e=>g.fromApi(e.data)))}unarchive(t){return this.http.patch(`${this.apiUrl}/${t}/unarchive`,{}).pipe(S(e=>g.fromApi(e.data)))}toFormData(t){let e=new FormData;return t.nom&&e.append("nom",t.nom),t.type&&e.append("type",t.type),t.qte_stock!==void 0&&t.qte_stock!==null&&e.append("qte_stock",t.qte_stock.toString()),t.prix_usine!==void 0&&t.prix_usine!==null&&e.append("prix_usine",t.prix_usine.toString()),t.prix_vente!==void 0&&t.prix_vente!==null&&e.append("prix_vente",t.prix_vente.toString()),t.prix_achat!==void 0&&t.prix_achat!==null&&e.append("prix_achat",t.prix_achat.toString()),t.statut&&e.append("statut",t.statut),t.description&&e.append("description",t.description),t.cout!==void 0&&t.cout!==null&&e.append("cout",t.cout.toString()),t.image instanceof File&&e.append("image",t.image,t.image.name),console.log("FormData content:"),e.forEach((i,r)=>{console.log(`  ${r}:`,i)}),e}static \u0275fac=function(e){return new(e||s)(xe(Ce))};static \u0275prov=ve({token:s,factory:s.\u0275fac,providedIn:"root"})};var bt=["dt"],vt=()=>({"min-width":"75rem"}),xt=()=>[10,20,30],yt=()=>({width:"720px",maxWidth:"95vw"}),Pt=()=>({width:"450px"});function St(s,t){if(s&1){let e=P();o(0,"p-button",12),h("onClick",function(){c(e);let r=u();return m(r.goToNewProduits())}),n(),o(1,"p-button",13),h("onClick",function(){c(e);let r=u();return m(r.deleteSelectedProducts())}),n()}if(s&2){let e=u();l(),d("disabled",!e.selectedProduits||!e.selectedProduits.length)}}function Ct(s,t){if(s&1){let e=P();o(0,"p-button",14),h("onClick",function(){c(e);let r=u();return m(r.exportCSV())}),n()}}function wt(s,t){if(s&1){let e=P();o(0,"div",15)(1,"h5",16),p(2,"Gestion des Produits"),n(),o(3,"p-iconfield"),_(4,"p-inputicon",17),o(5,"input",18),h("input",function(r){c(e);let a=u(),y=z(8);return m(a.onGlobalFilter(y,r))}),n()()()}}function Et(s,t){s&1&&(o(0,"tr")(1,"th",19),_(2,"p-tableHeaderCheckbox"),n(),o(3,"th",20)(4,"span",21),p(5,"Code "),_(6,"p-sortIcon",22),n()(),o(7,"th",23)(8,"span",21),p(9,"Nom "),_(10,"p-sortIcon",24),n()(),o(11,"th",25)(12,"span",21),p(13,"Type "),_(14,"p-sortIcon",26),n()(),o(15,"th",27)(16,"span",21),p(17,"Qt\xE9 "),_(18,"p-sortIcon",28),n()(),o(19,"th",29)(20,"span",21),p(21,"Status "),_(22,"p-sortIcon",30),n()(),o(23,"th",31),p(24,"Action"),n()())}function Mt(s,t){if(s&1){let e=P();o(0,"tr")(1,"td",19),_(2,"p-tableCheckbox",32),n(),o(3,"td",31),p(4),n(),o(5,"td",33),p(6),n(),o(7,"td"),p(8),n(),o(9,"td"),p(10),n(),o(11,"td"),_(12,"p-tag",34),n(),o(13,"td")(14,"button",35),h("click",function(r){let a=c(e).$implicit,y=u();return m(y.goToEditProduit(r,a.id))}),n(),o(15,"p-button",36),h("click",function(){let r=c(e).$implicit,a=u();return m(a.deleteProduct(r))}),n()()()}if(s&2){let e=t.$implicit,i=u();l(2),d("value",e),l(2),F(e.code),l(2),F(e.nom),l(2),F(e.type),l(2),F(e.qte_stock),l(2),d("value",i.getStatutLabel(e.statut))("severity",i.getStatutSeverity(e.statut)),l(2),d("pTooltip","Voir"),l(),d("rounded",!0)("outlined",!0)}}function Tt(s,t){if(s&1){let e=P();o(0,"div",59)(1,"label",60),p(2,"Code"),n(),o(3,"input",61),x("ngModelChange",function(r){c(e);let a=u(2);return v(a.produit.code,r)||(a.produit.code=r),m(r)}),n()()}if(s&2){let e=u(2);l(3),b("ngModel",e.produit.code),d("disabled",!0)}}function It(s,t){s&1&&(o(0,"small",62),p(1,"Type obligatoire."),n())}function kt(s,t){s&1&&(o(0,"small",62),p(1,"Nom obligatoire."),n())}function Ft(s,t){if(s&1){let e=P();o(0,"div")(1,"label",63),p(2,"Statut"),n(),o(3,"p-select",64),x("ngModelChange",function(r){c(e);let a=u(2);return v(a.produit.statut,r)||(a.produit.statut=r),m(r)}),n()()}if(s&2){let e=u(2);l(3),b("ngModel",e.produit.statut),d("options",e.statutOptions)}}function Dt(s,t){if(s&1){let e=P();f(0,Tt,4,2,"div",37),o(1,"div",38)(2,"div")(3,"label",39),p(4,"Type"),n(),o(5,"p-select",40),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.type,r)||(a.produit.type=r),m(r)}),n(),f(6,It,2,0,"small",41),n(),o(7,"div")(8,"label",42),p(9,"Nom"),n(),o(10,"input",43),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.nom,r)||(a.produit.nom=r),m(r)}),n(),f(11,kt,2,0,"small",41),n(),o(12,"div")(13,"label",44),p(14,"Description"),n(),o(15,"textarea",45),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.description,r)||(a.produit.description=r),m(r)}),n()(),f(16,Ft,4,2,"div",46),o(17,"div",47)(18,"div",48)(19,"label",49),p(20,"Quantit\xE9"),n(),o(21,"p-inputnumber",50),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.qte_stock,r)||(a.produit.qte_stock=r),m(r)}),n()(),o(22,"div",48)(23,"label",51),p(24,"Co\xFBt"),n(),o(25,"p-inputnumber",52),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.cout,r)||(a.produit.cout=r),m(r)}),n()()(),o(26,"div",47)(27,"div",48)(28,"label",53),p(29,"Prix achat"),n(),o(30,"p-inputnumber",54),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.prix_achat,r)||(a.produit.prix_achat=r),m(r)}),n()(),o(31,"div",48)(32,"label",55),p(33,"Prix vente"),n(),o(34,"p-inputnumber",56),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.prix_vente,r)||(a.produit.prix_vente=r),m(r)}),n()()(),o(35,"div")(36,"label",57),p(37,"Prix usine"),n(),o(38,"p-inputnumber",58),x("ngModelChange",function(r){c(e);let a=u();return v(a.produit.prix_usine,r)||(a.produit.prix_usine=r),m(r)}),n()()()}if(s&2){let e=u();d("ngIf",e.produit==null?null:e.produit.id),l(5),b("ngModel",e.produit.type),d("options",e.typeOptions),l(),d("ngIf",e.submitted&&!e.produit.type),l(4),b("ngModel",e.produit.nom),l(),d("ngIf",e.submitted&&!(e.produit.nom!=null&&e.produit.nom.trim())),l(4),b("ngModel",e.produit.description),l(),d("ngIf",e.produit==null?null:e.produit.id),l(5),b("ngModel",e.produit.qte_stock),l(4),b("ngModel",e.produit.cout),l(5),b("ngModel",e.produit.prix_achat),l(4),b("ngModel",e.produit.prix_vente),l(4),b("ngModel",e.produit.prix_usine)}}function Vt(s,t){if(s&1){let e=P();o(0,"p-button",65),h("click",function(){c(e);let r=u();return m(r.hideDialog())}),n(),o(1,"p-button",66),h("click",function(){c(e);let r=u();return m(r.saveProduit())}),n()}if(s&2){let e=u();d("disabled",e.saving),l(),d("disabled",e.saving)("loading",e.saving)}}var B=class s{constructor(t,e,i,r){this.router=t;this.produitService=e;this.messageService=i;this.confirmationService=r}produits=[];produit=new g;loading=!0;saving=!1;filterFields=["code","nom","description","type","statut","qte_stock"];produitDialog=!1;selectedProduits;submitted=!1;typeOptions=[];statutOptions=[];dt;exportColumns;cols;exportCSV(){this.dt.exportCSV()}ngOnInit(){this.initOptions(),this.initColumns(),this.loadProduits()}loadProduits(){this.loading=!0,this.produitService.getAll().subscribe({next:t=>{this.produits=t,this.loading=!1},error:t=>{console.error("Erreur lors du chargement des produits :",t),this.loading=!1,this.showApiError(t,"Chargement des produits impossible")}})}initOptions(){this.typeOptions=Object.entries(D).map(([t,e])=>({label:e,value:t})),this.statutOptions=Object.entries(M).map(([t,e])=>({label:e,value:t}))}initColumns(){this.cols=[{field:"code",header:"Code",customExportHeader:"Product Code"},{field:"nom",header:"Nom"},{field:"image",header:"Image"},{field:"prix_vente",header:"Prix"},{field:"type",header:"Type"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}openNew(){this.produit=new g,this.submitted=!1,this.produitDialog=!0}editProduct(t){this.produit=new g(V({},t)),this.produitDialog=!0}deleteSelectedProducts(){this.confirmationService.confirm({message:"Are you sure you want to delete the selected products?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{let t=(this.selectedProduits??[]).map(e=>e.id).filter(e=>!!e);t.length!==0&&be(t.map(e=>this.produitService.delete(e))).subscribe({next:()=>{this.produits=this.produits.filter(e=>!t.includes(e.id)),this.selectedProduits=null,this.messageService.add({severity:"success",summary:"Successful",detail:"Products Deleted",life:3e3})},error:e=>{console.error("Erreur lors de la suppression des produits :",e),this.showApiError(e,"Suppression impossible")}})}})}hideDialog(){this.produitDialog=!1,this.submitted=!1}deleteProduct(t){this.confirmationService.confirm({message:"Are you sure you want to delete "+(t.nom||"this product")+"?",header:"Confirm",icon:"pi pi-exclamation-triangle",accept:()=>{t.id&&this.produitService.delete(t.id).subscribe({next:()=>{this.produits=this.produits.filter(e=>e.id!==t.id),this.messageService.add({severity:"success",summary:"Successful",detail:"Product Deleted",life:3e3})},error:e=>{console.error("Erreur lors de la suppression du produit :",e),this.showApiError(e,"Suppression impossible")}})}})}getSeverity(t){switch(t){case"INSTOCK":return"success";case"LOWSTOCK":return"warn";case"OUTOFSTOCK":return"danger";default:return"info"}}getStatutSeverity(t){return t?le[t]??le.brouillon:le.brouillon}getStatutLabel(t){return t?M[t]??M.brouillon:M.brouillon}saveProduit(){if(this.submitted=!0,!this.produit.nom?.trim()||!this.produit.type||this.saving)return;this.saving=!0;let t={nom:this.produit.nom.trim(),type:this.produit.type,qte_stock:this.produit.qte_stock??0,statut:this.produit.statut,cout:this.produit.cout??void 0,description:this.produit.description??void 0,prix_usine:this.produit.prix_usine??void 0,prix_vente:this.produit.prix_vente??void 0,prix_achat:this.produit.prix_achat??void 0},e=!!this.produit.id;(e?this.produitService.update(this.produit.id,t):this.produitService.create(t)).subscribe({next:()=>{this.produitDialog=!1,this.produit=new g,this.submitted=!1,this.saving=!1,this.loadProduits(),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:e?"Produit mis \xE0 jour":"Produit cr\xE9\xE9",life:3e3})},error:r=>{this.saving=!1,this.showApiError(r,"Sauvegarde impossible")}})}showApiError(t,e){let i="Erreur",r=this.extractErrorMessage(t,e);t.status===422&&t.error?.errors?Object.values(t.error.errors).flat().forEach(y=>{this.messageService.add({severity:"error",summary:"Validation",detail:y,life:5e3})}):this.messageService.add({severity:"error",summary:i,detail:r,life:5e3})}extractErrorMessage(t,e){return typeof t?.error?.message=="string"&&t.error.message.trim().length>0?t.error.message:typeof t?.message=="string"&&t.message.trim().length>0?t.message:e}goToNewProduits(){this.router.navigate(["/produits/produits-new"])}goToEditProduit(t,e){t.stopPropagation(),this.router.navigate(["/produits/produits-edit",e])}static \u0275fac=function(e){return new(e||s)(C(A),C(T),C(w),C(H))};static \u0275cmp=I({type:s,selectors:[["app-produits-liste"]],viewQuery:function(e,i){if(e&1&&j(bt,5),e&2){let r;G(r=Q())&&(i.dt=r.first)}},features:[k([w,T,H])],decls:21,vars:22,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["content",""],["footer",""],[1,"card"],["styleClass","mb-12"],["dataKey","id","currentPageReportTemplate","  {first} \xE0 {last} sur {totalRecords} produits",3,"selectionChange","value","loading","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions"],[3,"visibleChange","visible","header","modal"],["label","Nouveau","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick"],["severity","secondary","label","Delete","icon","pi pi-trash","outlined","",3,"onClick","disabled"],["label","Export","icon","pi pi-upload","severity","secondary",3,"onClick"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Rechercher...",3,"input"],[2,"width","3rem"],["pSortableColumn","code",2,"min-width","16rem"],[1,"flex","items-center","gap-2"],["field","code"],["pSortableColumn","nom",2,"min-width","16rem"],["field","nom"],["pSortableColumn","type",2,"min-width","10rem"],["field","type"],["pSortableColumn","qte_stock",2,"min-width","12rem"],["field","qte_stock"],["pSortableColumn","statut",2,"min-width","12rem"],["field","statut"],[2,"min-width","12rem"],[3,"value"],[2,"min-width","16rem"],[3,"value","severity"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm","mr-2",3,"click","pTooltip"],["icon","pi pi-trash","severity","danger",3,"click","rounded","outlined"],["class","mb-4",4,"ngIf"],[1,"flex","flex-col","gap-6"],["for","type",1,"block","font-bold","mb-4"],["inputId","type","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un type","fluid","",3,"ngModelChange","ngModel","options"],["class","text-red-500",4,"ngIf"],["for","nom",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","nom","required","","autofocus","","fluid","",3,"ngModelChange","ngModel"],["for","description",1,"block","font-bold","mb-4"],["id","description","pTextarea","","rows","3","cols","20","fluid","",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-6"],["for","qte_stock",1,"block","font-bold","mb-4"],["id","qte_stock","fluid","",3,"ngModelChange","ngModel"],["for","cout",1,"block","font-bold","mb-4"],["id","cout","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_achat",1,"block","font-bold","mb-4"],["id","prix_achat","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_vente",1,"block","font-bold","mb-4"],["id","prix_vente","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],["for","prix_usine",1,"block","font-bold","mb-4"],["id","prix_usine","mode","currency","currency","GNF","locale","fr-GN","fluid","",3,"ngModelChange","ngModel"],[1,"mb-4"],["for","code",1,"block","font-bold","mb-4"],["type","text","pInputText","","id","code","fluid","",3,"ngModelChange","ngModel","disabled"],[1,"text-red-500"],["for","statut",1,"block","font-bold","mb-4"],["inputId","statut","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","fluid","",3,"ngModelChange","ngModel","options"],["label","Annuler","icon","pi pi-times","text","",3,"click","disabled"],["label","Enregistrer","icon","pi pi-check",3,"click","disabled","loading"]],template:function(e,i){if(e&1){let r=P();_(0,"p-toast"),o(1,"div",8)(2,"p-toolbar",9),f(3,St,2,1,"ng-template",null,0,E)(5,Ct,1,0,"ng-template",null,1,E),n(),o(7,"p-table",10,2),x("selectionChange",function(y){return c(r),v(i.selectedProduits,y)||(i.selectedProduits=y),m(y)}),f(9,wt,6,0,"ng-template",null,3,E)(11,Et,25,0,"ng-template",null,4,E)(13,Mt,16,10,"ng-template",null,5,E),n()(),o(15,"p-dialog",11),x("visibleChange",function(y){return c(r),v(i.produitDialog,y)||(i.produitDialog=y),m(y)}),f(16,Dt,39,13,"ng-template",null,6,E)(18,Vt,2,3,"ng-template",null,7,E),n(),_(20,"p-confirmdialog")}e&2&&(l(7),d("value",i.produits)("loading",i.loading)("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",W(18,vt)),b("selection",i.selectedProduits),d("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",W(19,xt)),l(8),_e(W(20,yt)),b("visible",i.produitDialog),d("header",i.produit!=null&&i.produit.id?"Modifier un produit":"Nouveau produit")("modal",!0),l(5),_e(W(21,Pt)))},dependencies:[O,R,Qe,We,Be,qe,je,Ge,X,K,Y,Ee,J,re,ie,Ie,te,ee,U,L,Je,Ye,Ke,$,Z,it,tt,se,ae,Ue,oe,ne,Ze,Xe,He,ze,Ve,De,Fe,ke,et,$e,Oe,Re],encapsulation:2})};var Rt=["buttonEl"];function Ot(s,t){if(s&1){let e=P();o(0,"button",39),h("click",function(){c(e);let r=u();return m(r.enableEditing())}),n()}}function At(s,t){s&1&&(o(0,"small",40),p(1," Nom du produit obligatoire. "),n())}function Lt(s,t){s&1&&(o(0,"small",40),p(1," Prix d'achat obligatoire pour ce type. "),n())}function Ut(s,t){s&1&&(o(0,"small",40),p(1," Prix de vente obligatoire pour ce type. "),n())}function Nt(s,t){s&1&&(o(0,"small",40),p(1,' Prix usine obligatoire pour "Fabricable". '),n())}function Wt(s,t){if(s&1){let e=P();o(0,"div",41)(1,"p-inputnumber",42),x("ngModelChange",function(r){c(e);let a=u();return v(a.product.prix_usine,r)||(a.product.prix_usine=r),m(r)}),n(),f(2,Nt,2,0,"small",13),n()}if(s&2){let e=u();l(),b("ngModel",e.product.prix_usine),d("min",0)("disabled",e.fieldsDisabled)("invalid",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)),l(),d("ngIf",e.submitted&&e.isPrixUsineRequired()&&e.isPriceMissing(e.product.prix_usine)&&e.isEditing)}}function Bt(s,t){s&1&&(o(0,"div",43),_(1,"i",44),p(2," Pour un service, renseignez au moins un prix : achat ou vente. "),n())}function qt(s,t){s&1&&(o(0,"div",49),_(1,"i",50),o(2,"span",51),p(3,"Ajouter une image"),n(),o(4,"span",52),p(5,"Cliquez pour s\xE9lectionner"),n()())}function jt(s,t){if(s&1){let e=P();o(0,"button",57),h("click",function(r){c(e);let a=u(4);return m(a.removeImage(r))}),_(1,"i",58),n()}}function Gt(s,t){if(s&1&&(o(0,"div",53)(1,"div",54),_(2,"img",55),f(3,jt,2,0,"button",56),n()()),s&2){let e=u(3);l(2),d("src",e.imagePreview||e.product.getImageUrl(),me),l(),d("ngIf",!e.fieldsDisabled)}}function Qt(s,t){if(s&1){let e=P();o(0,"div",46),h("click",function(){c(e),u();let r=z(2),a=u();return m(!a.fieldsDisabled&&r.advancedFileInput.nativeElement.click())}),f(1,qt,6,0,"div",47)(2,Gt,4,2,"div",48),n()}if(s&2){let e=u(2);l(),d("ngIf",!e.imagePreview&&!e.product.image_url),l(),d("ngIf",e.imagePreview||e.product.image_url)}}function zt(s,t){if(s&1){let e=P();o(0,"div")(1,"p-fileUpload",45,0),h("onSelect",function(r){c(e);let a=u();return m(a.onUpload(r))}),f(3,Qt,3,2,"ng-template",null,1,E),n()()}if(s&2){let e=u();l(),d("customUpload",!0)("multiple",!1)("showUploadButton",!1)("showCancelButton",!1)("auto",!0)("disabled",e.fieldsDisabled)}}function Ht(s,t){if(s&1&&(o(0,"div",59),_(1,"img",55),n()),s&2){let e=u();l(),d("src",e.product.getImageUrl(),me)}}function Kt(s,t){s&1&&(o(0,"small",60),_(1,"i",61),p(2,"Le stock n'est pas g\xE9r\xE9 pour les services. "),n())}function Yt(s,t){if(s&1){let e=P();o(0,"div",62)(1,"div",63)(2,"button",64),h("click",function(){c(e);let r=u();return m(r.onSubmit())}),n(),o(3,"button",65),h("click",function(){c(e);let r=u();return m(r.mode==="create"?r.onCancel():r.cancelEditing())}),n()()()}if(s&2){let e=u();l(2),d("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading),l(),d("disabled",e.loading)}}var N=class s{buttonEl;mode="create";initialData=null;loading=!1;submitForm=new ge;cancel=new ge;submitted=!1;isEditing=!1;typeOptions=[{label:D.materiel,value:"materiel"},{label:D.service,value:"service"},{label:D.fabricable,value:"fabricable"},{label:D.achat_vente,value:"achat_vente"}];statutOptions=[{label:M.brouillon,value:"brouillon"},{label:M.actif,value:"actif"},{label:M.inactif,value:"inactif"},{label:M.rupture_stock,value:"rupture_stock"}];product=new g({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"actif",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null});selectedImageFile=null;imagePreview=null;ngOnInit(){this.initialData&&(this.product=new g(this.initialData),this.imagePreview=this.initialData.image_url),this.mode==="create"&&(this.isEditing=!0)}isPrixUsineVisible(){return this.product.type==="fabricable"}isPrixUsineRequired(){return this.product.type==="fabricable"}isPrixVenteRequired(){return["fabricable","achat_vente"].includes(this.product.type)}ngOnChanges(t){t.initialData?.currentValue&&(this.product=new g(t.initialData.currentValue),this.imagePreview=t.initialData.currentValue.image_url??null,this.mode==="edit"&&(this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null)),t.mode?.currentValue==="create"&&(this.isEditing=!0)}isPrixAchatRequired(){return["materiel","achat_vente"].includes(this.product.type)}isQteStockDisabled(){return this.product.type==="service"||this.fieldsDisabled}isValidPrice(t){return typeof t=="number"&&t>=0}isPriceMissing(t){return t==null}hasServicePrice(){return this.isValidPrice(this.product.prix_achat)||this.isValidPrice(this.product.prix_vente)}showServicePriceError(){return this.submitted&&this.isEditing&&this.product.type==="service"&&!this.hasServicePrice()}get isActifSwitch(){return this.product.statut==="actif"}onStatutToggleChange(t){this.product.statut=t?"actif":"inactif"}onTypeChange(){this.isPrixUsineVisible()||(this.product.prix_usine=null),this.product.type==="service"&&(this.product.qte_stock=0)}isValid(){return!(!this.product.nom?.trim()||!this.product.type||this.isPrixUsineRequired()&&!this.isValidPrice(this.product.prix_usine)||this.isPrixVenteRequired()&&!this.isValidPrice(this.product.prix_vente)||this.isPrixAchatRequired()&&!this.isValidPrice(this.product.prix_achat)||this.product.type==="service"&&!this.hasServicePrice())}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.selectedImageFile=null,this.initialData?(this.product=new g(this.initialData),this.imagePreview=this.initialData.image_url):this.resetForm()}onUpload(t){if(t?.files?.length){let e=t.files[0];this.selectedImageFile=e;let i=new FileReader;i.onload=r=>this.imagePreview=r.target.result,i.readAsDataURL(e)}}removeImage(t){t.stopPropagation(),this.selectedImageFile=null,this.imagePreview=null,this.product.image_url=null}onSubmit(){if(this.submitted=!0,!this.isValid())return;let t={nom:this.product.nom.trim(),type:this.product.type,qte_stock:this.product.qte_stock,description:this.product.description?.trim()||void 0,cout:this.product.cout??void 0};t.statut=this.product.statut,this.product.prix_usine!==null&&(t.prix_usine=this.product.prix_usine),this.product.prix_vente!==null&&(t.prix_vente=this.product.prix_vente),this.product.prix_achat!==null&&(t.prix_achat=this.product.prix_achat),this.selectedImageFile&&(t.image=this.selectedImageFile),console.log("DTO:",t),this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}getPrixHelperText(){switch(this.product.type){case"materiel":return"Prix d'achat obligatoire";case"service":return"Pour un service, renseignez au moins un prix : achat ou vente";case"fabricable":return"Prix usine et prix de vente obligatoires";case"achat_vente":return"Prix d'achat et prix de vente obligatoires";default:return"S\xC3\xA9lectionnez un type de produit"}}resetForm(){this.submitted=!1,this.selectedImageFile=null,this.imagePreview=null,this.product=new g({nom:"",code:"",prix_usine:null,prix_achat:null,prix_vente:null,qte_stock:0,cout:null,statut:"actif",type:"materiel",in_stock:!0,is_archived:!1,description:null,image_url:null})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=I({type:s,selectors:[["app-produits-form"]],viewQuery:function(e,i){if(e&1&&j(Rt,5),e&2){let r;G(r=Q())&&(i.buttonEl=r)}},inputs:{mode:"mode",initialData:"initialData",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[k([w]),ye],decls:57,vars:35,consts:[["fileUploader",""],["content",""],[1,"card","product-form"],[1,"flex","justify-between","items-start","gap-4","mb-8","form-header"],[1,"block","text-surface-900","dark:text-surface-0","font-bold","text-2xl"],[1,"text-surface-500","dark:text-surface-300"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-6","flex-wrap"],[1,"col-span-12","lg:col-span-8"],[1,"form-section","mb-6"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","mt-2"],["id","nom","pInputText","","type","text","placeholder","Nom du produit","fluid","",3,"ngModelChange","ngModel","disabled","invalid"],["class","text-red-500",4,"ngIf"],[1,"col-span-12","mt-4"],[1,"col-span-12","lg:col-span-4"],["inputId","prix_achat","mode","currency","currency","GNF","locale","fr-GN","placeholder","prix d'achat","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["inputId","prix_vente","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix de vente","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],["inputId","cout","mode","currency","currency","GNF","locale","fr-GN","placeholder","co\xFBt","fluid","",3,"ngModelChange","ngModel","min","disabled"],["class","col-span-12 lg:col-span-4 mt-4",4,"ngIf"],["class","col-span-12 service-alert",4,"ngIf"],[1,"form-section"],[1,"section-title"],[1,"pi","pi-image","mr-2"],[4,"ngIf"],["class","flex justify-center mt-2",4,"ngIf"],[1,"col-span-12","lg:col-span-4","flex","flex-col","gap-y-4","mt-7"],[1,"border","border-surface-200","dark:border-surface-700","rounded"],[1,"text-surface-900","dark:text-surface-0","font-bold","block","border-b","border-surface-200","dark:border-surface-700","p-4"],[1,"p-4"],[1,"bg-surface-100","dark:bg-surface-700","py-2","px-4","flex","items-center","rounded"],[1,"text-black/90","dark:text-surface-0!","font-bold","mr-4"],[1,"text-black/60","dark:text-surface-0!","font-semibold"],[1,"ml-auto",3,"ngModelChange","ngModel","disabled"],["placeholder","S\xE9lectionner un type",3,"ngModelChange","onChange","options","ngModel","disabled"],["placeholder","0","fluid","",3,"ngModelChange","ngModel","showButtons","min","disabled"],["class","text-gray-500 block mt-2 mb-2 ml-4",4,"ngIf"],[1,"sticky","top-6","flex","flex-col","gap-4"],["class","form-section p-4",4,"ngIf"],["pButton","","pRipple","","label","Modifier","icon","pi pi-pencil","severity","warn",1,"w-auto",3,"click"],[1,"text-red-500"],[1,"col-span-12","lg:col-span-4","mt-4"],["inputId","prix_usine","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix usine","fluid","",3,"ngModelChange","ngModel","min","disabled","invalid"],[1,"col-span-12","service-alert"],[1,"pi","pi-exclamation-circle","mr-2"],["name","image","accept","image/*","styleClass","product-uploader border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 p-0 rounded-lg",3,"onSelect","customUpload","multiple","showUploadButton","showCancelButton","auto","disabled"],[1,"w-full","py-4","upload-dropzone",3,"click"],["class","h-48 flex flex-col justify-center items-center",4,"ngIf"],["class","relative w-full flex justify-center py-3",4,"ngIf"],[1,"h-48","flex","flex-col","justify-center","items-center"],[1,"pi","pi-image","text-primary","text-4xl","mb-4"],[1,"block","font-semibold","text-surface-900","dark:text-surface-0","text-lg"],[1,"text-surface-500","text-sm","mt-1"],[1,"relative","w-full","flex","justify-center","py-3"],[1,"relative"],["alt","Image du produit",1,"max-h-72","rounded","shadow","object-contain",3,"src"],["pButton","","pRipple","","rounded","","type","button","severity","danger","class","absolute -top-2 -right-2",3,"click",4,"ngIf"],["pButton","","pRipple","","rounded","","type","button","severity","danger",1,"absolute","-top-2","-right-2",3,"click"],[1,"pi","pi-times"],[1,"flex","justify-center","mt-2"],[1,"text-gray-500","block","mt-2","mb-2","ml-4"],[1,"pi","pi-info-circle","mr-1"],[1,"form-section","p-4"],[1,"flex","gap-3"],["pButton","","pRipple","","icon","pi pi-check",1,"flex-1",3,"click","label","loading","disabled"],["pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"flex-1",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"div",2)(1,"div",3)(2,"div")(3,"span",4),p(4),n(),o(5,"small",5),p(6," Renseignez les informations principales, les prix et le statut de publication. "),n()(),f(7,Ot,1,0,"button",6),n(),o(8,"p-fluid",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"input",12),x("ngModelChange",function(a){return v(i.product.nom,a)||(i.product.nom=a),a}),n(),f(14,At,2,0,"small",13),n(),o(15,"div",14)(16,"div",10)(17,"div",15)(18,"p-inputnumber",16),x("ngModelChange",function(a){return v(i.product.prix_achat,a)||(i.product.prix_achat=a),a}),n(),f(19,Lt,2,0,"small",13),n(),o(20,"div",15)(21,"p-inputnumber",17),x("ngModelChange",function(a){return v(i.product.prix_vente,a)||(i.product.prix_vente=a),a}),n(),f(22,Ut,2,0,"small",13),n(),o(23,"div",15)(24,"p-inputnumber",18),x("ngModelChange",function(a){return v(i.product.cout,a)||(i.product.cout=a),a}),n()()()(),f(25,Wt,3,5,"div",19)(26,Bt,3,0,"div",20),n()(),o(27,"div",21)(28,"div",22),_(29,"i",23),p(30," Visuel du produit "),n(),f(31,zt,5,6,"div",24)(32,Ht,2,1,"div",25),n()(),o(33,"div",26)(34,"div",27)(35,"span",28),p(36,"Etat du produit"),n(),o(37,"div",29)(38,"div",30)(39,"span",31),p(40,"Status:"),n(),o(41,"span",32),p(42),n(),o(43,"p-toggleswitch",33),h("ngModelChange",function(a){return i.onStatutToggleChange(a)}),n()()()(),o(44,"div",27)(45,"span",28),p(46,"Type"),n(),o(47,"div",29)(48,"p-select",34),x("ngModelChange",function(a){return v(i.product.type,a)||(i.product.type=a),a}),h("onChange",function(){return i.onTypeChange()}),n()()(),o(49,"div",27)(50,"span",28),p(51,"Quantit\xE9 en stock"),n(),o(52,"div",29)(53,"p-inputnumber",35),x("ngModelChange",function(a){return v(i.product.qte_stock,a)||(i.product.qte_stock=a),a}),n()(),f(54,Kt,3,0,"small",36),n(),o(55,"div",37),f(56,Yt,4,4,"div",38),n()()()()),e&2&&(l(4),Pe(" ",i.mode==="create"?"Cr\xE9er un produit":"D\xE9tails du produit"," "),l(3),d("ngIf",i.mode==="edit"&&!i.isEditing),l(6),b("ngModel",i.product.nom),d("disabled",i.fieldsDisabled)("invalid",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())),l(),d("ngIf",i.submitted&&!(i.product.nom!=null&&i.product.nom.trim())&&i.isEditing),l(4),b("ngModel",i.product.prix_achat),d("min",0)("disabled",i.fieldsDisabled)("invalid",i.submitted&&i.isPrixAchatRequired()&&i.isPriceMissing(i.product.prix_achat)),l(),d("ngIf",i.submitted&&i.isPrixAchatRequired()&&i.isPriceMissing(i.product.prix_achat)&&i.isEditing),l(2),b("ngModel",i.product.prix_vente),d("min",0)("disabled",i.fieldsDisabled)("invalid",i.submitted&&i.isPrixVenteRequired()&&i.isPriceMissing(i.product.prix_vente)),l(),d("ngIf",i.submitted&&i.isPrixVenteRequired()&&i.isPriceMissing(i.product.prix_vente)&&i.isEditing),l(2),b("ngModel",i.product.cout),d("min",0)("disabled",i.fieldsDisabled),l(),d("ngIf",i.isPrixUsineVisible()),l(),d("ngIf",i.showServicePriceError()),l(5),d("ngIf",i.isEditing),l(),d("ngIf",!i.isEditing&&i.product.image_url),l(10),F(i.isActifSwitch?"Actif":"Inactif"),l(),d("ngModel",i.isActifSwitch)("disabled",i.fieldsDisabled),l(5),d("options",i.typeOptions),b("ngModel",i.product.type),d("disabled",i.fieldsDisabled),l(5),b("ngModel",i.product.qte_stock),d("showButtons",!0)("min",0)("disabled",i.isQteStockDisabled()),l(),d("ngIf",i.product.type==="service"),l(2),d("ngIf",i.isEditing))},dependencies:[O,R,at,$,Z,X,K,Y,J,nt,rt,re,ie,se,ae,Le,Ae,te,ee,ot,Te,Me,oe,ne],styles:[".product-form[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--surface-200);padding-bottom:1rem}.product-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]{border:1px solid var(--surface-200);border-radius:.875rem;background:var(--surface-0);padding:1.25rem}.product-form[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-bottom:1rem;font-weight:700;color:var(--text-color)}.product-form[_ngcontent-%COMP%]   .side-title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-color);padding:1rem 1rem .875rem;border-bottom:1px solid var(--surface-200);background:color-mix(in srgb,var(--surface-50) 70%,transparent)}.product-form[_ngcontent-%COMP%]   .helper-chip[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--blue-100) 50%,transparent);border-radius:999px;padding:.35rem .7rem;font-weight:500}.product-form[_ngcontent-%COMP%]   .status-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-size:.8rem;font-weight:700;border-radius:999px;padding:.2rem .6rem}.product-form[_ngcontent-%COMP%]   .status-pill-active[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.product-form[_ngcontent-%COMP%]   .status-pill-inactive[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.product-form[_ngcontent-%COMP%]   .service-alert[_ngcontent-%COMP%]{display:flex;align-items:center;color:#991b1b;background:#fef2f2;border:1px solid #fecaca;border-radius:.5rem;padding:.65rem .8rem;font-size:.9rem}.product-form[_ngcontent-%COMP%]   .upload-dropzone[_ngcontent-%COMP%]{cursor:pointer;border-radius:.75rem;transition:background-color .2s ease}.product-form[_ngcontent-%COMP%]   .upload-dropzone[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary-50) 35%,transparent)}","[_nghost-%COMP%]     .p-fileupload-header{display:none}[_nghost-%COMP%]     .p-fileupload-file-list{display:none}[_nghost-%COMP%]     .p-fileupload-content{height:20rem}"]})};var ue=class s{constructor(t,e,i){this.router=t;this.messageService=e;this.produitService=i}loading=!1;onSubmitForm(t){this.loading=!0,this.produitService.create(t).subscribe({next:e=>this.handleSuccess("Produit cr\xE9\xE9 avec succ\xE8s",e),error:e=>this.handleError("Erreur lors de la cr\xE9ation du produit",e)})}onCancel(){this.router.navigate(["/produits"])}handleSuccess(t,e){if(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:t,life:2e3}),this.loading=!1,e?.id){this.router.navigate(["/produits/produits-edit",e.id]);return}this.router.navigate(["/produits"])}handleError(t,e){let i=e?.error?.message||t;e?.status===422&&e?.error?.errors?Object.values(e.error.errors).flat().forEach(a=>{this.messageService.add({severity:"error",summary:i,detail:a,life:5e3})}):this.messageService.add({severity:"error",summary:"Erreur",detail:i,life:5e3}),this.loading=!1,console.error(e)}static \u0275fac=function(e){return new(e||s)(C(A),C(w),C(T))};static \u0275cmp=I({type:s,selectors:[["app-produits-new"]],features:[k([w])],decls:2,vars:1,consts:[["mode","create",3,"submitForm","cancel","loading"]],template:function(e,i){e&1&&(_(0,"p-toast"),o(1,"app-produits-form",0),h("submitForm",function(a){return i.onSubmitForm(a)})("cancel",function(){return i.onCancel()}),n()),e&2&&(l(),d("loading",i.loading))},dependencies:[N,U,L],encapsulation:2})};function Jt(s,t){if(s&1){let e=P();o(0,"app-produits-form",1),h("submitForm",function(r){c(e);let a=u();return m(a.onSubmitForm(r))})("cancel",function(){c(e);let r=u();return m(r.onCancel())}),n()}if(s&2){let e=u();d("initialData",e.initialData)("loading",e.loading)}}var pe=class s{constructor(t,e,i,r){this.route=t;this.router=e;this.produitService=i;this.messageService=r}loading=!1;produitId=null;initialData=null;ngOnInit(){let t=this.route.snapshot.paramMap.get("id"),e=t?Number(t):NaN;if(!Number.isFinite(e)||e<=0){this.router.navigate(["/produits"]);return}this.produitId=e,this.loadProduit(e)}onSubmitForm(t){this.produitId&&(this.loading=!0,this.produitService.update(this.produitId,t).subscribe({next:e=>{this.initialData=e,this.loading=!1,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Produit modifi\xE9 avec succ\xE8s",life:3e3})},error:e=>{this.loading=!1,this.showApiError(e,"Erreur lors de la modification du produit")}}))}onCancel(){this.router.navigate(["/produits"])}loadProduit(t){this.loading=!0,this.produitService.getById(t).subscribe({next:e=>{this.initialData=e,this.loading=!1},error:e=>{this.loading=!1,this.showApiError(e,"Erreur lors du chargement du produit")}})}showApiError(t,e){let i=t?.error?.message||e;this.messageService.add({severity:"error",summary:"Erreur",detail:i,life:5e3})}static \u0275fac=function(e){return new(e||s)(C(we),C(A),C(T),C(w))};static \u0275cmp=I({type:s,selectors:[["app-produits-edit"]],features:[k([w])],decls:2,vars:1,consts:[["mode","edit",3,"initialData","loading","submitForm","cancel",4,"ngIf"],["mode","edit",3,"submitForm","cancel","initialData","loading"]],template:function(e,i){e&1&&(_(0,"p-toast"),f(1,Jt,1,2,"app-produits-form",0)),e&2&&(l(),d("ngIf",i.initialData))},dependencies:[O,R,N,U,L],encapsulation:2})};var Br=[{path:"",component:B},{path:"produits",component:B},{path:"produits-new",component:ue},{path:"produits-edit/:id",component:pe},{path:"**",redirectTo:"/notfound"}];export{Br as default};
