import{a as dt,b as ct,c as ut,d as _t,e as gt,f as ft}from"./chunk-MWSLOWH7.js";import{e as mt}from"./chunk-G3EWAPCI.js";import{a as lt,b as pt}from"./chunk-YN5NEZXT.js";import"./chunk-IQMD5EXF.js";import{a as re}from"./chunk-76H2XSLD.js";import{a as ce,b as ot}from"./chunk-JFBSWTEJ.js";import{a as O}from"./chunk-IUCT6ZC4.js";import{a as at,b as st}from"./chunk-B343KFHS.js";import{a as nt}from"./chunk-BODMXXTX.js";import{a as He,b as Ge}from"./chunk-S6GQEZ25.js";import{a as it,b as rt}from"./chunk-OSPOBHXF.js";import"./chunk-W6ATTUIF.js";import{a as Qe,d as Ze,e as Je,f as Xe,k as $e}from"./chunk-H3KUFEZW.js";import"./chunk-J2NAM4JI.js";import{a as Ye}from"./chunk-HAPAEHXV.js";import"./chunk-UWQRO6Z5.js";import"./chunk-KBIYZYNQ.js";import"./chunk-PLDQAYOC.js";import"./chunk-OODPPDAJ.js";import{a as et,b as tt}from"./chunk-LBJBWH2H.js";import"./chunk-QRO5GYCP.js";import"./chunk-6XF2XUWF.js";import"./chunk-KMJ4YXQB.js";import"./chunk-BJ3DV25B.js";import"./chunk-CKKBGSMP.js";import"./chunk-UUZ5LIFL.js";import{a as ie}from"./chunk-F3DTTKBG.js";import{a as qe,b as A,c as Ke}from"./chunk-6H43JJA3.js";import"./chunk-SIZMBHAK.js";import"./chunk-KE6PKGKV.js";import"./chunk-42H63HPA.js";import{b as Fe,d as F}from"./chunk-7G5MAEGV.js";import{a as q,b as K}from"./chunk-QTD5PLHI.js";import"./chunk-WU36US54.js";import"./chunk-OAY6NCLF.js";import{a as U,d as j}from"./chunk-64S7HSEB.js";import{c as Y,e as Q}from"./chunk-OPAF3U63.js";import"./chunk-QO7YANFN.js";import{c as te,d as ze}from"./chunk-3ZFUBRWI.js";import"./chunk-VV6ELWME.js";import"./chunk-VSD657XK.js";import"./chunk-Z2X2BPAP.js";import{a as Ne,c as Be}from"./chunk-F4Z36YAX.js";import{a as ee,b as Ae}from"./chunk-OVLHBJZG.js";import{b as Z,e as J,f as De,g as Re,h as X,i as Le,p as $}from"./chunk-4JYGVSAH.js";import{a as We,b as je}from"./chunk-AGXCPBUM.js";import"./chunk-VPIKZKGZ.js";import"./chunk-YNVQ7POR.js";import"./chunk-3QS7CSSK.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as H,j as G}from"./chunk-LBKL4PXF.js";import"./chunk-G5FZIH5E.js";import{la as z,pa as E,ta as Oe}from"./chunk-5CRI5L3F.js";import{j as Ve,k as V,v as T}from"./chunk-PVTSUL7D.js";import"./chunk-4O3FVBGX.js";import{$b as Pe,Ab as s,Bb as a,Cb as h,Gb as Ee,Hb as Ue,Jb as b,La as le,Na as Ce,Nb as g,Ob as m,Pa as o,T as B,Ua as pe,X as be,Xb as R,Y as ve,Zb as Me,_a as w,_b as Te,ac as d,ba as c,bc as v,ca as u,cc as L,db as M,dc as Ie,fc as y,ga as ye,gc as x,hc as C,ic as ke,jb as _,jc as k,kc as W,oa as xe,rb as S,ub as we,uc as me,vb as Se,wc as de,yc as I,zb as l}from"./chunk-WZ5FQRRG.js";import{a as fe,b as he}from"./chunk-GAL4ENT6.js";var P=class r{constructor(t){this.http=t}apiUrl=`${A.apiUrl}/users`;authUrl=`${A.apiUrl}/auth`;createUser(t){return this.http.post(`${this.authUrl}/register`,t)}createUserViaApi(t){return this.http.post(this.apiUrl,t)}getUsers(t){let e=new U;return t&&(t.is_active!==void 0&&(e=e.set("is_active",t.is_active.toString())),t.search&&(e=e.set("search",t.search)),t.pays&&(e=e.set("pays",t.pays)),t.ville&&(e=e.set("ville",t.ville)),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.page&&(e=e.set("page",t.page.toString()))),this.http.get(this.apiUrl,{params:e})}getUser(t){return this.http.get(`${this.apiUrl}/${t}`)}updateUser(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}toggleUserStatus(t){return this.http.patch(`${this.apiUrl}/${t}/toggle-status`,{})}deleteUser(t){return this.http.delete(`${this.apiUrl}/${t}`)}searchUsers(t){let e=new U().set("search",t);return this.http.get(this.apiUrl,{params:e})}getActiveUsers(){let t=new U().set("is_active","true");return this.http.get(this.apiUrl,{params:t})}getInactiveUsers(){let t=new U().set("is_active","false");return this.http.get(this.apiUrl,{params:t})}getUsersByCountry(t){let e=new U().set("pays",t);return this.http.get(this.apiUrl,{params:e})}getUsersByCity(t){let e=new U().set("ville",t);return this.http.get(this.apiUrl,{params:e})}getUsersPaginated(t=1,e=10,n){let i=new U().set("page",t.toString()).set("per_page",e.toString());return n&&(n.is_active!==void 0&&(i=i.set("is_active",n.is_active.toString())),n.search&&(i=i.set("search",n.search)),n.pays&&(i=i.set("pays",n.pays)),n.ville&&(i=i.set("ville",n.ville)),n.sort_by&&(i=i.set("sort_by",n.sort_by)),n.sort_order&&(i=i.set("sort_order",n.sort_order))),this.http.get(this.apiUrl,{params:i})}sortUsers(t,e="asc"){let n=new U().set("sort_by",t||"created_at").set("sort_order",e);return this.http.get(this.apiUrl,{params:n})}static \u0275fac=function(e){return new(e||r)(be(j))};static \u0275prov=B({token:r,factory:r.\u0275fac,providedIn:"root"})};var Et=()=>[10,25,50],Ut=()=>["nom_complet","email","phone","reference","pays","ville"],Mt=()=>({"min-width":"150px"});function Tt(r,t){if(r&1){let e=b();s(0,"button",37),g("click",function(i){c(e);let p=m().$implicit,f=m(2);return i.stopPropagation(),u(f.deleteUser(i,p.id))}),a()}r&2&&l("pTooltip","Supprimer")}function Pt(r,t){if(r&1){let e=b();s(0,"article",27),g("click",function(i){let p=c(e).$implicit,f=m(2);return u(f.goToEdit(i,p.id))}),s(1,"div",28),d(2),a(),s(3,"div",29)(4,"div",30),d(5),a(),s(6,"div",31),d(7),me(8,"phoneFormat"),a(),s(9,"div",32),h(10,"p-tag",33),s(11,"div",34)(12,"button",35),g("click",function(i){let p=c(e).$implicit,f=m(2);return u(f.goToEdit(i,p.id))}),a(),_(13,Tt,1,1,"button",36),a()()()()}if(r&2){let e=t.$implicit,n=m(2);o(2),L(" ",n.getInitials(e.nom_complet)," "),o(3),v(e.nom_complet),o(2),v(e.email||de(8,8,e.phone,"INT")),o(3),l("value",e.is_active?"Actif":"Inactif")("severity",e.is_active?"success":"danger"),o(2),l("pTooltip",n.canUpdate?"Modifier":"Voir")("disabled",!n.canUpdate),o(),l("ngIf",n.canDelete)}}function It(r,t){if(r&1&&(s(0,"section",25),_(1,Pt,14,11,"article",26),a()),r&2){let e=m();o(),l("ngForOf",e.mobileVisibleUsers)("ngForTrackBy",e.trackByUserId)}}function kt(r,t){r&1&&(s(0,"div",39),d(1,"Chargement..."),a())}function Vt(r,t){r&1&&(s(0,"div",39),d(1,"Aucun utilisateur."),a())}function Ft(r,t){if(r&1&&_(0,kt,2,0,"div",38)(1,Vt,2,0,"div",38),r&2){let e=m();l("ngIf",e.loading),o(),l("ngIf",!e.loading&&!e.mobileFilteredUsers.length)}}function Ot(r,t){if(r&1){let e=b();s(0,"div",40)(1,"button",41),g("click",function(){c(e);let i=m();return u(i.loadMoreMobile())}),a()()}}function Dt(r,t){if(r&1){let e=b();s(0,"button",42),g("click",function(){c(e);let i=m();return u(i.navigateToCreate())}),h(1,"i",43),a()}}function Rt(r,t){if(r&1){let e=b();s(0,"button",50),g("click",function(){c(e);let i=m(2);return u(i.navigateToCreate())}),a()}}function Lt(r,t){if(r&1){let e=b();s(0,"div",44)(1,"p-icon-field",45),h(2,"p-inputicon",18),s(3,"input",46),g("input",function(i){c(e);let p=m(),f=R(24);return u(p.onGlobalFilter(f,i))}),a()(),s(4,"div",47)(5,"p-select",48),C("ngModelChange",function(i){c(e);let p=m();return x(p.selectedStatus,i)||(p.selectedStatus=i),u(i)}),g("onChange",function(){c(e);let i=m();return u(i.filterByStatus())}),a(),_(6,Rt,1,0,"button",49),a()()}if(r&2){let e=m();o(5),Te(W(6,Mt)),l("options",e.statusOptions),y("ngModel",e.selectedStatus),l("showClear",!0),o(),l("ngIf",e.canCreate)}}function At(r,t){r&1&&(s(0,"tr")(1,"th",51)(2,"span",52),d(3," Nom complet "),h(4,"p-sortIcon",53),a()(),s(5,"th",54)(6,"span",52),d(7," T\xE9l\xE9phone "),h(8,"p-sortIcon",55),a()(),s(9,"th",56)(10,"span",52),d(11," R\xF4le "),a()(),s(12,"th",57)(13,"span",52),d(14," Adresse "),h(15,"p-sortIcon",58),a()(),s(16,"th",59)(17,"span",52),d(18," Statut "),h(19,"p-sortIcon",60),a()(),s(20,"th",61),d(21," Actions "),a()())}function Nt(r,t){if(r&1&&h(0,"p-tag",75),r&2){let e=t.$implicit,n=m(3);l("value",e)("severity",n.getRoleSeverity(e))}}function Bt(r,t){if(r&1&&(Ee(0),_(1,Nt,1,2,"p-tag",74),Ue()),r&2){let e=m().$implicit;o(),l("ngForOf",e.role_names||e.roles)}}function Wt(r,t){r&1&&(s(0,"span",76),d(1,"-"),a())}function jt(r,t){if(r&1){let e=b();s(0,"button",77),g("click",function(i){c(e);let p=m().$implicit,f=m();return u(f.toggleStatus(i,p.id))}),a()}if(r&2){let e=m().$implicit;Me("p-button-success",e.is_active)("p-button-danger",!e.is_active),l("icon",e.is_active?"pi pi-lock-open":"pi pi-lock")("pTooltip",e.is_active?"D\xE9sactiver":"Activer")}}function zt(r,t){if(r&1){let e=b();s(0,"button",37),g("click",function(i){c(e);let p=m().$implicit,f=m();return u(f.deleteUser(i,p.id))}),a()}r&2&&l("pTooltip","Supprimer")}function qt(r,t){if(r&1){let e=b();s(0,"tr",62)(1,"td")(2,"div",52)(3,"div",63),d(4),a(),s(5,"div")(6,"div",64),d(7),a(),s(8,"div",65),d(9),a()()()(),s(10,"td")(11,"div",66)(12,"span",67),d(13),me(14,"phoneFormat"),a()()(),s(15,"td"),_(16,Bt,2,1,"ng-container",68)(17,Wt,2,0,"ng-template",null,7,I),a(),s(19,"td")(20,"div",52),h(21,"span"),s(22,"div")(23,"div",69),d(24),a(),s(25,"div",70),d(26),a()()()(),s(27,"td"),h(28,"p-tag",71),a(),s(29,"td")(30,"div",72)(31,"button",35),g("click",function(i){let p=c(e).$implicit,f=m();return u(f.goToEdit(i,p.id))}),a(),_(32,jt,1,6,"button",73)(33,zt,1,1,"button",36),a()()()}if(r&2){let e=t.$implicit,n=R(18),i=m();l("pSelectableRow",e),o(4),L(" ",i.getInitials(e.nom_complet)," "),o(3),v(e.nom_complet),o(2),v(e.reference),o(4),v(de(14,18,e.phone,"INT")),o(3),l("ngIf",(e.role_names==null?null:e.role_names.length)||(e.roles==null?null:e.roles.length))("ngIfElse",n),o(5),Pe(ke("fi fi-",e.code_pays==null?null:e.code_pays.toLowerCase()," text-xl")),o(3),v(e.ville),o(2),v(e.quartier),o(2),l("value",e.is_active?"Actif":"Inactif")("severity",e.is_active?"success":"danger"),o(3),l("pTooltip",i.canUpdate?"Modifier":"Voir")("disabled",!i.canUpdate),o(),l("ngIf",i.canUpdate),o(),l("ngIf",i.canDelete)}}function Kt(r,t){r&1&&(s(0,"tr")(1,"td",78)(2,"div",79),h(3,"i",80),s(4,"span"),d(5,"Aucun utilisateur trouv\xE9"),a()()()())}var ne=class r{constructor(t,e,n,i,p,f){this.userService=t;this.router=e;this.messageService=n;this.confirmationService=i;this.authService=p;this.document=f;this.canCreate=this.authService.hasPermission("users.create"),this.canUpdate=this.authService.hasPermission("users.update"),this.canDelete=this.authService.hasPermission("users.delete")}users=[];selectedUser=null;loading=!1;selectedStatus=null;mobileSearchTerm="";mobilePageSize=10;mobileVisibleCount=this.mobilePageSize;mobileBreakpoint=768;mobilePwaClass="utilisateurs-mobile-pwa";statusOptions=[{label:"Actif",value:!0},{label:"Inactif",value:!1}];mobileStatusMenuItems=[{label:"Tous les statuts",command:()=>this.applyMobileStatusFilter(null)},{label:"Actif",command:()=>this.applyMobileStatusFilter(!0)},{label:"Inactif",command:()=>this.applyMobileStatusFilter(!1)}];canCreate=!1;canUpdate=!1;canDelete=!1;ngOnInit(){this.loadUsers(),this.syncMobilePwaMode()}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onWindowResize(){this.syncMobilePwaMode()}goHome(){this.router.navigate(["/"])}onMobileSearchChange(){this.mobileVisibleCount=this.mobilePageSize}get mobileFilteredUsers(){let t=this.mobileSearchTerm.trim().toLowerCase();return t?this.users.filter(e=>e.nom_complet&&e.nom_complet.toLowerCase().includes(t)||e.email&&e.email.toLowerCase().includes(t)||e.phone&&e.phone.replace(/\s/g,"").includes(t)||e.reference&&e.reference.toLowerCase().includes(t)):this.users}get mobileVisibleUsers(){return this.mobileFilteredUsers.slice(0,this.mobileVisibleCount)}get canLoadMoreMobile(){return this.mobileVisibleCount<this.mobileFilteredUsers.length}loadMoreMobile(){this.mobileVisibleCount+=this.mobilePageSize}trackByUserId(t,e){return e.id}syncMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}loadUsers(){this.loading=!0;let t=this.selectedStatus!==null?{is_active:this.selectedStatus}:void 0;this.userService.getUsers(t).subscribe({next:e=>{e.success&&(this.users=Array.isArray(e.data)?e.data:e.data.data,this.mobileVisibleCount=this.mobilePageSize),this.loading=!1},error:e=>{console.error("Erreur lors du chargement des utilisateurs:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les utilisateurs"}),this.loading=!1}})}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}filterByStatus(){this.loadUsers()}applyMobileStatusFilter(t){this.selectedStatus=t,this.loadUsers()}navigateToCreate(){this.router.navigate(["contacts/utilisateurs/new"])}onRowSelect(t){this.router.navigate(["contacts/utilisateurs/edit",t.data.id])}goToEdit(t,e){t.stopPropagation(),this.router.navigate(["contacts/utilisateurs/edit/",e])}toggleStatus(t,e){t.stopPropagation();let i=this.users.find(p=>p.id===e)?.is_active?"d\xE9sactiver":"activer";this.confirmationService.confirm({message:`Voulez-vous vraiment ${i} cet utilisateur ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui",rejectLabel:"Non",accept:()=>{this.userService.toggleUserStatus(e).subscribe({next:p=>{p.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:p.message}),this.loadUsers())},error:p=>{console.error("Erreur:",p),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de changer le statut de l'utilisateur"})}})}})}deleteUser(t,e){t.stopPropagation(),this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer cet utilisateur ? Cette action est irr\xE9versible.",header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",acceptLabel:"Oui, supprimer",rejectLabel:"Annuler",acceptButtonStyleClass:"p-button-danger",accept:()=>{this.userService.deleteUser(e).subscribe({next:n=>{n.success&&(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur supprim\xE9 avec succ\xE8s"}),this.loadUsers())},error:n=>{console.error("Erreur:",n),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer l'utilisateur"})}})}})}getInitials(t){if(!t)return"??";let e=t.trim().split(" ");return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():t.substring(0,2).toUpperCase()}getRoleSeverity(t){return{admin:"danger",manager:"warn",employe:"info",superviseur:"success"}[t?.toLowerCase()]||"secondary"}static \u0275fac=function(e){return new(e||r)(w(P),w(F),w(E),w(z),w(Ke),w(ye))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-liste"]],hostBindings:function(e,n){e&1&&g("resize",function(){return n.onWindowResize()},Ce)},features:[k([E,z])],decls:33,vars:20,consts:[["statusMenu",""],["mobileListState",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["noRole",""],[1,"utilisateurs-mobile-app"],[1,"mobile-header"],["pButton","","pRipple","","icon","pi pi-arrow-left","aria-label","Retour \xE0 l'accueil",1,"p-button-rounded","p-button-text","mobile-back",3,"click"],[1,"mobile-title-wrap"],[1,"mobile-title"],[1,"mobile-subtitle"],["appendTo","body","styleClass","mobile-status-menu",3,"model","popup"],["pButton","","pRipple","","icon","pi pi-filter","aria-label","Filtrer par statut",1,"p-button-rounded","p-button-text","mobile-add",3,"click"],[1,"mobile-scroll"],[1,"mobile-search"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Nom, email, t\xE9l\xE9phone...",1,"w-full",3,"ngModelChange","ngModel"],["class","mobile-list",4,"ngIf","ngIfElse"],["class","mobile-load-more",4,"ngIf"],["type","button","class","mobile-fab","aria-label","Nouveau utilisateur",3,"click",4,"ngIf"],[1,"card","utilisateurs-desktop"],["paginatorDropdownAppendTo","body","responsiveLayout","scroll","currentPageReportTemplate","  {first} / {last} de {totalRecords} entr\xE9es","selectionMode","single","styleClass","cursor-pointer",3,"selectionChange","onRowSelect","value","paginator","rows","showCurrentPageReport","loading","rowsPerPageOptions","globalFilterFields","selection","rowHover"],[1,"mobile-list"],["class","mobile-user-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mobile-user-card",3,"click"],["aria-hidden","true",1,"mobile-card-avatar"],[1,"mobile-card-body"],[1,"mobile-card-name"],[1,"mobile-card-meta"],[1,"mobile-card-footer"],["styleClass","mobile-status-tag",3,"value","severity"],[1,"mobile-card-actions"],["pButton","","pRipple","","icon","pi pi-eye","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","pTooltip","disabled"],["pButton","","pRipple","","icon","pi pi-trash","class","p-button-rounded p-button-text p-button-danger p-button-sm","tooltipPosition","top",3,"pTooltip","click",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-trash","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-danger","p-button-sm",3,"click","pTooltip"],["class","mobile-state",4,"ngIf"],[1,"mobile-state"],[1,"mobile-load-more"],["pButton","","label","Charger plus","icon","pi pi-angle-down",1,"mobile-load-more-btn",3,"click"],["type","button","aria-label","Nouveau utilisateur",1,"mobile-fab",3,"click"],[1,"pi","pi-user-plus"],[1,"flex","flex-wrap","gap-2","items-center","justify-between"],[1,"w-full","sm:w-80","order-1","sm:order-0"],["pInputText","","type","text","placeholder","Rechercher un utilisateur...",1,"w-full",3,"input"],[1,"flex","gap-2","w-full","sm:w-auto","flex-order-0","sm:flex-order-1"],["placeholder","Tous les statuts",3,"ngModelChange","onChange","options","ngModel","showClear"],["pButton","","outlined","","class","flex-shrink-0","icon","pi pi-user-plus","label","Nouveau",3,"click",4,"ngIf"],["pButton","","outlined","","icon","pi pi-user-plus","label","Nouveau",1,"flex-shrink-0",3,"click"],["pSortableColumn","nom_complet",1,"white-space-nowrap",2,"width","25%"],[1,"flex","items-center","gap-2"],["field","nom_complet"],["pSortableColumn","phone",1,"white-space-nowrap",2,"width","15%"],["field","phone"],[1,"white-space-nowrap",2,"width","12%"],["pSortableColumn","pays",1,"white-space-nowrap",2,"width","18%"],["field","pays"],["pSortableColumn","is_active",1,"white-space-nowrap",2,"width","10%"],["field","is_active"],[1,"white-space-nowrap",2,"width","10%"],[3,"pSelectableRow"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary-100","text-primary-700","font-semibold"],[1,"font-semibold"],[1,"text-sm","text-surface-500","mt-1"],[1,"flex","items-center","gap-1"],[1,"text-surface-700"],[4,"ngIf","ngIfElse"],[1,"font-medium"],[1,"text-sm","text-surface-500"],[3,"value","severity"],[1,"flex","gap-2"],["pButton","","pRipple","","class","p-button-rounded p-button-text p-button-sm","tooltipPosition","top",3,"icon","p-button-success","p-button-danger","pTooltip","click",4,"ngIf"],["class","mr-1",3,"value","severity",4,"ngFor","ngForOf"],[1,"mr-1",3,"value","severity"],[1,"text-surface-400"],["pButton","","pRipple","","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm",3,"click","icon","pTooltip"],["colspan","6",1,"text-center","py-8"],[1,"flex","flex-col","items-center","gap-3","text-surface-500"],[1,"pi","pi-users","text-4xl"]],template:function(e,n){if(e&1){let i=b();h(0,"p-confirmDialog"),s(1,"div",8)(2,"header",9)(3,"button",10),g("click",function(){return c(i),u(n.goHome())}),a(),s(4,"div",11)(5,"h1",12),d(6,"Utilisateurs"),a(),s(7,"p",13),d(8),a()(),h(9,"p-menu",14,0),s(11,"button",15),g("click",function(f){c(i);let xt=R(10);return u(xt.toggle(f))}),a()(),s(12,"div",16)(13,"section",17)(14,"p-icon-field"),h(15,"p-inputicon",18),s(16,"input",19),C("ngModelChange",function(f){return c(i),x(n.mobileSearchTerm,f)||(n.mobileSearchTerm=f),u(f)}),g("ngModelChange",function(){return c(i),u(n.onMobileSearchChange())}),a()()(),_(17,It,2,2,"section",20)(18,Ft,2,2,"ng-template",null,1,I)(20,Ot,2,0,"div",21),a(),_(21,Dt,2,0,"button",22),a(),s(22,"div",23)(23,"p-table",24,2),C("selectionChange",function(f){return c(i),x(n.selectedUser,f)||(n.selectedUser=f),u(f)}),g("onRowSelect",function(f){return c(i),u(n.onRowSelect(f))}),_(25,Lt,7,7,"ng-template",null,3,I)(27,At,22,0,"ng-template",null,4,I)(29,qt,34,21,"ng-template",null,5,I)(31,Kt,6,0,"ng-template",null,6,I),a()()}if(e&2){let i=R(19);o(8),Ie("",n.mobileFilteredUsers.length," utilisateur",n.mobileFilteredUsers.length!==1?"s":""),o(),l("model",n.mobileStatusMenuItems)("popup",!0),o(7),y("ngModel",n.mobileSearchTerm),o(),l("ngIf",!n.loading&&n.mobileVisibleUsers.length)("ngIfElse",i),o(3),l("ngIf",!n.loading&&n.canLoadMoreMobile),o(),l("ngIf",n.canCreate),o(2),l("value",n.users)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("loading",n.loading)("rowsPerPageOptions",W(18,Et))("globalFilterFields",W(19,Ut)),y("selection",n.selectedUser),l("rowHover",!0)}},dependencies:[T,Ve,V,$,Z,J,X,$e,Qe,Ze,Xe,Je,Ae,ee,Q,Y,G,H,Ne,Be,tt,et,je,We,ze,te,rt,it,Ge,He,nt],styles:["[_nghost-%COMP%]{display:block}.utilisateurs-mobile-app[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 768px){[_nghost-%COMP%]{--mobile-primary: #5f6bff;--mobile-text: #334155;--mobile-muted: #7f8ca3;--mobile-card: #ffffff;--mobile-border: #e2e8f0}.utilisateurs-desktop[_ngcontent-%COMP%]{display:none}.utilisateurs-mobile-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;height:100vh;height:100dvh;overflow:hidden;margin-top:calc(-.25rem - env(safe-area-inset-top));margin-left:-.875rem;margin-right:-.875rem;margin-bottom:calc(-.875rem - env(safe-area-inset-bottom));padding:0 .875rem env(safe-area-inset-bottom);padding-left:calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:#f8fafc;animation:_ngcontent-%COMP%_mobileFade .24s ease-out}.mobile-header[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;gap:.55rem;margin:0 -.875rem;padding:calc(.5rem + env(safe-area-inset-top)) calc(.875rem + env(safe-area-inset-right)) .6rem calc(.875rem + env(safe-area-inset-left));background:var(--mobile-card);border-bottom:1px solid var(--mobile-border);box-shadow:0 1px 3px #0f172a0f;position:sticky;top:0;z-index:30}.mobile-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:.75rem;padding-bottom:calc(4rem + env(safe-area-inset-bottom))}.mobile-back[_ngcontent-%COMP%], .mobile-add[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;flex-shrink:0;color:var(--mobile-primary)!important;background:#5f6bff1a!important}.mobile-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0;text-align:center}.mobile-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--mobile-text)}.mobile-subtitle[_ngcontent-%COMP%]{margin:.15rem 0 0;font-size:.8rem;font-weight:500;color:var(--mobile-muted)}.mobile-search[_ngcontent-%COMP%]{background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.75rem;padding:.4rem .6rem}.mobile-search[_ngcontent-%COMP%]   .p-iconfield[_ngcontent-%COMP%], .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{width:100%}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{border:0;box-shadow:none;background:transparent;font-size:.95rem}.mobile-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem;margin-top:1rem}.mobile-user-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.875rem;background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.875rem;padding:.875rem;box-shadow:0 1px 3px #0000000d;cursor:pointer;transition:box-shadow .2s ease}.mobile-user-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000014}.mobile-card-avatar[_ngcontent-%COMP%]{width:2.75rem;height:2.75rem;min-width:2.75rem;min-height:2.75rem;border-radius:50%;background:linear-gradient(135deg,var(--mobile-primary) 0%,#7c8aff 100%);color:#fff;font-size:.8rem;font-weight:700;display:flex;align-items:center;justify-content:center}.mobile-card-body[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-card-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--mobile-text);line-height:1.3}.mobile-card-meta[_ngcontent-%COMP%]{font-size:.85rem;color:var(--mobile-muted);margin-top:.2rem}.mobile-card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}.mobile-card-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.mobile-card-actions[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{width:2rem;height:2rem}[_nghost-%COMP%]     .mobile-status-tag{font-size:.75rem;padding:.2rem .5rem;border-radius:999px}.mobile-state[_ngcontent-%COMP%]{margin-top:1rem;background:var(--mobile-card);border:1px dashed var(--mobile-border);border-radius:.875rem;padding:1.5rem;text-align:center;color:var(--mobile-muted);font-size:.9rem}.mobile-load-more[_ngcontent-%COMP%]{padding-top:.5rem}.mobile-load-more-btn[_ngcontent-%COMP%]{width:100%;border-radius:999px;font-weight:600}.mobile-fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(1rem + env(safe-area-inset-bottom));right:calc(1rem + env(safe-area-inset-right));z-index:25;width:3.5rem;height:3.5rem;min-width:3.5rem;min-height:3.5rem;padding:0;border:none;border-radius:50%;background:var(--mobile-primary);color:#fff;box-shadow:0 4px 14px #5f6bff66;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.mobile-fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.35rem}.mobile-fab[_ngcontent-%COMP%]:active{transform:scale(.96)}.app-dark   [_nghost-%COMP%]{--mobile-primary: var(--p-primary-400);--mobile-text: var(--p-surface-100);--mobile-muted: var(--p-surface-400);--mobile-card: var(--p-surface-800);--mobile-border: var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .utilisateurs-mobile-app[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .utilisateurs-mobile-app[_ngcontent-%COMP%]{background:var(--p-surface-950)}.app-dark[_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .mobile-user-card[_ngcontent-%COMP%]:active, .app-dark   [_nghost-%COMP%]   .mobile-user-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000040}.app-dark[_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-state[_ngcontent-%COMP%]{background:var(--p-surface-800);border-color:var(--p-surface-600);color:var(--p-surface-400)}}@keyframes _ngcontent-%COMP%_mobileFade{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}"]})};var vt={M:"M.",Mme:"Mme",Mlle:"Mlle"},yt={cni:"Carte nationale d'identit\xE9",passeport:"Passeport",permis:"Permis de conduire",carte_sejour:"Carte de s\xE9jour"};function Gt(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function Yt(r,t){if(r&1&&(s(0,"div",24),h(1,"img",25),s(2,"span",26),d(3),a(),s(4,"span"),d(5),a()()),r&2){let e=t.$implicit;o(),l("src",e.flag,le)("alt",e.name),o(2),v(e.dialCode),o(2),v(e.name)}}function Qt(r,t){if(r&1&&(s(0,"div",24),h(1,"img",25),s(2,"span",26),d(3),a(),s(4,"span"),d(5),a()()),r&2){let e=m().$implicit;o(),l("src",e.flag,le)("alt",e.name),o(2),v(e.dialCode),o(2),v(e.name)}}function Zt(r,t){if(r&1&&_(0,Qt,6,4,"div",27),r&2){let e=t.$implicit;l("ngIf",e)}}function Jt(r,t){r&1&&(s(0,"small",28),d(1,"Pays obligatoire."),a())}function Xt(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function $t(r,t){r&1&&(s(0,"small",29),d(1,"T\xE9l\xE9phone obligatoire."),a())}function ei(r,t){if(r&1&&(s(0,"small",30),d(1),a()),r&2){let e=m(2);o(),v(e.phoneError)}}function ti(r,t){if(r&1){let e=b();s(0,"div",31)(1,"button",32),g("click",function(){c(e);let i=m(2);return u(i.onCancel())}),a(),s(2,"button",33),g("click",function(){c(e);let i=m(2);return u(i.goNext())}),a()()}if(r&2){let e=m(2);o(),l("disabled",e.loading),o(),l("disabled",!e.isStep1Valid()||e.formDisabled)}}function ii(r,t){if(r&1){let e=b();s(0,"div",10)(1,"div",11)(2,"label",12),d(3,"Pays "),_(4,Gt,2,0,"span",13),a(),s(5,"p-select",14),C("ngModelChange",function(i){c(e);let p=m();return x(p.phoneCountry,i)||(p.phoneCountry=i),u(i)}),g("onCountryChange",function(){c(e);let i=m();return u(i.onCountryChange())}),_(6,Yt,6,4,"ng-template",15)(7,Zt,1,1,"ng-template",16),a(),_(8,Jt,2,0,"small",17),a(),s(9,"div",11)(10,"label",18),d(11,"T\xE9l\xE9phone "),_(12,Xt,2,0,"span",13),a(),s(13,"input",19),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.phone,i)||(p.model.phone=i),u(i)}),g("input",function(){c(e);let i=m();return u(i.onPhoneInput())})("blur",function(){c(e);let i=m();return u(i.onPhoneBlur())}),a(),_(14,$t,2,0,"small",20)(15,ei,2,1,"small",21),a()(),_(16,ti,3,2,"div",22)}if(r&2){let e=m();o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.phoneCountry),l("options",e.countries)("disabled",e.fieldsDisabled)("placeholder",""),S("aria-invalid",e.submitted&&!e.phoneCountry),o(3),l("ngIf",e.submitted&&!e.phoneCountry&&e.isEditing),o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.model.phone),l("invalid",(e.submitted||e.phoneError)&&(!(e.model.phone!=null&&e.model.phone.trim())||!!e.phoneError))("disabled",e.fieldsDisabled),S("aria-invalid",!!e.phoneError)("aria-describedby",e.phoneError?"phone-error":null),o(),l("ngIf",e.submitted&&!(e.model.phone!=null&&e.model.phone.trim())&&e.isEditing),o(),l("ngIf",e.phoneError&&(e.model.phone==null?null:e.model.phone.trim())&&e.isEditing),o(),l("ngIf",e.isEditing)}}function ri(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function ni(r,t){r&1&&(s(0,"small",39),d(1,"Type de compte obligatoire."),a())}function ai(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function si(r,t){r&1&&(s(0,"small",43),d(1,"R\xF4le obligatoire."),a())}function oi(r,t){if(r&1){let e=b();s(0,"div",11)(1,"label",40),d(2,"R\xF4le "),_(3,ai,2,0,"span",13),a(),s(4,"p-select",41),C("ngModelChange",function(i){c(e);let p=m(2);return x(p.model.role,i)||(p.model.role=i),u(i)}),a(),_(5,si,2,0,"small",42),a()}if(r&2){let e=m(2);o(3),l("ngIf",e.isEditing),o(),y("ngModel",e.model.role),l("options",e.filteredRoles)("disabled",e.fieldsDisabled)("invalid",e.submitted&&!e.model.role)("placeholder",""),S("aria-invalid",e.submitted&&!e.model.role),o(),l("ngIf",e.submitted&&!e.model.role&&e.isEditing)}}function li(r,t){if(r&1){let e=b();s(0,"div",44)(1,"button",45),g("click",function(){c(e);let i=m(2);return u(i.goPrev())}),a(),s(2,"div",46)(3,"button",32),g("click",function(){c(e);let i=m(2);return u(i.onCancel())}),a(),s(4,"button",33),g("click",function(){c(e);let i=m(2);return u(i.goNext())}),a()()()}if(r&2){let e=m(2);o(),l("disabled",e.loading),o(2),l("disabled",e.loading),o(),l("disabled",!e.isStep2Valid()||e.formDisabled)}}function pi(r,t){if(r&1){let e=b();s(0,"div",10)(1,"div",11)(2,"label",34),d(3,"Type de compte "),_(4,ri,2,0,"span",13),a(),s(5,"p-select",35),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.type,i)||(p.model.type=i),u(i)}),g("onChange",function(){c(e);let i=m();return u(i.onTypeChange())}),a(),_(6,ni,2,0,"small",36),a(),_(7,oi,6,8,"div",37),a(),_(8,li,5,3,"div",38)}if(r&2){let e=m();o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.model.type),l("options",e.userTypeOptions)("disabled",e.fieldsDisabled)("invalid",e.submitted&&!e.model.type)("placeholder",""),S("aria-invalid",e.submitted&&!e.model.type),o(),l("ngIf",e.submitted&&!e.model.type&&e.isEditing),o(),l("ngIf",e.isRoleSelectable),o(),l("ngIf",e.isEditing)}}function mi(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function di(r,t){r&1&&(s(0,"small",59),d(1,"Nom obligatoire."),a())}function ci(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function ui(r,t){r&1&&(s(0,"small",60),d(1,"Pr\xE9nom obligatoire."),a())}function _i(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function gi(r,t){r&1&&(s(0,"small",61),d(1,"Ville obligatoire."),a())}function fi(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function hi(r,t){r&1&&(s(0,"small",62),d(1,"Quartier obligatoire."),a())}function bi(r,t){if(r&1){let e=b();s(0,"div",44)(1,"button",45),g("click",function(){c(e);let i=m(2);return u(i.goPrev())}),a(),s(2,"div",46)(3,"button",32),g("click",function(){c(e);let i=m(2);return u(i.onCancel())}),a(),s(4,"button",33),g("click",function(){c(e);let i=m(2);return u(i.goNext())}),a()()()}if(r&2){let e=m(2);o(),l("disabled",e.loading),o(2),l("disabled",e.loading),o(),l("disabled",!e.isStep3Valid()||e.formDisabled)}}function vi(r,t){if(r&1){let e=b();s(0,"div",10)(1,"div",11)(2,"label",47),d(3,"Nom "),_(4,mi,2,0,"span",13),a(),s(5,"input",48),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.nom,i)||(p.model.nom=i),u(i)}),a(),_(6,di,2,0,"small",49),a(),s(7,"div",11)(8,"label",50),d(9,"Pr\xE9nom "),_(10,ci,2,0,"span",13),a(),s(11,"input",51),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.prenom,i)||(p.model.prenom=i),u(i)}),a(),_(12,ui,2,0,"small",52),a(),s(13,"div",11)(14,"label",53),d(15,"Ville "),_(16,_i,2,0,"span",13),a(),s(17,"input",54),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.ville,i)||(p.model.ville=i),u(i)}),a(),_(18,gi,2,0,"small",55),a(),s(19,"div",11)(20,"label",56),d(21,"Quartier "),_(22,fi,2,0,"span",13),a(),s(23,"input",57),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.quartier,i)||(p.model.quartier=i),u(i)}),a(),_(24,hi,2,0,"small",58),a()(),_(25,bi,5,3,"div",38)}if(r&2){let e=m();o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.model.nom),l("invalid",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim()))("disabled",e.fieldsDisabled),S("aria-invalid",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim())),o(),l("ngIf",e.submitted&&!(e.model.nom!=null&&e.model.nom.trim())&&e.isEditing),o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.model.prenom),l("invalid",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim()))("disabled",e.fieldsDisabled),S("aria-invalid",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim())),o(),l("ngIf",e.submitted&&!(e.model.prenom!=null&&e.model.prenom.trim())&&e.isEditing),o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.model.ville),l("invalid",e.submitted&&!(e.model.ville!=null&&e.model.ville.trim()))("disabled",e.fieldsDisabled),S("aria-invalid",e.submitted&&!(e.model.ville!=null&&e.model.ville.trim())),o(),l("ngIf",e.submitted&&!(e.model.ville!=null&&e.model.ville.trim())&&e.isEditing),o(4),l("ngIf",e.isEditing),o(),y("ngModel",e.model.quartier),l("invalid",e.submitted&&!(e.model.quartier!=null&&e.model.quartier.trim()))("disabled",e.fieldsDisabled),S("aria-invalid",e.submitted&&!(e.model.quartier!=null&&e.model.quartier.trim())),o(),l("ngIf",e.submitted&&!(e.model.quartier!=null&&e.model.quartier.trim())&&e.isEditing),o(),l("ngIf",e.isEditing)}}function yi(r,t){if(r&1&&(s(0,"small",72),d(1),a()),r&2){let e=m(3);o(),v(e.passwordError)}}function xi(r,t){if(r&1){let e=b();s(0,"div",68)(1,"label",69),d(2,"Mot de passe "),s(3,"span",23),d(4,"*"),a()(),s(5,"p-password",70),C("ngModelChange",function(i){c(e);let p=m(2);return x(p.model.password,i)||(p.model.password=i),u(i)}),a(),_(6,yi,2,1,"small",71),a()}if(r&2){let e=m(2);o(5),y("ngModel",e.model.password),l("toggleMask",!0)("feedback",!0)("invalid",e.submitted&&!!e.passwordError)("disabled",e.fieldsDisabled),S("aria-invalid",!!e.passwordError),o(),l("ngIf",e.submitted&&e.passwordError&&e.isEditing)}}function Ci(r,t){if(r&1){let e=b();s(0,"div",44)(1,"button",45),g("click",function(){c(e);let i=m(2);return u(i.goPrev())}),a(),s(2,"div",46)(3,"button",32),g("click",function(){c(e);let i=m(2);return u(i.onCancel())}),a(),s(4,"button",33),g("click",function(){c(e);let i=m(2);return u(i.goNext())}),a()()()}if(r&2){let e=m(2);o(),l("disabled",e.loading),o(2),l("disabled",e.loading),o(),l("disabled",!e.isStep4Valid()||e.formDisabled)}}function wi(r,t){if(r&1){let e=b();s(0,"div",10)(1,"div",11)(2,"label",63),d(3,"Email"),a(),s(4,"input",64),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.email,i)||(p.model.email=i),u(i)}),a()(),s(5,"div",11)(6,"label",65),d(7,"Date de naissance"),a(),s(8,"p-datepicker",66),C("ngModelChange",function(i){c(e);let p=m();return x(p.dateNaissanceObj,i)||(p.dateNaissanceObj=i),u(i)}),a()(),_(9,xi,7,7,"div",67),a(),_(10,Ci,5,3,"div",38)}if(r&2){let e=m();o(4),y("ngModel",e.model.email),l("disabled",e.fieldsDisabled),o(4),y("ngModel",e.dateNaissanceObj),l("showIcon",!0)("disabled",e.fieldsDisabled)("maxDate",e.today),o(),l("ngIf",e.mode==="create"),o(),l("ngIf",e.isEditing)}}function Si(r,t){r&1&&(s(0,"small",91),d(1,"Tous les champs ci-dessous sont requis."),a())}function Ei(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function Ui(r,t){if(r&1&&(s(0,"small",92),d(1),a()),r&2){let e=m(2);o(),v(e.kycErrors.piece_numero)}}function Mi(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function Ti(r,t){if(r&1&&(s(0,"small",93),d(1),a()),r&2){let e=m(2);o(),v(e.kycErrors.piece_pays)}}function Pi(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function Ii(r,t){if(r&1&&(s(0,"small",94),d(1),a()),r&2){let e=m(2);o(),v(e.kycErrors.piece_delivree_le)}}function ki(r,t){r&1&&(s(0,"span",23),d(1,"*"),a())}function Vi(r,t){if(r&1&&(s(0,"small",95),d(1),a()),r&2){let e=m(2);o(),v(e.kycErrors.piece_expire_le)}}function Fi(r,t){if(r&1&&(s(0,"div",96)(1,"small",97),h(2,"i",98),d(3),a()()),r&2){let e=m(2);o(3),L(" ",e.kycErrors.dates," ")}}function Oi(r,t){if(r&1){let e=b();s(0,"div",99)(1,"button",45),g("click",function(){c(e);let i=m(2);return u(i.goPrev())}),a(),s(2,"div",46)(3,"button",32),g("click",function(){c(e);let i=m(2);return u(i.onCancel())}),a(),h(4,"button",100),a()()}if(r&2){let e=m(2);o(),l("disabled",e.loading),o(2),l("disabled",e.loading),o(),l("label",e.mode==="create"?"Enregistrer":"Sauvegarder")("loading",e.loading)("disabled",!e.isValid()||e.loading||e.formDisabled)}}function Di(r,t){if(r&1){let e=b();s(0,"p",73),d(1,"Tous les champs ci-dessous sont optionnels."),a(),s(2,"div",10)(3,"div",11)(4,"label",74),d(5,"Type de pi\xE8ce"),a(),s(6,"p-select",75),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.piece_type,i)||(p.model.piece_type=i),u(i)}),g("onChange",function(){c(e);let i=m();return u(i.onPieceTypeChange())}),a(),_(7,Si,2,0,"small",76),a(),s(8,"div",11)(9,"label",77),d(10,"Num\xE9ro de pi\xE8ce "),_(11,Ei,2,0,"span",13),a(),s(12,"input",78),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.piece_numero,i)||(p.model.piece_numero=i),u(i)}),g("ngModelChange",function(){c(e);let i=m();return u(i.onKycFieldChange())}),a(),_(13,Ui,2,1,"small",79),a(),s(14,"div",11)(15,"label",80),d(16,"Pays de d\xE9livrance "),_(17,Mi,2,0,"span",13),a(),s(18,"p-select",81),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.piece_pays,i)||(p.model.piece_pays=i),u(i)}),g("onChange",function(){c(e);let i=m();return u(i.onKycFieldChange())}),a(),_(19,Ti,2,1,"small",82),a(),s(20,"div",11)(21,"label",83),d(22,"D\xE9livr\xE9e le "),_(23,Pi,2,0,"span",13),a(),s(24,"input",84),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.piece_delivree_le,i)||(p.model.piece_delivree_le=i),u(i)}),g("change",function(){c(e);let i=m();return u(i.onKycFieldChange())}),a(),_(25,Ii,2,1,"small",85),a(),s(26,"div",11)(27,"label",86),d(28,"Expire le "),_(29,ki,2,0,"span",13),a(),s(30,"input",87),C("ngModelChange",function(i){c(e);let p=m();return x(p.model.piece_expire_le,i)||(p.model.piece_expire_le=i),u(i)}),g("change",function(){c(e);let i=m();return u(i.onKycFieldChange())}),a(),_(31,Vi,2,1,"small",88),a()(),_(32,Fi,4,1,"div",89)(33,Oi,5,5,"div",90)}if(r&2){let e=m();o(6),y("ngModel",e.model.piece_type),l("options",e.pieceTypeOptions)("disabled",e.fieldsDisabled)("showClear",!0)("placeholder",""),o(),l("ngIf",e.isKycActive),o(4),l("ngIf",e.isKycActive),o(),y("ngModel",e.model.piece_numero),l("disabled",e.fieldsDisabled)("invalid",!!e.kycErrors.piece_numero),S("aria-invalid",!!e.kycErrors.piece_numero)("aria-describedby",e.kycErrors.piece_numero?"piece_numero-error":null),o(),l("ngIf",e.kycErrors.piece_numero),o(4),l("ngIf",e.isKycActive),o(),y("ngModel",e.model.piece_pays),l("options",e.countries)("disabled",e.fieldsDisabled)("showClear",!0)("invalid",!!e.kycErrors.piece_pays)("placeholder",""),S("aria-invalid",!!e.kycErrors.piece_pays),o(),l("ngIf",e.kycErrors.piece_pays),o(4),l("ngIf",e.isKycActive),o(),y("ngModel",e.model.piece_delivree_le),l("disabled",e.fieldsDisabled)("invalid",!!e.kycErrors.piece_delivree_le),S("aria-invalid",!!e.kycErrors.piece_delivree_le),o(),l("ngIf",e.kycErrors.piece_delivree_le),o(4),l("ngIf",e.isKycActive),o(),y("ngModel",e.model.piece_expire_le),l("disabled",e.fieldsDisabled)("invalid",!!e.kycErrors.piece_expire_le||!!e.kycErrors.dates),S("aria-invalid",!!e.kycErrors.piece_expire_le||!!e.kycErrors.dates),o(),l("ngIf",e.kycErrors.piece_expire_le),o(),l("ngIf",e.kycErrors.dates),o(),l("ngIf",e.isEditing)}}var D=class r{constructor(t){this.roleService=t}mode="create";initialData=null;loading=!1;formDisabled=!1;submitForm=new pe;cancel=new pe;submitted=!1;isEditing=!1;model={};activeStep=1;dateNaissanceObj=null;today=new Date;userTypeOptions=[{label:"Staff",value:"staff"},{label:"Client",value:"client"},{label:"Prestataire",value:"prestataire"},{label:"Investisseur",value:"investisseur"}];civiliteOptions=Object.entries(vt).map(([t,e])=>({label:e,value:t}));STAFF_ROLES=["admin","manager","comptable","agent_vente","employe"];availableRoles=[];pieceTypeOptions=Object.entries(yt).map(([t,e])=>({label:e,value:t}));phoneError=null;phoneCountry="GN";passwordError=null;kycErrors={};countries=O;ngOnInit(){this.loadRoles(),this.initializeModel()}ngOnChanges(t){if(t.initialData){let e=t.initialData;e.currentValue&&Object.keys(e.currentValue).length>0&&this.initializeModel()}}loadRoles(){this.roleService.getRoles().subscribe({next:t=>{t.success&&(this.availableRoles=t.data.map(e=>({label:e.role.name.charAt(0).toUpperCase()+e.role.name.slice(1),value:e.role.name})))},error:()=>{this.availableRoles=[{label:"Admin",value:"admin"},{label:"Manager",value:"manager"},{label:"Employ\xE9",value:"employe"}]}})}get filteredRoles(){return this.model.type==="staff"?this.availableRoles.filter(t=>this.STAFF_ROLES.includes(t.value)):[]}get isRoleSelectable(){return this.model.type==="staff"}onTypeChange(){this.model.type&&(this.model.type==="staff"?this.model.role=void 0:this.model.role=this.model.type)}get isKycActive(){return!!this.model.piece_type}onPieceTypeChange(){this.model.piece_type?this.submitted&&this.setKycErrors():(this.model.piece_numero=void 0,this.model.piece_pays=void 0,this.model.piece_delivree_le=void 0,this.model.piece_expire_le=void 0,this.kycErrors={})}onKycFieldChange(){this.submitted&&this.isKycActive&&this.setKycErrors()}checkKyc(){if(!this.model.piece_type)return!0;if(!this.model.piece_numero?.trim()||!this.model.piece_pays||!this.model.piece_delivree_le||!this.model.piece_expire_le)return!1;let t=new Date;t.setHours(23,59,59,999);let e=new Date(this.model.piece_delivree_le);return!(e>t||new Date(this.model.piece_expire_le)<=e)}setKycErrors(){if(this.kycErrors={},!!this.model.piece_type){if(this.model.piece_numero?.trim()||(this.kycErrors.piece_numero="Num\xE9ro de pi\xE8ce obligatoire."),this.model.piece_pays||(this.kycErrors.piece_pays="Pays de d\xE9livrance obligatoire."),!this.model.piece_delivree_le)this.kycErrors.piece_delivree_le="Date de d\xE9livrance obligatoire.";else{let t=new Date;t.setHours(23,59,59,999),new Date(this.model.piece_delivree_le)>t&&(this.kycErrors.piece_delivree_le="La date de d\xE9livrance ne peut pas \xEAtre dans le futur.")}if(this.model.piece_expire_le||(this.kycErrors.piece_expire_le="Date d'expiration obligatoire."),this.model.piece_delivree_le&&this.model.piece_expire_le){let t=new Date(this.model.piece_delivree_le);new Date(this.model.piece_expire_le)<=t&&(this.kycErrors.dates="La date d'expiration doit \xEAtre post\xE9rieure \xE0 la date de d\xE9livrance.")}}}initializeModel(){this.initialData?(this.model={nom:this.initialData.nom,prenom:this.initialData.prenom,phone:this.initialData.phone,email:this.initialData.email,pays:this.initialData.pays,code_pays:this.initialData.code_pays,code_phone_pays:this.initialData.code_phone_pays,ville:this.initialData.ville??void 0,quartier:this.initialData.quartier??void 0,type:this.initialData.type,role:this.initialData.role_names?.[0]??this.initialData.roles?.[0],reference:this.initialData.reference,civilite:this.initialData.civilite??void 0,piece_type:this.initialData.piece_type??void 0,piece_numero:this.initialData.piece_numero??void 0,piece_delivree_le:this.initialData.piece_delivree_le??void 0,piece_expire_le:this.initialData.piece_expire_le??void 0,piece_pays:this.initialData.piece_pays??void 0},this.dateNaissanceObj=this.initialData.date_naissance?new Date(this.initialData.date_naissance):null):(this.model={},this.dateNaissanceObj=null),this.mode==="create"&&!this.model.ville?.trim()&&(this.model.ville="Conakry"),this.mode==="create"?this.isEditing=!0:this.mode==="edit"&&this.initialData&&(this.isEditing=!0),this.model.code_pays?this.phoneCountry=this.model.code_pays:this.model.phone&&this.detectPhoneCountry(this.model.phone),this.submitted=!1,this.phoneError=null,this.passwordError=null,this.kycErrors={}}detectPhoneCountry(t){try{let e=ce(t);e&&e.country&&(this.phoneCountry=e.country)}catch{}}validatePhone(){if(!this.model.phone?.trim())return this.phoneError="T\xE9l\xE9phone obligatoire.",!1;try{if(!ot(this.model.phone,this.phoneCountry))return this.phoneError=`Num\xE9ro invalide pour ${this.getCountryName(this.phoneCountry)}.`,!1;let e=ce(this.model.phone,this.phoneCountry);return e?(this.model.phone=e.formatInternational(),this.model.code_pays=this.phoneCountry,this.model.pays=this.getCountryName(this.phoneCountry),this.phoneError=null,!0):(this.phoneError="Format de num\xE9ro invalide.",!1)}catch{return this.phoneError="Format de num\xE9ro invalide.",!1}}validatePassword(){if(this.mode==="edit"&&!this.model.password?.trim())return this.passwordError=null,!0;if(this.mode==="create"&&!this.model.password?.trim())return this.passwordError="Mot de passe obligatoire.",!1;let t=this.model.password||"";return t.length<8?(this.passwordError="Le mot de passe doit contenir au moins 8 caract\xE8res.",!1):!/[a-z]/.test(t)||!/[A-Z]/.test(t)?(this.passwordError="Le mot de passe doit contenir des majuscules et des minuscules.",!1):/[0-9]/.test(t)?(this.passwordError=null,!0):(this.passwordError="Le mot de passe doit contenir au moins un chiffre.",!1)}formatDate(t){return t?t.toISOString().split("T")[0]:null}getCountryName(t){let e=this.countries.find(n=>n.code===t);return e?e.name:t}getSelectedCountryDialCode(){let t=this.countries.find(e=>e.code===this.phoneCountry);return t?t.dialCode:""}onCountryChange(){this.model.phone&&this.validatePhone()}onPhoneInput(){this.submitted&&this.validatePhone()}onPhoneBlur(){this.model.phone?.trim()&&this.validatePhone()}isStep1Valid(){return!this.phoneCountry||!this.model.phone?.trim()?!1:this.validatePhone()}isStep2Valid(){return!(!this.model.type||this.isRoleSelectable&&!this.model.role)}isStep3Valid(){return!!(this.model.nom?.trim()&&this.model.prenom?.trim()&&this.model.ville?.trim()&&this.model.quartier?.trim())}isStep4Valid(){return!(this.mode==="create"&&!this.validatePassword())}isStep5Valid(){return!0}isValid(){return!(!this.isStep1Valid()||!this.isStep2Valid()||!this.isStep3Valid()||!this.isStep4Valid()||!this.checkKyc())}goNext(){this.submitted=!0,this.activeStep===1&&this.isStep1Valid()?this.activeStep=2:this.activeStep===2&&this.isStep2Valid()?this.activeStep=3:this.activeStep===3&&this.isStep3Valid()?this.activeStep=4:this.activeStep===4&&this.isStep4Valid()&&(this.activeStep=5)}goPrev(){this.activeStep>1&&(this.activeStep=this.activeStep-1)}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.phoneError=null,this.passwordError=null,this.kycErrors={},this.initializeModel()}onSubmit(){this.submitted=!0,this.setKycErrors(),this.isValid()&&this.submitForm.emit(he(fe({},this.model),{password_confirmation:this.model.password,date_naissance:this.formatDate(this.dateNaissanceObj)??void 0}))}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading||this.formDisabled}get formTitle(){if(this.mode==="create")return"Cr\xE9er un compte utilisateur";let t=this.model.reference?.trim();return t?`Modification compte utilisateur : ${t}`:"Modification compte utilisateur"}static \u0275fac=function(e){return new(e||r)(w(re))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-form"]],inputs:{mode:"mode",initialData:"initialData",loading:"loading",formDisabled:"formDisabled"},outputs:{submitForm:"submitForm",cancel:"cancel"},features:[xe],decls:32,vars:12,consts:[[1,"min-h-full","bg-white"],[1,"utilisateurs-form-card","max-w-5xl","mx-auto","px-4","sm:px-6","py-8","sm:py-10"],[1,"bg-white","rounded-xl","border","border-gray-200","shadow-sm","p-6","sm:p-8","md:p-10"],[1,"mb-8","sm:mb-10"],[1,"text-xl","sm:text-2xl","font-bold","text-gray-900","tracking-tight"],[1,"mt-1","text-sm","text-gray-500"],[1,"utilisateurs-form-fields",3,"ngSubmit"],[1,"w-full","utilisateurs-form-stepper","mb-8",3,"valueChange","value"],[3,"value"],["pTemplate","content"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-5","py-2"],[1,"utilisateurs-form-field"],["for","codePays",1,"utilisateurs-form-label"],["class","text-red-500","aria-hidden","true",4,"ngIf"],["id","codePays","name","codePays","optionLabel","name","optionValue","code","fluid","","aria-describedby","codePays-error",3,"ngModelChange","onCountryChange","ngModel","options","disabled","placeholder"],["pTemplate","item"],["pTemplate","selectedItem"],["id","codePays-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","phone",1,"utilisateurs-form-label"],["id","phone","name","phone","type","tel","pInputText","","fluid","","placeholder","Exemple: 622 00 00 00",1,"w-full",3,"ngModelChange","input","blur","ngModel","invalid","disabled"],["id","phone-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["class","utilisateurs-form-error","role","alert",4,"ngIf"],["class","utilisateurs-form-step-actions flex flex-wrap items-center justify-end gap-3 pt-6 mt-6 border-t border-gray-200",4,"ngIf"],["aria-hidden","true",1,"text-red-500"],[1,"flex","items-center","gap-2"],[1,"w-5","h-auto","rounded-sm",3,"src","alt"],[1,"font-semibold","text-primary"],["class","flex items-center gap-2",4,"ngIf"],["id","codePays-error","role","alert",1,"utilisateurs-form-error"],["id","phone-error","role","alert",1,"utilisateurs-form-error"],["role","alert",1,"utilisateurs-form-error"],[1,"utilisateurs-form-step-actions","flex","flex-wrap","items-center","justify-end","gap-3","pt-6","mt-6","border-t","border-gray-200"],["type","button","pButton","","pRipple","","label","Annuler","icon","pi pi-times","severity","secondary",1,"utilisateurs-form-cancel",3,"click","disabled"],["type","button","pButton","","pRipple","","label","Suivant","icon","pi pi-arrow-right","iconPos","right",1,"utilisateurs-form-next",3,"click","disabled"],["for","type",1,"utilisateurs-form-label"],["id","type","name","type","optionLabel","label","optionValue","value","fluid","","aria-describedby","type-error",3,"ngModelChange","onChange","ngModel","options","disabled","invalid","placeholder"],["id","type-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["class","utilisateurs-form-field",4,"ngIf"],["class","utilisateurs-form-step-actions flex flex-wrap items-center justify-between gap-3 pt-6 mt-6 border-t border-gray-200",4,"ngIf"],["id","type-error","role","alert",1,"utilisateurs-form-error"],["for","role",1,"utilisateurs-form-label"],["id","role","name","role","optionLabel","label","optionValue","value","fluid","","aria-describedby","role-error",3,"ngModelChange","ngModel","options","disabled","invalid","placeholder"],["id","role-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["id","role-error","role","alert",1,"utilisateurs-form-error"],[1,"utilisateurs-form-step-actions","flex","flex-wrap","items-center","justify-between","gap-3","pt-6","mt-6","border-t","border-gray-200"],["type","button","pButton","","pRipple","","label","Pr\xE9c\xE9dent","icon","pi pi-arrow-left","severity","secondary",1,"utilisateurs-form-prev",3,"click","disabled"],[1,"flex","flex-wrap","items-center","gap-3"],["for","nom",1,"utilisateurs-form-label"],["id","nom","name","nom","type","text","pInputText","","fluid","","aria-describedby","nom-error",1,"w-full",3,"ngModelChange","ngModel","invalid","disabled"],["id","nom-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","prenom",1,"utilisateurs-form-label"],["id","prenom","name","prenom","type","text","pInputText","","fluid","","aria-describedby","prenom-error",1,"w-full",3,"ngModelChange","ngModel","invalid","disabled"],["id","prenom-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","ville",1,"utilisateurs-form-label"],["id","ville","name","ville","type","text","pInputText","","fluid","","aria-describedby","ville-error",1,"w-full",3,"ngModelChange","ngModel","invalid","disabled"],["id","ville-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","quartier",1,"utilisateurs-form-label"],["id","quartier","name","quartier","type","text","pInputText","","fluid","","aria-describedby","quartier-error",1,"w-full",3,"ngModelChange","ngModel","invalid","disabled"],["id","quartier-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["id","nom-error","role","alert",1,"utilisateurs-form-error"],["id","prenom-error","role","alert",1,"utilisateurs-form-error"],["id","ville-error","role","alert",1,"utilisateurs-form-error"],["id","quartier-error","role","alert",1,"utilisateurs-form-error"],["for","email",1,"utilisateurs-form-label"],["id","email","name","email","type","email","pInputText","","fluid","","placeholder","exemple@email.com",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","date_naissance",1,"utilisateurs-form-label"],["id","date_naissance","name","date_naissance","dateFormat","dd/mm/yy","placeholder","jj/mm/aaaa","fluid","",3,"ngModelChange","ngModel","showIcon","disabled","maxDate"],["class","utilisateurs-form-field md:col-span-2",4,"ngIf"],[1,"utilisateurs-form-field","md:col-span-2"],["for","password",1,"utilisateurs-form-label"],["id","password","name","password","fluid","","placeholder","Min. 8 caract\xE8res, majuscules, minuscules et chiffres","promptLabel","Entrez un mot de passe","weakLabel","Faible","mediumLabel","Moyen","strongLabel","Fort","aria-describedby","password-error",3,"ngModelChange","ngModel","toggleMask","feedback","invalid","disabled"],["id","password-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["id","password-error","role","alert",1,"utilisateurs-form-error"],[1,"text-sm","text-gray-500","mb-5"],["for","piece_type",1,"utilisateurs-form-label"],["id","piece_type","name","piece_type","optionLabel","label","optionValue","value","fluid","",3,"ngModelChange","onChange","ngModel","options","disabled","showClear","placeholder"],["class","text-gray-500 block mt-1.5 text-sm",4,"ngIf"],["for","piece_numero",1,"utilisateurs-form-label"],["id","piece_numero","name","piece_numero","type","text","pInputText","","fluid","","placeholder","Ex: GN-123456789",1,"w-full",3,"ngModelChange","ngModel","disabled","invalid"],["id","piece_numero-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","piece_pays",1,"utilisateurs-form-label"],["id","piece_pays","name","piece_pays","optionLabel","name","optionValue","code","fluid","","aria-describedby","piece_pays-error",3,"ngModelChange","onChange","ngModel","options","disabled","showClear","invalid","placeholder"],["id","piece_pays-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","piece_delivree_le",1,"utilisateurs-form-label"],["id","piece_delivree_le","name","piece_delivree_le","type","date","pInputText","","fluid","","aria-describedby","piece_delivree_le-error",1,"w-full",3,"ngModelChange","change","ngModel","disabled","invalid"],["id","piece_delivree_le-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["for","piece_expire_le",1,"utilisateurs-form-label"],["id","piece_expire_le","name","piece_expire_le","type","date","pInputText","","fluid","","aria-describedby","piece_expire_le-error",1,"w-full",3,"ngModelChange","change","ngModel","disabled","invalid"],["id","piece_expire_le-error","class","utilisateurs-form-error","role","alert",4,"ngIf"],["class","mb-4",4,"ngIf"],["class","utilisateurs-form-actions flex flex-wrap items-center justify-between gap-3 pt-6 mt-6 border-t border-gray-200",4,"ngIf"],[1,"text-gray-500","block","mt-1.5","text-sm"],["id","piece_numero-error","role","alert",1,"utilisateurs-form-error"],["id","piece_pays-error","role","alert",1,"utilisateurs-form-error"],["id","piece_delivree_le-error","role","alert",1,"utilisateurs-form-error"],["id","piece_expire_le-error","role","alert",1,"utilisateurs-form-error"],[1,"mb-4"],["role","alert",1,"utilisateurs-form-error","flex","items-center","gap-1.5"],["aria-hidden","true",1,"pi","pi-exclamation-triangle","text-xs"],[1,"utilisateurs-form-actions","flex","flex-wrap","items-center","justify-between","gap-3","pt-6","mt-6","border-t","border-gray-200"],["type","submit","pButton","","pRipple","","icon","pi pi-check","aria-busy","loading",1,"utilisateurs-form-submit",3,"label","loading","disabled"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"header",3)(4,"h1",4),d(5),a(),s(6,"p",5),d(7,"Renseignez les informations du compte utilisateur."),a()(),s(8,"form",6),g("ngSubmit",function(){return n.activeStep===5?n.onSubmit():n.goNext()}),s(9,"p-stepper",7),C("valueChange",function(p){return x(n.activeStep,p)||(n.activeStep=p),p}),s(10,"p-step-list")(11,"p-step",8),d(12,"T\xE9l\xE9phone"),a(),s(13,"p-step",8),d(14,"Type + R\xF4le"),a(),s(15,"p-step",8),d(16,"Informations personnelles"),a(),s(17,"p-step",8),d(18,"Acc\xE8s"),a(),s(19,"p-step",8),d(20,"Pi\xE8ce d'identit\xE9"),a()(),s(21,"p-step-panels")(22,"p-step-panel",8),_(23,ii,17,16,"ng-template",9),a(),s(24,"p-step-panel",8),_(25,pi,9,10,"ng-template",9),a(),s(26,"p-step-panel",8),_(27,vi,26,25,"ng-template",9),a(),s(28,"p-step-panel",8),_(29,wi,11,8,"ng-template",9),a(),s(30,"p-step-panel",8),_(31,Di,34,36,"ng-template",9),a()()()()()()()),e&2&&(o(5),v(n.formTitle),o(4),y("value",n.activeStep),o(2),l("value",1),o(2),l("value",2),o(2),l("value",3),o(2),l("value",4),o(2),l("value",5),o(3),l("value",1),o(2),l("value",2),o(2),l("value",3),o(2),l("value",4),o(2),l("value",5))},dependencies:[T,V,te,ee,Q,Y,Oe,G,H,$,Le,Z,J,De,X,Re,pt,lt,mt,Ye,ft,gt,dt,_t,ut,ct],styles:[".utilisateurs-form-label[_ngcontent-%COMP%]{display:block;margin-bottom:.375rem;font-size:.875rem;font-weight:500;line-height:1.4;color:var(--p-text-color, var(--text-color))}.utilisateurs-form-field[_ngcontent-%COMP%]{margin-bottom:0}.utilisateurs-form-error[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.8125rem;line-height:1.3;color:var(--p-red-600, #b91c1c)}@media (prefers-contrast: high){.utilisateurs-form-error[_ngcontent-%COMP%]{color:var(--p-red-700, #991b1b);font-weight:500}}.utilisateurs-form-stepper[_ngcontent-%COMP%]     .p-stepper .p-step-list{justify-content:center;gap:.5rem;margin-bottom:1.5rem}.utilisateurs-form-stepper[_ngcontent-%COMP%]     .p-stepper .p-step{font-size:.875rem;font-weight:500}.utilisateurs-form-step-actions[_ngcontent-%COMP%]     .p-button, .utilisateurs-form-actions[_ngcontent-%COMP%]     .p-button{min-height:2.5rem;min-width:6rem}.utilisateurs-form-submit[_ngcontent-%COMP%]     .p-button{font-weight:600}[_nghost-%COMP%]     .p-inputtext:focus-visible, [_nghost-%COMP%]     .p-select .p-select-label:focus-visible, [_nghost-%COMP%]     .p-datepicker .p-inputtext:focus-visible, [_nghost-%COMP%]     .p-password input:focus-visible, [_nghost-%COMP%]     .p-button:focus-visible{outline:2px solid var(--p-primary-color, var(--primary-color));outline-offset:2px}@media (max-width: 768px){.utilisateurs-form-step-actions[_ngcontent-%COMP%], .utilisateurs-form-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.utilisateurs-form-step-actions[_ngcontent-%COMP%]     .p-button, .utilisateurs-form-actions[_ngcontent-%COMP%]     .p-button{width:100%;justify-content:center;min-width:unset}}"]})};var ae=class r{http=ve(j);apiBase=`${A.apiUrl}/usines`;getAll(){return this.http.get(this.apiBase)}create(t){return this.http.post(this.apiBase,t)}update(t,e){return this.http.patch(`${this.apiBase}/${t}`,e)}setDefault(t){return this.http.patch(`${this.apiBase}/${t}/set-default`,{})}assignUser(t,e){return this.http.post(`${this.apiBase}/${t}/users`,e)}removeUser(t,e){return this.http.delete(`${this.apiBase}/${t}/users/${e}`)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=B({token:r,factory:r.\u0275fac,providedIn:"root"})};function Ai(r,t){r&1&&h(0,"p-message",6),r&2&&l("text","Veuillez s\xE9lectionner une usine dans la barre du haut pour pouvoir cr\xE9er un utilisateur.")}function Ni(r,t){r&1&&(s(0,"div",7),h(1,"i",10),s(2,"span"),d(3,"L'utilisateur sera assign\xE9 \xE0 : "),s(4,"strong"),d(5),a()()()),r&2&&(o(5),v(t.nom))}var se=class r{constructor(t,e,n,i,p){this.userService=t;this.messageService=e;this.router=n;this.usineContext=i;this.usineService=p}loading=!1;onCancel(){this.router.navigate(["contacts/utilisateurs"])}onSubmit(t){let e=this.usineContext.currentUsineId();if(e===null){this.messageService.add({severity:"warn",summary:"Usine requise",detail:"Veuillez s\xE9lectionner une usine avant de cr\xE9er un utilisateur.",life:5e3});return}this.loading=!0;let n={nom:t.nom||"",prenom:t.prenom||"",phone:(t.phone||"").replace(/\s+/g,""),email:t.email||void 0,pays:t.pays||"Guin\xE9e",code_pays:t.code_pays||"GN",code_phone_pays:this.getCodePhonePays(t.code_pays||"GN"),ville:t.ville||"",quartier:t.quartier||"",password:t.password||"",password_confirmation:t.password_confirmation||"",type:t.type??"staff",role:t.role||"",civilite:t.civilite||void 0,date_naissance:t.date_naissance||void 0,piece_type:t.piece_type||void 0,piece_numero:t.piece_numero||void 0,piece_delivree_le:t.piece_delivree_le||void 0,piece_expire_le:t.piece_expire_le||void 0,piece_pays:t.piece_pays||void 0};this.userService.createUserViaApi(n).subscribe({next:i=>{if(!i.success||!i.data?.id){this.messageService.add({severity:"error",summary:"Erreur",detail:i.message||"Utilisateur cr\xE9\xE9 mais r\xE9ponse invalide."}),this.loading=!1;return}let p=i.data;this.usineService.assignUser(e,{user_id:p.id,role:n.role||void 0}).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur cr\xE9\xE9 et assign\xE9 \xE0 l'usine."}),setTimeout(()=>{this.router.navigate(["contacts/utilisateurs/edit",p.id])},600),this.loading=!1},error:f=>{console.error("Erreur assignation usine:",f),this.messageService.add({severity:"error",summary:"Erreur",detail:f.error?.message||"Utilisateur cr\xE9\xE9 mais l'assignation \xE0 l'usine a \xE9chou\xE9.",life:6e3}),this.loading=!1}})},error:i=>{console.error("Erreur lors de la cr\xE9ation:",i),this.messageService.add({severity:"error",summary:"Erreur",detail:i.error?.message||"Erreur lors de la cr\xE9ation de l'utilisateur"}),this.loading=!1}})}getCodePhonePays(t){let e=O.find(n=>n.code===t);return e?e.dialCode:"+224"}static \u0275fac=function(e){return new(e||r)(w(P),w(E),w(F),w(qe),w(ae))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-new"]],features:[k([E])],decls:12,vars:4,consts:[[1,"edit-page"],[1,"edit-mobile-header"],["type","button","aria-label","Retour \xE0 la liste",1,"edit-back",3,"click"],[1,"pi","pi-arrow-left"],[1,"edit-title"],[1,"edit-header-spacer"],["severity","warn","styleClass","usine-context-message mb-3",3,"text"],[1,"usine-assignation-reminder","mb-3"],[1,"edit-content"],[3,"submitForm","cancel","mode","loading","formDisabled"],[1,"pi","pi-building"]],template:function(e,n){if(e&1&&(h(0,"p-toast"),s(1,"div",0)(2,"header",1)(3,"button",2),g("click",function(){return n.onCancel()}),h(4,"i",3),a(),s(5,"h1",4),d(6,"Nouvel utilisateur"),a(),h(7,"span",5),a(),we(8,Ai,1,1,"p-message",6)(9,Ni,6,1,"div",7),s(10,"div",8)(11,"app-utilisateurs-form",9),g("submitForm",function(p){return n.onSubmit(p)})("cancel",function(){return n.onCancel()}),a()()()),e&2){let i;o(8),Se(n.usineContext.isConsolidated()?8:(i=n.usineContext.currentUsine())?9:-1,i),o(3),l("mode","create")("loading",n.loading)("formDisabled",n.usineContext.isConsolidated())}},dependencies:[T,K,q,st,at,D],styles:["[_nghost-%COMP%]{display:block}.usine-assignation-reminder[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border-radius:6px;background:var(--blue-50, #eff6ff);color:var(--blue-800, #1e40af);font-size:.875rem;border:1px solid var(--blue-200, #bfdbfe)}.usine-assignation-reminder[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1rem;opacity:.9}.usine-context-message[_ngcontent-%COMP%]{display:block}.edit-mobile-header[_ngcontent-%COMP%]{display:none}.edit-content[_ngcontent-%COMP%]{padding:1rem}@media screen and (max-width: 768px){.edit-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;margin:calc(-.25rem - env(safe-area-inset-top)) -.875rem calc(-.875rem - env(safe-area-inset-bottom));margin-left:-.875rem;margin-right:-.875rem;padding:0;padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);padding-bottom:env(safe-area-inset-bottom);background:#fff}.edit-mobile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-shrink:0;padding:calc(.5rem + env(safe-area-inset-top)) .75rem .6rem calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:var(--surface-card);border-bottom:1px solid var(--surface-border);box-shadow:0 1px 3px #0000000f;position:sticky;top:0;z-index:25}.edit-back[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;min-width:2.25rem;border:none;border-radius:50%;background:var(--p-primary-50);color:var(--p-primary-500);display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}.edit-back[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem}.edit-title[_ngcontent-%COMP%]{flex:1;margin:0;font-size:1.15rem;font-weight:700;color:var(--text-color);min-width:0;text-align:center}.edit-header-spacer[_ngcontent-%COMP%]{width:2.25rem;min-width:2.25rem}.edit-content[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:.875rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom))}}"]})};function Bi(r,t){r&1&&(s(0,"div",9),h(1,"i",10),a())}function Wi(r,t){if(r&1){let e=b();s(0,"app-utilisateurs-form",11),g("submitForm",function(i){c(e);let p=m();return u(p.onSubmit(i))})("cancel",function(){c(e);let i=m();return u(i.onCancel())}),a()}if(r&2){let e=m();l("mode","edit")("initialData",e.userData)("loading",e.loading)}}var oe=class r{constructor(t,e,n,i,p){this.route=t;this.router=e;this.userService=n;this.roleService=i;this.messageService=p}loading=!1;userId=null;userData=null;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.userId=parseInt(t,10),this.loadUser(this.userId))}loadUser(t){this.loading=!0,this.userService.getUser(t).subscribe({next:e=>{if(e.success&&e.data){let n=e.data,i={id:n.id,reference:n.reference,nom:n.nom,prenom:n.prenom,phone:n.phone,email:n.email,pays:n.pays,code_pays:n.code_pays,code_phone_pays:n.code_phone_pays,ville:n.ville,quartier:n.quartier,type:n.type,roles:n.role_names||n.roles,role_names:n.role_names,is_active:n.is_active,civilite:n.civilite,date_naissance:n.date_naissance,piece_type:n.piece_type,piece_numero:n.piece_numero,piece_delivree_le:n.piece_delivree_le,piece_expire_le:n.piece_expire_le,piece_pays:n.piece_pays},p=n.role_names||n.roles;!p||p.length===0?this.roleService.getUserRoles(t).subscribe({next:f=>{f.success&&f.data&&(i.roles=f.data.roles),this.userData=i,this.loading=!1},error:()=>{this.userData=i,this.loading=!1}}):(this.userData=i,this.loading=!1)}else this.loading=!1},error:e=>{console.error("Erreur lors du chargement:",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Erreur lors du chargement de l'utilisateur"}),this.loading=!1}})}onSubmit(t){if(!this.userId)return;this.loading=!0;let e={nom:t.nom,prenom:t.prenom,phone:(t.phone||"").replace(/\s+/g,""),email:t.email||void 0,pays:t.pays,code_pays:t.code_pays,code_phone_pays:this.getCodePhonePays(t.code_pays||"GN"),ville:t.ville,quartier:t.quartier,type:t.type,role:t.role,civilite:t.civilite||null,date_naissance:t.date_naissance||null,piece_type:t.piece_type||null,piece_numero:t.piece_numero||null,piece_delivree_le:t.piece_delivree_le||null,piece_expire_le:t.piece_expire_le||null,piece_pays:t.piece_pays||null};this.userService.updateUser(this.userId,e).subscribe({next:n=>{n.success?(this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Utilisateur modifi\xE9 avec succ\xE8s"}),this.loadUser(this.userId)):this.loading=!1},error:n=>{console.error("Erreur lors de la modification:",n),this.messageService.add({severity:"error",summary:"Erreur",detail:n.error?.message||"Erreur lors de la modification de l'utilisateur"}),this.loading=!1}})}onCancel(){this.router.navigate(["contacts/utilisateurs"])}getCodePhonePays(t){let e=O.find(n=>n.code===t);return e?e.dialCode:"+224"}static \u0275fac=function(e){return new(e||r)(w(Fe),w(F),w(P),w(re),w(E))};static \u0275cmp=M({type:r,selectors:[["app-utilisateurs-edit"]],features:[k([E])],decls:11,vars:2,consts:[[1,"edit-page"],[1,"edit-mobile-header"],["type","button","aria-label","Retour \xE0 la liste",1,"edit-back",3,"click"],[1,"pi","pi-arrow-left"],[1,"edit-title"],[1,"edit-header-spacer"],[1,"edit-content"],["class","flex justify-center items-center h-96",4,"ngIf"],[3,"mode","initialData","loading","submitForm","cancel",4,"ngIf"],[1,"flex","justify-center","items-center","h-96"],[1,"pi","pi-spin","pi-spinner","text-4xl","text-primary"],[3,"submitForm","cancel","mode","initialData","loading"]],template:function(e,n){e&1&&(h(0,"p-toast"),s(1,"div",0)(2,"header",1)(3,"button",2),g("click",function(){return n.onCancel()}),h(4,"i",3),a(),s(5,"h1",4),d(6,"Modifier l'utilisateur"),a(),h(7,"span",5),a(),s(8,"div",6),_(9,Bi,2,0,"div",7)(10,Wi,1,3,"app-utilisateurs-form",8),a()()),e&2&&(o(9),l("ngIf",n.loading&&!n.userData),o(),l("ngIf",n.userData))},dependencies:[T,V,D,K,q],styles:["[_nghost-%COMP%]{display:block}.edit-mobile-header[_ngcontent-%COMP%]{display:none}.edit-content[_ngcontent-%COMP%]{padding:1rem}@media screen and (max-width: 768px){.edit-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;margin:calc(-.25rem - env(safe-area-inset-top)) -.875rem calc(-.875rem - env(safe-area-inset-bottom));margin-left:-.875rem;margin-right:-.875rem;padding:0;padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);padding-bottom:env(safe-area-inset-bottom);background:#fff}.edit-mobile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-shrink:0;padding:calc(.5rem + env(safe-area-inset-top)) .75rem .6rem calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:var(--surface-card);border-bottom:1px solid var(--surface-border);box-shadow:0 1px 3px #0000000f;position:sticky;top:0;z-index:25}.edit-back[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;min-width:2.25rem;border:none;border-radius:50%;background:var(--p-primary-50);color:var(--p-primary-500);display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}.edit-back[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem}.edit-title[_ngcontent-%COMP%]{flex:1;margin:0;font-size:1.15rem;font-weight:700;color:var(--text-color);min-width:0;text-align:center}.edit-header-spacer[_ngcontent-%COMP%]{width:2.25rem;min-width:2.25rem}.edit-content[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:.875rem;padding-bottom:calc(1rem + env(safe-area-inset-bottom))}}"]})};var yn=[{path:"",component:ne,canActivate:[ie],data:{permissions:["users.read"]}},{path:"new",component:se,canActivate:[ie],data:{permissions:["users.create"]}},{path:"edit/:id",component:oe,canActivate:[ie],data:{permissions:["users.update"]}},{path:"**",redirectTo:"/notfound"}];export{yn as default};
