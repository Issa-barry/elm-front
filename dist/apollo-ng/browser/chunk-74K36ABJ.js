import{a as Y,b as A}from"./chunk-2RRFE6AH.js";import{a as z}from"./chunk-BNBOLTWB.js";import{a as X}from"./chunk-GHOOEVKO.js";import{a as H,b as N}from"./chunk-7GJBPOT6.js";import"./chunk-YG7LP6WD.js";import"./chunk-4SCZYFYR.js";import{e as G,j as I}from"./chunk-3PAKMIDN.js";import"./chunk-LJTUVZ5Q.js";import"./chunk-KDHKK32X.js";import{d as U,e as W}from"./chunk-KT3B5SP3.js";import"./chunk-E3FSYXNL.js";import"./chunk-U3UB2P3Z.js";import{a as L,b as D}from"./chunk-JRNNJ6SL.js";import{b as E,e as w,h as T,j as J,m as Q,p as R}from"./chunk-WX7SVATX.js";import"./chunk-YBEZL4R2.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import"./chunk-BMS6JNLC.js";import"./chunk-JMQBCY5U.js";import{pa as g}from"./chunk-PUR6U5O3.js";import{i as K,k as b,v as S}from"./chunk-4C25TOQ5.js";import"./chunk-4O3FVBGX.js";import{Kb as v,Lb as M,Ma as o,Xa as P,Zb as m,_b as _,ab as x,cc as d,dc as u,ec as f,gb as y,gc as C,hc as V,k as j,u as O,wb as l,xb as a,yb as s,z as B,zb as c}from"./chunk-DXANH7IG.js";import"./chunk-GAL4ENT6.js";function se(n,r){if(n&1&&(a(0,"div",12),m(1),s()),n&2){let i=M();o(),_(i.errorMessage)}}function oe(n,r){if(n&1&&(a(0,"div",13),m(1),s()),n&2){let i=M();o(),_(i.successMessage)}}var F=class n{constructor(r,i){this.parametresService=r;this.messageService=i}loading=!1;saving=!1;errorMessage="";successMessage="";idRouleauPacking="";prixRouleauDefaut=0;idRouleauParam;prixRouleauParam;produitRouleauKey="produit_rouleau_id";legacyProduitRouleauKey="id_rouleau_packing";ngOnInit(){this.loadPackingParametres()}loadPackingParametres(){this.loading=!0,this.errorMessage="",this.parametresService.getParametres("packing").subscribe({next:r=>{let i=r.data.parametres??[];this.idRouleauParam=i.find(e=>e.cle===this.produitRouleauKey)??i.find(e=>e.cle===this.legacyProduitRouleauKey),this.prixRouleauParam=i.find(e=>e.cle==="prix_rouleau_defaut"),this.idRouleauPacking=this.idRouleauParam?.valeur?.toString()??"",this.prixRouleauDefaut=Number(this.prixRouleauParam?.valeur??0)||0,this.loading=!1},error:()=>{this.errorMessage="Impossible de charger les parametres.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.loading=!1}})}savePackingParametres(){if(this.errorMessage="",this.successMessage="",!this.idRouleauParam||!this.prixRouleauParam){this.errorMessage="Parametres packing introuvables (produit_rouleau_id / prix_rouleau_defaut).",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3});return}let r=Number(this.idRouleauPacking);if(!Number.isFinite(r)){this.errorMessage='Le champ "ID du produit rouleau" doit etre numerique.',this.messageService.add({severity:"warn",summary:"Validation",detail:this.errorMessage,life:3e3});return}this.saving=!0,O([this.parametresService.updateParametre(this.idRouleauParam.id,{valeur:r}).pipe(B(()=>j(null))),this.parametresService.updateParametre(this.prixRouleauParam.id,{valeur:Number(this.prixRouleauDefaut||0)}).pipe(B(()=>j(null)))]).subscribe({next:i=>{i.some(p=>p===null)?(this.errorMessage="Une ou plusieurs mises a jour ont echoue.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3})):(this.successMessage="Parametres mis a jour avec succes.",this.messageService.add({severity:"success",summary:"Succes",detail:this.successMessage,life:3e3})),this.saving=!1},error:()=>{this.errorMessage="Erreur lors de la sauvegarde.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.saving=!1}})}static \u0275fac=function(i){return new(i||n)(P(X),P(g))};static \u0275cmp=x({type:n,selectors:[["app-parametres-packing"]],features:[C([g])],decls:17,vars:8,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"flex","gap-12","flex-col-reverse","md:flex-row"],[1,"flex-auto","flex","flex-col","gap-6"],[1,"flex","flex-col","gap-2"],["for","produit_rouleau_id",1,"text-surface-900","dark:text-surface-0"],["id","produit_rouleau_id","type","number","min","0","step","1","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","prix_rouleau_defaut",1,"text-surface-900","dark:text-surface-0"],["id","prix_rouleau_defaut","type","number","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(i,e){i&1&&(a(0,"div",0)(1,"div",1),m(2,"Parametres Packing"),s(),y(3,se,2,1,"div",2)(4,oe,2,1,"div",3),a(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),m(9,"ID du produit rouleau (packing)"),s(),a(10,"input",8),f("ngModelChange",function(t){return u(e.idRouleauPacking,t)||(e.idRouleauPacking=t),t}),s()(),a(11,"div",6)(12,"label",9),m(13,"Prix par defaut du rouleau de packing"),s(),a(14,"input",10),f("ngModelChange",function(t){return u(e.prixRouleauDefaut,t)||(e.prixRouleauDefaut=t),t}),s()()()(),a(15,"div")(16,"p-button",11),v("onClick",function(){return e.savePackingParametres()}),s()()()),i&2&&(o(3),l("ngIf",e.errorMessage),o(),l("ngIf",e.successMessage),o(6),d("ngModel",e.idRouleauPacking),l("disabled",e.loading||e.saving),o(4),d("ngModel",e.prixRouleauDefaut),l("disabled",e.loading||e.saving),o(2),l("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[S,b,R,E,J,w,Q,T,W,U,A,D,L,N,I],encapsulation:2})};function ne(n,r){if(n&1&&(a(0,"div",18),m(1),s()),n&2){let i=M();o(),_(i.errorMessage)}}function le(n,r){if(n&1&&(a(0,"div",19),m(1),s()),n&2){let i=M();o(),_(i.successMessage)}}var q=class n{constructor(r,i){this.authService=r;this.messageService=i}loading=!1;saving=!1;profileLoaded=!1;errorMessage="";successMessage="";form={nom:"",prenom:"",email:"",ville:"",quartier:""};ngOnInit(){this.loadProfile()}loadProfile(){this.loading=!0,this.profileLoaded=!1,this.errorMessage="",this.successMessage="",this.authService.me().subscribe({next:r=>{let i=this.extractUserFromPayload(r?.data)??this.authService.currentUser();if(!i){this.errorMessage="Impossible de charger le profile.",this.pushMessage("error","Erreur",this.errorMessage),this.loading=!1;return}this.applyUserToForm(i),this.profileLoaded=!0,this.loading=!1},error:()=>{let r=this.authService.currentUser();if(r){this.applyUserToForm(r),this.profileLoaded=!0,this.loading=!1;return}this.errorMessage="Impossible de charger le profile.",this.pushMessage("error","Erreur",this.errorMessage),this.loading=!1}})}saveProfile(){if(this.loading||this.saving||!this.profileLoaded)return;this.errorMessage="",this.successMessage="";let r=this.buildUpdatePayload();this.saving=!0,this.authService.updateProfile(r).subscribe({next:i=>{let e=this.extractUserFromPayload(i?.data)??this.authService.currentUser();e&&this.applyUserToForm(e),this.successMessage=i?.message||"Profil mis a jour avec succes.",this.pushMessage("success","Succes",this.successMessage),this.saving=!1},error:i=>{this.errorMessage=this.extractErrorMessage(i),this.pushMessage("error","Erreur",this.errorMessage),this.saving=!1}})}buildUpdatePayload(){let r=this.form.nom.trim(),i=this.form.prenom.trim(),e=this.form.email.trim(),p=this.form.ville.trim(),t=this.form.quartier.trim(),h={};return r.length>0&&(h.nom=r),i.length>0&&(h.prenom=i),h.email=e.length>0?e:null,p.length>0&&(h.ville=p),t.length>0&&(h.quartier=t),h}applyUserToForm(r){this.form={nom:r.nom??"",prenom:r.prenom??"",email:r.email??"",ville:r.ville??"",quartier:r.quartier??""}}extractUserFromPayload(r){if(!r||typeof r!="object")return null;let i=r.user??r;return!i||typeof i!="object"?null:i}extractErrorMessage(r){let i=r?.error?.errors;if(i&&typeof i=="object"){for(let e of Object.values(i))if(Array.isArray(e)){let p=e.find(t=>typeof t=="string");if(typeof p=="string"&&p.trim().length>0)return p}}return typeof r?.error?.message=="string"&&r.error.message.trim().length>0?r.error.message:"Erreur lors de la mise a jour du profile."}pushMessage(r,i,e){this.messageService.add({severity:r,summary:i,detail:e,life:3e3})}static \u0275fac=function(i){return new(i||n)(P(z),P(g))};static \u0275cmp=x({type:n,selectors:[["app-parametres-profile"]],decls:28,vars:14,consts:[[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"flex","flex-col","gap-2"],["for","profile_nom",1,"text-surface-900","dark:text-surface-0"],["id","profile_nom","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_prenom",1,"text-surface-900","dark:text-surface-0"],["id","profile_prenom","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],[1,"flex","flex-col","gap-2","md:col-span-2"],["for","profile_email",1,"text-surface-900","dark:text-surface-0"],["id","profile_email","type","email","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_ville",1,"text-surface-900","dark:text-surface-0"],["id","profile_ville","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","profile_quartier",1,"text-surface-900","dark:text-surface-0"],["id","profile_quartier","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(i,e){i&1&&(a(0,"div",0)(1,"div",1),m(2,"Parametres Profile"),s(),y(3,ne,2,1,"div",2)(4,le,2,1,"div",3),a(5,"div",4)(6,"div",5)(7,"label",6),m(8,"Nom"),s(),a(9,"input",7),f("ngModelChange",function(t){return u(e.form.nom,t)||(e.form.nom=t),t}),s()(),a(10,"div",5)(11,"label",8),m(12,"Prenom"),s(),a(13,"input",9),f("ngModelChange",function(t){return u(e.form.prenom,t)||(e.form.prenom=t),t}),s()(),a(14,"div",10)(15,"label",11),m(16,"Email"),s(),a(17,"input",12),f("ngModelChange",function(t){return u(e.form.email,t)||(e.form.email=t),t}),s()(),a(18,"div",5)(19,"label",13),m(20,"Ville"),s(),a(21,"input",14),f("ngModelChange",function(t){return u(e.form.ville,t)||(e.form.ville=t),t}),s()(),a(22,"div",5)(23,"label",15),m(24,"Quartier"),s(),a(25,"input",16),f("ngModelChange",function(t){return u(e.form.quartier,t)||(e.form.quartier=t),t}),s()()(),a(26,"div")(27,"p-button",17),v("onClick",function(){return e.saveProfile()}),s()()()),i&2&&(o(3),l("ngIf",e.errorMessage),o(),l("ngIf",e.successMessage),o(5),d("ngModel",e.form.nom),l("disabled",e.loading||e.saving),o(4),d("ngModel",e.form.prenom),l("disabled",e.loading||e.saving),o(4),d("ngModel",e.form.email),l("disabled",e.loading||e.saving),o(4),d("ngModel",e.form.ville),l("disabled",e.loading||e.saving),o(4),d("ngModel",e.form.quartier),l("disabled",e.loading||e.saving),o(2),l("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[S,b,R,E,w,T,W,U,D,L],encapsulation:2})};var me=()=>["/roles"];function pe(n,r){n&1&&c(0,"app-parametres-profile")}function de(n,r){n&1&&c(0,"app-parametres-packing")}var k=class n{activeSection="packing";setActiveSection(r){this.activeSection=r}onSectionClick(r,i){r.preventDefault(),r.stopPropagation(),this.setActiveSection(i)}isActive(r){return this.activeSection===r}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=x({type:n,selectors:[["app-parametres-liste"]],features:[C([g])],decls:29,vars:8,consts:[[1,"rounded-t-3xl","bg-surface-0","dark:bg-surface-900","flex-auto","py-6","lg:py-8","px-8","lg:px-20"],[1,"flex","flex-col","w-full","pb-8","gap-2"],[1,"mt-0","text-surface-900","dark:text-surface-0","font-medium","text-2xl","leading-tight"],[1,"mt-0","text-surface-500","dark:text-surface-300","leading-tight"],[1,"grid","grid-cols-12","gap-4","py-6","lg:py-8"],[1,"col-span-12","lg:col-span-2"],[1,"list-none","m-0","p-0","hidden","lg:flex","flex-col","justify-start"],[1,"-ml-[2px]",3,"ngClass"],["href","#",1,"w-full","text-left","flex","items-center","py-3","px-4","font-medium","transition-colors","hover:text-primary",3,"click","ngClass"],[1,"pi","pi-user","mr-2","text-base!","leading-normal!"],[1,"pi","pi-cog","mr-2","text-base!","leading-normal!"],[1,"border-l-2","border-surface-200","dark:border-surface-700","-ml-[2px]"],[1,"flex","items-center","py-3","px-4","text-surface-700","dark:text-surface-200","font-medium","hover:text-primary","transition-colors",3,"routerLink"],[1,"pi","pi-shield","mr-2","text-base!","leading-normal!"],[1,"col-span-12","lg:col-span-10","xl:col-span-10","bg-surface-0","dark:bg-surface-900","p-8","rounded-2xl","flex-auto"],[4,"ngIf"]],template:function(i,e){i&1&&(c(0,"p-toast"),a(1,"div",0)(2,"div",1)(3,"h2",2),m(4,"Parametres"),s(),a(5,"p",3),m(6,"Gestion des parametres de l'application"),s()(),c(7,"p-divider"),a(8,"div",4)(9,"div",5)(10,"ul",6)(11,"li",7)(12,"a",8),v("click",function(t){return e.onSectionClick(t,"profile")}),c(13,"i",9),a(14,"span"),m(15,"Profile"),s()()(),a(16,"li",7)(17,"a",8),v("click",function(t){return e.onSectionClick(t,"packing")}),c(18,"i",10),a(19,"span"),m(20,"Packing"),s()()(),a(21,"li",11)(22,"a",12),c(23,"i",13),a(24,"span"),m(25,"R\xF4les & Permissions"),s()()()()(),a(26,"div",14),y(27,pe,1,0,"app-parametres-profile",15)(28,de,1,0,"app-parametres-packing",15),s()()()),i&2&&(o(11),l("ngClass",e.isActive("profile")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),l("ngClass",e.isActive("profile")?"text-primary":"text-surface-700 dark:text-surface-200"),o(4),l("ngClass",e.isActive("packing")?"border-l-2 border-primary":"border-l-2 border-surface-200 dark:border-surface-700"),o(),l("ngClass",e.isActive("packing")?"text-primary":"text-surface-700 dark:text-surface-200"),o(5),l("routerLink",V(7,me)),o(5),l("ngIf",e.isActive("profile")),o(),l("ngIf",e.isActive("packing")))},dependencies:[S,K,b,A,Y,N,H,I,G,F,q],encapsulation:2})};var Oe=[{path:"",component:k,data:{breadcrumb:"Param\xE8tres"}},{path:"parametres",component:k,data:{breadcrumb:"Param\xE8tres"}}];export{Oe as default};
