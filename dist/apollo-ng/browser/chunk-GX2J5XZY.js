import{a as A,b as G}from"./chunk-TVBRH5GA.js";import{a as O}from"./chunk-V5BDAJUE.js";import"./chunk-6MPWZMCU.js";import{a as K,b as V}from"./chunk-RZ54S6YK.js";import"./chunk-VNQN43PB.js";import"./chunk-BYIX3OH7.js";import"./chunk-473TDG6C.js";import{a as W,b as j}from"./chunk-2NPKJRPA.js";import{b as C,e as D,h as w,j as L,m as T,p as N}from"./chunk-ZFESDBSD.js";import"./chunk-MTJX5HHL.js";import{d as B,e as F}from"./chunk-6QETJJ6S.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import"./chunk-FOGUVNDD.js";import"./chunk-TMCD2O4W.js";import"./chunk-2AWI64NH.js";import{pa as c}from"./chunk-6DTVT4GD.js";import{k as E,u as I}from"./chunk-NSTAUJR5.js";import"./chunk-4O3FVBGX.js";import{Kb as k,Lb as x,Ma as l,Xa as v,Zb as i,_b as h,ab as _,cc as P,dc as y,ec as M,gb as S,gc as R,k as g,u as b,wb as u,xb as t,yb as a,z as f,zb as d}from"./chunk-U3BUAVLN.js";import"./chunk-GAL4ENT6.js";function q(o,s){if(o&1&&(t(0,"div",26),i(1),a()),o&2){let r=x();l(),h(r.errorMessage)}}function J(o,s){if(o&1&&(t(0,"div",27),i(1),a()),o&2){let r=x();l(),h(r.successMessage)}}var m=class o{constructor(s,r){this.parametresService=s;this.messageService=r}loading=!1;saving=!1;errorMessage="";successMessage="";idRouleauPacking="";prixRouleauDefaut=0;idRouleauParam;prixRouleauParam;produitRouleauKey="produit_rouleau_id";legacyProduitRouleauKey="id_rouleau_packing";ngOnInit(){this.loadPackingParametres()}loadPackingParametres(){this.loading=!0,this.errorMessage="",this.parametresService.getParametres("packing").subscribe({next:s=>{let r=s.data.parametres??[];this.idRouleauParam=r.find(e=>e.cle===this.produitRouleauKey)??r.find(e=>e.cle===this.legacyProduitRouleauKey),this.prixRouleauParam=r.find(e=>e.cle==="prix_rouleau_defaut"),this.idRouleauPacking=this.idRouleauParam?.valeur?.toString()??"",this.prixRouleauDefaut=Number(this.prixRouleauParam?.valeur??0)||0,this.loading=!1},error:()=>{this.errorMessage="Impossible de charger les parametres.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.loading=!1}})}savePackingParametres(){if(this.errorMessage="",this.successMessage="",!this.idRouleauParam||!this.prixRouleauParam){this.errorMessage="Parametres packing introuvables (produit_rouleau_id / prix_rouleau_defaut).",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3});return}let s=Number(this.idRouleauPacking);if(!Number.isFinite(s)){this.errorMessage='Le champ "ID du produit rouleau" doit etre numerique.',this.messageService.add({severity:"warn",summary:"Validation",detail:this.errorMessage,life:3e3});return}this.saving=!0,b([this.parametresService.updateParametre(this.idRouleauParam.id,{valeur:s}).pipe(f(()=>g(null))),this.parametresService.updateParametre(this.prixRouleauParam.id,{valeur:Number(this.prixRouleauDefaut||0)}).pipe(f(()=>g(null)))]).subscribe({next:r=>{r.some(p=>p===null)?(this.errorMessage="Une ou plusieurs mises a jour ont echoue.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3})):(this.successMessage="Parametres mis a jour avec succes.",this.messageService.add({severity:"success",summary:"Succes",detail:this.successMessage,life:3e3})),this.saving=!1},error:()=>{this.errorMessage="Erreur lors de la sauvegarde.",this.messageService.add({severity:"error",summary:"Erreur",detail:this.errorMessage,life:3e3}),this.saving=!1}})}static \u0275fac=function(r){return new(r||o)(v(O),v(c))};static \u0275cmp=_({type:o,selectors:[["app-parametres-liste"]],features:[R([c])],decls:39,vars:8,consts:[[1,"rounded-t-3xl","bg-surface-0","dark:bg-surface-900","flex-auto","py-6","lg:py-8","px-8","lg:px-20"],[1,"flex","flex-col","w-full","pb-8","gap-2"],[1,"mt-0","text-surface-900","dark:text-surface-0","font-medium","text-2xl","leading-tight"],[1,"mt-0","text-surface-500","dark:text-surface-300","leading-tight"],[1,"grid","grid-cols-12","gap-4","py-6","lg:py-8"],[1,"col-span-12","lg:col-span-2"],[1,"list-none","m-0","p-0","hidden","lg:flex","flex-col","justify-start"],[1,"border-l-2","border-surface-200","dark:border-surface-700","-ml-[2px]"],[1,"flex","items-center","py-3","px-4","text-surface-700","dark:text-surface-200","font-medium"],[1,"pi","pi-user","mr-2","text-base!","leading-normal!"],[1,"border-l-2","border-primary","-ml-[2px]"],[1,"flex","items-center","py-3","px-4","text-primary","font-medium"],[1,"pi","pi-cog","mr-2","text-base!","leading-normal!"],[1,"col-span-12","lg:col-span-10","xl:col-span-10","bg-surface-0","dark:bg-surface-900","p-8","rounded-2xl","flex-auto"],[1,"flex","flex-col","gap-8"],[1,"text-surface-900","dark:text-surface-0","font-semibold","text-lg","leading-tight"],["class","text-red-500 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],[1,"flex","gap-12","flex-col-reverse","md:flex-row"],[1,"flex-auto","flex","flex-col","gap-6"],[1,"flex","flex-col","gap-2"],["for","produit_rouleau_id",1,"text-surface-900","dark:text-surface-0"],["id","produit_rouleau_id","type","number","min","0","step","1","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["for","prix_rouleau_defaut",1,"text-surface-900","dark:text-surface-0"],["id","prix_rouleau_defaut","type","number","pInputText","",1,"w-full",3,"ngModelChange","ngModel","disabled"],["label","Enregistrer","icon","pi pi-save",3,"onClick","loading","disabled"],[1,"text-red-500","text-sm"],[1,"text-green-600","text-sm"]],template:function(r,e){r&1&&(d(0,"p-toast"),t(1,"div",0)(2,"div",1)(3,"h2",2),i(4,"Parametres"),a(),t(5,"p",3),i(6,"Gestion des parametres de l'application"),a()(),d(7,"p-divider"),t(8,"div",4)(9,"div",5)(10,"ul",6)(11,"li",7)(12,"a",8),d(13,"i",9),t(14,"span"),i(15,"General"),a()()(),t(16,"li",10)(17,"a",11),d(18,"i",12),t(19,"span"),i(20,"Packing"),a()()()()(),t(21,"div",13)(22,"div",14)(23,"div",15),i(24,"Parametres Packing"),a(),S(25,q,2,1,"div",16)(26,J,2,1,"div",17),t(27,"div",18)(28,"div",19)(29,"div",20)(30,"label",21),i(31,"ID du produit rouleau (packing)"),a(),t(32,"input",22),M("ngModelChange",function(n){return y(e.idRouleauPacking,n)||(e.idRouleauPacking=n),n}),a()(),t(33,"div",20)(34,"label",23),i(35,"Prix par defaut du rouleau de packing"),a(),t(36,"input",24),M("ngModelChange",function(n){return y(e.prixRouleauDefaut,n)||(e.prixRouleauDefaut=n),n}),a()()()(),t(37,"div")(38,"p-button",25),k("onClick",function(){return e.savePackingParametres()}),a()()()()()()),r&2&&(l(25),u("ngIf",e.errorMessage),l(),u("ngIf",e.successMessage),l(6),P("ngModel",e.idRouleauPacking),u("disabled",e.loading||e.saving),l(4),P("ngModel",e.prixRouleauDefaut),u("disabled",e.loading||e.saving),l(2),u("loading",e.saving)("disabled",e.loading||e.saving))},dependencies:[I,E,N,C,L,D,T,w,F,B,G,A,j,W,V,K],encapsulation:2})};var ce=[{path:"",component:m,data:{breadcrumb:"Param\xE8tres"}},{path:"parametres",component:m,data:{breadcrumb:"Param\xE8tres"}}];export{ce as default};
