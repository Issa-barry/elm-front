{
  "version": 3,
  "sources": ["src/app/guards/authorization.guard.ts"],
  "sourcesContent": ["import { inject } from '@angular/core';\nimport { CanActivateFn, Router, UrlTree } from '@angular/router';\n\nimport { AuthService } from '@/services/auth/auth.service';\n\nfunction hasAtLeastOne(required: string[] | undefined, current: string[] | undefined): boolean {\n  if (!required || required.length === 0) {\n    return true;\n  }\n\n  if (!current || current.length === 0) {\n    // Fallback permissif: le backend reste la source d'autorite.\n    return true;\n  }\n\n  return required.some(item => current.includes(item));\n}\n\nexport const authorizationGuard: CanActivateFn = (route): boolean | UrlTree => {\n  const authService = inject(AuthService);\n  const router = inject(Router);\n\n  const user = authService.currentUser();\n  if (!user) {\n    return router.createUrlTree(['/auth/login']);\n  }\n\n  const requiredRoles = route.data?.['roles'] as string[] | undefined;\n  const requiredPermissions = route.data?.['permissions'] as string[] | undefined;\n\n  const userRoles = user.roles ?? [];\n  const userPermissions = user.permissions ?? [];\n\n  const hasRole = hasAtLeastOne(requiredRoles, userRoles);\n  const hasPermission = hasAtLeastOne(requiredPermissions, userPermissions);\n\n  if (hasRole && hasPermission) {\n    return true;\n  }\n\n  return router.createUrlTree(['/']);\n};\n"],
  "mappings": ";;;;;;;;;;;AAKA,SAAS,cAAc,UAAgC,SAA6B;AAClF,MAAI,CAAC,YAAY,SAAS,WAAW,GAAG;AACtC,WAAO;EACT;AAEA,MAAI,CAAC,WAAW,QAAQ,WAAW,GAAG;AAEpC,WAAO;EACT;AAEA,SAAO,SAAS,KAAK,UAAQ,QAAQ,SAAS,IAAI,CAAC;AACrD;AAEO,IAAM,qBAAoC,CAAC,UAA4B;AAC5E,QAAM,cAAc,OAAO,WAAW;AACtC,QAAM,SAAS,OAAO,MAAM;AAE5B,QAAM,OAAO,YAAY,YAAW;AACpC,MAAI,CAAC,MAAM;AACT,WAAO,OAAO,cAAc,CAAC,aAAa,CAAC;EAC7C;AAEA,QAAM,gBAAgB,MAAM,OAAO,OAAO;AAC1C,QAAM,sBAAsB,MAAM,OAAO,aAAa;AAEtD,QAAM,YAAY,KAAK,SAAS,CAAA;AAChC,QAAM,kBAAkB,KAAK,eAAe,CAAA;AAE5C,QAAM,UAAU,cAAc,eAAe,SAAS;AACtD,QAAM,gBAAgB,cAAc,qBAAqB,eAAe;AAExE,MAAI,WAAW,eAAe;AAC5B,WAAO;EACT;AAEA,SAAO,OAAO,cAAc,CAAC,GAAG,CAAC;AACnC;",
  "names": []
}
