import{b as ht}from"./chunk-XJUYRIZM.js";import"./chunk-OT3OGSTC.js";import{a as xt}from"./chunk-JWF72WUB.js";import{a as ce,b as de}from"./chunk-XTLZ7ZAT.js";import{a as rt}from"./chunk-Z7B4OLW3.js";import{a as ct,b as dt}from"./chunk-H75UAUBU.js";import{a as pe}from"./chunk-Z4AMWPA3.js";import{b as bt}from"./chunk-DEFPUDC4.js";import{a as kt}from"./chunk-BODMXXTX.js";import{a as nt,b as at}from"./chunk-74ROJ2SD.js";import{a as _t,b as ft}from"./chunk-JPW6ZAFI.js";import{a as mt,b as gt}from"./chunk-GKSDJ35N.js";import{a as ot,d as lt,e as st,k as pt}from"./chunk-5SU3VX4I.js";import"./chunk-FSPVSKSZ.js";import{a as z,b as re}from"./chunk-UNI73J4N.js";import"./chunk-PLHOD4D2.js";import"./chunk-4CBX77DK.js";import{b as j,c as oe}from"./chunk-7NAAWXSB.js";import"./chunk-XVRWV2XV.js";import{b as ut}from"./chunk-LBJBWH2H.js";import"./chunk-JNNIOAIW.js";import"./chunk-VQVZZS7K.js";import"./chunk-D6JQVQWY.js";import"./chunk-EB4NKW3M.js";import"./chunk-MHNPKBVZ.js";import{a as le,b as se}from"./chunk-XG7KTEHV.js";import"./chunk-4D2WW7CC.js";import"./chunk-CFBWG52G.js";import{a as G}from"./chunk-ZCWLOCVK.js";import{a as tt,b as it}from"./chunk-CYMODEE3.js";import"./chunk-SIZMBHAK.js";import"./chunk-QICZJIV6.js";import"./chunk-Y2GJFJSJ.js";import{d as Z}from"./chunk-7G5MAEGV.js";import"./chunk-OAY6NCLF.js";import{a as I,d as Ae}from"./chunk-64S7HSEB.js";import{a as We,b as ze,c as ie,d as je,e as ne}from"./chunk-BOPQ6VBP.js";import"./chunk-QO7YANFN.js";import{c as W,d as ae}from"./chunk-BR4KK4GE.js";import"./chunk-W5YXJREM.js";import"./chunk-VSD657XK.js";import"./chunk-TYSRPQOK.js";import"./chunk-Y2OLWBL2.js";import"./chunk-Z2X2BPAP.js";import{a as Ye,b as Je,c as Xe,d as Ze}from"./chunk-F4Z36YAX.js";import{a as Qe,b as qe}from"./chunk-OVLHBJZG.js";import{b as Ue,e as B,f as Ge,g as He,h as A,i as Ke,p as N}from"./chunk-4JYGVSAH.js";import{a as $e,b as et}from"./chunk-W6DWJODJ.js";import"./chunk-6FAG7IWX.js";import"./chunk-BODZH67C.js";import"./chunk-7UZYWCAJ.js";import{i as te,j as Ne}from"./chunk-MUZL2WG3.js";import"./chunk-G5FZIH5E.js";import{la as $,pa as O,ta as ee}from"./chunk-5CRI5L3F.js";import{i as X,j as Ve,k as V,r as Re,s as Be,v as R}from"./chunk-PVTSUL7D.js";import"./chunk-4O3FVBGX.js";import{Ab as a,Bb as r,Cb as m,Db as Me,Eb as Ee,Jb as k,Na as Se,Nb as f,Ob as d,Pa as l,Sb as Ie,T as ve,Tb as Oe,Ua as D,Ub as Te,X as ye,Xb as q,Yb as De,Zb as Fe,_a as C,_b as be,ac as s,ba as u,bc as v,ca as _,cc as y,db as S,dc as w,ec as Y,fc as h,ga as Ce,gc as x,hc as P,jb as g,jc as J,ka as we,kc as F,nc as ke,u as Pe,uc as E,vc as Le,wc as L,yc as M,zb as p}from"./chunk-WZ5FQRRG.js";import{a as he,b as xe}from"./chunk-GAL4ENT6.js";var Pt={a_valider:"\xC0 valider",valide:"Valid\xE9",annule:"Annul\xE9"},vt={a_valider:"warn",valide:"success",annule:"danger"};function Dt(n,t){if(n&1&&(a(0,"div",27),s(1),r()),n&2){let e=d();l(),w(" ",e.selectedPrestataire.prenom," ",e.selectedPrestataire.nom," ")}}function Ft(n,t){n&1&&m(0,"p-skeleton",28)}function Lt(n,t){if(n&1&&(a(0,"div",32),m(1,"i",33),a(2,"span"),s(3),r()()),n&2){let e=t.$implicit;l(3),Y("",e.prenom," ",e.nom," \xB7 ",e.phone)}}function Vt(n,t){if(n&1&&(a(0,"div",32),m(1,"i",33),a(2,"span"),s(3),r()()),n&2){let e=d().$implicit;l(3),w("",e.prenom," ",e.nom)}}function Rt(n,t){if(n&1&&g(0,Vt,4,2,"div",34),n&2){let e=t.$implicit;p("ngIf",e)}}function Bt(n,t){if(n&1){let e=k();a(0,"p-select",29),P("ngModelChange",function(o){u(e);let c=d();return x(c.selectedPrestataire,o)||(c.selectedPrestataire=o),_(o)}),g(1,Lt,4,3,"ng-template",30)(2,Rt,1,1,"ng-template",31),r()}if(n&2){let e=d();h("ngModel",e.selectedPrestataire),p("options",e.prestataires)("filter",!0)}}function At(n,t){n&1&&(a(0,"small",35),s(1,"Le prestataire est requis."),r())}function Nt(n,t){n&1&&m(0,"p-skeleton",28)}function Wt(n,t){if(n&1){let e=k();a(0,"p-inputnumber",17),P("ngModelChange",function(o){u(e);let c=d();return x(c.packing.prix_par_rouleau,o)||(c.packing.prix_par_rouleau=o),_(o)}),f("onInput",function(){u(e);let o=d();return _(o.calculateMontant())}),r()}if(n&2){let e=d();h("ngModel",e.packing.prix_par_rouleau),p("min",0)}}var me=class n{packing={};prestataires=[];selectedPrestataire=null;saving=!1;dialogLoading=!1;submitted=!1;onSaveEvent=new D;onClose=new D;selectedPrestataireChange=new D;statuses=[{label:"\xC0 valider",value:"a_valider"},{label:"Valid\xE9",value:"valide"},{label:"Annul\xE9",value:"annule"}];calculateMontant(){this.packing.nb_rouleaux&&this.packing.prix_par_rouleau&&(this.packing.montant=this.packing.nb_rouleaux*this.packing.prix_par_rouleau)}onSave(){this.selectedPrestataire&&this.onSaveEvent.emit({packing:this.packing,prestataire:this.selectedPrestataire})}formatCurrency(t){return new Intl.NumberFormat("fr-FR",{style:"decimal",minimumFractionDigits:0}).format(t)+" GNF"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-packing-mobile-form"]],inputs:{packing:"packing",prestataires:"prestataires",selectedPrestataire:"selectedPrestataire",saving:"saving",dialogLoading:"dialogLoading",submitted:"submitted"},outputs:{onSaveEvent:"onSaveEvent",onClose:"onClose",selectedPrestataireChange:"selectedPrestataireChange"},decls:48,vars:19,consts:[[1,"packing-mobile-panel","flex","flex-col","h-full","bg-surface-0","dark:bg-surface-900"],[1,"packing-mobile-header","w-full","flex-shrink-0","p-6","border-b","border-surface-200","dark:border-surface-700","flex","justify-start","items-center"],[1,"flex-1"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-medium","leading-tight"],["class","text-surface-500 dark:text-surface-400 text-sm font-normal mt-1",4,"ngIf"],["pButton","",1,"w-10","h-10",3,"click","text","rounded"],["pButtonIcon","",1,"pi","pi-times"],[1,"packing-mobile-body","flex-1","min-h-0","w-full","p-6","flex","flex-col","justify-start","items-start","gap-6","overflow-y-auto"],[1,"w-full","flex","flex-col","gap-3"],[1,"text-surface-500","dark:text-surface-400","text-xs","font-semibold","uppercase","tracking-wider"],[1,"w-full","flex","flex-col","gap-1"],[1,"text-sm","font-medium","text-surface-700","dark:text-surface-300"],["height","2.75rem","styleClass","w-full",4,"ngIf"],["optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full",3,"ngModel","options","filter","ngModelChange",4,"ngIf"],["class","text-red-500 text-xs",4,"ngIf"],[1,"w-full","flex","flex-col","gap-4"],["dateFormat","dd/mm/yy","inputStyleClass","w-full","styleClass","w-full",3,"ngModelChange","ngModel","showIcon"],["styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],["styleClass","w-full",3,"ngModel","min","ngModelChange","onInput",4,"ngIf"],["optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","styleClass","w-full",3,"ngModelChange","ngModel","options"],[1,"w-full","p-4","bg-surface-50","dark:bg-surface-800","rounded-xl","flex","items-center","justify-between"],[1,"text-surface-900","dark:text-surface-0","text-base","font-semibold"],[1,"text-lg","font-bold","leading-tight",2,"color","var(--p-primary-600)"],[1,"packing-mobile-footer","w-full","border-t","border-surface-200","dark:border-surface-700","p-6","flex","flex-col","gap-3","flex-shrink-0"],["pButton","",1,"w-full","py-3",3,"click","disabled","loading"],["pButtonIcon","",1,"pi","pi-check","mr-2"],["pButtonLabel",""],[1,"text-surface-500","dark:text-surface-400","text-sm","font-normal","mt-1"],["height","2.75rem","styleClass","w-full"],["optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full",3,"ngModelChange","ngModel","options","filter"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"flex","items-center","gap-2"],[1,"pi","pi-user","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"text-red-500","text-xs"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),s(4),r(),g(5,Dt,2,2,"div",4),r(),a(6,"button",5),f("click",function(){return i.onClose.emit()}),m(7,"i",6),r()(),a(8,"div",7)(9,"div",8)(10,"div",9),s(11,"Prestataire"),r(),a(12,"div",10)(13,"label",11),s(14,"Machiniste"),r(),g(15,Ft,1,0,"p-skeleton",12)(16,Bt,3,3,"p-select",13)(17,At,2,0,"small",14),r()(),a(18,"div",15)(19,"div",9),s(20,"Informations"),r(),a(21,"div",10)(22,"label",11),s(23,"Date"),r(),a(24,"p-datepicker",16),P("ngModelChange",function(c){return x(i.packing.date,c)||(i.packing.date=c),c}),r()(),a(25,"div",10)(26,"label",11),s(27,"Nombre de rouleaux"),r(),a(28,"p-inputnumber",17),P("ngModelChange",function(c){return x(i.packing.nb_rouleaux,c)||(i.packing.nb_rouleaux=c),c}),f("onInput",function(){return i.calculateMontant()}),r()(),a(29,"div",10)(30,"label",11),s(31,"Prix / rouleau (GNF)"),r(),g(32,Nt,1,0,"p-skeleton",12)(33,Wt,1,2,"p-inputnumber",18),r(),a(34,"div",10)(35,"label",11),s(36,"Statut"),r(),a(37,"p-select",19),P("ngModelChange",function(c){return x(i.packing.statut,c)||(i.packing.statut=c),c}),r()()(),a(38,"div",20)(39,"span",21),s(40,"Montant total"),r(),a(41,"span",22),s(42),r()()(),a(43,"div",23)(44,"button",24),f("click",function(){return i.onSave()}),m(45,"i",25),a(46,"span",26),s(47),r()()()()),e&2&&(l(4),y(" ",i.packing!=null&&i.packing.id?"D\xE9tails du packing":"Nouveau packing"," "),l(),p("ngIf",(i.packing==null?null:i.packing.id)&&i.selectedPrestataire),l(),p("text",!0)("rounded",!0),l(9),p("ngIf",i.dialogLoading),l(),p("ngIf",!i.dialogLoading),l(),p("ngIf",i.submitted&&!i.selectedPrestataire&&!i.dialogLoading),l(7),h("ngModel",i.packing.date),p("showIcon",!0),l(4),h("ngModel",i.packing.nb_rouleaux),p("min",0),l(4),p("ngIf",i.dialogLoading),l(),p("ngIf",!i.dialogLoading),l(4),h("ngModel",i.packing.statut),p("options",i.statuses),l(5),v(i.formatCurrency(i.packing.montant||0)),l(2),p("disabled",i.saving||i.dialogLoading||!i.selectedPrestataire)("loading",i.saving),l(3),v(i.packing!=null&&i.packing.id?"Sauvegarder":"Enregistrer"))},dependencies:[R,V,N,B,A,ne,ie,We,ze,ee,oe,j,ae,W,re,z,de,ce],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;min-height:0}.packing-mobile-panel[_ngcontent-%COMP%]{min-height:0;overflow:hidden}@media (max-width: 768px){[_nghost-%COMP%]{width:100%;max-width:100%;overflow:hidden}.packing-mobile-panel[_ngcontent-%COMP%]{width:100%;max-width:100%}.packing-mobile-footer[_ngcontent-%COMP%]{padding-bottom:calc(1.5rem + env(safe-area-inset-bottom))}}"]})};var U=class n{constructor(t){this.http=t}apiUrl=`${tt.apiUrl}/packings`;getPackings(t){let e=new I;return t&&(t.prestataire_id&&(e=e.set("prestataire_id",t.prestataire_id.toString())),t.statut&&(e=e.set("statut",t.statut)),t.date_debut&&(e=e.set("date_debut",t.date_debut)),t.date_fin&&(e=e.set("date_fin",t.date_fin)),t.non_payes&&(e=e.set("non_payes",t.non_payes.toString())),t.search&&(e=e.set("search",t.search)),t.sort_by&&(e=e.set("sort_by",t.sort_by)),t.sort_order&&(e=e.set("sort_order",t.sort_order)),t.per_page&&(e=e.set("per_page",t.per_page.toString())),t.page&&(e=e.set("page",t.page.toString()))),this.http.get(this.apiUrl,{params:e})}getPacking(t){return this.http.get(`${this.apiUrl}/${t}`)}createPacking(t){return this.http.post(this.apiUrl,t)}updatePacking(t,e){return this.http.put(`${this.apiUrl}/${t}`,e)}changeStatut(t,e){return this.http.patch(`${this.apiUrl}/${t}/statut`,e)}deletePacking(t){return this.http.delete(`${this.apiUrl}/${t}`)}searchPackings(t){let e=new I().set("search",t);return this.http.get(this.apiUrl,{params:e})}getPackingsByPrestataire(t){let e=new I().set("prestataire_id",t.toString());return this.http.get(this.apiUrl,{params:e})}getPackingsByStatut(t){let e=new I().set("statut",t);return this.http.get(this.apiUrl,{params:e})}getPackingsNonPayes(){let t=new I().set("non_payes","true");return this.http.get(this.apiUrl,{params:t})}getPackingsByPeriode(t,e){let i=new I().set("date_debut",t).set("date_fin",e);return this.http.get(this.apiUrl,{params:i})}getPackingsPaginated(t=1,e=10,i){let o=new I().set("page",t.toString()).set("per_page",e.toString());return i&&(i.prestataire_id&&(o=o.set("prestataire_id",i.prestataire_id.toString())),i.statut&&(o=o.set("statut",i.statut)),i.date_debut&&(o=o.set("date_debut",i.date_debut)),i.date_fin&&(o=o.set("date_fin",i.date_fin)),i.non_payes&&(o=o.set("non_payes",i.non_payes.toString())),i.search&&(o=o.set("search",i.search)),i.sort_by&&(o=o.set("sort_by",i.sort_by)),i.sort_order&&(o=o.set("sort_order",i.sort_order))),this.http.get(this.apiUrl,{params:o})}static \u0275fac=function(e){return new(e||n)(ye(Ae))};static \u0275prov=ve({token:n,factory:n.\u0275fac,providedIn:"root"})};var Gt=["dt"],Ht=()=>({"min-width":"65rem"}),Kt=()=>[10,20,30],Qt=()=>({width:"750px",maxWidth:"95vw"}),qt=()=>({overflow:"visible"}),Yt=()=>({"960px":"95vw","768px":"100vw","480px":"100vw"}),Jt=()=>({width:"450px"}),Xt=(n,t,e)=>({"mobile-status-badge--warn":n,"mobile-status-badge--success":t,"mobile-status-badge--danger":e}),Zt=(n,t,e)=>({"status-badge--warn":n,"status-badge--success":t,"status-badge--danger":e});function $t(n,t){if(n&1&&(a(0,"div",62),s(1),r()),n&2){let e=d().$implicit,i=d(2);l(),y(" ",i.getPrestataireInitials(e.prestataire)," ")}}function ei(n,t){n&1&&(a(0,"div",63),s(1,"?"),r())}function ti(n,t){if(n&1){let e=k();a(0,"button",64),f("click",function(o){u(e);let c=d().$implicit,b=d(2);return o.stopPropagation(),_(b.editPacking(c))}),r()}}function ii(n,t){if(n&1){let e=k();a(0,"article",52),f("click",function(){let o=u(e).$implicit,c=d(2);return _(c.canUpdate&&c.editPacking(o))}),g(1,$t,2,1,"div",53)(2,ei,2,0,"div",54),a(3,"div",55)(4,"div",56),s(5),r(),a(6,"div",57),s(7),r(),a(8,"div",58)(9,"span",59),s(10),r(),a(11,"span",60),s(12),r(),g(13,ti,1,0,"button",61),r()()()}if(n&2){let e=t.$implicit,i=d(2);l(),p("ngIf",e.prestataire),l(),p("ngIf",!e.prestataire),l(3),v(e.prestataire?e.prestataire.prenom+" "+e.prestataire.nom:e.reference||"Packing"),l(2),w("",i.formatDateDisplay(e.date)," \xB7 ",e.nb_rouleaux," rouleaux"),l(3),v(i.formatCurrency(e.montant)),l(),p("ngClass",ke(9,Xt,e.statut==="a_valider",e.statut==="valide",e.statut==="annule")),l(),v(i.getStatutLabel(e.statut)),l(),p("ngIf",i.canUpdate)}}function ni(n,t){if(n&1&&(a(0,"section",50),g(1,ii,14,13,"article",51),r()),n&2){let e=d();l(),p("ngForOf",e.mobileVisiblePackings)("ngForTrackBy",e.trackByPackingId)}}function ai(n,t){n&1&&(a(0,"div",66),s(1,"Chargement..."),r())}function ri(n,t){n&1&&(a(0,"div",66),s(1,"Aucun packing."),r())}function oi(n,t){if(n&1&&g(0,ai,2,0,"div",65)(1,ri,2,0,"div",65),n&2){let e=d();p("ngIf",e.loading),l(),p("ngIf",!e.loading&&!e.mobileFilteredPackings.length)}}function li(n,t){if(n&1){let e=k();a(0,"div",67)(1,"button",68),f("click",function(){u(e);let o=d();return _(o.loadMoreMobile())}),r()()}}function si(n,t){if(n&1){let e=k();a(0,"button",69),f("click",function(){u(e);let o=d();return _(o.openNew())}),m(1,"i",70),r()}}function pi(n,t){if(n&1){let e=k();a(0,"p-button",72),f("onClick",function(){u(e);let o=d(2);return _(o.openNew())}),r()}}function ci(n,t){if(n&1&&g(0,pi,1,0,"p-button",71),n&2){let e=d();p("ngIf",e.canCreate)}}function di(n,t){if(n&1){let e=k();a(0,"p-button",78),f("onClick",function(){u(e);let o=d(2);return _(o.clearDateFilters())}),r()}n&2&&p("outlined",!0)("rounded",!0)}function mi(n,t){if(n&1){let e=k();a(0,"div",73)(1,"p-select",74),P("ngModelChange",function(o){u(e);let c=d();return x(c.filterStatut,o)||(c.filterStatut=o),_(o)}),f("onChange",function(){u(e);let o=d();return _(o.onDateFilter())}),r(),a(2,"p-datepicker",75),P("ngModelChange",function(o){u(e);let c=d();return x(c.filterDateRange,o)||(c.filterDateRange=o),_(o)}),f("onSelect",function(){u(e);let o=d();return _(o.onDateRangeSelect())}),r(),g(3,di,1,2,"p-button",76),a(4,"p-button",77),f("onClick",function(){u(e);let o=d();return _(o.exportCSV())}),r()()}if(n&2){let e=d();l(),h("ngModel",e.filterStatut),p("options",e.statuses)("showClear",!0),l(),h("ngModel",e.filterDateRange),p("showIcon",!0)("readonlyInput",!0),l(),p("ngIf",e.filterDateRange||e.filterStatut)}}function gi(n,t){if(n&1){let e=k();a(0,"div",79)(1,"h5",80),s(2,"Gestion des Packings"),r(),a(3,"p-iconfield"),m(4,"p-inputicon",20),a(5,"input",81),f("input",function(o){u(e);let c=d(),b=q(29);return _(c.onGlobalFilter(b,o))}),r()()()}}function ui(n,t){n&1&&(a(0,"tr")(1,"th",82)(2,"span",83),s(3,"Prestataire "),m(4,"p-sortIcon",84),r()(),a(5,"th")(6,"span",83),s(7,"T\xE9l\xE9phone"),r()(),a(8,"th",85)(9,"span",83),s(10,"Date "),m(11,"p-sortIcon",86),r()(),a(12,"th",87)(13,"span",88),s(14,"Rouleaux "),m(15,"p-sortIcon",89),r()(),a(16,"th",90)(17,"span",88),s(18,"Montant "),m(19,"p-sortIcon",91),r()(),a(20,"th",92)(21,"span",93),s(22,"Statut "),m(23,"p-sortIcon",94),r()(),m(24,"th",95),r())}function _i(n,t){if(n&1&&(a(0,"div",104)(1,"span",105),s(2),r(),a(3,"span",106),s(4),r()()),n&2){let e,i=d().$implicit;l(),De("background","var(--p-primary-50)")("color","var(--p-primary-600)"),l(),y(" ",i.prestataire.nom==null||(e=i.prestataire.nom.charAt(0))==null?null:e.toUpperCase()," "),l(2),w("",i.prestataire.nom," ",i.prestataire.prenom)}}function fi(n,t){if(n&1&&(a(0,"span"),s(1),E(2,"phoneFormat"),r()),n&2){let e=d().$implicit;l(),v(L(2,1,e.prestataire.phone,"INT"))}}function bi(n,t){if(n&1){let e=k();a(0,"p-button",107),f("click",function(){u(e);let o=d().$implicit,c=d();return _(c.editPacking(o))}),r()}n&2&&p("text",!0)("rounded",!0)}function ki(n,t){if(n&1){let e=k();a(0,"tr",96),f("dblclick",function(){let o=u(e).$implicit,c=d();return _(c.canUpdate&&c.editPacking(o))}),a(1,"td"),g(2,_i,5,7,"div",97),r(),a(3,"td",98),g(4,fi,3,4,"span",99),r(),a(5,"td",98),s(6),r(),a(7,"td",100),s(8),r(),a(9,"td",100),s(10),r(),a(11,"td",101)(12,"span",102),s(13),r()(),a(14,"td",101),g(15,bi,1,2,"p-button",103),r()()}if(n&2){let e=t.$implicit,i=d();l(2),p("ngIf",e.prestataire),l(2),p("ngIf",e.prestataire),l(2),v(i.formatDateDisplay(e.date)),l(2),v(e.nb_rouleaux),l(2),v(i.formatCurrency(e.montant)),l(2),p("ngClass",ke(8,Zt,e.statut==="a_valider",e.statut==="valide",e.statut==="annule")),l(),y(" ",i.getStatutLabel(e.statut)," "),l(2),p("ngIf",i.canUpdate)}}function hi(n,t){n&1&&(a(0,"tr")(1,"td",108)(2,"div",109),m(3,"i",110),a(4,"span"),s(5,"Aucun packing trouv\xE9"),r()()()())}function xi(n,t){n&1&&m(0,"p-skeleton",111)}function Pi(n,t){if(n&1&&(a(0,"div",73),m(1,"i",115),a(2,"span"),s(3),r()()),n&2){let e=t.$implicit;l(3),Y("",e.prenom," ",e.nom," \xB7 ",e.phone)}}function vi(n,t){if(n&1&&(a(0,"div",73),m(1,"i",115),a(2,"span"),s(3),r()()),n&2){let e=d().$implicit;l(3),w("",e.prenom," ",e.nom)}}function yi(n,t){if(n&1&&g(0,vi,4,2,"div",116),n&2){let e=t.$implicit;p("ngIf",e)}}function Ci(n,t){if(n&1){let e=k();a(0,"p-select",112),P("ngModelChange",function(o){u(e);let c=d();return x(c.selectedPrestataire,o)||(c.selectedPrestataire=o),_(o)}),g(1,Pi,4,3,"ng-template",113)(2,yi,1,1,"ng-template",114),r()}if(n&2){let e=d();h("ngModel",e.selectedPrestataire),p("options",e.prestataires)("filter",!0)}}function wi(n,t){n&1&&(a(0,"small",117),s(1,"Le prestataire est requis."),r())}function Si(n,t){n&1&&m(0,"p-skeleton",111)}function Mi(n,t){if(n&1){let e=k();a(0,"p-inputnumber",118),P("ngModelChange",function(o){u(e);let c=d();return x(c.packing.prix_par_rouleau,o)||(c.packing.prix_par_rouleau=o),_(o)}),f("onInput",function(){u(e);let o=d();return _(o.calculateMontant())}),r()}if(n&2){let e=d();h("ngModel",e.packing.prix_par_rouleau),p("min",0)}}function Ei(n,t){if(n&1){let e=k();a(0,"div",119)(1,"p-button",120),f("click",function(){u(e);let o=d();return _(o.hideDialog())}),r(),a(2,"p-button",121),f("click",function(){u(e);let o=d();return _(o.savePacking())}),r()()}if(n&2){let e=d();l(),p("outlined",!0)("disabled",e.saving),l(),p("disabled",e.saving||e.dialogLoading)("loading",e.saving)}}function Ii(n,t){if(n&1){let e=k();a(0,"div",122)(1,"div",123),f("click",function(){u(e);let o=d();return _(o.closeMobileForm())}),r(),a(2,"div",124)(3,"app-packing-mobile-form",125),f("onSaveEvent",function(o){u(e);let c=d();return _(c.onMobileFormSave(o))})("onClose",function(){u(e);let o=d();return _(o.closeMobileForm())}),r()()()}if(n&2){let e=d();l(3),p("packing",e.packing)("prestataires",e.prestataires)("selectedPrestataire",e.selectedPrestataire)("saving",e.saving)("dialogLoading",e.dialogLoading)("submitted",e.submitted)}}var K=class n{constructor(t,e,i,o,c,b,Q,qi){this.packingService=t;this.prestataireService=e;this.parametresService=i;this.messageService=o;this.confirmationService=c;this.authService=b;this.router=Q;this.document=qi;this.canCreate=this.authService.hasPermission("packings.create"),this.canUpdate=this.authService.hasPermission("packings.update"),this.canDelete=this.authService.hasPermission("packings.delete")}filterFields=["reference","prestataire.nom","prestataire.prenom","prestataire.phone","statut","montant"];packingDialog=!1;packings=we([]);packing={};selectedPackings=null;submitted=!1;loading=!1;saving=!1;dialogLoading=!1;mobileSearchTerm="";mobilePageSize=10;mobileVisibleCount=this.mobilePageSize;mobileFormVisible=!1;mobileBreakpoint=768;mobilePwaClass="packings-mobile-pwa";filterDateRange=null;filterStatut=null;mobileStatusMenuItems=[{label:"Tous les statuts",command:()=>this.applyMobileStatusFilter(null)},{label:"\xC0 valider",command:()=>this.applyMobileStatusFilter("a_valider")},{label:"Valid\xE9",command:()=>this.applyMobileStatusFilter("valide")},{label:"Annul\xE9",command:()=>this.applyMobileStatusFilter("annule")}];prixRouleauDefaut=0;prestataires=[];filteredPrestataires=[];selectedPrestataire=null;statuses=[{label:"\xC0 valider",value:"a_valider"},{label:"Valid\xE9",value:"valide"},{label:"Annul\xE9",value:"annule"}];canCreate=!1;canUpdate=!1;canDelete=!1;dt;exportColumns;cols;ngOnInit(){this.loadPackings(),this.loadPrestataires(),this.loadPrixRouleauDefaut(),this.initColumns(),this.syncMobilePwaMode()}ngOnDestroy(){this.document.body.classList.remove(this.mobilePwaClass)}onWindowResize(){this.syncMobilePwaMode()}goHome(){this.router.navigate(["/"])}onMobileSearchChange(){this.mobileVisibleCount=this.mobilePageSize}get mobileFilteredPackings(){let t=this.packings(),e=this.mobileSearchTerm.trim().toLowerCase();return e?t.filter(i=>{let o=(i.reference||"").toLowerCase(),c=(i.prestataire?.nom||"").toLowerCase(),b=(i.prestataire?.prenom||"").toLowerCase(),Q=(i.prestataire?.phone||"").replace(/\s/g,"");return o.includes(e)||c.includes(e)||b.includes(e)||Q.includes(e)}):t}get mobileVisiblePackings(){return this.mobileFilteredPackings.slice(0,this.mobileVisibleCount)}get canLoadMoreMobile(){return this.mobileVisibleCount<this.mobileFilteredPackings.length}loadMoreMobile(){this.mobileVisibleCount+=this.mobilePageSize}trackByPackingId(t,e){return e.id}getPrestataireInitials(t){if(!t)return"?";let e=(t.nom||"").charAt(0).toUpperCase(),i=(t.prenom||"").charAt(0).toUpperCase();return e+i||"?"}goToEditPacking(t){this.router.navigate(["packings","packings-edit",t.id])}applyMobileStatusFilter(t){this.filterStatut=t,this.loadPackings()}get isMobile(){return typeof window<"u"&&window.innerWidth<=this.mobileBreakpoint}syncMobilePwaMode(){typeof window>"u"||(window.innerWidth<=this.mobileBreakpoint?this.document.body.classList.add(this.mobilePwaClass):this.document.body.classList.remove(this.mobilePwaClass))}initColumns(){this.cols=[{field:"reference",header:"R\xE9f\xE9rence"},{field:"prestataire",header:"Prestataire"},{field:"date",header:"Date"},{field:"nb_rouleaux",header:"Rouleaux"},{field:"montant",header:"Montant"},{field:"statut",header:"Statut"}],this.exportColumns=this.cols.map(t=>({title:t.header,dataKey:t.field}))}onDateRangeSelect(){this.filterDateRange&&this.filterDateRange[1]&&this.loadPackings()}onDateFilter(){this.loadPackings()}clearDateFilters(){this.filterDateRange=null,this.filterStatut=null,this.loadPackings()}loadPackings(){this.loading=!0;let t={};this.filterDateRange?.[0]&&(t.date_debut=this.formatDate(this.filterDateRange[0])),this.filterDateRange?.[1]&&(t.date_fin=this.formatDate(this.filterDateRange[1])),this.filterStatut&&(t.statut=this.filterStatut),this.packingService.getPackings(Object.keys(t).length?t:void 0).subscribe({next:e=>{let i="data"in e&&Array.isArray(e.data)?e.data:e.data?.data||[];this.packings.set(i),this.mobileVisibleCount=this.mobilePageSize,this.loading=!1},error:e=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les packings",life:3e3}),this.loading=!1}})}loadPrixRouleauDefaut(){this.parametresService.getPrixRouleauDefaut().subscribe({next:t=>{this.prixRouleauDefaut=t},error:()=>{this.prixRouleauDefaut=0}})}loadPrestataires(){this.prestataireService.getActivePrestataires().subscribe({next:t=>{this.prestataires=t.data.filter(e=>e.type==="machiniste")},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires",life:3e3})}})}filterPrestataire(t){let e=t.query.toLowerCase();this.filteredPrestataires=this.prestataires.filter(i=>i.nom.toLowerCase().includes(e)||i.prenom.toLowerCase().includes(e)||i.phone.includes(e))}exportCSV(){this.dt.exportCSV()}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}openNew(){this.selectedPrestataire=null,this.submitted=!1,this.dialogLoading=!0,this.isMobile?this.mobileFormVisible=!0:this.packingDialog=!0,Pe({prixRouleauDefaut:this.parametresService.getPrixRouleauDefaut(),prestataires:this.prestataireService.getActivePrestataires()}).subscribe({next:({prixRouleauDefaut:t,prestataires:e})=>{this.prixRouleauDefaut=t,this.prestataires=e.data.filter(i=>i.type==="machiniste"),this.packing={statut:"valide",date:new Date,nb_rouleaux:0,prix_par_rouleau:this.prixRouleauDefaut,montant:0},this.dialogLoading=!1},error:()=>{this.packing={statut:"valide",date:new Date,nb_rouleaux:0,prix_par_rouleau:this.prixRouleauDefaut,montant:0},this.dialogLoading=!1}})}editPacking(t){this.packing=xe(he({},t),{date:t.date?new Date(t.date):void 0}),this.selectedPrestataire=t.prestataire||null,this.isMobile?this.mobileFormVisible=!0:this.packingDialog=!0}deletePacking(t){this.confirmationService.confirm({message:`\xCAtes-vous s\xFBr de vouloir supprimer le packing ${t.reference} ?`,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.packingService.deletePacking(t.id).subscribe({next:()=>{this.packings.set(this.packings().filter(e=>e.id!==t.id)),this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing supprim\xE9",life:3e3})},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de supprimer le packing",life:3e3})}})}})}deleteSelectedPackings(){this.confirmationService.confirm({message:"\xCAtes-vous s\xFBr de vouloir supprimer les packings s\xE9lectionn\xE9s ?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.selectedPackings?.forEach(t=>{this.packingService.deletePacking(t.id).subscribe()}),this.packings.set(this.packings().filter(t=>!this.selectedPackings?.includes(t))),this.selectedPackings=null,this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packings supprim\xE9s",life:3e3})}})}hideDialog(){this.packingDialog=!1,this.submitted=!1}closeMobileForm(){this.mobileFormVisible=!1,this.submitted=!1}onMobileFormSave(t){this.packing=t.packing,this.selectedPrestataire=t.prestataire,this.savePacking()}savePacking(){if(this.submitted=!0,!this.selectedPrestataire||this.saving)return;this.saving=!0;let t={prestataire_id:this.selectedPrestataire.id,date:this.formatDate(this.packing.date),nb_rouleaux:this.packing.nb_rouleaux||0,prix_par_rouleau:this.packing.prix_par_rouleau||0,statut:this.packing.statut,notes:this.packing.notes??void 0};this.packing.id?this.packingService.updatePacking(this.packing.id,t).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing mis \xE0 jour",life:3e3}),this.packingDialog=!1,this.mobileFormVisible=!1,this.packing={},this.saving=!1,this.loadPackings()},error:e=>{this.showApiError(e,"Impossible de mettre \xE0 jour le packing"),this.saving=!1}}):this.packingService.createPacking(t).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing cr\xE9\xE9",life:3e3}),this.packingDialog=!1,this.mobileFormVisible=!1,this.packing={},this.saving=!1,this.loadPackings()},error:e=>{this.showApiError(e,"Impossible de cr\xE9er le packing"),this.saving=!1}})}calculateMontant(){this.packing.nb_rouleaux&&this.packing.prix_par_rouleau&&(this.packing.montant=this.packing.nb_rouleaux*this.packing.prix_par_rouleau)}formatDate(t){return t?typeof t=="string"?t:new Date(t).toISOString().split("T")[0]:""}getStatutLabel(t){return Pt[t]||t}getStatutSeverity(t){return vt[t]||"info"}formatCurrency(t){return new Intl.NumberFormat("fr-FR",{style:"decimal",minimumFractionDigits:0}).format(t)+" GNF"}formatDateDisplay(t){return t==null?"":(typeof t=="string"?new Date(t):t).toLocaleDateString("fr-FR")}showApiError(t,e){let i=t.error?.message||e;t.status===422&&t.error?.errors?Object.values(t.error.errors).flat().forEach(c=>{this.messageService.add({severity:"error",summary:i,detail:c,life:5e3})}):this.messageService.add({severity:"error",summary:i,detail:"",life:5e3})}static \u0275fac=function(e){return new(e||n)(C(U),C(pe),C(xt),C(O),C($),C(it),C(Z),C(Ce))};static \u0275cmp=S({type:n,selectors:[["app-packing-liste"]],viewQuery:function(e,i){if(e&1&&Ie(Gt,5),e&2){let o;Oe(o=Te())&&(i.dt=o.first)}},hostBindings:function(e,i){e&1&&f("resize",function(){return i.onWindowResize()},Se)},features:[J([O,$])],decls:79,vars:49,consts:[["statusMenu",""],["mobileListState",""],["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["footer",""],[1,"packing-mobile-app"],[1,"mobile-header"],["pButton","","pRipple","","icon","pi pi-arrow-left","aria-label","Retour \xE0 l'accueil",1,"p-button-rounded","p-button-text","mobile-back",3,"click"],[1,"mobile-title-wrap"],[1,"mobile-title"],[1,"mobile-subtitle"],["appendTo","body","styleClass","mobile-status-menu",3,"model","popup"],["pButton","","pRipple","","icon","pi pi-filter","aria-label","Filtrer par statut",1,"p-button-rounded","p-button-text","mobile-add",3,"click"],[1,"mobile-scroll"],[1,"mobile-search"],["styleClass","pi pi-search"],["pInputText","","type","text","placeholder","Prestataire, r\xE9f\xE9rence...",1,"w-full",3,"ngModelChange","ngModel"],["class","mobile-list",4,"ngIf","ngIfElse"],["class","mobile-load-more",4,"ngIf"],["type","button","class","mobile-fab","aria-label","Nouveau packing",3,"click",4,"ngIf"],[1,"card","packing-desktop"],["styleClass","mb-12"],["dataKey","id","currentPageReportTemplate","  {first} \xE0 {last} sur {totalRecords} packings",3,"selectionChange","value","rows","columns","paginator","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions","loading"],["styleClass","packing-dialog",3,"visibleChange","visible","contentStyle","header","modal","breakpoints","maximizable"],[1,"packing-dialog-content"],[1,"packing-dialog-section"],[1,"packing-dialog-section-title"],[1,"packing-dialog-field"],["for","prestataire"],["height","2.75rem","styleClass","w-full",4,"ngIf"],["id","prestataire","optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full packing-dialog-select",3,"ngModel","options","filter","ngModelChange",4,"ngIf"],["class","packing-dialog-error",4,"ngIf"],["for","date"],["id","date","dateFormat","dd/mm/yy","inputStyleClass","w-full","styleClass","w-full",3,"ngModelChange","ngModel","showIcon"],[1,"packing-dialog-row"],["for","nb_rouleaux"],["id","nb_rouleaux","styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],["for","prix_par_rouleau"],["id","prix_par_rouleau","styleClass","w-full",3,"ngModel","min","ngModelChange","onInput",4,"ngIf"],["for","statut"],["id","statut","optionLabel","label","optionValue","value","placeholder","S\xE9lectionner un statut","styleClass","w-full packing-dialog-select",3,"ngModelChange","ngModel","options"],[1,"packing-dialog-total"],[1,"packing-dialog-total-label"],[1,"packing-dialog-total-value"],["class","fixed inset-0 z-50",4,"ngIf"],[1,"mobile-list"],["class","mobile-packing-card",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mobile-packing-card",3,"click"],["class","mobile-card-avatar","aria-hidden","true",4,"ngIf"],["class","mobile-card-avatar mobile-card-avatar--fallback","aria-hidden","true",4,"ngIf"],[1,"mobile-card-body"],[1,"mobile-card-name"],[1,"mobile-card-meta"],[1,"mobile-card-footer"],[1,"mobile-card-summary"],[1,"mobile-status-badge",3,"ngClass"],["pButton","","pRipple","","icon","pi pi-arrow-right","class","p-button-rounded p-button-text p-button-sm mobile-action-btn","pTooltip","Modifier","tooltipPosition","top",3,"click",4,"ngIf"],["aria-hidden","true",1,"mobile-card-avatar"],["aria-hidden","true",1,"mobile-card-avatar","mobile-card-avatar--fallback"],["pButton","","pRipple","","icon","pi pi-arrow-right","pTooltip","Modifier","tooltipPosition","top",1,"p-button-rounded","p-button-text","p-button-sm","mobile-action-btn",3,"click"],["class","mobile-state",4,"ngIf"],[1,"mobile-state"],[1,"mobile-load-more"],["pButton","","label","Charger plus","icon","pi pi-angle-down",1,"mobile-load-more-btn",3,"click"],["type","button","aria-label","Nouveau packing",1,"mobile-fab",3,"click"],[1,"pi","pi-plus"],["label","Ajouter packing","icon","pi pi-plus","severity","secondary","class","mr-2",3,"onClick",4,"ngIf"],["label","Ajouter packing","icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick"],[1,"flex","items-center","gap-2"],["optionLabel","label","optionValue","value","placeholder","Statut","styleClass","w-40",3,"ngModelChange","onChange","ngModel","options","showClear"],["selectionMode","range","dateFormat","dd/mm/yy","placeholder","P\xE9riode","inputStyleClass","w-full","styleClass","w-56",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput"],["icon","pi pi-filter-slash","severity","secondary","pTooltip","Effacer les filtres",3,"outlined","rounded","onClick",4,"ngIf"],["label","Export","icon","pi pi-download","severity","secondary",3,"onClick"],["icon","pi pi-filter-slash","severity","secondary","pTooltip","Effacer les filtres",3,"onClick","outlined","rounded"],[1,"flex","items-center","justify-between"],[1,"m-0"],["pInputText","","type","text","placeholder","Rechercher...",3,"input"],["pSortableColumn","prestataire.nom"],[1,"col-header"],["field","prestataire.nom"],["pSortableColumn","date"],["field","date"],["pSortableColumn","nb_rouleaux",1,"text-right"],[1,"col-header","justify-end"],["field","nb_rouleaux"],["pSortableColumn","montant",1,"text-right"],["field","montant"],["pSortableColumn","statut",1,"text-center"],[1,"col-header","justify-center"],["field","statut"],[1,"text-center",2,"width","5rem"],[1,"table-row",3,"dblclick"],["class","cell-prestataire",4,"ngIf"],[1,"cell-secondary","cell-bold"],[4,"ngIf"],[1,"text-right","cell-mono","cell-bold"],[1,"text-center"],[1,"status-badge",3,"ngClass"],["icon","pi pi-arrow-right","severity","secondary","pTooltip","Modifier",3,"text","rounded","click",4,"ngIf"],[1,"cell-prestataire"],[1,"cell-prestataire__avatar"],[1,"cell-prestataire__name"],["icon","pi pi-arrow-right","severity","secondary","pTooltip","Modifier",3,"click","text","rounded"],["colspan","7"],[1,"empty-state"],[1,"pi","pi-inbox"],["height","2.75rem","styleClass","w-full"],["id","prestataire","optionLabel","nom","filterBy","nom,prenom,phone","placeholder","S\xE9lectionner un prestataire","styleClass","w-full packing-dialog-select",3,"ngModelChange","ngModel","options","filter"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"pi","pi-user","text-primary"],["class","flex items-center gap-2",4,"ngIf"],[1,"packing-dialog-error"],["id","prix_par_rouleau","styleClass","w-full",3,"ngModelChange","onInput","ngModel","min"],[1,"packing-dialog-footer"],["label","Annuler","icon","pi pi-times","severity","secondary",3,"click","outlined","disabled"],["label","Enregistrer","icon","pi pi-check",3,"click","disabled","loading"],[1,"fixed","inset-0","z-50"],[1,"absolute","inset-0","bg-black/50","animate-fadein",3,"click"],[1,"packing-mobile-slideover","bg-surface-0","dark:bg-surface-900","absolute","top-0","right-0","shadow-xl","w-full","h-full","animate-fadeinright"],[3,"onSaveEvent","onClose","packing","prestataires","selectedPrestataire","saving","dialogLoading","submitted"]],template:function(e,i){if(e&1){let o=k();m(0,"p-toast"),a(1,"div",10)(2,"header",11)(3,"button",12),f("click",function(){return u(o),_(i.goHome())}),r(),a(4,"div",13)(5,"h1",14),s(6,"Packings"),r(),a(7,"p",15),s(8),r()(),m(9,"p-menu",16,0),a(11,"button",17),f("click",function(b){u(o);let Q=q(10);return _(Q.toggle(b))}),r()(),a(12,"div",18)(13,"section",19)(14,"p-iconfield"),m(15,"p-inputicon",20),a(16,"input",21),P("ngModelChange",function(b){return u(o),x(i.mobileSearchTerm,b)||(i.mobileSearchTerm=b),_(b)}),f("ngModelChange",function(){return u(o),_(i.onMobileSearchChange())}),r()()(),g(17,ni,2,2,"section",22)(18,oi,2,2,"ng-template",null,1,M)(20,li,2,0,"div",23),r(),g(21,si,2,0,"button",24),r(),a(22,"div",25)(23,"p-toolbar",26),g(24,ci,1,1,"ng-template",null,2,M)(26,mi,5,7,"ng-template",null,3,M),r(),a(28,"p-table",27,4),P("selectionChange",function(b){return u(o),x(i.selectedPackings,b)||(i.selectedPackings=b),_(b)}),g(30,gi,6,0,"ng-template",null,5,M)(32,ui,25,0,"ng-template",null,6,M)(34,ki,16,12,"ng-template",null,7,M)(36,hi,6,0,"ng-template",null,8,M),r()(),a(38,"p-dialog",28),P("visibleChange",function(b){return u(o),x(i.packingDialog,b)||(i.packingDialog=b),_(b)}),a(39,"div",29)(40,"section",30)(41,"h3",31),s(42,"Prestataire"),r(),a(43,"div",32)(44,"label",33),s(45,"Machiniste"),r(),g(46,xi,1,0,"p-skeleton",34)(47,Ci,3,3,"p-select",35)(48,wi,2,0,"small",36),r()(),a(49,"section",30)(50,"h3",31),s(51,"Informations"),r(),a(52,"div",32)(53,"label",37),s(54,"Date"),r(),a(55,"p-datepicker",38),P("ngModelChange",function(b){return u(o),x(i.packing.date,b)||(i.packing.date=b),_(b)}),r()(),a(56,"div",39)(57,"div",32)(58,"label",40),s(59,"Nombre de rouleaux"),r(),a(60,"p-inputnumber",41),P("ngModelChange",function(b){return u(o),x(i.packing.nb_rouleaux,b)||(i.packing.nb_rouleaux=b),_(b)}),f("onInput",function(){return u(o),_(i.calculateMontant())}),r()(),a(61,"div",32)(62,"label",42),s(63,"Prix / rouleau (GNF)"),r(),g(64,Si,1,0,"p-skeleton",34)(65,Mi,1,2,"p-inputnumber",43),r()(),a(66,"div",32)(67,"label",44),s(68,"Statut"),r(),a(69,"p-select",45),P("ngModelChange",function(b){return u(o),x(i.packing.statut,b)||(i.packing.statut=b),_(b)}),r()()(),a(70,"div",46)(71,"span",47),s(72,"Montant total"),r(),a(73,"span",48),s(74),r()()(),g(75,Ei,3,4,"ng-template",null,9,M),r(),m(77,"p-confirmdialog"),g(78,Ii,4,6,"div",49)}if(e&2){let o=q(19);l(8),w("",i.mobileFilteredPackings.length," packing",i.mobileFilteredPackings.length!==1?"s":""),l(),p("model",i.mobileStatusMenuItems)("popup",!0),l(7),h("ngModel",i.mobileSearchTerm),l(),p("ngIf",!i.loading&&i.mobileVisiblePackings.length)("ngIfElse",o),l(3),p("ngIf",!i.loading&&i.canLoadMoreMobile),l(),p("ngIf",i.canCreate),l(7),p("value",i.packings())("rows",10)("columns",i.cols)("paginator",!0)("globalFilterFields",i.filterFields)("tableStyle",F(43,Ht)),h("selection",i.selectedPackings),p("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",F(44,Kt))("loading",i.loading),l(10),be(F(45,Qt)),h("visible",i.packingDialog),p("contentStyle",F(46,qt))("header",i.packing!=null&&i.packing.id?"D\xE9tails du packing":"Nouveau packing")("modal",!0)("breakpoints",F(47,Yt))("maximizable",!1),l(8),p("ngIf",i.dialogLoading),l(),p("ngIf",!i.dialogLoading),l(),p("ngIf",i.submitted&&!i.selectedPrestataire&&!i.dialogLoading),l(7),h("ngModel",i.packing.date),p("showIcon",!0),l(5),h("ngModel",i.packing.nb_rouleaux),p("min",0),l(4),p("ngIf",i.dialogLoading),l(),p("ngIf",!i.dialogLoading),l(4),h("ngModel",i.packing.statut),p("options",i.statuses),l(5),v(i.formatCurrency(i.packing.montant||0)),l(3),be(F(48,Jt)),l(),p("ngIf",i.mobileFormVisible)}},dependencies:[R,X,Ve,V,pt,ot,ee,lt,st,N,Ue,B,A,ne,ie,je,Ne,te,se,le,dt,ct,qe,Qe,ae,W,oe,j,gt,mt,ut,Ze,Xe,Je,Ye,ft,_t,re,z,ht,bt,et,$e,de,ce,at,nt,me,kt],styles:["[_nghost-%COMP%]{display:block}.packing-mobile-app[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 768px){[_nghost-%COMP%]{--mobile-primary: #5f6bff;--mobile-text: #334155;--mobile-muted: #7f8ca3;--mobile-card: #ffffff;--mobile-border: #e2e8f0}.packing-desktop[_ngcontent-%COMP%]{display:none}.packing-mobile-app[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;height:100vh;height:100dvh;overflow:hidden;margin-top:calc(-.25rem - env(safe-area-inset-top));margin-left:-.875rem;margin-right:-.875rem;margin-bottom:calc(-.875rem - env(safe-area-inset-bottom));padding:0 .875rem env(safe-area-inset-bottom);padding-left:calc(.875rem + env(safe-area-inset-left));padding-right:calc(.875rem + env(safe-area-inset-right));background:#f8fafc;animation:_ngcontent-%COMP%_packingMobileFade .24s ease-out}.mobile-header[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;gap:.55rem;margin:0 -.875rem;padding:calc(.5rem + env(safe-area-inset-top)) calc(.875rem + env(safe-area-inset-right)) .6rem calc(.875rem + env(safe-area-inset-left));background:var(--mobile-card);border-bottom:1px solid var(--mobile-border);box-shadow:0 1px 3px #0f172a0f;position:sticky;top:0;z-index:30}.mobile-scroll[_ngcontent-%COMP%]{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:.75rem;padding-bottom:calc(4rem + env(safe-area-inset-bottom))}.mobile-back[_ngcontent-%COMP%], .mobile-add[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;flex-shrink:0;color:var(--mobile-primary)!important;background:#5f6bff1a!important}.mobile-title-wrap[_ngcontent-%COMP%]{flex:1;min-width:0;text-align:center}.mobile-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--mobile-text)}.mobile-subtitle[_ngcontent-%COMP%]{margin:.15rem 0 0;font-size:.8rem;font-weight:500;color:var(--mobile-muted)}.mobile-search[_ngcontent-%COMP%]{background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.75rem;padding:.4rem .6rem}.mobile-search[_ngcontent-%COMP%]   .p-iconfield[_ngcontent-%COMP%], .mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{width:100%}.mobile-search[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{border:0;box-shadow:none;background:transparent;font-size:.95rem}.mobile-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem;margin-top:1rem}.mobile-packing-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.875rem;background:var(--mobile-card);border:1px solid var(--mobile-border);border-radius:.875rem;padding:.875rem;box-shadow:0 1px 3px #0000000d;cursor:pointer;transition:box-shadow .2s ease}.mobile-packing-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000014}.mobile-card-avatar[_ngcontent-%COMP%]{width:2.75rem;height:2.75rem;min-width:2.75rem;min-height:2.75rem;border-radius:50%;background:linear-gradient(135deg,var(--mobile-primary) 0%,#7c8aff 100%);color:#fff;font-size:.75rem;font-weight:700;display:flex;align-items:center;justify-content:center}.mobile-card-avatar--fallback[_ngcontent-%COMP%]{background:var(--mobile-muted)}.mobile-card-body[_ngcontent-%COMP%]{flex:1;min-width:0}.mobile-card-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--mobile-text);line-height:1.3}.mobile-card-meta[_ngcontent-%COMP%]{font-size:.85rem;color:var(--mobile-muted);margin-top:.2rem}.mobile-card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}.mobile-card-summary[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:var(--mobile-text)}.mobile-status-badge[_ngcontent-%COMP%]{font-size:.72rem;font-weight:600;padding:.2rem .5rem;border-radius:999px}.mobile-status-badge--warn[_ngcontent-%COMP%]{background:#fffbeb;color:#d97706}.mobile-status-badge--success[_ngcontent-%COMP%]{background:#ecfdf5;color:#059669}.mobile-status-badge--danger[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626}.mobile-action-btn[_ngcontent-%COMP%]{width:2rem;height:2rem;color:var(--mobile-primary)!important}.mobile-state[_ngcontent-%COMP%]{margin-top:1rem;background:var(--mobile-card);border:1px dashed var(--mobile-border);border-radius:.875rem;padding:1.5rem;text-align:center;color:var(--mobile-muted);font-size:.9rem}.mobile-load-more[_ngcontent-%COMP%]{padding-top:.5rem}.mobile-load-more-btn[_ngcontent-%COMP%]{width:100%;border-radius:999px;font-weight:600}.mobile-fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(1rem + env(safe-area-inset-bottom));right:calc(1rem + env(safe-area-inset-right));z-index:25;width:3.5rem;height:3.5rem;min-width:3.5rem;min-height:3.5rem;padding:0;border:none;border-radius:50%;background:var(--mobile-primary);color:#fff;box-shadow:0 4px 14px #5f6bff66;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;-webkit-tap-highlight-color:transparent}.mobile-fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.35rem}.mobile-fab[_ngcontent-%COMP%]:active{transform:scale(.96)}.app-dark   [_nghost-%COMP%]{--mobile-primary: var(--p-primary-400);--mobile-text: var(--p-surface-100);--mobile-muted: var(--p-surface-400);--mobile-card: var(--p-surface-800);--mobile-border: var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .packing-mobile-app[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .packing-mobile-app[_ngcontent-%COMP%]{background:var(--p-surface-950)}.app-dark[_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-header[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0003}.app-dark[_nghost-%COMP%]   .mobile-status-badge--warn[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-status-badge--warn[_ngcontent-%COMP%]{background:#d9770633;color:#fbbf24}.app-dark[_nghost-%COMP%]   .mobile-status-badge--success[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-status-badge--success[_ngcontent-%COMP%]{background:#05966933;color:#34d399}.app-dark[_nghost-%COMP%]   .mobile-status-badge--danger[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .mobile-status-badge--danger[_ngcontent-%COMP%]{background:#dc262633;color:#f87171}.app-dark[_nghost-%COMP%]   .mobile-packing-card[_ngcontent-%COMP%]:active, .app-dark   [_nghost-%COMP%]   .mobile-packing-card[_ngcontent-%COMP%]:active{box-shadow:0 2px 8px #00000040}}@keyframes _ngcontent-%COMP%_packingMobileFade{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}.tableau-card[_ngcontent-%COMP%]{border-radius:14px!important;box-shadow:0 1px 3px #0000000a!important;overflow:hidden}[_nghost-%COMP%]     .p-datatable .p-datatable-caption{padding:1.5rem 1.75rem 1.75rem;border-bottom:1px solid var(--p-surface-100);margin-bottom:0}.table-caption[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1.5rem;flex-wrap:wrap}.table-caption__filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.table-caption__actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{padding:1rem 1.25rem}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:1.1rem 1.25rem}.col-header[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.03em;color:var(--p-surface-500)}.table-row[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s ease}.cell-prestataire[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.cell-prestataire__avatar[_ngcontent-%COMP%]{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;flex-shrink:0}.cell-prestataire__name[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem;color:var(--p-surface-800)}.cell-secondary[_ngcontent-%COMP%]{color:var(--p-surface-600);font-size:.9rem}.cell-mono[_ngcontent-%COMP%]{font-variant-numeric:tabular-nums;font-size:.9rem}.cell-success[_ngcontent-%COMP%]{color:#059669}.cell-bold[_ngcontent-%COMP%]{font-weight:600;color:var(--p-surface-800)}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:20px;font-size:.78rem;font-weight:600;letter-spacing:.01em}.status-badge--warn[_ngcontent-%COMP%]{background:#fffbeb;color:#d97706}.status-badge--success[_ngcontent-%COMP%]{background:#ecfdf5;color:#059669}.status-badge--danger[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.75rem;padding:3rem 0;color:var(--p-surface-300)}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem}.empty-state[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem}[_nghost-%COMP%]     .packing-dialog .p-dialog-content{padding:1.25rem 1.5rem;overflow-y:auto}[_nghost-%COMP%]     .packing-dialog .p-dialog-footer{display:flex;flex-wrap:wrap;gap:.75rem;justify-content:flex-end;padding:1rem 1.5rem;border-top:1px solid var(--p-surface-200)}[_nghost-%COMP%]     .packing-dialog .packing-dialog-content{display:flex;flex-direction:column;gap:1.5rem}[_nghost-%COMP%]     .packing-dialog .packing-dialog-section{display:flex;flex-direction:column;gap:1rem}[_nghost-%COMP%]     .packing-dialog .packing-dialog-section-title{margin:0;font-size:.8rem;font-weight:700;text-transform:uppercase;letter-spacing:.04em;color:var(--p-surface-500)}[_nghost-%COMP%]     .packing-dialog .packing-dialog-field{display:flex;flex-direction:column;gap:.35rem}[_nghost-%COMP%]     .packing-dialog .packing-dialog-field label{font-size:.9rem;font-weight:600;color:var(--p-surface-700)}[_nghost-%COMP%]     .packing-dialog .packing-dialog-error{font-size:.8rem;color:var(--p-red-500)}[_nghost-%COMP%]     .packing-dialog .packing-dialog-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}[_nghost-%COMP%]     .packing-dialog .packing-dialog-total{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.25rem;background:var(--p-primary-50);border-radius:.75rem;margin-top:.25rem}[_nghost-%COMP%]     .packing-dialog .packing-dialog-total-label{font-size:1rem;font-weight:700;color:var(--p-surface-700)}[_nghost-%COMP%]     .packing-dialog .packing-dialog-total-value{font-size:1.35rem;font-weight:700;color:var(--p-primary-600)}[_nghost-%COMP%]     .packing-dialog .packing-dialog-footer{display:flex;flex-wrap:wrap;gap:.75rem;justify-content:flex-end}@media (max-width: 480px){[_nghost-%COMP%]     .packing-dialog .packing-dialog-row{grid-template-columns:1fr}[_nghost-%COMP%]     .packing-dialog .packing-dialog-footer{flex-direction:column}[_nghost-%COMP%]     .packing-dialog .packing-dialog-footer .p-button{width:100%;justify-content:center}}.packing-mobile-slideover[_ngcontent-%COMP%]{z-index:51}.app-dark[_nghost-%COMP%]   .cell-prestataire__name[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .cell-prestataire__name[_ngcontent-%COMP%], .app-dark[_nghost-%COMP%]   .cell-bold[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .cell-bold[_ngcontent-%COMP%]{color:var(--p-surface-100)}.app-dark[_nghost-%COMP%]   .cell-secondary[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .cell-secondary[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .col-header[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .col-header[_ngcontent-%COMP%]{color:var(--p-surface-400)}.app-dark[_nghost-%COMP%]   .status-badge--danger[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .status-badge--danger[_ngcontent-%COMP%]{background:#dc26261f}.app-dark[_nghost-%COMP%]   .status-badge--warn[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .status-badge--warn[_ngcontent-%COMP%]{background:#d977061f}.app-dark[_nghost-%COMP%]   .status-badge--success[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .status-badge--success[_ngcontent-%COMP%]{background:#0596691f}.app-dark   [_nghost-%COMP%]     .p-datatable .p-datatable-caption{border-bottom-color:var(--p-surface-700)}.app-dark   [_nghost-%COMP%]     .packing-dialog .packing-dialog-section-title{color:var(--p-surface-400)}.app-dark   [_nghost-%COMP%]     .packing-dialog .packing-dialog-field label{color:var(--p-surface-300)}.app-dark   [_nghost-%COMP%]     .packing-dialog .packing-dialog-total{background:var(--p-surface-800)}.app-dark   [_nghost-%COMP%]     .packing-dialog .packing-dialog-total-label{color:var(--p-surface-200)}.app-dark   [_nghost-%COMP%]     .packing-dialog .packing-dialog-total-value{color:var(--p-primary-400)}.app-dark   [_nghost-%COMP%]     .packing-dialog .p-dialog-footer{border-top-color:var(--p-surface-600)}.app-dark[_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%], .app-dark   [_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%]{color:var(--p-surface-500)}"]})};function Oi(n,t){if(n&1){let e=k();a(0,"button",35),f("click",function(){u(e);let o=d();return _(o.enableEditing())}),m(1,"i",36),s(2," Modifier "),r()}}function Ti(n,t){n&1&&(a(0,"span",37),s(1,"*"),r())}function Di(n,t){if(n&1&&(a(0,"div",26)(1,"div",38),m(2,"i",39),r(),a(3,"div")(4,"div",40),s(5),r(),a(6,"div",41),s(7),r()()()),n&2){let e=t.$implicit;l(5),w("",e.prenom," ",e.nom),l(2),v(e.phone)}}function Fi(n,t){if(n&1&&(a(0,"div",43),m(1,"i",39),a(2,"span"),s(3),r()()),n&2){let e=d().$implicit;l(3),w("",e.prenom," ",e.nom)}}function Li(n,t){if(n&1&&g(0,Fi,4,2,"div",42),n&2){let e=t.$implicit;p("ngIf",e)}}function Vi(n,t){n&1&&(a(0,"small",37),s(1," Veuillez s\xE9lectionnez un machiniste "),r())}function Ri(n,t){n&1&&(a(0,"span",37),s(1,"*"),r())}function Bi(n,t){if(n&1&&(a(0,"small",44),s(1),r()),n&2){let e=d();l(),y(" ",e.dateError," ")}}function Ai(n,t){n&1&&(a(0,"span",37),s(1,"*"),r())}function Ni(n,t){n&1&&(a(0,"small",37),s(1," Le nombre de rouleaux doit \xEAtre sup\xE9rieur \xE0 0 "),r())}function Wi(n,t){n&1&&(a(0,"span",37),s(1,"*"),r())}function zi(n,t){n&1&&(a(0,"small",37),s(1," Le prix unitaire doit \xEAtre sup\xE9rieur \xE0 0 "),r())}function ji(n,t){if(n&1&&(a(0,"div",45),m(1,"i",46),s(2),E(3,"number"),r()),n&2){let e=d();l(2),w(" ",e.model.nb_rouleaux," rouleaux \xD7 ",L(3,2,e.model.prix_par_rouleau,"1.0-0")," GNF ")}}function Ui(n,t){n&1&&(a(0,"div",47),m(1,"i",48),s(2," Entrez la quantit\xE9 et le prix unitaire pour calculer le montant "),r())}function Gi(n,t){if(n&1&&(a(0,"div",49)(1,"div",50)(2,"div",51),m(3,"i",52),a(4,"span",53),s(5,"R\xE9capitulatif"),r()(),a(6,"div",54)(7,"div",55)(8,"div",56),m(9,"i",57),a(10,"div",58)(11,"div",29),s(12,"Prestataire"),r(),a(13,"div",59),s(14),r(),a(15,"div",60),s(16),r()()(),a(17,"div",56),m(18,"i",61),a(19,"div",58)(20,"div",29),s(21,"Date"),r(),a(22,"div",62),s(23),E(24,"date"),r()()()(),a(25,"div",55)(26,"div",56),m(27,"i",63),a(28,"div",58)(29,"div",29),s(30,"Quantit\xE9"),r(),a(31,"div",64),s(32),r()()(),a(33,"div",56),m(34,"i",65),a(35,"div",58)(36,"div",29),s(37,"Prix unitaire"),r(),a(38,"div",62),s(39),E(40,"number"),r()()(),a(41,"div",66),m(42,"i",67),a(43,"div",58)(44,"div",29),s(45,"Montant total"),r(),a(46,"div",68),s(47),E(48,"number"),r()()()()()()()),n&2){let e,i,o=d();l(14),w(" ",(e=o.getSelectedPrestataire())==null?null:e.prenom," ",(e=o.getSelectedPrestataire())==null?null:e.nom," "),l(2),y(" ",(i=o.getSelectedPrestataire())==null?null:i.phone," "),l(7),y(" ",L(24,7,o.model.date,"dd/MM/yyyy")," "),l(9),y(" ",o.model.nb_rouleaux," rouleaux "),l(7),y(" ",L(40,10,o.model.prix_par_rouleau,"1.0-0")," GNF "),l(8),y(" ",L(48,13,o.model.montant,"1.0-0")," GNF ")}}function Hi(n,t){if(n&1&&(a(0,"span"),s(1),r()),n&2){let e=d(2);l(),v(e.mode==="create"?"Enregistrer":"Sauvegarder")}}function Ki(n,t){n&1&&(a(0,"span"),s(1,"Enregistrement..."),r())}function Qi(n,t){if(n&1){let e=k();a(0,"div",69)(1,"button",70),m(2,"i",71),g(3,Hi,2,1,"span",72)(4,Ki,2,0,"span",72),r(),a(5,"button",73),f("click",function(){u(e);let o=d();return _(o.mode==="create"?o.onCancel():o.cancelEditing())}),m(6,"i",74),s(7," Annuler "),r()()}if(n&2){let e=d();l(),p("disabled",!e.isValid()||e.loading),l(),Fe("mr-2",!e.loading),p("ngClass",e.loading?"pi-spin pi-spinner":"pi-check"),l(),p("ngIf",!e.loading),l(),p("ngIf",e.loading),l(),p("disabled",e.loading)}}var T=class{id;prestataire_id;prestataire;reference;date;nb_rouleaux=0;prix_par_rouleau=0;montant=0;statut="valide";notes;constructor(t){t&&(this.id=t.id,this.prestataire_id=t.prestataire_id,this.prestataire=t.prestataire,this.reference=t.reference,this.date=t.date?new Date(t.date):null,this.nb_rouleaux=t.nb_rouleaux||0,this.prix_par_rouleau=t.prix_par_rouleau||0,this.montant=t.montant||0,this.statut=t.statut||"valide",this.notes=t.notes)}calculateMontant(){this.montant=this.nb_rouleaux*this.prix_par_rouleau}},ue=class n{mode="create";initialData=null;prestataires=[];loading=!1;submitForm=new D;cancel=new D;submitted=!1;isEditing=!1;model=new T;minDate=new Date;dateError=null;ngOnInit(){this.model=this.initialData?new T(this.initialData):new T,this.mode==="create"&&(this.isEditing=!0,this.model.date||(this.model.date=new Date))}onPrixOrQuantityChange(){this.model.nb_rouleaux&&this.model.prix_par_rouleau&&this.model.calculateMontant()}validateDate(){return this.model.date?(this.dateError=null,!0):(this.dateError="Date obligatoire.",!1)}onDateChange(){this.submitted&&this.validateDate()}onDateBlur(){this.model.date&&this.validateDate()}getPrestataireLabel(t){return`${t.prenom} ${t.nom} - ${t.phone}`}getSelectedPrestataire(){return this.filteredPrestataires.find(t=>t.id===this.model.prestataire_id)}get filteredPrestataires(){let t=this.model.prestataire_id;return(this.prestataires??[]).filter(e=>t&&e.id===t?!0:e.type==="machiniste")}isValid(){return!(this.model.prestataire_id&&this.model.date&&this.model.nb_rouleaux&&this.model.nb_rouleaux>0&&this.model.prix_par_rouleau&&this.model.prix_par_rouleau>0)?!1:this.validateDate()}enableEditing(){this.isEditing=!0}cancelEditing(){this.isEditing=!1,this.submitted=!1,this.dateError=null,this.model=this.initialData?new T(this.initialData):new T}resetForm(){this.submitted=!1,this.dateError=null,this.model=new T}formatDate(t){return t?(typeof t=="string"?new Date(t):t).toISOString().split("T")[0]:""}onEnterKey(t){this.isEditing&&(t.preventDefault(),this.onSubmit())}onSubmit(){if(this.submitted=!0,!this.isValid())return;this.model.calculateMontant();let t={prestataire_id:this.model.prestataire_id,date:this.formatDate(this.model.date),nb_rouleaux:this.model.nb_rouleaux,prix_par_rouleau:this.model.prix_par_rouleau,statut:this.model.statut,notes:this.model.notes??void 0};this.submitForm.emit(t)}onCancel(){this.cancel.emit()}get fieldsDisabled(){return this.mode==="edit"&&!this.isEditing||this.loading}hasErrors(){return!!this.dateError}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-packing-from"]],inputs:{mode:"mode",initialData:"initialData",prestataires:"prestataires",loading:"loading"},outputs:{submitForm:"submitForm",cancel:"cancel"},decls:54,vars:34,consts:[[1,"card"],[1,"contents",3,"ngSubmit","keydown.enter"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-surface-900","dark:text-surface-0","text-xl","font-bold"],["pButton","","pRipple","","severity","warn","class","w-auto",3,"click",4,"ngIf"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","lg:col-span-2"],[1,"col-span-12","lg:col-span-10"],[1,"mb-6","col-span-12"],["for","prestataire",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["class","text-red-500",4,"ngIf"],["id","prestataire","optionLabel","nom","optionValue","id","placeholder","S\xE9lectionnez un machiniste","filterBy","nom,prenom,phone","fluid","",3,"ngModelChange","ngModel","options","filter","showClear","disabled"],["pTemplate","item"],["pTemplate","selectedItem"],[1,"mb-6","col-span-12","md:col-span-6"],["for","date",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","date","dateFormat","dd/mm/yy","placeholder","S\xE9lectionnez la date","fluid","",3,"ngModelChange","onSelect","onBlur","ngModel","showIcon","disabled"],["class","text-red-500 block mt-1",4,"ngIf"],[1,"mb-6","col-span-12","grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-6"],["for","nbRouleaux",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","nbRouleaux","placeholder","Entrez le nombre","mode","decimal","fluid","",3,"ngModelChange","ngModel","showButtons","min","max","useGrouping","disabled"],["for","prixRouleau",1,"font-medium","text-surface-900","dark:text-surface-0","mb-2","block"],["id","prixRouleau","mode","currency","currency","GNF","locale","fr-GN","placeholder","Prix par rouleau","fluid","",3,"ngModelChange","ngModel","min","disabled"],[1,"bg-gradient-to-r","from-primary/10","to-primary/5","border-l-4","border-primary","rounded-lg","p-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-full","bg-primary/20","flex","items-center","justify-center"],[1,"pi","pi-money-bill","text-primary","text-xl"],[1,"text-xs","text-surface-600","dark:text-surface-400","mb-1"],[1,"text-3xl","font-bold","text-primary"],["class","text-sm text-surface-600 dark:text-surface-300 mt-3 flex items-center gap-2",4,"ngIf"],["class","text-sm text-surface-500 dark:text-surface-400 mt-3 italic",4,"ngIf"],["class","col-span-12 mb-6",4,"ngIf"],["class","col-span-12 flex gap-2 mb-4",4,"ngIf"],["pButton","","pRipple","","severity","warn",1,"w-auto",3,"click"],[1,"pi","pi-pencil","mr-2"],[1,"text-red-500"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-full","bg-primary/10"],[1,"pi","pi-user","text-primary"],[1,"font-medium"],[1,"text-sm","text-surface-500"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-red-500","block","mt-1"],[1,"text-sm","text-surface-600","dark:text-surface-300","mt-3","flex","items-center","gap-2"],[1,"pi","pi-calculator","text-surface-500"],[1,"text-sm","text-surface-500","dark:text-surface-400","mt-3","italic"],[1,"pi","pi-info-circle","mr-2"],[1,"col-span-12","mb-6"],[1,"bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-800","rounded-lg","p-5"],[1,"flex","items-center","gap-2","mb-4"],[1,"pi","pi-info-circle","text-blue-600","dark:text-blue-400","text-lg"],[1,"font-bold","text-blue-900","dark:text-blue-100","text-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"space-y-3"],[1,"flex","items-start","gap-3"],[1,"pi","pi-user","text-blue-600","mt-1"],[1,"flex-1"],[1,"font-semibold","text-surface-900","dark:text-surface-0"],[1,"text-sm","text-surface-500","dark:text-surface-400"],[1,"pi","pi-calendar","text-blue-600","mt-1"],[1,"font-medium","text-surface-900","dark:text-surface-0"],[1,"pi","pi-box","text-blue-600","mt-1"],[1,"font-bold","text-primary","text-xl"],[1,"pi","pi-tag","text-blue-600","mt-1"],[1,"flex","items-start","gap-3","pt-3","border-t","border-blue-200","dark:border-blue-700"],[1,"pi","pi-wallet","text-blue-600","mt-1"],[1,"font-bold","text-primary","text-2xl"],[1,"col-span-12","flex","gap-2","mb-4"],["type","submit","pButton","","pRipple","",1,"w-auto",3,"disabled"],[1,"pi",3,"ngClass"],[4,"ngIf"],["pButton","","pRipple","","severity","secondary",1,"w-auto",3,"click","disabled"],[1,"pi","pi-times","mr-2"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"form",1),f("ngSubmit",function(){return i.onSubmit()})("keydown.enter",function(c){return i.onEnterKey(c)}),a(2,"div",2)(3,"span",3),s(4),r(),g(5,Oi,3,0,"button",4),r(),a(6,"div",5),m(7,"div",6),a(8,"div",7)(9,"div",5)(10,"div",8)(11,"label",9),s(12," Prestataire "),g(13,Ti,2,0,"span",10),s(14," (Machiniste) "),r(),a(15,"p-select",11),P("ngModelChange",function(c){return x(i.model.prestataire_id,c)||(i.model.prestataire_id=c),c}),g(16,Di,8,3,"ng-template",12)(17,Li,1,1,"ng-template",13),r(),g(18,Vi,2,0,"small",10),r(),a(19,"div",14)(20,"label",15),s(21," Date "),g(22,Ri,2,0,"span",10),r(),a(23,"p-datepicker",16),P("ngModelChange",function(c){return x(i.model.date,c)||(i.model.date=c),c}),f("onSelect",function(){return i.onDateChange()})("onBlur",function(){return i.onDateBlur()}),r(),g(24,Bi,2,1,"small",17),r(),a(25,"div",18)(26,"div",19)(27,"label",20),s(28," Nombre de rouleaux "),g(29,Ai,2,0,"span",10),r(),a(30,"p-inputnumber",21),P("ngModelChange",function(c){return x(i.model.nb_rouleaux,c)||(i.model.nb_rouleaux=c),c}),f("ngModelChange",function(){return i.onPrixOrQuantityChange()}),r(),g(31,Ni,2,0,"small",10),r(),a(32,"div",19)(33,"label",22),s(34," Prix unitaire (GNF) "),g(35,Wi,2,0,"span",10),r(),a(36,"p-inputnumber",23),P("ngModelChange",function(c){return x(i.model.prix_par_rouleau,c)||(i.model.prix_par_rouleau=c),c}),f("ngModelChange",function(){return i.onPrixOrQuantityChange()}),r(),g(37,zi,2,0,"small",10),r()(),a(38,"div",8)(39,"div",24)(40,"div",25)(41,"div",26)(42,"div",27),m(43,"i",28),r(),a(44,"div")(45,"div",29),s(46," Montant total "),r(),a(47,"div",30),s(48),E(49,"money"),r()()()(),g(50,ji,4,5,"div",31)(51,Ui,3,0,"div",32),r()(),g(52,Gi,49,16,"div",33)(53,Qi,8,7,"div",34),r()()()()()),e&2&&(l(4),y(" ",i.mode==="create"?"Nouveau packing":"D\xE9tails du packing"," "),l(),p("ngIf",i.mode==="edit"&&!i.isEditing),l(8),p("ngIf",i.isEditing),l(2),h("ngModel",i.model.prestataire_id),p("options",i.filteredPrestataires)("filter",!0)("showClear",!0)("disabled",i.fieldsDisabled),l(3),p("ngIf",i.submitted&&!i.model.prestataire_id&&i.isEditing),l(4),p("ngIf",i.isEditing),l(),h("ngModel",i.model.date),p("showIcon",!0)("disabled",i.fieldsDisabled),l(),p("ngIf",i.submitted&&i.dateError&&i.isEditing),l(5),p("ngIf",i.isEditing),l(),h("ngModel",i.model.nb_rouleaux),p("showButtons",!0)("min",1)("max",9999)("useGrouping",!1)("disabled",i.fieldsDisabled),l(),p("ngIf",i.submitted&&(!i.model.nb_rouleaux||i.model.nb_rouleaux<1)&&i.isEditing),l(4),p("ngIf",i.isEditing),l(),h("ngModel",i.model.prix_par_rouleau),p("min",0)("disabled",i.fieldsDisabled),l(),p("ngIf",i.submitted&&(!i.model.prix_par_rouleau||i.model.prix_par_rouleau<=0)&&i.isEditing),l(11),y(" ",Le(49,32,i.model.montant)," "),l(2),p("ngIf",i.model.nb_rouleaux&&i.model.prix_par_rouleau),l(),p("ngIf",!i.model.nb_rouleaux||!i.model.prix_par_rouleau),l(),p("ngIf",i.model.prestataire_id&&i.model.date&&i.model.nb_rouleaux&&i.model.prix_par_rouleau&&!i.hasErrors()),l(),p("ngIf",i.isEditing))},dependencies:[R,X,V,N,Ke,B,Ge,A,He,z,W,j,te,Be,Re,rt],encapsulation:2})};var _e=class n{constructor(t,e,i,o){this.prestataireService=t;this.packingService=e;this.messageService=i;this.router=o}prestataires=[];loading=!1;ngOnInit(){this.loadPrestataires()}loadPrestataires(){this.loading=!0,this.prestataireService.getPrestataires().subscribe({next:t=>{this.prestataires=this.extractPrestataires(t),this.loading=!1},error:t=>{console.error("Erreur lors du chargement des prestataires :",t),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les prestataires",life:3e3}),this.loading=!1}})}extractPrestataires(t){let e=t?.data;return Array.isArray(e)?e:e&&Array.isArray(e.data)?e.data:[]}onSubmit(t){this.loading=!0,this.packingService.createPacking(t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Packing cr\xE9\xE9 avec succ\xE8s",life:3e3}),this.loading=!1,setTimeout(()=>{this.router.navigate(["/packings/packings-liste"])},1e3)},error:e=>{console.error("Erreur lors de la cr\xE9ation du packing :",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de cr\xE9er le packing",life:3e3}),this.loading=!1}})}onCancel(){this.router.navigate(["/packings/packings-liste"])}static \u0275fac=function(e){return new(e||n)(C(pe),C(U),C(O),C(Z))};static \u0275cmp=S({type:n,selectors:[["app-packing-new"]],features:[J([O])],decls:2,vars:3,consts:[[3,"submitForm","cancel","mode","prestataires","loading"]],template:function(e,i){e&1&&(m(0,"p-toast"),a(1,"app-packing-from",0),f("submitForm",function(c){return i.onSubmit(c)})("cancel",function(){return i.onCancel()}),r()),e&2&&(l(),p("mode","create")("prestataires",i.prestataires)("loading",i.loading))},dependencies:[ue,se,le],encapsulation:2})};var fe=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-packing-edit"]],decls:2,vars:0,template:function(e,i){e&1&&(Me(0,"p"),s(1,"packing-edit works!"),Ee())},encapsulation:2})};var Fa=[{path:"",component:K,canActivate:[G],data:{permissions:["packings.read"]}},{path:"packings",component:K,canActivate:[G],data:{permissions:["packings.read"]}},{path:"packings-new",component:_e,canActivate:[G],data:{permissions:["packings.create"]}},{path:"packings-edit/:id",component:fe,canActivate:[G],data:{permissions:["packings.update"]}},{path:"**",redirectTo:"/notfound"}];export{Fa as default};
